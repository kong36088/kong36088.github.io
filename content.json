[{"title":"","date":"2018-02-06T11:39:12.308Z","path":"2018/02/06/Memcacheæºç æ¢ç´¢/","text":"title: MemCacheæºç æ¢ç´¢categories: ç½‘ç»œåè®®##åˆ†ç±»tags: [ç½‘ç»œåè®®,è®¡ç®—æœºç½‘ç»œ,WebSocket]##æ ‡ç­¾ï¼Œå¤šæ ‡ç­¾æ ¼å¼ä¸º [tag1,tag2,â€¦]keywords: ç½‘ç»œåè®®,è®¡ç®—æœºç½‘ç»œ,WebSocket##æ–‡ç« å…³é”®è¯ï¼Œå¤šå…³é”®è¯æ ¼å¼ä¸º keyword1,keywords2,â€¦date: 2017/02/06 19:50:21â€”C ç»“æ„ä»‹ç»MemCacheåˆ†ä¸ºå‡ ä¸ªç»“æ„ï¼šslab_classã€slabã€pageã€chunk slab_classï¼šæ‹¥æœ‰åŒæ ·chunkå¤§å°çš„slabè¢«ç»„ç»‡åœ¨ä¸€èµ·ï¼Œæˆä¸ºslab_class slabï¼šMemCacheå°†å†…å­˜ç©ºé—´åˆ†ä¸ºä¸€ç»„slabï¼Œslabä¸‹é¢æ˜¯è‹¥å¹²ä¸ªchunk chunkï¼šchunkæ˜¯çœŸæ­£å­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼ŒåŒä¸€ä¸ªslabé‡Œé¢chunkçš„å¤§å°æ˜¯ä¸€æ ·çš„ã€‚ MemCacheä¸­çš„valueè¿‡æ¥å­˜æ”¾çš„åœ°æ–¹æ˜¯ç”±valueçš„å¤§å°å†³å®šçš„ï¼Œvalueæ€»æ˜¯ä¼šè¢«å­˜æ”¾åˆ°ä¸chunkå¤§å°æœ€æ¥è¿‘çš„ä¸€ä¸ªslabä¸­ï¼Œæ¯”å¦‚slabclass[1]çš„chunkå¤§å°ä¸º80å­—èŠ‚ã€slabclass[2]çš„chunkå¤§å°ä¸º100å­—èŠ‚ã€slabclass[3]çš„chunkå¤§å°ä¸º128å­—èŠ‚ï¼ˆç›¸é‚»slabå†…çš„chunkåŸºæœ¬ä»¥1.25ä¸ºæ¯”ä¾‹è¿›è¡Œå¢é•¿ï¼ŒMemCacheå¯åŠ¨æ—¶å¯ä»¥ç”¨-fæŒ‡å®šè¿™ä¸ªæ¯”ä¾‹ï¼‰ï¼Œé‚£ä¹ˆè¿‡æ¥ä¸€ä¸ª88å­—èŠ‚çš„valueï¼Œè¿™ä¸ªvalueå°†è¢«æ”¾åˆ°2å·slabä¸­ã€‚æ”¾slabçš„æ—¶å€™ï¼Œé¦–å…ˆslabè¦ç”³è¯·å†…å­˜ï¼Œç”³è¯·å†…å­˜æ˜¯ä»¥pageä¸ºå•ä½çš„ï¼Œæ‰€ä»¥åœ¨æ”¾å…¥ç¬¬ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæ— è®ºå¤§å°ä¸ºå¤šå°‘ï¼Œéƒ½ä¼šæœ‰1Må¤§å°çš„pageè¢«åˆ†é…ç»™è¯¥slabã€‚ç”³è¯·åˆ°pageåï¼Œslabä¼šå°†è¿™ä¸ªpageçš„å†…å­˜æŒ‰chunkçš„å¤§å°è¿›è¡Œåˆ‡åˆ†ï¼Œè¿™æ ·å°±å˜æˆäº†ä¸€ä¸ªchunkæ•°ç»„ï¼Œæœ€åä»è¿™ä¸ªchunkæ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªç”¨äºå­˜å‚¨æ•°æ®ã€‚ slab_classå¾ªç€ slabs_init() æ–¹æ³•çœ‹ä¸‹å»å‘ç°ï¼Œslab_classçš„ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ•°å€¼å®šä¹‰åœ¨ memcached.h æ–‡ä»¶å½“ä¸­ã€‚ 12/* slab class max is a 6-bit number, -1. */#define MAX_NUMBER_OF_SLAB_CLASSES (63 + 1) æ•°å€¼æ˜¯ç›´æ¥å†™æ­»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡æœ‰åŠæ³•æ”¹å˜å®ƒã€‚ è¿™é‡Œæ˜¯slab_classç»“æ„çš„å®šä¹‰ï¼š 123456789101112131415typedef struct &#123; unsigned int size; /* sizes of items */ /* itemçš„å¤§å° */ unsigned int perslab; /* how many items per slab */ /* æ¯ä¸€ä¸ªslabçš„itemæ•°é‡ */ void *slots; /* list of item ptrs */ /* ç©ºé—²item(è¢«å›æ”¶çš„item)é“¾è¡¨çš„æŒ‡é’ˆ */ unsigned int sl_curr; /* total free items in list */ /* ç©ºé—²itemçš„æ€»æ•°é‡ */ unsigned int slabs; /* how many slabs were allocated for this class */ /* åœ¨è¿™ä¸ªslabclassä¸­å·²åˆ†é…slabçš„æ•°é‡ */ void **slab_list; /* array of slab pointers */ /* slabæ•°ç»„ */ unsigned int list_size; /* size of prev array */ /* å‰ä¸€ä¸ªæ•°ç»„çš„å¤§å° */ unsigned int killing; /* index+1 of dying slab, or zero if none */ size_t requested; /* The number of requested bytes */ /* è¢«è®¿é—®åˆ°çš„å­—èŠ‚æ•° */&#125; slabclass_t; mainå‡½æ•°ååˆ†çš„é•¿ï¼Œæœ‰ä¸€åƒå¤šåˆ°ä¸¤åƒè¡Œçš„ä»£ç ã€‚å…¶ä¸­æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯åœ¨è§£æå‘½ä»¤è¡Œä¼ å…¥çš„å‚æ•°ï¼Œå¹¶ä¸”å¯¹å…¨å±€çš„settingså˜é‡è¿›è¡Œè®¾ç½®ã€‚ 12345678910111213typedef struct _strchunk &#123; struct _strchunk *next; /* points within its own chain. */ struct _strchunk *prev; /* can potentially point to the head. */ struct _stritem *head; /* always points to the owner chunk */ int size; /* available chunk space in bytes */ int used; /* chunk space used */ int nbytes; /* used. */ unsigned short refcount; /* used? */ uint8_t orig_clsid; /* For obj hdr chunks slabs_clsid is fake. */ uint8_t it_flags; /* ITEM_* above. */ uint8_t slabs_clsid; /* Same as above. */ char data[];&#125; item_chunk; æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚ å‚è€ƒ https://www.csdn.net/article/2016-03-16/2826609 http://www.programering.com/a/MzM3MjMwATU.html","tags":[]},{"title":"WebSocketåè®®å°è®°","date":"2017-12-26T13:52:21.000Z","path":"2017/12/26/WebSocketåè®®å°è®°/","text":"æ‚è°ˆåœ¨ä¸€ä¸¤å¹´å‰å°±å·²ç»ä½¿ç”¨è¿‡websocketåè®®ï¼Œä½†æ˜¯å½“æ—¶ä¹Ÿä»…ä»…æ˜¯åœç•™åœ¨ä½¿ç”¨ä¸Šï¼Œå¯¹äºå¾ˆå¤šåŸç†ä»¥åŠåè®®çš„å®ç°æ²¡æœ‰è¿‡å¤šçš„ç†è§£ã€‚åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œæˆ‘å¯¹websocketéƒ½è¿˜åªæ˜¯åœç•™åœ¨â€œä¼šç”¨â€çš„é˜¶æ®µã€‚ æœ€è¿‘æ€»ç®—æœ‰æ—¶é—´æ¥æ£é¼“æ£é¼“ä¸€äº›åº•å±‚åŸç†æ€§çš„ä¸œè¥¿ï¼Œç®—æ˜¯æŸ¥ç¼ºè¡¥æ¼å§ã€‚ è®©æˆ‘ä»¬è¿›å…¥æˆ‘ä»¬çš„ä¸»é¢˜â€”â€”websocketã€‚ WebSocket åˆæ¢é¦–å…ˆï¼ŒWebSocketæ˜¯ä¸€ä¸ªæŒä¹…è¿æ¥åè®®ï¼ŒWebSocketæ˜¯HTML5å‡ºçš„ä¸œè¥¿ï¼ˆåè®®ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´HTTPåè®®æ²¡æœ‰å˜åŒ–ï¼Œæˆ–è€…è¯´æ²¡å…³ç³»ï¼Œä½†HTTPæ˜¯ä¸æ”¯æŒæŒä¹…è¿æ¥çš„ï¼ˆé•¿è¿æ¥ï¼Œå¾ªç¯è¿æ¥çš„ä¸ç®—ï¼‰ WebSocketå’ŒHTTPä¹‹å‰ä¼šæœ‰ä¸€äº›å°å°çš„å…±åŒç‚¹ï¼Œæ¯”å¦‚ï¼š1ã€ä»–ä»¬éƒ½æ˜¯åŸºäºTCPã€‚å› ä¸ºWebSocketæ˜¯åŸºäºTCPçš„ï¼Œæ‰€ä»¥è¿æ¥å¯é æ€§å¾—åˆ°äº†ä¿éšœã€‚2ã€ä»–ä»¬éƒ½æœ‰â€œHeaderâ€ï¼Œåƒ Cookie=xxxx;Content-Type=xxxx; è¿™æ ·çš„é”®å€¼å¯¹ ä»–ä»¬ä¹‹é—´çš„å…³ç³»å°±åƒæ˜¯è¿™æ ·çš„ï¼š WebSocket ä¹‹æ·±å…¥æ¡æ‰‹é˜¶æ®µä¸€èµ·æ¥çœ‹çœ‹WebSocketå»ºç«‹è¿æ¥çš„è¿‡ç¨‹ã€‚ è¿™é‡Œæ˜¯æµè§ˆå™¨å‘èµ·çš„è¯·æ±‚ï¼š12345678GET /chat HTTP/1.1Host: server.example.comUpgrade: websocketConnection: UpgradeSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==Sec-WebSocket-Protocol: chat, superchatSec-WebSocket-Version: 13Origin: http://example.com å¯ä»¥çœ‹åˆ°ï¼Œæ¯”èµ·ä¼ ç»Ÿçš„HTTPåè®®ï¼Œå¤šäº†å‡ ä¸ªå¤´ï¼šUpgrade Sec-WebSocket-Key Sec-WebSocket-Protocol Sec-WebSocket-Versionè¿™äº›å¤´éƒ¨æ˜¯ç”¨äºç»™WebSocketæ¡æ‰‹å»ºç«‹è¿æ¥ç”¨çš„ï¼ŒæŒ‡å®šçš„æ˜¯websocketåè®®Sec-WebSocket-Key æ˜¯æµè§ˆå™¨éšæœºç”Ÿæˆçš„base64 encodeçš„å€¼ï¼Œç”¨æ¥è¯¢é—®æœåŠ¡å™¨æ˜¯å¦æ˜¯æ”¯æŒWebSocketã€‚ å†çœ‹çœ‹æœåŠ¡ç«¯è¿”å›çš„Responseï¼š12345HTTP/1.1 101 Switching ProtocolsUpgrade: websocketConnection: UpgradeSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=Sec-WebSocket-Protocol: chat Sec-WebSocket-Acceptæ˜¯å°†è¯·æ±‚åŒ…Sec-WebSocket-Keyçš„å€¼ï¼Œä¸â€258EAFA5-E914-47DA-95CA-C5AB0DC85B11â€³è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åå¯¹æ‹¼æ¥åçš„å­—ç¬¦ä¸²è¿›è¡Œsha-1è¿ç®—ï¼Œå†è¿›è¡Œbase64ç¼–ç å¾—åˆ°çš„ã€‚ç”¨æ¥è¯´æ˜è‡ªå·±æ˜¯WebSocketåŠ©ç†æœåŠ¡å™¨ã€‚ Data Frameï¼ˆæ•°æ®å¸§ï¼‰WebSocketæ•°æ®å¸§ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š1234567891011121314151617180 1 2 30 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1+-+-+-+-+-------+-+-------------+-------------------------------+|F|R|R|R| opcode|M| Payload len | Extended payload length ||I|S|S|S| (4) |A| (7) | (16/64) ||N|V|V|V| |S| | (if payload len==126/127) || |1|2|3| |K| | |+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +| Extended payload length continued, if payload len == 127 |+ - - - - - - - - - - - - - - - +-------------------------------+| |Masking-key, if MASK set to 1 |+-------------------------------+-------------------------------+| Masking-key (continued) | Payload Data |+-------------------------------- - - - - - - - - - - - - - - - +: Payload Data continued ... :+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +| Payload Data continued ... |+---------------------------------------------------------------+ è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸Šç»™å‡ºçš„ç¤ºä¾‹ã€‚ FINï¼šè¿™é‡Œç¬¬ä¸€ä½FINè¡¨ç¤ºè¿™æ˜¯æ¶ˆæ¯çš„æœ€åä¸€å¸§ï¼ˆç»“æŸå¸§ï¼‰ï¼Œä¸€ä¸ªæ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å¸§æ„æˆã€‚è‹¥æ¶ˆæ¯ç”±ä¸€å¸§æ„æˆï¼Œèµ·å§‹å¸§å³ç»“æŸå¸§ã€‚FINä½å 1bitã€‚ RSV1ï¼ŒRSV2ï¼ŒRSV3ï¼šå„1ä½MUST be 0 unless an extension is negotiated that defines meanings for non-zero values. If a nonzero value is received and none of the negotiated extensions defines the meaning of such a nonzero value, the receiving endpoint MUST Fail the WebSocket Connection.å¤§è‡´æ„æ€æ˜¯å¦‚æœæœªå®šä¹‰æ‰©å±•ï¼Œå„ä½æ˜¯0ï¼›å¦‚æœå®šä¹‰äº†æ‰©å±•ï¼Œå³ä¸ºé0å€¼ã€‚å¦‚æœæ¥æ”¶çš„å¸§æ­¤å¤„é0ï¼Œæ‰©å±•ä¸­å´æ²¡æœ‰è¯¥å€¼çš„å®šä¹‰ï¼Œé‚£ä¹ˆå…³é—­è¿æ¥ã€‚ OPCODEï¼š4ä½è§£é‡ŠPayloadDataï¼Œå¦‚æœæ¥æ”¶åˆ°æœªçŸ¥çš„opcodeï¼Œæ¥æ”¶ç«¯å¿…é¡»å…³é—­è¿æ¥ã€‚0x0è¡¨ç¤ºé™„åŠ æ•°æ®å¸§0x1è¡¨ç¤ºæ–‡æœ¬æ•°æ®å¸§0x2è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®å¸§0x3-7æš‚æ—¶æ— å®šä¹‰ï¼Œä¸ºä»¥åçš„éæ§åˆ¶å¸§ä¿ç•™0x8è¡¨ç¤ºè¿æ¥å…³é—­0x9è¡¨ç¤ºping0xAè¡¨ç¤ºpong0xB-Fæš‚æ—¶æ— å®šä¹‰ï¼Œä¸ºä»¥åçš„æ§åˆ¶å¸§ä¿ç•™ MASKï¼š1ä½ç”¨äºæ ‡è¯†PayloadDataæ˜¯å¦ç»è¿‡æ©ç å¤„ç†ã€‚å¦‚æœæ˜¯1ï¼ŒMasking-keyåŸŸçš„æ•°æ®å³æ˜¯æ©ç å¯†é’¥ï¼Œç”¨äºè§£ç PayloadDataã€‚å®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®å¸§éœ€è¦è¿›è¡Œæ©ç å¤„ç†ï¼Œæ‰€ä»¥æ­¤ä½æ˜¯1ã€‚ Payload lengthï¼š7ä½ï¼Œ7+16ä½ï¼Œ7+64ä½PayloadDataçš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚å¦‚æœå…¶å€¼åœ¨0-125ï¼Œåˆ™æ˜¯payloadçš„çœŸå®é•¿åº¦ã€‚å¦‚æœå€¼æ˜¯126ï¼Œåˆ™åé¢2ä¸ªå­—èŠ‚å½¢æˆçš„16ä½æ— ç¬¦å·æ•´å‹æ•°çš„å€¼æ˜¯payloadçš„çœŸå®é•¿åº¦ã€‚æ³¨æ„ï¼Œç½‘ç»œå­—èŠ‚åºï¼Œéœ€è¦è½¬æ¢ã€‚å¦‚æœå€¼æ˜¯127ï¼Œåˆ™åé¢8ä¸ªå­—èŠ‚å½¢æˆçš„64ä½æ— ç¬¦å·æ•´å‹æ•°çš„å€¼æ˜¯payloadçš„çœŸå®é•¿åº¦ã€‚æ³¨æ„ï¼Œç½‘ç»œå­—èŠ‚åºï¼Œéœ€è¦è½¬æ¢ã€‚é•¿åº¦è¡¨ç¤ºéµå¾ªä¸€ä¸ªåŸåˆ™ï¼Œç”¨æœ€å°‘çš„å­—èŠ‚è¡¨ç¤ºé•¿åº¦ï¼ˆæˆ‘ç†è§£æ˜¯å°½é‡å‡å°‘ä¸å¿…è¦çš„ä¼ è¾“ï¼‰ã€‚ä¸¾ä¾‹è¯´ï¼ŒpayloadçœŸå®é•¿åº¦æ˜¯124ï¼Œåœ¨0-125ä¹‹é—´ï¼Œå¿…é¡»ç”¨å‰7ä½è¡¨ç¤ºï¼›ä¸å…è®¸é•¿åº¦1æ˜¯126æˆ–127ï¼Œç„¶åé•¿åº¦2æ˜¯124ï¼Œè¿™æ ·è¿ååŸåˆ™ã€‚Payloadé•¿åº¦æ˜¯ExtensionDataé•¿åº¦ä¸ApplicationDataé•¿åº¦ä¹‹å’Œã€‚ExtensionDataé•¿åº¦å¯èƒ½æ˜¯0ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒPayloadé•¿åº¦å³æ˜¯ApplicationDataé•¿åº¦ã€‚ WebSocketåè®®è§„å®šæ•°æ®é€šè¿‡å¸§åºåˆ—ä¼ è¾“ã€‚å®¢æˆ·ç«¯å¿…é¡»å¯¹å…¶å‘é€åˆ°æœåŠ¡å™¨çš„æ‰€æœ‰å¸§è¿›è¡Œæ©ç å¤„ç†ã€‚æœåŠ¡å™¨ä¸€æ—¦æ”¶åˆ°æ— æ©ç å¸§ï¼Œå°†å…³é—­è¿æ¥ã€‚æœåŠ¡å™¨å¯èƒ½å‘é€ä¸€ä¸ªçŠ¶æ€ç æ˜¯1002ï¼ˆè¡¨ç¤ºåè®®é”™è¯¯ï¼‰çš„Closeå¸§ã€‚è€ŒæœåŠ¡å™¨å‘é€å®¢æˆ·ç«¯çš„æ•°æ®å¸§ä¸åšæ©ç å¤„ç†ï¼Œä¸€æ—¦å®¢æˆ·ç«¯å‘ç°ç»è¿‡æ©ç å¤„ç†çš„å¸§ï¼Œå°†å…³é—­è¿æ¥ã€‚å®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨çŠ¶æ€ç 1002ã€‚ WebSocket å¿ƒè·³å¿ƒè·³ä¸»è¦æ˜¯ç”¨äºæ£€æµ‹å¯¹ç«¯æ˜¯å¦åœ¨çº¿ï¼Œä»¥å‡å°èµ„æºå‹åŠ›ã€‚ WebSocketçš„å¿ƒè·³ä¸»è¦æ˜¯é€šè¿‡ Pingã€Pong æ§åˆ¶å¸§è¿›è¡Œæ§åˆ¶ã€‚Pingçš„åè®®å¤´æ˜¯0x9ï¼ŒPongçš„åè®®å¤´æ˜¯0xA åœ¨ä¸€ç«¯å‘å‡º Ping å¸§åï¼Œè‹¥å¯¹ç«¯æ”¶åˆ°è¯¥å¸§ï¼Œåˆ™å¿…é¡»å›åº” Pong å¸§ä»¥è¡¨ç¤ºåœ¨çº¿ å‚è€ƒhttps://datatracker.ietf.org/doc/rfc6455/ https://www.zhihu.com/question/20215561/answer/40316953 https://baike.baidu.com/item/WebSocket/1953845?fr=aladdin http://blog.csdn.net/ttdevs/article/details/62887058","tags":[{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è®¡ç®—æœºç½‘ç»œ/"},{"name":"ç½‘ç»œåè®®","slug":"ç½‘ç»œåè®®","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ç½‘ç»œåè®®/"},{"name":"WebSocket","slug":"WebSocket","permalink":"https://github.com/kong36088/kong36088.github.io/tags/WebSocket/"}]},{"title":"å°è®°è°ƒè¯•PHP-Xä¸€ä¸ªåè¡€çš„core dumpè¿‡ç¨‹","date":"2017-12-05T11:05:21.000Z","path":"2017/12/05/å°è®°è°ƒè¯•PHP-Xä¸€ä¸ªåè¡€çš„core dumpè¿‡ç¨‹/","text":"åœ¨ä½¿ç”¨PHP-Xå¼€å‘PHPæ‹“å±•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„bug åœ¨é¢‘ç¹åœ°è°ƒç”¨zend_wrong_paramers_count_errorè¿™ä¸ªZend APIæ–¹æ³•åï¼Œä¼šå¯¼è‡´å‘ç”Ÿcore dumpã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯æŠ›å‡ºä¸€ä¸ªå…¥å‚å‚æ•°æ•°é‡ä¸æ­£ç¡®çš„Warningçº§åˆ«å¼‚å¸¸ å…ˆçœ‹çœ‹æˆ‘ä»¬çš„æºç ï¼š 123456789101112131415161718ZEND_RESULT_CODE _check_args_num(zend_execute_data *data, int num_args)&#123; uint32_t min_num_args = data-&gt;func-&gt;common.required_num_args; uint32_t max_num_args = data-&gt;func-&gt;common.num_args; if (num_args &lt; min_num_args || (num_args &gt; max_num_args &amp;&amp; max_num_args &gt; 0)) &#123; #if PHP_MAJOR_VERSION &gt;= 7 &amp;&amp; PHP_MINOR_VERSION == 0 zend_wrong_paramers_count_error(num_args, min_num_args, max_num_args); #else zend_wrong_parameters_count_error(num_args, min_num_args, max_num_args); //å‡ºé”™æ‰€åœ¨ #endif return FAILURE; &#125; return SUCCESS;&#125; ä½¿ç”¨gdbå¯¹coreè¿›è¡Œåˆ†æ123456789101112131415161718192021222324252627282930$ gdb php -c /corefile/core.11[New LWP 2852]Core was generated by `php ../tests/main.php'.Program terminated with signal SIGSEGV, Segmentation fault.#0 0x000000000085c681 in incomplete_class_message (object=0x7effd7a6b140, error_type=32511) at /usr/local/php-7.2.0/ext/standard/incomplete_class.c:4747 php_error_docref(NULL, error_type, INCOMPLETE_CLASS_MSG, \"unknown\")$ (gdb) bt#0 0x000000000085c681 in zend_mm_alloc_small (bin_num=8, size=79, heap=0x7f1cf8800040) at /usr/local/php-7.0.26/Zend/zend_alloc.c:1318#1 zend_mm_alloc_heap (size=79, heap=0x7f1cf8800040) at /usr/local/php-7.0.26/Zend/zend_alloc.c:1389#2 zend_mm_realloc_heap (heap=0x7f1cf8800040, ptr=0x0, size=79, copy_size=79) at /usr/local/php-7.0.26/Zend/zend_alloc.c:1485#3 0x000000000086409e in _erealloc (ptr=0x0, size=79) at /usr/local/php-7.0.26/Zend/zend_alloc.c:2506#4 0x00000000007f999c in xbuf_format_converter (xbuf=0x7ffeddbfe950, is_char=1 '\\001', fmt=0xe356e5 \"PHP %s: %s in %s on line %d\", ap=0x7ffeddbfe9a8) at /usr/local/php-7.0.26/main/spprintf.c:246#5 0x00000000007fc799 in vspprintf (pbuf=0x7ffeddbfeb40, max_len=0, format=0xe356e5 \"PHP %s: %s in %s on line %d\", ap=0x7ffeddbfe9a8) at /usr/local/php-7.0.26/main/spprintf.c:847#6 0x00000000007fc8af in spprintf (pbuf=0x7ffeddbfeb40, max_len=0, format=0xe356e5 \"PHP %s: %s in %s on line %d\") at /usr/local/php-7.0.26/main/spprintf.c:871#7 0x00000000007f2fd3 in php_error_cb (type=2, error_filename=0x7f1cf886a068 \"/share/docker/c/www/PHP-X-demo/args/tests/main.php\", error_lineno=10, format=0xe4b424 \"%s\", args=0x7ffeddbfed40) at /usr/local/php-7.0.26/main/main.c:1122#8 0x00000000008a398d in zend_error (type=2, format=0xe4b424 \"%s\") at /usr/local/php-7.0.26/Zend/zend.c:1172#9 0x00000000008a468b in zend_internal_type_error (throw_exception=0 '\\000', format=0xe4b520 \"%s%s%s() expects %s %d parameter%s, %d given\") at /usr/local/php-7.0.26/Zend/zend.c:1366#10 0x00000000008a5476 in zend_wrong_paramers_count_error (num_args=2, min_num_args=1, max_num_args=1) at /usr/local/php-7.0.26/Zend/zend_API.c:205#11 0x00007f1cf83ba69f in php::_check_args_num (data=0x7f1cf8813170, num_args=2) at /share/docker/c/www/PHP-X/src/base.cc:216#12 0x00007f1cf83ba54e in php::_exec_method (data=0x7f1cf8813170, return_value=0x7f1cf8813110) at /share/docker/c/www/PHP-X/src/base.cc:194#13 0x0000000000938799 in ZEND_DO_FCALL_SPEC_HANDLER () at /usr/local/php-7.0.26/Zend/zend_vm_execute.h:842#14 0x0000000000934566 in execute_ex (ex=0x7f1cf8813030) at /usr/local/php-7.0.26/Zend/zend_vm_execute.h:414#15 0x0000000000934efa in zend_execute (op_array=0x7f1cf887f000, return_value=0x0) at /usr/local/php-7.0.26/Zend/zend_vm_execute.h:458#16 0x00000000008a4a6d in zend_execute_scripts (type=8, retval=0x0, file_count=3) at /usr/local/php-7.0.26/Zend/zend.c:1445#17 0x00000000007f619f in php_execute_script (primary_file=0x7ffeddc01ac0) at /usr/local/php-7.0.26/main/main.c:2518#18 0x0000000000a103f7 in do_cli (argc=2, argv=0x2144a20) at /usr/local/php-7.0.26/sapi/cli/php_cli.c:977#19 0x0000000000a117bd in main (argc=2, argv=0x2144a20) at /usr/local/php-7.0.26/sapi/cli/php_cli.c:1347 çœ‹åˆ°è¿™ä¸ªbacktraceåä¸€å¤´é›¾æ°´ï¼Œè²Œä¼¼æ˜¯è·Ÿphpçš„å†…å­˜ç®¡ç†æ‰¯ä¸Šè¾¹äº†ï¼Ÿä½†å…¶å®ä¸ç„¶ ç»è¿‡é•¿æ—¶é—´çš„debugå‘ç°ï¼ŒåŸæ¥æ˜¯æˆ‘çš„æ‹“å±•æŸè¡Œä»£ç å†™é”™äº†ï¼Œå¯¼è‡´å‘ç”Ÿäº†è¿™ç§é—®é¢˜ã€‚ ç›´æ¥ä¸Šæˆ‘ä»¬çš„ä»£ç ï¼š1234567891011121314151617181920212223242526void printArgs(Args args)&#123; cout &lt;&lt; \"Args: \"; for (unsigned int i = 0; i &lt;args.count(); i++) &#123; if (args[i].type() == IS_ARRAY) &#123; Array arr(args[i]); cout &lt;&lt; '['; for (auto it = arr.begin(); it != arr.end(); it++) &#123; cout &lt;&lt; it.value().toString(); &#125; cout &lt;&lt; ']' &lt;&lt; ' '; &#125; else &#123; cout &lt;&lt; args[i].toString() &lt;&lt; ' '; &#125; &#125; cout &lt;&lt; endl;&#125;PHPX_METHOD(ArgsTest,noneArgs)&#123; printArgs(args); cout &lt;&lt; \"noneArgs() called\" &lt;&lt; endl;&#125; æˆ‘ä»¬æ¥çœ‹çœ‹PHPX_METHODè¿™ä¸ªå®çš„å®šä¹‰1#define PHPX_METHOD(c, m) void c##_##m(Object &amp;_this, Args &amp;args, Variant &amp;retval) æ³¨æ„ä¸Šé¢çš„ä»£ç ä¸­printArgs(args);è¿™ä¸€è¡Œä»£ç ä¼ å…¥äº†argså‚æ•°ï¼Œè€Œä»PHPX_METHODå®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œargsæ˜¯ä¸€ä¸ªå¼•ç”¨å‚æ•°ï¼Œä½†æ˜¯åœ¨printArgs()å‡½æ•°å®šä¹‰æ—¶ï¼Œæ²¡æœ‰æŠŠargsä½œä¸ºå¼•ç”¨å‚æ•°è€Œå¯¼è‡´äº†é”™è¯¯ã€‚åˆæ­¥çŒœæµ‹æ˜¯å› ä¸ºä¼ å‚è¿‡ç¨‹ä¸­ï¼Œä¸€äº›å¯¹è±¡å¤åˆ¶çš„é—®é¢˜å¯¼è‡´äº†é”™è¯¯ æ­£ç¡®å†™æ³•åº”è¯¥æ˜¯æŠŠvoid printArgs(Args args)æ”¹ä¸ºvoid printArgs(Args &amp;args) é—®é¢˜æœ€ç»ˆé¡ºåˆ©è§£å†³~","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"æºç ","slug":"æºç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æºç /"},{"name":"PHP-X","slug":"PHP-X","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP-X/"}]},{"title":"nginxåˆæ¢","date":"2017-10-18T09:45:21.000Z","path":"2017/10/18/nginxåˆæ¢/","text":"workeræ¨¡å‹ nginxæ¶æ„æ¯ä¸ªè¯·æ±‚ä¼šå ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªworkerè¿›ç¨‹å¯ä»¥å¤„ç†æˆåƒä¸Šä¸‡çš„è¯·æ±‚ã€‚ nginxé‡‡ç”¨å¤šworkerçš„æ–¹å¼æ¥å¤„ç†è¯·æ±‚ï¼Œæ¯ä¸ªworkeré‡Œé¢åªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œé‚£èƒ½å¤Ÿå¤„ç†çš„å¹¶å‘æ•°å¾ˆæœ‰é™å•Šï¼Œå¤šå°‘ä¸ªworkerå°±èƒ½å¤„ç†å¤šå°‘ä¸ªå¹¶å‘ï¼Œä½•æ¥é«˜å¹¶å‘å‘¢ï¼Ÿéä¹Ÿï¼Œè¿™å°±æ˜¯nginxçš„é«˜æ˜ä¹‹å¤„ï¼Œnginxé‡‡ç”¨äº†å¼‚æ­¥éé˜»å¡çš„æ–¹å¼æ¥å¤„ç†è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œnginxæ˜¯å¯ä»¥åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ä¸ªè¯·æ±‚çš„ã€‚ å¼‚æ­¥éé˜»å¡çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œå…·ä½“åˆ°ç³»ç»Ÿè°ƒç”¨å°±æ˜¯åƒselect/poll/epoll/kqueueè¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒä»¬æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œè®©ä½ å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªäº‹ä»¶ï¼Œè°ƒç”¨ä»–ä»¬æ˜¯é˜»å¡çš„ï¼Œä½†å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåœ¨è¶…æ—¶æ—¶é—´ä¹‹å†…ï¼Œå¦‚æœæœ‰äº‹ä»¶å‡†å¤‡å¥½äº†ï¼Œå°±è¿”å›ã€‚è¿™ç§æœºåˆ¶æ­£å¥½è§£å†³äº†æˆ‘ä»¬ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ï¼Œæ‹¿epollä¸ºä¾‹ï¼Œå½“äº‹ä»¶æ²¡å‡†å¤‡å¥½æ—¶ï¼Œæ”¾åˆ°epollé‡Œé¢ï¼Œäº‹ä»¶å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å°±å»è¯»å†™ï¼Œå½“è¯»å†™è¿”å›EAGAINæ—¶ï¼Œæˆ‘ä»¬å°†å®ƒå†æ¬¡åŠ å…¥åˆ°epollé‡Œé¢ã€‚ nginxäº‹ä»¶å¤„ç†æ¨¡å‹ï¼š1234567891011121314151617181920212223while (true) &#123; for t in run_tasks: t.handler(); update_time(&amp;now); timeout = ETERNITY; for t in wait_tasks: /* sorted already */ if (t.time &lt;= now) &#123; t.timeout_handler(); &#125; else &#123; timeout = t.time - now; break; &#125; nevents = poll_function(events, timeout); for i in nevents: task t; if (events[i].type == READ) &#123; t.handler = read_handler; &#125; else &#123; /* events[i].type == WRITE */ t.handler = write_handler; &#125; run_tasks_add(t);&#125; connectionåœ¨è¿™é‡Œï¼Œå¾ˆå¤šäººä¼šè¯¯è§£worker_connectionsè¿™ä¸ªå‚æ•°çš„æ„æ€ï¼Œè®¤ä¸ºè¿™ä¸ªå€¼å°±æ˜¯nginxæ‰€èƒ½å»ºç«‹è¿æ¥çš„æœ€å¤§å€¼ã€‚å…¶å®ä¸ç„¶ï¼Œè¿™ä¸ªå€¼æ˜¯è¡¨ç¤ºæ¯ä¸ªworkerè¿›ç¨‹æ‰€èƒ½å»ºç«‹è¿æ¥çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªnginxèƒ½å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œåº”è¯¥æ˜¯worker_connections * worker_processesã€‚å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„æ˜¯æœ€å¤§è¿æ¥æ•°ï¼Œå¯¹äºHTTPè¯·æ±‚æœ¬åœ°èµ„æºæ¥è¯´ï¼Œèƒ½å¤Ÿæ”¯æŒçš„æœ€å¤§å¹¶å‘æ•°é‡æ˜¯worker_connections * worker_processesï¼Œè€Œå¦‚æœæ˜¯HTTPä½œä¸ºåå‘ä»£ç†æ¥è¯´ï¼Œæœ€å¤§å¹¶å‘æ•°é‡åº”è¯¥æ˜¯worker_connections * worker_processes/2ã€‚å› ä¸ºä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ¯ä¸ªå¹¶å‘ä¼šå»ºç«‹ä¸å®¢æˆ·ç«¯çš„è¿æ¥å’Œä¸åç«¯æœåŠ¡çš„è¿æ¥ï¼Œä¼šå ç”¨ä¸¤ä¸ªè¿æ¥ã€‚ æ¯ä¸ªworkeråˆ†é…åˆ°çš„è¯·æ±‚æ•°éœ€è¦é€šè¿‡ä¸€å®šçš„æœºåˆ¶è¿›è¡Œè°ƒæ§ï¼Œè¯·æ±‚è¶Šå¤šçš„workerè¢«åˆ†é…åˆ°è¯·æ±‚çš„å¯èƒ½æ€§è¶Šå°ã€‚å¯ä»¥å‚è€ƒä»¥ä¸‹ä¼ªä»£ç 12345678910111213141516171819202122ngx_accept_disabled = ngx_cycle-&gt;connection_n / 8 - ngx_cycle-&gt;free_connection_n;if (ngx_accept_disabled &gt; 0) &#123; ngx_accept_disabled--;&#125; else &#123; if (ngx_trylock_accept_mutex(cycle) == NGX_ERROR) &#123; return; &#125; if (ngx_accept_mutex_held) &#123; flags |= NGX_POST_EVENTS; &#125; else &#123; if (timer == NGX_TIMER_INFINITE || timer &gt; ngx_accept_mutex_delay) &#123; timer = ngx_accept_mutex_delay; &#125; &#125;&#125; é¦–å…ˆï¼Œnginxçš„å¤„ç†å¾—å…ˆæ‰“å¼€accept_mutexé€‰é¡¹ï¼Œæ­¤æ—¶ï¼Œåªæœ‰è·å¾—äº†accept_mutexçš„è¿›ç¨‹æ‰ä¼šå»æ·»åŠ acceptäº‹ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œnginxä¼šæ§åˆ¶è¿›ç¨‹æ˜¯å¦æ·»åŠ acceptäº‹ä»¶ã€‚nginxä½¿ç”¨ä¸€ä¸ªå«ngx_accept_disabledçš„å˜é‡æ¥æ§åˆ¶æ˜¯å¦å»ç«äº‰accept_mutexé”ã€‚åœ¨ç¬¬ä¸€æ®µä»£ç ä¸­ï¼Œè®¡ç®—ngx_accept_disabledçš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯nginxå•è¿›ç¨‹çš„æ‰€æœ‰è¿æ¥æ€»æ•°çš„å…«åˆ†ä¹‹ä¸€ï¼Œå‡å»å‰©ä¸‹çš„ç©ºé—²è¿æ¥æ•°é‡ï¼Œå¾—åˆ°çš„è¿™ä¸ªngx_accept_disabledæœ‰ä¸€ä¸ªè§„å¾‹ï¼Œå½“å‰©ä½™è¿æ¥æ•°å°äºæ€»è¿æ¥æ•°çš„å…«åˆ†ä¹‹ä¸€æ—¶ï¼Œå…¶å€¼æ‰å¤§äº0ï¼Œè€Œä¸”å‰©ä½™çš„è¿æ¥æ•°è¶Šå°ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ã€‚å†çœ‹ç¬¬äºŒæ®µä»£ç ï¼Œå½“ngx_accept_disabledå¤§äº0æ—¶ï¼Œä¸ä¼šå»å°è¯•è·å–accept_mutexé”ï¼Œå¹¶ä¸”å°†ngx_accept_disabledå‡1ï¼Œäºæ˜¯ï¼Œæ¯æ¬¡æ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œéƒ½ä¼šå»å‡1ï¼Œç›´åˆ°å°äº0ã€‚ä¸å»è·å–accept_mutexé”ï¼Œå°±æ˜¯ç­‰äºè®©å‡ºè·å–è¿æ¥çš„æœºä¼šï¼Œå¾ˆæ˜¾ç„¶å¯ä»¥çœ‹å‡ºï¼Œå½“ç©ºä½™è¿æ¥è¶Šå°‘æ—¶ï¼Œngx_accept_disableè¶Šå¤§ï¼Œäºæ˜¯è®©å‡ºçš„æœºä¼šå°±è¶Šå¤šï¼Œè¿™æ ·å…¶å®ƒè¿›ç¨‹è·å–é”çš„æœºä¼šä¹Ÿå°±è¶Šå¤§ã€‚ä¸å»acceptï¼Œè‡ªå·±çš„è¿æ¥å°±æ§åˆ¶ä¸‹æ¥äº†ï¼Œå…¶å®ƒè¿›ç¨‹çš„è¿æ¥æ± å°±ä¼šå¾—åˆ°åˆ©ç”¨ï¼Œè¿™æ ·ï¼Œnginxå°±æ§åˆ¶äº†å¤šè¿›ç¨‹é—´è¿æ¥çš„å¹³è¡¡äº†ã€‚ requestnginxå¯¹äºè§£æhttpåè®®ä¹Ÿæ˜¯é€šè¿‡ä¸€è¡Œä¸€è¡Œåœ°è¯»å–è¿›è¡Œå¤„ç†ã€‚ nginxä¼šå°†æ•´ä¸ªè¯·æ±‚å¤´éƒ½æ”¾åœ¨ä¸€ä¸ªbufferé‡Œé¢ï¼Œè¿™ä¸ªbufferçš„å¤§å°é€šè¿‡é…ç½®é¡¹client_header_buffer_sizeæ¥è®¾ç½®ï¼Œå¦‚æœç”¨æˆ·çš„è¯·æ±‚å¤´å¤ªå¤§ï¼Œè¿™ä¸ªbufferè£…ä¸ä¸‹ï¼Œé‚£nginxå°±ä¼šé‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„æ›´å¤§çš„bufferæ¥è£…è¯·æ±‚å¤´ï¼Œè¿™ä¸ªå¤§bufferå¯ä»¥é€šè¿‡large_client_header_buffersæ¥è®¾ç½®ï¼Œè¿™ä¸ªlarge_bufferè¿™ä¸€ç»„bufferï¼Œæ¯”å¦‚é…ç½®4 8kï¼Œå°±æ˜¯è¡¨ç¤ºæœ‰å››ä¸ª8kå¤§å°çš„bufferå¯ä»¥ç”¨ã€‚æ³¨æ„ï¼Œä¸ºäº†ä¿å­˜è¯·æ±‚è¡Œæˆ–è¯·æ±‚å¤´çš„å®Œæ•´æ€§ï¼Œä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è¡Œæˆ–è¯·æ±‚å¤´ï¼Œéœ€è¦æ”¾åœ¨ä¸€ä¸ªè¿ç»­çš„å†…å­˜é‡Œé¢ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚è¡Œæˆ–è¯·æ±‚å¤´ï¼Œåªä¼šä¿å­˜åœ¨ä¸€ä¸ªbufferé‡Œé¢ã€‚è¿™æ ·ï¼Œå¦‚æœè¯·æ±‚è¡Œå¤§äºä¸€ä¸ªbufferçš„å¤§å°ï¼Œå°±ä¼šè¿”å›414é”™è¯¯ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚å¤´å¤§å°å¤§äºä¸€ä¸ªbufferå¤§å°ï¼Œå°±ä¼šè¿”å›400é”™è¯¯ã€‚åœ¨äº†è§£äº†è¿™äº›å‚æ•°çš„å€¼ï¼Œä»¥åŠnginxå®é™…çš„åšæ³•ä¹‹åï¼Œåœ¨åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ¹æ®å®é™…çš„éœ€æ±‚æ¥è°ƒæ•´è¿™äº›å‚æ•°ï¼Œæ¥ä¼˜åŒ–æˆ‘ä»¬çš„ç¨‹åºäº†ã€‚ å¤„ç†æµç¨‹å›¾ï¼š keepaliveè¿™é‡Œæ˜¯httpå±‚çš„keepaliveï¼Œä¸tcpå±‚çš„ä¸åŒã€‚ nginxçš„keepaliveå¯ä»¥å¯¹è¿æ¥è¿›è¡Œå¤ç”¨ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå½“å®¢æˆ·ç«¯çš„ä¸€æ¬¡è®¿é—®ï¼Œéœ€è¦å¤šæ¬¡è®¿é—®åŒä¸€ä¸ªserveræ—¶ï¼Œæ‰“å¼€keepaliveçš„ä¼˜åŠ¿éå¸¸å¤§ï¼Œæ¯”å¦‚å›¾ç‰‡æœåŠ¡å™¨ï¼Œé€šå¸¸ä¸€ä¸ªç½‘é¡µä¼šåŒ…å«å¾ˆå¤šä¸ªå›¾ç‰‡ã€‚æ‰“å¼€keepaliveä¹Ÿä¼šå¤§é‡å‡å°‘time-waitçš„æ•°é‡ã€‚ pipeåœ¨http1.1ä¸­ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„ç‰¹æ€§ï¼Œå³pipelineã€‚å®ƒå¯ä»¥çœ‹ä½œä¸ºkeepaliveçš„ä¸€ç§å‡åï¼Œå› ä¸ºpipelineä¹Ÿæ˜¯åŸºäºé•¿è¿æ¥çš„ï¼Œç›®çš„å°±æ˜¯åˆ©ç”¨ä¸€ä¸ªè¿æ¥åšå¤šæ¬¡è¯·æ±‚ã€‚ lingering_closelingering_closeï¼Œå­—é¢æ„æ€å°±æ˜¯å»¶è¿Ÿå…³é—­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“nginxè¦å…³é—­è¿æ¥æ—¶ï¼Œå¹¶éç«‹å³å…³é—­è¿æ¥ï¼Œè€Œæ˜¯å…ˆå…³é—­tcpè¿æ¥çš„å†™ï¼Œå†ç­‰å¾…ä¸€æ®µæ—¶é—´åå†å…³æ‰è¿æ¥çš„è¯»ã€‚ nginxåœ¨æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œå¯èƒ½ç”±äºå®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯å‡ºé”™äº†ï¼Œè¦ç«‹å³å“åº”é”™è¯¯ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œè€Œnginxåœ¨å“åº”é”™è¯¯ä¿¡æ¯åï¼Œå¤§åˆ†éƒ¨æƒ…å†µä¸‹æ˜¯éœ€è¦å…³é—­å½“å‰è¿æ¥ã€‚nginxæ‰§è¡Œå®Œwrite()ç³»ç»Ÿè°ƒç”¨æŠŠé”™è¯¯ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ï¼Œwrite()ç³»ç»Ÿè°ƒç”¨è¿”å›æˆåŠŸå¹¶ä¸è¡¨ç¤ºæ•°æ®å·²ç»å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œæœ‰å¯èƒ½è¿˜åœ¨tcpè¿æ¥çš„write bufferé‡Œã€‚æ¥ç€å¦‚æœç›´æ¥æ‰§è¡Œclose()ç³»ç»Ÿè°ƒç”¨å…³é—­tcpè¿æ¥ï¼Œå†…æ ¸ä¼šé¦–å…ˆæ£€æŸ¥tcpçš„read bufferé‡Œæœ‰æ²¡æœ‰å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®ç•™åœ¨å†…æ ¸æ€æ²¡æœ‰è¢«ç”¨æˆ·æ€è¿›ç¨‹è¯»å–ï¼Œå¦‚æœæœ‰åˆ™å‘é€ç»™å®¢æˆ·ç«¯RSTæŠ¥æ–‡æ¥å…³é—­tcpè¿æ¥ä¸¢å¼ƒwrite bufferé‡Œçš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç­‰å¾…write bufferé‡Œçš„æ•°æ®å‘é€å®Œæ¯•ï¼Œç„¶åå†ç»è¿‡æ­£å¸¸çš„4æ¬¡åˆ†æ‰‹æŠ¥æ–‡æ–­å¼€è¿æ¥ã€‚æ‰€ä»¥,å½“åœ¨æŸäº›åœºæ™¯ä¸‹å‡ºç°tcp write bufferé‡Œçš„æ•°æ®åœ¨write()ç³»ç»Ÿè°ƒç”¨ä¹‹ååˆ°close()ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œä¹‹å‰æ²¡æœ‰å‘é€å®Œæ¯•ï¼Œä¸”tcp read bufferé‡Œé¢è¿˜æœ‰æ•°æ®æ²¡æœ‰è¯»ï¼Œclose()ç³»ç»Ÿè°ƒç”¨ä¼šå¯¼è‡´å®¢æˆ·ç«¯æ”¶åˆ°RSTæŠ¥æ–‡ä¸”ä¸ä¼šæ‹¿åˆ°æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„é”™è¯¯ä¿¡æ¯æ•°æ®ã€‚é‚£å®¢æˆ·ç«¯è‚¯å®šä¼šæƒ³ï¼Œè¿™æœåŠ¡å™¨å¥½éœ¸é“ï¼ŒåŠ¨ä¸åŠ¨å°±resetæˆ‘çš„è¿æ¥ï¼Œè¿ä¸ªé”™è¯¯ä¿¡æ¯éƒ½æ²¡æœ‰ã€‚ æ•°æ®ç»“æ„å­—ç¬¦ä¸²ngx_str_tå­—ç¬¦ä¸²å‹æ•°æ®ç»“æ„ï¼š1234typedef struct &#123; size_t len; u_char *data;&#125; ngx_str_t; é€šè¿‡lenæŒ‡å®šå­—ç¬¦ä¸²é•¿åº¦ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ä»¤ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡é’ˆæŒ‡å‘åŒä¸€æ®µå­—ç¬¦ä¸²å†…å­˜ï¼Œä»è€ŒèŠ‚çœå†…å­˜ã€‚ ç›¸å…³çš„APIï¼š1234567#define ngx_string(str) &#123; sizeof(str) - 1, (u_char *) str &#125;#define ngx_null_string &#123; 0, NULL &#125;#define ngx_str_set(str, text) \\ (str)-&gt;len = sizeof(text) - 1; (str)-&gt;data = (u_char *) text#define ngx_str_null(str) (str)-&gt;len = 0; (str)-&gt;data = NULL... poolnginx_pool_tæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œåœ¨å¾ˆå¤šé‡è¦çš„åœºåˆéƒ½æœ‰ä½¿ç”¨ï¼Œå¾ˆå¤šé‡è¦çš„æ•°æ®ç»“æ„ä¹Ÿéƒ½åœ¨ä½¿ç”¨å®ƒã€‚é‚£ä¹ˆå®ƒç©¶ç«Ÿæ˜¯ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿç®€å•çš„è¯´ï¼Œå®ƒæä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¸®åŠ©ç®¡ç†ä¸€ç³»åˆ—çš„èµ„æºï¼ˆå¦‚å†…å­˜ï¼Œæ–‡ä»¶ç­‰ï¼‰ï¼Œä½¿å¾—å¯¹è¿™äº›èµ„æºçš„ä½¿ç”¨å’Œé‡Šæ”¾ç»Ÿä¸€è¿›è¡Œï¼Œå…é™¤äº†ä½¿ç”¨è¿‡ç¨‹ä¸­è€ƒè™‘åˆ°å¯¹å„ç§å„æ ·èµ„æºçš„ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼Œæ˜¯å¦é—æ¼äº†é‡Šæ”¾çš„æ‹…å¿ƒã€‚1234567891011typedef struct ngx_pool_s ngx_pool_t;struct ngx_pool_s &#123; ngx_pool_data_t d; size_t max; ngx_pool_t *current; ngx_chain_t *chain; ngx_pool_large_t *large; ngx_pool_cleanup_t *cleanup; ngx_log_t *log;&#125;; æ•°ç»„ngx_array_tæ˜¯nginxå†…éƒ¨ä½¿ç”¨çš„æ•°ç»„ç»“æ„ã€‚nginxçš„æ•°ç»„ç»“æ„åœ¨å­˜å‚¨ä¸Šä¸å¤§å®¶è®¤çŸ¥çš„Cè¯­è¨€å†…ç½®çš„æ•°ç»„æœ‰ç›¸ä¼¼æ€§ï¼Œæ¯”å¦‚å®é™…ä¸Šå­˜å‚¨æ•°æ®çš„åŒºåŸŸä¹Ÿæ˜¯ä¸€å¤§å—è¿ç»­çš„å†…å­˜ã€‚ä½†æ˜¯æ•°ç»„é™¤äº†å­˜å‚¨æ•°æ®çš„å†…å­˜ä»¥å¤–è¿˜åŒ…å«ä¸€äº›å…ƒä¿¡æ¯æ¥æè¿°ç›¸å…³çš„ä¸€äº›ä¿¡æ¯ã€‚ä¸‹é¢æˆ‘ä»¬ä»æ•°ç»„çš„å®šä¹‰ä¸Šæ¥è¯¦ç»†çš„äº†è§£ä¸€ä¸‹ã€‚ngx_array_tçš„å®šä¹‰ä½äºsrc/core/ngx_array.c|hé‡Œé¢ã€‚12345678typedef struct ngx_array_s ngx_array_t;struct ngx_array_s &#123; void *elts; ngx_uint_t nelts; size_t size; ngx_uint_t nalloc; ngx_pool_t *pool;&#125;; elts: æŒ‡å‘å®é™…çš„æ•°æ®å­˜å‚¨åŒºåŸŸã€‚nelts: æ•°ç»„å®é™…å…ƒç´ ä¸ªæ•°ã€‚size: æ•°ç»„å•ä¸ªå…ƒç´ çš„å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚nalloc: æ•°ç»„çš„å®¹é‡ã€‚è¡¨ç¤ºè¯¥æ•°ç»„åœ¨ä¸å¼•å‘æ‰©å®¹çš„å‰æä¸‹ï¼Œå¯ä»¥æœ€å¤šå­˜å‚¨çš„å…ƒç´ çš„ä¸ªæ•°ã€‚å½“neltså¢é•¿åˆ°è¾¾nalloc æ—¶ï¼Œå¦‚æœå†å¾€æ­¤æ•°ç»„ä¸­å­˜å‚¨å…ƒç´ ï¼Œåˆ™ä¼šå¼•å‘æ•°ç»„çš„æ‰©å®¹ã€‚æ•°ç»„çš„å®¹é‡å°†ä¼šæ‰©å±•åˆ°åŸæœ‰å®¹é‡çš„2å€å¤§å°ã€‚å®é™…ä¸Šæ˜¯åˆ†é…æ–°çš„ä¸€å—å†…å­˜ï¼Œæ–°çš„ä¸€å—å†…å­˜çš„å¤§å°æ˜¯åŸæœ‰å†…å­˜å¤§å°çš„2å€ã€‚åŸæœ‰çš„æ•°æ®ä¼šè¢«æ‹·è´åˆ°æ–°çš„ä¸€å—å†…å­˜ä¸­ã€‚pool: è¯¥æ•°ç»„ç”¨æ¥åˆ†é…å†…å­˜çš„å†…å­˜æ± ã€‚ hashngx_hash_tä¸åƒå…¶ä»–çš„hashè¡¨çš„å®ç°ï¼Œå¯ä»¥æ’å…¥åˆ é™¤å…ƒç´ ï¼Œå®ƒåªèƒ½ä¸€æ¬¡åˆå§‹åŒ–ï¼Œå°±æ„å»ºèµ·æ•´ä¸ªhashè¡¨ä»¥åï¼Œæ—¢ä¸èƒ½å†åˆ é™¤ï¼Œä¹Ÿä¸èƒ½åœ¨æ’å…¥å…ƒç´ äº†ã€‚ngx_hash_tçš„å¼€é“¾å¹¶ä¸æ˜¯çœŸçš„å¼€äº†ä¸€ä¸ªé“¾è¡¨ï¼Œå®é™…ä¸Šæ˜¯å¼€äº†ä¸€æ®µè¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œå‡ ä¹å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¿™æ˜¯å› ä¸ºngx_hash_tåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šç»å†ä¸€æ¬¡é¢„è®¡ç®—çš„è¿‡ç¨‹ï¼Œæå‰æŠŠæ¯ä¸ªæ¡¶é‡Œé¢ä¼šæœ‰å¤šå°‘å…ƒç´ æ”¾è¿›å»ç»™è®¡ç®—å‡ºæ¥ï¼Œè¿™æ ·å°±æå‰çŸ¥é“æ¯ä¸ªæ¡¶çš„å¤§å°äº†ã€‚é‚£ä¹ˆå°±ä¸éœ€è¦ä½¿ç”¨é“¾è¡¨ï¼Œä¸€æ®µè¿ç»­çš„å­˜å‚¨ç©ºé—´å°±è¶³å¤Ÿäº†ã€‚è¿™ä¹Ÿä»ä¸€å®šç¨‹åº¦ä¸ŠèŠ‚çœäº†å†…å­˜çš„ä½¿ç”¨ã€‚ ngx_hash_tçš„åˆå§‹åŒ–ã€‚1ngx_int_t ngx_hash_init(ngx_hash_init_t *hinit, ngx_hash_key_t *names, ngx_uint_t nelts); 123456789101112typedef struct &#123; ngx_hash_t *hash; ngx_hash_key_pt key; ngx_uint_t max_size; ngx_uint_t bucket_size; char *name; ngx_pool_t *pool; ngx_pool_t *temp_pool;&#125; ngx_hash_init_t; hash: è¯¥å­—æ®µå¦‚æœä¸ºNULLï¼Œé‚£ä¹ˆè°ƒç”¨å®Œåˆå§‹åŒ–å‡½æ•°åï¼Œè¯¥å­—æ®µæŒ‡å‘æ–°åˆ›å»ºå‡ºæ¥çš„hashè¡¨ã€‚å¦‚æœè¯¥å­—æ®µä¸ä¸ºNULLï¼Œé‚£ä¹ˆåœ¨åˆå§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„æ•°æ®è¢«æ’å…¥äº†è¿™ä¸ªå­—æ®µæ‰€æŒ‡çš„hashè¡¨ä¸­ã€‚key: æŒ‡å‘ä»å­—ç¬¦ä¸²ç”Ÿæˆhashå€¼çš„hashå‡½æ•°ã€‚nginxçš„æºä»£ç ä¸­æä¾›äº†é»˜è®¤çš„å®ç°å‡½æ•°ngx_hash_key_lcã€‚max_size: hashè¡¨ä¸­çš„æ¡¶çš„ä¸ªæ•°ã€‚è¯¥å­—æ®µè¶Šå¤§ï¼Œå…ƒç´ å­˜å‚¨æ—¶å†²çªçš„å¯èƒ½æ€§è¶Šå°ï¼Œæ¯ä¸ªæ¡¶ä¸­å­˜å‚¨çš„å…ƒç´ ä¼šæ›´å°‘ï¼Œåˆ™æŸ¥è¯¢èµ·æ¥çš„é€Ÿåº¦æ›´å¿«ã€‚å½“ç„¶ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼Œè¶Šé€ æˆå†…å­˜çš„æµªè´¹ä¹Ÿè¶Šå¤§ï¼Œ(å®é™…ä¸Šä¹Ÿæµªè´¹ä¸äº†å¤šå°‘)ã€‚bucket_size: æ¯ä¸ªæ¡¶çš„æœ€å¤§é™åˆ¶å¤§å°ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚å¦‚æœåœ¨åˆå§‹åŒ–ä¸€ä¸ªhashè¡¨çš„æ—¶å€™ï¼Œå‘ç°æŸä¸ªæ¡¶é‡Œé¢æ— æ³•å­˜çš„ä¸‹æ‰€æœ‰å±äºè¯¥æ¡¶çš„å…ƒç´ ï¼Œåˆ™hashè¡¨åˆå§‹åŒ–å¤±è´¥ã€‚name: è¯¥hashè¡¨çš„åå­—ã€‚pool: è¯¥hashè¡¨åˆ†é…å†…å­˜ä½¿ç”¨çš„poolã€‚temp_pool: è¯¥hashè¡¨ä½¿ç”¨çš„ä¸´æ—¶poolï¼Œåœ¨åˆå§‹åŒ–å®Œæˆä»¥åï¼Œè¯¥poolå¯ä»¥è¢«é‡Šæ”¾å’Œé”€æ¯æ‰ã€‚ 12345typedef struct &#123; ngx_str_t key; ngx_uint_t key_hash; void *value;&#125; ngx_hash_key_t; æ€»çš„æ¥è¯´ï¼Œnginxå°è£…çš„æ•°æ®ç»“æ„ååˆ†ä¹‹ä¸°å¯Œï¼ŒåŒ…æ‹¬åŠ¨æ€listã€queueè¿™æ ·çš„ç»“æ„ã€‚ å‚è€ƒhttp://tengine.taobao.org/book/chapter_02.html","tags":[{"name":"æºç ","slug":"æºç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æºç /"},{"name":"Nginx","slug":"Nginx","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Nginx/"},{"name":"C","slug":"C","permalink":"https://github.com/kong36088/kong36088.github.io/tags/C/"}]},{"title":"nginxé…ç½®locationä»¥åŠrewrite","date":"2017-09-27T09:45:21.000Z","path":"2017/09/27/nginxé…ç½®locationä»¥åŠrewrite/","text":"1. locationæ­£åˆ™å†™æ³•ä¸€ä¸ªç¤ºä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243location = / &#123; # ç²¾ç¡®åŒ¹é… / ï¼Œä¸»æœºååé¢ä¸èƒ½å¸¦ä»»ä½•å­—ç¬¦ä¸² [ configuration A ]&#125;location / &#123; # å› ä¸ºæ‰€æœ‰çš„åœ°å€éƒ½ä»¥ / å¼€å¤´ï¼Œæ‰€ä»¥è¿™æ¡è§„åˆ™å°†åŒ¹é…åˆ°æ‰€æœ‰è¯·æ±‚ # ä½†æ˜¯æ­£åˆ™å’Œæœ€é•¿å­—ç¬¦ä¸²ä¼šä¼˜å…ˆåŒ¹é… [ configuration B ]&#125;location /documents/ &#123; # åŒ¹é…ä»»ä½•ä»¥ /documents/ å¼€å¤´çš„åœ°å€ï¼ŒåŒ¹é…ç¬¦åˆä»¥åï¼Œè¿˜è¦ç»§ç»­å¾€ä¸‹æœç´¢ # åªæœ‰åé¢çš„æ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰åŒ¹é…åˆ°æ—¶ï¼Œè¿™ä¸€æ¡æ‰ä¼šé‡‡ç”¨è¿™ä¸€æ¡ [ configuration C ]&#125;location ~ /documents/Abc &#123; # åŒ¹é…ä»»ä½•ä»¥ /documents/Abc å¼€å¤´çš„åœ°å€ï¼ŒåŒ¹é…ç¬¦åˆä»¥åï¼Œè¿˜è¦ç»§ç»­å¾€ä¸‹æœç´¢ # åªæœ‰åé¢çš„æ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰åŒ¹é…åˆ°æ—¶ï¼Œè¿™ä¸€æ¡æ‰ä¼šé‡‡ç”¨è¿™ä¸€æ¡ [ configuration CC ]&#125;location ^~ /images/ &#123; # åŒ¹é…ä»»ä½•ä»¥ /images/ å¼€å¤´çš„åœ°å€ï¼ŒåŒ¹é…ç¬¦åˆä»¥åï¼Œåœæ­¢å¾€ä¸‹æœç´¢æ­£åˆ™ï¼Œé‡‡ç”¨è¿™ä¸€æ¡ã€‚ [ configuration D ]&#125;location ~* \\.(gif|jpg|jpeg)$ &#123; # åŒ¹é…æ‰€æœ‰ä»¥ gif,jpgæˆ–jpeg ç»“å°¾çš„è¯·æ±‚ # ç„¶è€Œï¼Œæ‰€æœ‰è¯·æ±‚ /images/ ä¸‹çš„å›¾ç‰‡ä¼šè¢« config D å¤„ç†ï¼Œå› ä¸º ^~ åˆ°è¾¾ä¸äº†è¿™ä¸€æ¡æ­£åˆ™ [ configuration E ]&#125;location /images/ &#123; # å­—ç¬¦åŒ¹é…åˆ° /images/ï¼Œç»§ç»­å¾€ä¸‹ï¼Œä¼šå‘ç° ^~ å­˜åœ¨ [ configuration F ]&#125;location /images/abc &#123; # æœ€é•¿å­—ç¬¦åŒ¹é…åˆ° /images/abcï¼Œç»§ç»­å¾€ä¸‹ï¼Œä¼šå‘ç° ^~ å­˜åœ¨ # Fä¸Gçš„æ”¾ç½®é¡ºåºæ˜¯æ²¡æœ‰å…³ç³»çš„ [ configuration G ]&#125;location ~ /images/abc/ &#123; # åªæœ‰å»æ‰ config D æ‰æœ‰æ•ˆï¼šå…ˆæœ€é•¿åŒ¹é… config G å¼€å¤´çš„åœ°å€ï¼Œç»§ç»­å¾€ä¸‹æœç´¢ï¼ŒåŒ¹é…åˆ°è¿™ä¸€æ¡æ­£åˆ™ï¼Œé‡‡ç”¨ [ configuration H ]&#125;location ~* /js/.*/\\.js ä»¥=å¼€å¤´è¡¨ç¤ºç²¾ç¡®åŒ¹é…å¦‚ A ä¸­åªåŒ¹é…æ ¹ç›®å½•ç»“å°¾çš„è¯·æ±‚ï¼Œåé¢ä¸èƒ½å¸¦ä»»ä½•å­—ç¬¦ä¸²ã€‚^~ å¼€å¤´è¡¨ç¤ºuriä»¥æŸä¸ªå¸¸è§„å­—ç¬¦ä¸²å¼€å¤´ï¼Œä¸æ˜¯æ­£åˆ™åŒ¹é…~ å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…;~* å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…/ é€šç”¨åŒ¹é…, å¦‚æœæ²¡æœ‰å…¶å®ƒåŒ¹é…,ä»»ä½•è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°é¡ºåº noä¼˜å…ˆçº§ï¼š(location =) &gt; (location å®Œæ•´è·¯å¾„) &gt; (location ^~ è·¯å¾„) &gt; (location ~,~* æ­£åˆ™é¡ºåº) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) &gt; (/) ä¸Šé¢çš„åŒ¹é…ç»“æœæŒ‰ç…§ä¸Šé¢çš„locationå†™æ³•ï¼Œä»¥ä¸‹çš„åŒ¹é…ç¤ºä¾‹æˆç«‹ï¼š / -&gt; config Aç²¾ç¡®å®Œå…¨åŒ¹é…ï¼Œå³ä½¿/index.htmlä¹ŸåŒ¹é…ä¸äº†/downloads/download.html -&gt; config BåŒ¹é…Bä»¥åï¼Œå¾€ä¸‹æ²¡æœ‰ä»»ä½•åŒ¹é…ï¼Œé‡‡ç”¨B/images/1.gif -&gt; configuration DåŒ¹é…åˆ°Fï¼Œå¾€ä¸‹åŒ¹é…åˆ°Dï¼Œåœæ­¢å¾€ä¸‹/images/abc/def -&gt; config Dæœ€é•¿åŒ¹é…åˆ°Gï¼Œå¾€ä¸‹åŒ¹é…Dï¼Œåœæ­¢å¾€ä¸‹ä½ å¯ä»¥çœ‹åˆ° ä»»ä½•ä»¥/images/å¼€å¤´çš„éƒ½ä¼šåŒ¹é…åˆ°Då¹¶åœæ­¢ï¼ŒFGå†™åœ¨è¿™é‡Œæ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼ŒHæ˜¯æ°¸è¿œè½®ä¸åˆ°çš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†è¯´æ˜åŒ¹é…é¡ºåº/documents/document.html -&gt; config CåŒ¹é…åˆ°Cï¼Œå¾€ä¸‹æ²¡æœ‰ä»»ä½•åŒ¹é…ï¼Œé‡‡ç”¨C/documents/1.jpg -&gt; configuration EåŒ¹é…åˆ°Cï¼Œå¾€ä¸‹æ­£åˆ™åŒ¹é…åˆ°E/documents/Abc.jpg -&gt; config CCæœ€é•¿åŒ¹é…åˆ°Cï¼Œå¾€ä¸‹æ­£åˆ™é¡ºåºåŒ¹é…åˆ°CCï¼Œä¸ä¼šå¾€ä¸‹åˆ°E å®é™…ä½¿ç”¨å»ºè®®123456789101112131415161718192021æ‰€ä»¥å®é™…ä½¿ç”¨ä¸­ï¼Œä¸ªäººè§‰å¾—è‡³å°‘æœ‰ä¸‰ä¸ªåŒ¹é…è§„åˆ™å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š#ç›´æ¥åŒ¹é…ç½‘ç«™æ ¹ï¼Œé€šè¿‡åŸŸåè®¿é—®ç½‘ç«™é¦–é¡µæ¯”è¾ƒé¢‘ç¹ï¼Œä½¿ç”¨è¿™ä¸ªä¼šåŠ é€Ÿå¤„ç†ï¼Œå®˜ç½‘å¦‚æ˜¯è¯´ã€‚#è¿™é‡Œæ˜¯ç›´æ¥è½¬å‘ç»™åç«¯åº”ç”¨æœåŠ¡å™¨äº†ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªé™æ€é¦–é¡µ# ç¬¬ä¸€ä¸ªå¿…é€‰è§„åˆ™location = / &#123; proxy_pass http://tomcat:8080/index&#125;# ç¬¬äºŒä¸ªå¿…é€‰è§„åˆ™æ˜¯å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚ï¼Œè¿™æ˜¯nginxä½œä¸ºhttpæœåŠ¡å™¨çš„å¼ºé¡¹# æœ‰ä¸¤ç§é…ç½®æ¨¡å¼ï¼Œç›®å½•åŒ¹é…æˆ–åç¼€åŒ¹é…,ä»»é€‰å…¶ä¸€æˆ–æ­é…ä½¿ç”¨location ^~ /static/ &#123; root /webroot/static/;&#125;location ~* \\.(gif|jpg|jpeg|png|css|js|ico)$ &#123; root /webroot/res/;&#125;#ç¬¬ä¸‰ä¸ªè§„åˆ™å°±æ˜¯é€šç”¨è§„åˆ™ï¼Œç”¨æ¥è½¬å‘åŠ¨æ€è¯·æ±‚åˆ°åç«¯åº”ç”¨æœåŠ¡å™¨#éé™æ€æ–‡ä»¶è¯·æ±‚å°±é»˜è®¤æ˜¯åŠ¨æ€è¯·æ±‚ï¼Œè‡ªå·±æ ¹æ®å®é™…æŠŠæ¡#æ¯•ç«Ÿç›®å‰çš„ä¸€äº›æ¡†æ¶çš„æµè¡Œï¼Œå¸¦.php,.jspåç¼€çš„æƒ…å†µå¾ˆå°‘äº†location / &#123; proxy_pass http://tomcat:8080/&#125; http://tengine.taobao.org/book/chapter_02.htmlhttp://nginx.org/en/docs/http/ngx_http_rewrite_module.html 2. Rewriteè§„åˆ™rewriteåŠŸèƒ½å°±æ˜¯ï¼Œä½¿ç”¨nginxæä¾›çš„å…¨å±€å˜é‡æˆ–è‡ªå·±è®¾ç½®çš„å˜é‡ï¼Œç»“åˆæ­£åˆ™è¡¨è¾¾å¼å’Œæ ‡å¿—ä½å®ç°urlé‡å†™ä»¥åŠé‡å®šå‘ã€‚rewriteåªèƒ½æ”¾åœ¨server{},location{},if{}ä¸­ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååè¾¹çš„é™¤å»ä¼ é€’çš„å‚æ•°å¤–çš„å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œä¾‹å¦‚ http://seanlook.com/a/we/index.php?id=1&amp;u=str åªå¯¹/a/we/index.phpé‡å†™ã€‚è¯­æ³•rewrite regex replacement [flag]; å¦‚æœç›¸å¯¹åŸŸåæˆ–å‚æ•°å­—ç¬¦ä¸²èµ·ä½œç”¨ï¼Œå¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡åŒ¹é…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨proxy_passåå‘ä»£ç†ã€‚ è¡¨æ˜çœ‹rewriteå’ŒlocationåŠŸèƒ½æœ‰ç‚¹åƒï¼Œéƒ½èƒ½å®ç°è·³è½¬ï¼Œä¸»è¦åŒºåˆ«åœ¨äºrewriteæ˜¯åœ¨åŒä¸€åŸŸåå†…æ›´æ”¹è·å–èµ„æºçš„è·¯å¾„ï¼Œè€Œlocationæ˜¯å¯¹ä¸€ç±»è·¯å¾„åšæ§åˆ¶è®¿é—®æˆ–åå‘ä»£ç†ï¼Œå¯ä»¥proxy_passåˆ°å…¶ä»–æœºå™¨ã€‚å¾ˆå¤šæƒ…å†µä¸‹rewriteä¹Ÿä¼šå†™åœ¨locationé‡Œï¼Œå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼š æ‰§è¡Œserverå—çš„rewriteæŒ‡ä»¤æ‰§è¡ŒlocationåŒ¹é…æ‰§è¡Œé€‰å®šçš„locationä¸­çš„rewriteæŒ‡ä»¤å¦‚æœå…¶ä¸­æŸæ­¥URIè¢«é‡å†™ï¼Œåˆ™é‡æ–°å¾ªç¯æ‰§è¡Œ1-3ï¼Œç›´åˆ°æ‰¾åˆ°çœŸå®å­˜åœ¨çš„æ–‡ä»¶ï¼›å¾ªç¯è¶…è¿‡10æ¬¡ï¼Œåˆ™è¿”å›500 Internal Server Erroré”™è¯¯ã€‚ 2.1 flagæ ‡å¿—ä½last : ç›¸å½“äºApacheçš„[L]æ ‡è®°ï¼Œè¡¨ç¤ºå®Œæˆrewritebreak : åœæ­¢æ‰§è¡Œå½“å‰è™šæ‹Ÿä¸»æœºçš„åç»­rewriteæŒ‡ä»¤é›†redirect : è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€permanent : è¿”å›301æ°¸ä¹…é‡å®šå‘ï¼Œåœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€å› ä¸º301å’Œ302ä¸èƒ½ç®€å•çš„åªè¿”å›çŠ¶æ€ç ï¼Œè¿˜å¿…é¡»æœ‰é‡å®šå‘çš„URLï¼Œè¿™å°±æ˜¯returnæŒ‡ä»¤æ— æ³•è¿”å›301,302çš„åŸå› äº†ã€‚è¿™é‡Œ last å’Œ break åŒºåˆ«æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼š``lastä¸€èˆ¬å†™åœ¨serverå’Œifä¸­ï¼Œè€Œbreakä¸€èˆ¬ä½¿ç”¨åœ¨locationä¸­lastä¸ç»ˆæ­¢é‡å†™åçš„urlåŒ¹é…ï¼Œå³æ–°çš„urlä¼šå†ä»serverèµ°ä¸€éåŒ¹é…æµç¨‹ï¼Œè€Œbreakç»ˆæ­¢é‡å†™åçš„åŒ¹é…breakå’Œlastéƒ½èƒ½ç»„ç»‡ç»§ç»­æ‰§è¡Œåé¢çš„rewriteæŒ‡ä»¤2.2 ifæŒ‡ä»¤ä¸å…¨å±€å˜é‡ifåˆ¤æ–­æŒ‡ä»¤è¯­æ³•ä¸ºif(condition){â€¦}ï¼Œå¯¹ç»™å®šçš„æ¡ä»¶conditionè¿›è¡Œåˆ¤æ–­ã€‚å¦‚æœä¸ºçœŸï¼Œå¤§æ‹¬å·å†…çš„rewriteæŒ‡ä»¤å°†è¢«æ‰§è¡Œï¼Œifæ¡ä»¶(conditon)å¯ä»¥æ˜¯å¦‚ä¸‹ä»»ä½•å†…å®¹ï¼š å½“è¡¨è¾¾å¼åªæ˜¯ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚æœå€¼ä¸ºç©ºæˆ–ä»»ä½•ä»¥0å¼€å¤´çš„å­—ç¬¦ä¸²éƒ½ä¼šå½“åšfalseç›´æ¥æ¯”è¾ƒå˜é‡å’Œå†…å®¹æ—¶ï¼Œä½¿ç”¨=æˆ–!=~æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œ~*ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ï¼Œ!~åŒºåˆ†å¤§å°å†™çš„ä¸åŒ¹é…-få’Œ!-fç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶-då’Œ!-dç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›®å½•-eå’Œ!-eç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–ç›®å½•-xå’Œ!-xç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ ä¾‹å¦‚ï¼š12345678910111213141516171819202122232425if ($http_user_agent ~ MSIE) &#123; rewrite ^(.*)$ /msie/$1 break;&#125; //å¦‚æœUAåŒ…å«\"MSIE\"ï¼Œrewriteè¯·æ±‚åˆ°/msid/ç›®å½•ä¸‹if ($http_cookie ~* \"id=([^;]+)(?:;|$)\") &#123; set $id $1; &#125; //å¦‚æœcookieåŒ¹é…æ­£åˆ™ï¼Œè®¾ç½®å˜é‡$idç­‰äºæ­£åˆ™å¼•ç”¨éƒ¨åˆ†if ($request_method = POST) &#123; return 405;&#125; //å¦‚æœæäº¤æ–¹æ³•ä¸ºPOSTï¼Œåˆ™è¿”å›çŠ¶æ€405ï¼ˆMethod not allowedï¼‰ã€‚returnä¸èƒ½è¿”å›301,302if ($slow) &#123; limit_rate 10k;&#125; //é™é€Ÿï¼Œ$slowå¯ä»¥é€šè¿‡ set æŒ‡ä»¤è®¾ç½®if (!-f $request_filename)&#123; break; proxy_pass http://127.0.0.1;&#125; //å¦‚æœè¯·æ±‚çš„æ–‡ä»¶åä¸å­˜åœ¨ï¼Œåˆ™åå‘ä»£ç†åˆ°localhost ã€‚è¿™é‡Œçš„breakä¹Ÿæ˜¯åœæ­¢rewriteæ£€æŸ¥if ($args ~ post=140)&#123; rewrite ^ http://example.com/ permanent;&#125; //å¦‚æœquery stringä¸­åŒ…å«\"post=140\"ï¼Œæ°¸ä¹…é‡å®šå‘åˆ°example.comlocation ~* \\.(gif|jpg|png|swf|flv)$ &#123; valid_referers none blocked www.jefflei.com www.leizhenfang.com; if ($invalid_referer) &#123; return 404; &#125; //é˜²ç›—é“¾&#125; å…¨å±€å˜é‡ä¸‹é¢æ˜¯å¯ä»¥ç”¨ä½œifåˆ¤æ–­çš„å…¨å±€å˜é‡ $args ï¼š #è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string$content_length ï¼š è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚$content_type ï¼š è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚$document_root ï¼š å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚$host ï¼š è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚$http_user_agent ï¼š å®¢æˆ·ç«¯agentä¿¡æ¯$http_cookie ï¼š å®¢æˆ·ç«¯cookieä¿¡æ¯$limit_rate ï¼š è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚$request_method ï¼š å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚$remote_addr ï¼š å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚$remote_port ï¼š å®¢æˆ·ç«¯çš„ç«¯å£ã€‚$remote_user ï¼š å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚$request_filename ï¼š å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚$scheme ï¼š HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚$server_protocol ï¼š è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚$server_addr ï¼š æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚$server_name ï¼š æœåŠ¡å™¨åç§°ã€‚$server_port ï¼š è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚$request_uri ï¼š åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼šâ€/foo/bar.php?arg=bazâ€ã€‚$uri ï¼š ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚$document_uri ï¼š ä¸$uriç›¸åŒã€‚ä¾‹ï¼šhttp://localhost:88/test1/test2/test.php$hostï¼šlocalhost$server_portï¼š88$request_uriï¼šhttp://localhost:88/test1/test2/test.php$document_uriï¼š/test1/test2/test.php$document_rootï¼š/var/www/html$request_filenameï¼š/var/www/html/test1/test2/test.php 2.3 å¸¸ç”¨æ­£åˆ™. ï¼š åŒ¹é…é™¤æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦? ï¼š é‡å¤0æ¬¡æˆ–1æ¬¡+ ï¼š é‡å¤1æ¬¡æˆ–æ›´å¤šæ¬¡* ï¼š é‡å¤0æ¬¡æˆ–æ›´å¤šæ¬¡\\d ï¼šåŒ¹é…æ•°å­—^ ï¼š åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å§‹$ ï¼š åŒ¹é…å­—ç¬¦ä¸²çš„ä»‹ç»{n} ï¼š é‡å¤næ¬¡{n,} ï¼š é‡å¤næ¬¡æˆ–æ›´å¤šæ¬¡[c] ï¼š åŒ¹é…å•ä¸ªå­—ç¬¦c[a-z] ï¼š åŒ¹é…a-zå°å†™å­—æ¯çš„ä»»æ„ä¸€ä¸ªå°æ‹¬å·()ä¹‹é—´åŒ¹é…çš„å†…å®¹ï¼Œå¯ä»¥åœ¨åé¢é€šè¿‡$1æ¥å¼•ç”¨ï¼Œ$2è¡¨ç¤ºçš„æ˜¯å‰é¢ç¬¬äºŒä¸ª()é‡Œçš„å†…å®¹ã€‚æ­£åˆ™é‡Œé¢å®¹æ˜“è®©äººå›°æƒ‘çš„æ˜¯\\è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚ 2.4 rewriteå®ä¾‹ä¾‹1ï¼š 12345678910111213141516171819202122232425262728http &#123; # å®šä¹‰imageæ—¥å¿—æ ¼å¼ log_format imagelog '[$time_local] ' $image_file ' ' $image_type ' ' $body_bytes_sent ' ' $status; # å¼€å¯é‡å†™æ—¥å¿— rewrite_log on; server &#123; root /home/www; location / &#123; # é‡å†™è§„åˆ™ä¿¡æ¯ error_log logs/rewrite.log notice; # æ³¨æ„è¿™é‡Œè¦ç”¨â€˜â€™å•å¼•å·å¼•èµ·æ¥ï¼Œé¿å…&#123;&#125; rewrite '^/images/([a-z]&#123;2&#125;)/([a-z0-9]&#123;5&#125;)/(.*)\\.(png|jpg|gif)$' /data?file=$3.$4; # æ³¨æ„ä¸èƒ½åœ¨ä¸Šé¢è¿™æ¡è§„åˆ™åé¢åŠ ä¸Šâ€œlastâ€å‚æ•°ï¼Œå¦åˆ™ä¸‹é¢çš„setæŒ‡ä»¤ä¸ä¼šæ‰§è¡Œ set $image_file $3; set $image_type $4; &#125; location /data &#123; # æŒ‡å®šé’ˆå¯¹å›¾ç‰‡çš„æ—¥å¿—æ ¼å¼ï¼Œæ¥åˆ†æå›¾ç‰‡ç±»å‹å’Œå¤§å° access_log logs/images.log mian; root /data/images; # åº”ç”¨å‰é¢å®šä¹‰çš„å˜é‡ã€‚åˆ¤æ–­é¦–å…ˆæ–‡ä»¶åœ¨ä¸åœ¨ï¼Œä¸åœ¨å†åˆ¤æ–­ç›®å½•åœ¨ä¸åœ¨ï¼Œå¦‚æœè¿˜ä¸åœ¨å°±è·³è½¬åˆ°æœ€åä¸€ä¸ªurlé‡Œ try_files /$arg_file /image404.html; &#125; location = /image404.html &#123; # å›¾ç‰‡ä¸å­˜åœ¨è¿”å›ç‰¹å®šçš„ä¿¡æ¯ return 404 \"image not found\\n\"; &#125;&#125; å¯¹å½¢å¦‚/images/ef/uh7b3/test.pngçš„è¯·æ±‚ï¼Œé‡å†™åˆ°/data?file=test.pngï¼Œäºæ˜¯åŒ¹é…åˆ°location /dataï¼Œå…ˆçœ‹/data/images/test.pngæ–‡ä»¶å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ­£å¸¸å“åº”ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™é‡å†™tryfilesåˆ°æ–°çš„image404 locationï¼Œç›´æ¥è¿”å›404çŠ¶æ€ç ã€‚ ä¾‹2ï¼š1rewrite ^/images/(.*)_(\\d+)x(\\d+)\\.(png|jpg|gif)$ /resizer/$1.$4?width=$2&amp;height=$3? last; å¯¹å½¢å¦‚/images/bla_500x400.jpgçš„æ–‡ä»¶è¯·æ±‚ï¼Œé‡å†™åˆ°/resizer/bla.jpg?width=500&amp;height=400åœ°å€ï¼Œå¹¶ä¼šç»§ç»­å°è¯•åŒ¹é…locationã€‚ è½¬è½½å‡ºå¤„http://seanlook.com/2015/05/17/nginx-location-rewrite/","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Nginx","slug":"Nginx","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Nginx/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://github.com/kong36088/kong36088.github.io/tags/é…ç½®/"}]},{"title":"PHP standardå‡½æ•°getcwdæºç é˜…è¯»å°è®°","date":"2017-06-28T03:20:21.000Z","path":"2017/06/28/PHP standardå‡½æ•°getcwdæºç é˜…è¯»å°è®°/","text":"é‡åˆ°äº†php-fpm register_shutdown_function()çš„ä¸€ä¸ªbugï¼š 12345echo \"Expected:\" . getcwd() . \"&lt;br&gt;\";register_shutdown_function(function () &#123; echo \"In shutdown function:\" . getcwd() . \"&lt;br&gt;\";&#125;); php-fpmè¾“å‡ºå¦‚ä¸‹12Expected:/var/www/html/testIn shutdown function:/ åœ¨cliæ¨¡å¼ä¸‹è¾“å‡ºæ­£å¸¸1Expected:/var/www/html/test&lt;br&gt;In shutdown function:/var/www/html/test&lt;br&gt; å»ç¿»ç¿»æºç ï¼Œæ‰¾åˆ°getcwdçš„å®šä¹‰å‡½æ•°å®šä¹‰çš„ä½ç½®åœ¨ï¼šext/standard/dir.cçš„364è¡Œ123456789101112131415161718192021PHP_FUNCTION(getcwd)&#123; char path[MAXPATHLEN]; char *ret=NULL; if (zend_parse_parameters_none() == FAILURE) &#123; return; &#125;#if HAVE_GETCWD ret = VCWD_GETCWD(path, MAXPATHLEN); //è¿™é‡Œè°ƒç”¨ZENDçš„æ–¹æ³•ï¼Œè·å–å½“å‰å·¥ä½œç›®å½•#elif HAVE_GETWD ret = VCWD_GETWD(path);#endif if (ret) &#123; RETURN_STRING(path); &#125; else &#123; RETURN_FALSE; &#125;&#125; å¯è§ï¼Œæ­¤æ–¹æ³•å…¶å®æ˜¯å…³è”åˆ°ä¸€ä¸ªZENDæ–¹æ³•VCWD_GETWD()1#define VCWD_GETCWD(buff, size) virtual_getcwd(buff, size) PHPå†…æ ¸å®šä¹‰äº†ååˆ†ä¹‹å¤šçš„å®ï¼Œæ‰€ä»¥éœ€è¦æ‰¾åˆ°çœŸæ­£å®šä¹‰è¿˜å¾—è´¹ç‚¹åŠ²æœ€ç»ˆæ‰¾åˆ°çœŸæ­£å®šä¹‰ä½ç½®ï¼Œåœ¨Zend\\zend_virtual_cwd.h 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667CWD_API char *virtual_getcwd_ex(size_t *length)&#123; cwd_state *state; state = &amp;CWDG(cwd); //è·å–å…¨å±€çš„virtual_getcwd if (state-&gt;cwd_length == 0) &#123; char *retval; *length = 1; retval = (char *) emalloc(2); if (retval == NULL) &#123; return NULL; &#125; retval[0] = DEFAULT_SLASH; retval[1] = '\\0'; return retval; &#125;#ifdef ZEND_WIN32 /* If we have something like C: */ if (state-&gt;cwd_length == 2 &amp;&amp; state-&gt;cwd[state-&gt;cwd_length-1] == ':') &#123; char *retval; *length = state-&gt;cwd_length+1; retval = (char *) emalloc(*length+1); if (retval == NULL) &#123; return NULL; &#125; memcpy(retval, state-&gt;cwd, *length); retval[0] = toupper(retval[0]); retval[*length-1] = DEFAULT_SLASH; retval[*length] = '\\0'; return retval; &#125;#endif if (!state-&gt;cwd) &#123; *length = 0; return NULL; &#125; *length = state-&gt;cwd_length; return estrdup(state-&gt;cwd);&#125;CWD_API char *virtual_getcwd(char *buf, size_t size)&#123; size_t length; char *cwd; cwd = virtual_getcwd_ex(&amp;length); // çœŸæ­£è·å–cwdçš„åœ°æ–¹ if (buf == NULL) &#123; return cwd; &#125; if (length &gt; size-1) &#123; efree(cwd); errno = ERANGE; /* Is this OK? */ return NULL; &#125; if (!cwd) &#123; return NULL; &#125; memcpy(buf, cwd, length+1); //å¤åˆ¶å†…å®¹ efree(cwd); // é˜²æ­¢å†…å­˜æ³„æ¼ return buf;&#125; æ‰¾åˆ°CWDGå®šä¹‰1234567#ifdef ZTSextern ts_rsrc_id cwd_globals_id;# define CWDG(v) ZEND_TSRMG(cwd_globals_id, virtual_cwd_globals *, v)#elseextern virtual_cwd_globals cwd_globals;# define CWDG(v) (cwd_globals.v)#endif å¯ä»¥çœ‹åˆ°ï¼Œæ–¹æ³•æ˜¯è·å–ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œcwd_globals æ ¹æ®ä¸Šé¢æºç çš„é˜…è¯»ï¼Œå¯ä»¥è¿›ä¸€æ­¥æ¨æµ‹åº”è¯¥æ˜¯shutdown_functionçš„æ—¶å€™cwd_globalså·²ç»è¢«ä¿®æ”¹äº†è¿™ç§æƒ…å†µåªå‘ç”Ÿåœ¨php-fpmæ¨¡å¼ä¸‹ï¼Œcliæœªå‘ç°","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"æºç ","slug":"æºç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æºç /"},{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å†…æ ¸/"}]},{"title":"PSRè§„èŒƒæ€»ç»“ï¼š","date":"2017-04-19T06:24:25.000Z","path":"2017/04/19/PSRè§„èŒƒæ€»ç»“/","text":"èƒ½æ„¿åŠ¨è¯ å¿…é¡» (MUST) ï¼šç»å¯¹ï¼Œä¸¥æ ¼éµå¾ªï¼Œè¯·ç…§åšï¼Œæ— æ¡ä»¶éµå®ˆï¼› ä¸€å®šä¸å¯ (MUST NOT) ï¼šç¦ä»¤ï¼Œä¸¥ä»¤ç¦æ­¢ï¼› åº”è¯¥ (SHOULD) ï¼šå¼ºçƒˆå»ºè®®è¿™æ ·åšï¼Œä½†æ˜¯ä¸å¼ºæ±‚ï¼› ä¸è¯¥ (SHOULD NOT) ï¼šå¼ºçƒˆä¸å»ºè®®è¿™æ ·åšï¼Œä½†æ˜¯ä¸å¼ºæ±‚ï¼› å¯ä»¥ (MAY) å’Œ å¯é€‰ (OPTIONAL) ï¼šé€‰æ‹©æ€§é«˜ä¸€ç‚¹ï¼Œåœ¨è¿™ä¸ªæ–‡æ¡£å†…ï¼Œæ­¤è¯è¯­ä½¿ç”¨è¾ƒå°‘ï¼› PSR-1ï¼ˆåŸºç¡€ç¼–ç è§„èŒƒï¼‰ PHPä»£ç æ–‡ä»¶ å¿…é¡» ä»¥ &lt;?php æˆ– &lt;?= æ ‡ç­¾å¼€å§‹ï¼› PHPä»£ç æ–‡ä»¶ å¿…é¡» ä»¥ ä¸å¸¦ BOM çš„ UTF-8 ç¼–ç ï¼› PHPä»£ç ä¸­ åº”è¯¥ åªå®šä¹‰ç±»ã€å‡½æ•°ã€å¸¸é‡ç­‰å£°æ˜ï¼Œæˆ–å…¶ä»–ä¼šäº§ç”Ÿ å‰¯ä½œç”¨ çš„æ“ä½œï¼ˆå¦‚ï¼šç”Ÿæˆæ–‡ä»¶è¾“å‡ºä»¥åŠä¿®æ”¹ .ini é…ç½®æ–‡ä»¶ç­‰ï¼‰ï¼ŒäºŒè€…åªèƒ½é€‰å…¶ä¸€ï¼› å‘½åç©ºé—´ä»¥åŠç±» å¿…é¡» ç¬¦åˆ PSR çš„è‡ªåŠ¨åŠ è½½è§„èŒƒï¼šPSR-4 ä¸­çš„ä¸€ä¸ªï¼› ç±»çš„å‘½å å¿…é¡» éµå¾ª StudlyCaps å¤§å†™å¼€å¤´çš„é©¼å³°å‘½åè§„èŒƒï¼› ç±»ä¸­çš„å¸¸é‡æ‰€æœ‰å­—æ¯éƒ½ å¿…é¡» å¤§å†™ï¼Œå•è¯é—´ç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼› æ–¹æ³•åç§° å¿…é¡» ç¬¦åˆ camelCase å¼çš„å°å†™å¼€å¤´é©¼å³°å‘½åè§„èŒƒã€‚ï¼ˆè¿™ä¸ªç±»ä¼¼äºJavaçš„å‘½åæ–¹å¼ï¼‰ PSR-2ï¼ˆç¼–ç é£æ ¼è§„èŒƒï¼‰ ä»£ç  å¿…é¡» éµå¾ª PSR-1 ä¸­çš„ç¼–ç è§„èŒƒ ã€‚ ä»£ç  å¿…é¡» ä½¿ç”¨4ä¸ªç©ºæ ¼ç¬¦è€Œä¸æ˜¯ã€ŒTab é”®ã€è¿›è¡Œç¼©è¿›ã€‚ æ¯è¡Œçš„å­—ç¬¦æ•° åº”è¯¥ è½¯æ€§ä¿æŒåœ¨ 80 ä¸ªä¹‹å†…ï¼Œç†è®ºä¸Š ä¸€å®šä¸å¯ å¤šäº 120 ä¸ªï¼Œä½† ä¸€å®šä¸å¯ æœ‰ç¡¬æ€§é™åˆ¶ã€‚ æ¯ä¸ª namespace å‘½åç©ºé—´å£°æ˜è¯­å¥å’Œ use å£°æ˜è¯­å¥å—åé¢ï¼Œå¿…é¡» æ’å…¥ä¸€ä¸ªç©ºç™½è¡Œã€‚ ç±»çš„å¼€å§‹èŠ±æ‹¬å·ï¼ˆ{ï¼‰ å¿…é¡» å†™åœ¨å‡½æ•°å£°æ˜åè‡ªæˆä¸€è¡Œï¼Œç»“æŸèŠ±æ‹¬å·ï¼ˆ}ï¼‰ä¹Ÿ å¿…é¡» å†™åœ¨å‡½æ•°ä¸»ä½“åè‡ªæˆä¸€è¡Œã€‚ æ–¹æ³•çš„å¼€å§‹èŠ±æ‹¬å·ï¼ˆ{ï¼‰ å¿…é¡» å†™åœ¨å‡½æ•°å£°æ˜åè‡ªæˆä¸€è¡Œï¼Œç»“æŸèŠ±æ‹¬å·ï¼ˆ}ï¼‰ä¹Ÿ å¿…é¡» å†™åœ¨å‡½æ•°ä¸»ä½“åè‡ªæˆä¸€è¡Œã€‚ ç±»çš„å±æ€§å’Œæ–¹æ³• å¿…é¡» æ·»åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼ˆprivateã€protected ä»¥åŠ publicï¼‰ï¼Œabstract ä»¥åŠ final å¿…é¡» å£°æ˜åœ¨è®¿é—®ä¿®é¥°ç¬¦ä¹‹å‰ï¼Œè€Œ static å¿…é¡» å£°æ˜åœ¨è®¿é—®ä¿®é¥°ç¬¦ä¹‹åã€‚ æ§åˆ¶ç»“æ„çš„å…³é”®å­—å å¿…é¡» è¦æœ‰ä¸€ä¸ªç©ºæ ¼ç¬¦ï¼Œè€Œè°ƒç”¨æ–¹æ³•æˆ–å‡½æ•°æ—¶åˆ™ ä¸€å®šä¸å¯ æœ‰ã€‚ æ§åˆ¶ç»“æ„çš„å¼€å§‹èŠ±æ‹¬å·ï¼ˆ{ï¼‰ å¿…é¡» å†™åœ¨å£°æ˜çš„åŒä¸€è¡Œï¼Œè€Œç»“æŸèŠ±æ‹¬å·ï¼ˆ}ï¼‰ å¿…é¡» å†™åœ¨ä¸»ä½“åè‡ªæˆä¸€è¡Œã€‚ æ§åˆ¶ç»“æ„çš„å¼€å§‹å·¦æ‹¬å·åå’Œç»“æŸå³æ‹¬å·å‰ï¼Œéƒ½ ä¸€å®šä¸å¯ æœ‰ç©ºæ ¼ç¬¦ã€‚ PSR-3ï¼ˆæ—¥å¿—æ¥å£è§„èŒƒï¼‰ LoggerInterface æ¥å£å¯¹å¤–å®šä¹‰äº†å…«ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«ç”¨æ¥è®°å½• RFC 5424 ä¸­å®šä¹‰çš„å…«ä¸ªç­‰çº§çš„æ—¥å¿—ï¼šdebugã€ infoã€ noticeã€ warningã€ errorã€ criticalã€ alert ä»¥åŠ emergencyï¼Œä»¥åŠè¿˜æœ‰ç¬¬ä¹ä¸ªæ–¹æ³• logï¼ˆç”¨äºå†™å…¥æˆ–è€…è®°å½•æ—¥å¿—ï¼‰ã€‚ å‚æ•° å¯ä»¥ æºå¸¦å ä½ç¬¦ï¼Œå¹¶ä¸”å ä½ç¬¦ å¿…é¡» ä¸ä¸Šä¸‹æ–‡çš„æ•°ç»„ä¸­é”®åä¿æŒä¸€è‡´ã€‚ å¿…é¡» ğŸˆ¶ï¸ä¸€ä¸ªå·¦èŠ±æ‹¬å·{å’Œå³èŠ±æ‹¬å·}ç»„æˆã€‚å ä½ç¬¦çš„åç§° åº”è¯¥ åªç”± A-Zã€a-zã€0-9ã€ä¸‹åˆ’çº¿ _ã€ä»¥åŠè‹±æ–‡çš„å¥å· . ç»„æˆï¼Œå…¶å®ƒå­—ç¬¦ä½œä¸ºå°†æ¥å ä½ç¬¦è§„èŒƒçš„ä¿ç•™ã€‚ æ¯ä¸ªè®°å½•å‡½æ•°éƒ½æ¥å—ä¸€ä¸ªä¸Šä¸‹æ–‡æ•°ç»„å‚æ•°ï¼Œç”¨æ¥è£…è½½å­—ç¬¦ä¸²ç±»å‹æ— æ³•è¡¨ç¤ºçš„ä¿¡æ¯ã€‚å®ƒ å¯ä»¥ è£…è½½ä»»ä½•ä¿¡æ¯ï¼Œæ‰€ä»¥å®ç°è€… å¿…é¡» ç¡®ä¿èƒ½æ­£ç¡®å¤„ç†å…¶è£…è½½çš„ä¿¡æ¯ï¼Œå¯¹äºå…¶è£…è½½çš„æ•°æ®ï¼Œ ä¸€å®šä¸å¯ æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ–äº§ç”ŸPHPå‡ºé”™ã€è­¦å‘Šæˆ–æé†’ä¿¡æ¯ï¼ˆerrorã€warningã€noticeï¼‰ Psr\\Log\\AbstractLogger ç±»ä½¿å¾—åªéœ€ç»§æ‰¿å®ƒå’Œå®ç°å…¶ä¸­çš„ log æ–¹æ³•ï¼Œå°±èƒ½å¤Ÿå¾ˆè½»æ˜“åœ°å®ç° LoggerInterface æ¥å£ï¼Œè€Œå¦å¤–å…«ä¸ªæ–¹æ³•å°±èƒ½å¤ŸæŠŠè®°å½•ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ ç»™å®ƒã€‚ åŒæ ·åœ°ï¼Œä½¿ç”¨ Psr\\Log\\LoggerTrait ä¹Ÿåªéœ€å®ç°å…¶ä¸­çš„ log æ–¹æ³•ã€‚ä¸è¿‡ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œåœ¨ traits å¯å¤ç”¨ä»£ç å—è¿˜ä¸èƒ½å®ç°æ¥å£å‰ï¼Œè¿˜éœ€è¦ implement LoggerInterfaceã€‚ åœ¨æ²¡æœ‰å¯ç”¨çš„æ—¥å¿—è®°å½•å™¨æ—¶ï¼ŒPsr\\Log\\NullLogger æ¥å£ å¯ä»¥ ä¸ºä½¿ç”¨è€…æä¾›ä¸€ä¸ªå¤‡ç”¨çš„æ—¥å¿—ã€Œé»‘æ´ã€ã€‚ä¸è¿‡ï¼Œå½“ä¸Šä¸‹æ–‡çš„æ„å»ºéå¸¸æ¶ˆè€—èµ„æºæ—¶ï¼Œå¸¦æ¡ä»¶æ£€æŸ¥çš„æ—¥å¿—è®°å½•æˆ–è®¸æ˜¯æ›´å¥½çš„åŠæ³•ã€‚ Psr\\Log\\LoggerAwareInterface æ¥å£ä»…åŒ…æ‹¬ä¸€ä¸ª setLogger(LoggerInterface $logger) æ–¹æ³•ï¼Œæ¡†æ¶å¯ä»¥ä½¿ç”¨å®ƒå®ç°è‡ªåŠ¨è¿æ¥ä»»æ„çš„æ—¥å¿—è®°å½•å®ä¾‹ã€‚ Psr\\Log\\LoggerAwareTrait traitå¯å¤ç”¨ä»£ç å—å¯ä»¥åœ¨ä»»ä½•çš„ç±»é‡Œé¢ä½¿ç”¨ï¼Œåªéœ€é€šè¿‡å®ƒæä¾›çš„ `$this-&gt;loggerï¼Œå°±å¯ä»¥è½»æ¾åœ°å®ç°ç­‰åŒçš„æ¥å£ã€‚ Psr\\Log\\LogLevel ç±»è£…è½½äº†å…«ä¸ªè®°å½•ç­‰çº§å¸¸é‡ã€‚ LoggerInterface.php123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113&lt;?phpnamespace Psr\\Log;/** * Describes a logger instance. * * The message MUST be a string or object implementing __toString(). * * The message MAY contain placeholders in the form: &#123;foo&#125; where foo * will be replaced by the context data in key \"foo\". * * The context array can contain arbitrary data. The only assumption that * can be made by implementors is that if an Exception instance is given * to produce a stack trace, it MUST be in a key named \"exception\". * * See https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-3-logger-interface.md * for the full interface specification. */interface LoggerInterface&#123; /** * System is unusable. * * @param string $message * @param array $context * * @return void */ public function emergency($message, array $context = array()); /** * Action must be taken immediately. * * Example: Entire website down, database unavailable, etc. This should * trigger the SMS alerts and wake you up. * * @param string $message * @param array $context * * @return void */ public function alert($message, array $context = array()); /** * Critical conditions. * * Example: Application component unavailable, unexpected exception. * * @param string $message * @param array $context * * @return void */ public function critical($message, array $context = array()); /** * Runtime errors that do not require immediate action but should typically * be logged and monitored. * * @param string $message * @param array $context * * @return void */ public function error($message, array $context = array()); /** * Exceptional occurrences that are not errors. * * Example: Use of deprecated APIs, poor use of an API, undesirable things * that are not necessarily wrong. * * @param string $message * @param array $context * * @return void */ public function warning($message, array $context = array()); /** * Normal but significant events. * * @param string $message * @param array $context * * @return void */ public function notice($message, array $context = array()); /** * Interesting events. * * Example: User logs in, SQL logs. * * @param string $message * @param array $context * * @return void */ public function info($message, array $context = array()); /** * Detailed debug information. * * @param string $message * @param array $context * * @return void */ public function debug($message, array $context = array()); /** * Logs with an arbitrary level. * * @param mixed $level * @param string $message * @param array $context * * @return void */ public function log($level, $message, array $context = array());&#125; å†çœ‹çœ‹AbstractLogger.php123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119&lt;?phpnamespace Psr\\Log;/** * This is a simple Logger implementation that other Loggers can inherit from. * * It simply delegates all log-level-specific methods to the `log` method to * reduce boilerplate code that a simple Logger that does the same thing with * messages regardless of the error level has to implement. */abstract class AbstractLogger implements LoggerInterface&#123; /** * System is unusable. * * @param string $message * @param array $context * * @return void */ public function emergency($message, array $context = array()) &#123; $this-&gt;log(LogLevel::EMERGENCY, $message, $context); &#125; /** * Action must be taken immediately. * * Example: Entire website down, database unavailable, etc. This should * trigger the SMS alerts and wake you up. * * @param string $message * @param array $context * * @return void */ public function alert($message, array $context = array()) &#123; $this-&gt;log(LogLevel::ALERT, $message, $context); &#125; /** * Critical conditions. * * Example: Application component unavailable, unexpected exception. * * @param string $message * @param array $context * * @return void */ public function critical($message, array $context = array()) &#123; $this-&gt;log(LogLevel::CRITICAL, $message, $context); &#125; /** * Runtime errors that do not require immediate action but should typically * be logged and monitored. * * @param string $message * @param array $context * * @return void */ public function error($message, array $context = array()) &#123; $this-&gt;log(LogLevel::ERROR, $message, $context); &#125; /** * Exceptional occurrences that are not errors. * * Example: Use of deprecated APIs, poor use of an API, undesirable things * that are not necessarily wrong. * * @param string $message * @param array $context * * @return void */ public function warning($message, array $context = array()) &#123; $this-&gt;log(LogLevel::WARNING, $message, $context); &#125; /** * Normal but significant events. * * @param string $message * @param array $context * * @return void */ public function notice($message, array $context = array()) &#123; $this-&gt;log(LogLevel::NOTICE, $message, $context); &#125; /** * Interesting events. * * Example: User logs in, SQL logs. * * @param string $message * @param array $context * * @return void */ public function info($message, array $context = array()) &#123; $this-&gt;log(LogLevel::INFO, $message, $context); &#125; /** * Detailed debug information. * * @param string $message * @param array $context * * @return void */ public function debug($message, array $context = array()) &#123; $this-&gt;log(LogLevel::DEBUG, $message, $context); &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬ç»§æ‰¿äº†AbstractLoggerï¼Œåªéœ€è¦å®ç°æˆ‘ä»¬è‡ªå·±çš„logæ–¹æ³•å°±å¯ä»¥äº† PSR-4ï¼ˆè‡ªåŠ¨åŠ è½½è§„èŒƒï¼‰ä¸€ä¸ªå®Œæ•´çš„ç±»åéœ€å…·æœ‰ä»¥ä¸‹ç»“æ„:1\\&lt;å‘½åç©ºé—´&gt;(\\&lt;å­å‘½åç©ºé—´&gt;)*\\&lt;ç±»å&gt; å®Œæ•´çš„ç±»å å¿…é¡» è¦æœ‰ä¸€ä¸ªé¡¶çº§å‘½åç©ºé—´ï¼Œè¢«ç§°ä¸º â€œvendor namespaceâ€ï¼› å®Œæ•´çš„ç±»å å¯ä»¥ æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­å‘½åç©ºé—´ï¼› å®Œæ•´çš„ç±»å å¿…é¡» æœ‰ä¸€ä¸ªæœ€ç»ˆçš„ç±»åï¼› å®Œæ•´çš„ç±»åä¸­ä»»æ„ä¸€éƒ¨åˆ†ä¸­çš„ä¸‹æ»‘çº¿éƒ½æ˜¯æ²¡æœ‰ç‰¹æ®Šå«ä¹‰çš„ï¼› å®Œæ•´çš„ç±»å **å¯ä»¥ ç”±ä»»æ„å¤§å°å†™å­—æ¯ç»„æˆï¼› æ‰€æœ‰ç±»åéƒ½ å¿…é¡» æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ å®Œæ•´çš„ç±»åä¸­ï¼Œå»æ‰æœ€å‰é¢çš„å‘½åç©ºé—´åˆ†éš”ç¬¦ï¼Œå‰é¢è¿ç»­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‘½åç©ºé—´å’Œå­å‘½åç©ºé—´ï¼Œä½œä¸ºã€Œå‘½åç©ºé—´å‰ç¼€ã€ï¼Œå…¶å¿…é¡»ä¸è‡³å°‘ä¸€ä¸ªã€Œæ–‡ä»¶åŸºç›®å½•ã€ç›¸å¯¹åº”ï¼› ç´§æ¥å‘½åç©ºé—´å‰ç¼€åçš„å­å‘½åç©ºé—´ å¿…é¡» ä¸ç›¸åº”çš„ã€Œæ–‡ä»¶åŸºç›®å½•ã€ç›¸åŒ¹é…ï¼Œå…¶ä¸­çš„å‘½åç©ºé—´åˆ†éš”ç¬¦å°†ä½œä¸ºç›®å½•åˆ†éš”ç¬¦ã€‚ æœ«å°¾çš„ç±»å å¿…é¡» ä¸å¯¹åº”çš„ä»¥ .php ä¸ºåç¼€çš„æ–‡ä»¶åŒåã€‚ è‡ªåŠ¨åŠ è½½å™¨ï¼ˆautoloaderï¼‰çš„å®ç° ä¸€å®šä¸å¯ æŠ›å‡ºå¼‚å¸¸ã€ä¸€å®šä¸å¯ è§¦å‘ä»»ä¸€çº§åˆ«çš„é”™è¯¯ä¿¡æ¯ä»¥åŠ ä¸åº”è¯¥ æœ‰è¿”å›å€¼ã€‚ Examples å®Œæ•´ç±»å å‘½åç©ºé—´å‰ç¼€ æ–‡ä»¶åŸºç›®å½• æ–‡ä»¶è·¯å¾„ \\Acme\\Log\\Writer\\File_Writer Acme\\Log\\Writer\\ ./acme-log-writer/lib/ ./acme-log-writer/lib/File_Writer.php \\Aura\\Web\\Response\\Status Aura\\Web /path/to/aura-web/src/ /path/to/aura-web/src/Response/Status.php \\Symfony\\Core\\Request Symfony\\Core ./vendor/Symfony/Core/ ./vendor/Symfony/Core/Request.php \\Zend\\Acl Zend /usr/includes/Zend/ /usr/includes/Zend/Acl.php PSR-6ï¼ˆç¼“å­˜æ¥å£è§„èŒƒï¼‰å®šä¹‰ è°ƒç”¨ç±»åº“ (Calling Library) - è°ƒç”¨è€…ï¼Œä½¿ç”¨ç¼“å­˜æœåŠ¡çš„ç±»åº“ï¼Œè¿™ä¸ªç±»åº“è°ƒç”¨ç¼“å­˜æœåŠ¡ï¼Œè°ƒç”¨çš„ æ˜¯æ­¤ç¼“å­˜æ¥å£è§„èŒƒçš„å…·ä½“ã€Œå®ç°ç±»åº“ã€ï¼Œè°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“ä»»ä½•ã€Œç¼“å­˜æœåŠ¡ã€çš„å…·ä½“å®ç°ã€‚ å®ç°ç±»åº“ (Implementing Library) - æ­¤ç±»åº“æ˜¯å¯¹ã€Œç¼“å­˜æ¥å£è§„èŒƒã€çš„å…·ä½“å®ç°ï¼Œå°è£…èµ·æ¥çš„ç¼“å­˜æœåŠ¡ï¼Œä¾›ã€Œè°ƒç”¨ç±»åº“ã€ä½¿ç”¨ã€‚å®ç°ç±»åº“ å¿…é¡» æä¾› PHP ç±»æ¥å®ç° Cache\\CacheItemPoolInterface å’Œ Cache\\CacheItemInterface æ¥å£ã€‚ å®ç°ç±»åº“ å¿…é¡» æ”¯æŒæœ€å°çš„å¦‚ä¸‹æè¿°çš„ TTL åŠŸèƒ½ï¼Œç§’çº§åˆ«çš„ç²¾å‡†åº¦ã€‚ ç”Ÿå­˜æ—¶é—´å€¼ (TTL - Time To Live) - å®šä¹‰äº†ç¼“å­˜å¯ä»¥å­˜æ´»çš„æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½çš„æ•´æ•°å€¼ã€‚ è¿‡æœŸæ—¶é—´ (Expiration) - å®šä¹‰å‡†ç¡®çš„è¿‡æœŸæ—¶é—´ç‚¹ï¼Œä¸€èˆ¬ä¸ºç¼“å­˜å­˜å‚¨å‘ç”Ÿçš„æ—¶é—´ç‚¹åŠ ä¸Š TTL æ—¶ é—´å€¼ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ª DateTime å¯¹è±¡ã€‚ å‡å¦‚ä¸€ä¸ªç¼“å­˜é¡¹çš„ TTL è®¾ç½®ä¸º 300 ç§’ï¼Œä¿å­˜äº 1:30:00 ï¼Œé‚£ä¹ˆç¼“å­˜é¡¹çš„è¿‡æœŸæ—¶é—´ä¸º 1:35:00ã€‚ å®ç°ç±»åº“ å¯ä»¥ è®©ç¼“å­˜é¡¹æå‰è¿‡æœŸï¼Œä½†æ˜¯ å¿…é¡» åœ¨åˆ°è¾¾è¿‡æœŸæ—¶é—´æ—¶ç«‹å³æŠŠç¼“å­˜é¡¹æ ‡ç¤ºä¸º è¿‡æœŸã€‚å¦‚æœè°ƒç”¨ç±»åº“åœ¨ä¿å­˜ä¸€ä¸ªç¼“å­˜é¡¹çš„æ—¶å€™æœªè®¾ç½®ã€Œè¿‡æœŸæ—¶é—´ã€ã€æˆ–è€…è®¾ç½®äº† null ä½œä¸ºè¿‡æœŸ æ—¶é—´ï¼ˆæˆ–è€… TTL è®¾ç½®ä¸º nullï¼‰ï¼Œå®ç°ç±»åº“ å¯ä»¥ ä½¿ç”¨é»˜è®¤è‡ªè¡Œé…ç½®çš„ä¸€ä¸ªæ—¶é—´ã€‚å¦‚æœæ²¡ æœ‰é»˜è®¤æ—¶é—´ï¼Œå®ç°ç±»åº“ å¿…é¡»æŠŠå­˜å‚¨æ—¶é—´å½“åš æ°¸ä¹…æ€§ å­˜å‚¨ï¼Œæˆ–è€…æŒ‰ç…§åº•å±‚é©±åŠ¨èƒ½æ”¯æŒçš„ æœ€é•¿æ—¶é—´ä½œä¸ºä¿æŒæ—¶é—´ã€‚ é”® (KEY) - é•¿åº¦å¤§äº 1 çš„å­—ä¸²ï¼Œç”¨ä½œç¼“å­˜é¡¹åœ¨ç¼“å­˜ç³»ç»Ÿé‡Œçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å®ç°ç±»åº“ å¿…é¡» æ”¯æŒã€Œé”®ã€è§„åˆ™ A-Z, a-z, 0-9, _, å’Œ . ä»»ä½•é¡ºåºçš„ UTF-8 ç¼–ç ï¼Œé•¿åº¦ å°äº 64 ä½ã€‚å®ç°ç±»åº“ å¯ä»¥ æ”¯æŒæ›´å¤šçš„ç¼–ç æˆ–è€…æ›´é•¿çš„é•¿åº¦ï¼Œä¸è¿‡ å¿…é¡» æ”¯æŒè‡³å°‘ä»¥ä¸ŠæŒ‡å®š çš„ç¼–ç å’Œé•¿åº¦ã€‚å®ç°ç±»åº“å¯è‡ªè¡Œå®ç°å¯¹ã€Œé”®ã€çš„è½¬ä¹‰ï¼Œä½†æ˜¯ å¿…é¡» ä¿è¯èƒ½å¤Ÿæ— æŸçš„è¿”å›ã€Œé”®ã€å­—ä¸²ã€‚ä»¥ä¸‹ çš„å­—ä¸²ä½œä¸ºç³»ç»Ÿä¿ç•™: {}()/\\@:ï¼Œä¸€å®šä¸å¯ ä½œä¸ºã€Œé”®ã€çš„å‘½åæ”¯æŒã€‚ å‘½ä¸­ (Hit) - ä¸€ä¸ªç¼“å­˜çš„å‘½ä¸­ï¼ŒæŒ‡çš„æ˜¯å½“è°ƒç”¨ç±»åº“ä½¿ç”¨ã€Œé”®ã€åœ¨è¯·æ±‚ä¸€ä¸ªç¼“å­˜é¡¹çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜ æ± é‡Œèƒ½æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜é¡¹ï¼Œå¹¶ä¸”æ­¤ç¼“å­˜é¡¹è¿˜æœªè¿‡æœŸï¼Œå¹¶ä¸”æ­¤æ•°æ®ä¸ä¼šå› ä¸ºä»»ä½•åŸå› å‡ºç°é”™è¯¯ã€‚è°ƒç”¨ç±» åº“ åº”è¯¥ ç¡®ä¿å…ˆéªŒè¯ä¸‹ isHit() æœ‰å‘½ä¸­åæ‰è°ƒç”¨ get() è·å–æ•°æ®ã€‚ æœªå‘½ä¸­ (Miss) - ä¸€ä¸ªç¼“å­˜æœªå‘½ä¸­ï¼Œæ˜¯å®Œå…¨çš„ä¸Šé¢æè¿°çš„ã€Œå‘½ä¸­ã€çš„ç›¸åã€‚æŒ‡çš„æ˜¯å½“è°ƒç”¨ç±»åº“ä½¿ç”¨ã€Œé”®ã€åœ¨è¯·æ±‚ä¸€ä¸ªç¼“å­˜é¡¹çš„æ—¶å€™ï¼Œåœ¨ç¼“å­˜æ± é‡Œæœªèƒ½æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜é¡¹ï¼Œæˆ–è€…æ­¤ç¼“å­˜é¡¹å·²ç»è¿‡æœŸï¼Œæˆ–è€…æ­¤æ•°æ®å› ä¸ºä»»ä½•åŸå› å‡ºç°é”™è¯¯ã€‚ä¸€ä¸ªè¿‡æœŸçš„ç¼“å­˜é¡¹ï¼Œå¿…é¡» è¢«å½“åš æœªå‘½ä¸­ æ¥å¯¹å¾…ã€‚ å»¶è¿Ÿ (Deferred) - ä¸€ä¸ªå»¶è¿Ÿçš„ç¼“å­˜ï¼ŒæŒ‡çš„æ˜¯è¿™ä¸ªç¼“å­˜é¡¹å¯èƒ½ä¸ä¼šç«‹åˆ»è¢«å­˜å‚¨åˆ°ç‰©ç†ç¼“å­˜æ± é‡Œã€‚ä¸€ä¸ª ç¼“å­˜æ± å¯¹è±¡ å¯ä»¥ å¯¹ä¸€ä¸ªæŒ‡å®šå»¶è¿Ÿçš„ç¼“å­˜é¡¹è¿›è¡Œå»¶è¿Ÿå­˜å‚¨ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åˆ©ç”¨ä¸€äº›ç¼“å­˜æœåŠ¡å™¨æä¾› çš„æ‰¹é‡æ’å…¥åŠŸèƒ½ã€‚ç¼“å­˜æ±  å¿…é¡» èƒ½å¯¹æ‰€æœ‰å»¶è¿Ÿç¼“å­˜æœ€ç»ˆèƒ½æŒä¹…åŒ–ï¼Œå¹¶ä¸”ä¸ä¼šä¸¢å¤±ã€‚å¯ä»¥ åœ¨è°ƒç”¨ç±»åº“è¿˜æœªå‘èµ·ä¿å­˜è¯·æ±‚ä¹‹å‰å°±åšæŒä¹…åŒ–ã€‚å½“è°ƒç”¨ç±»åº“è°ƒç”¨ commit() æ–¹æ³•æ—¶ï¼Œæ‰€æœ‰çš„å»¶è¿Ÿç¼“å­˜éƒ½ å¿…é¡» åšæŒä¹…åŒ–ã€‚å®ç°ç±»åº“ å¯ä»¥ è‡ªè¡Œå†³å®šä½¿ç”¨ä»€ä¹ˆé€»è¾‘æ¥è§¦å‘æ•°æ®æŒä¹…åŒ–ï¼Œå¦‚å¯¹è±¡çš„ ææ„æ–¹æ³• (destructor) å†…ã€è°ƒç”¨ save() æ—¶æŒä¹…åŒ–ã€å€’è®¡æ—¶ä¿å­˜æˆ–è€…è§¦åŠæœ€å¤§æ•°é‡æ—¶ä¿å­˜ç­‰ã€‚å½“è¯·æ±‚ä¸€ä¸ªå»¶è¿Ÿ ç¼“å­˜é¡¹æ—¶ï¼Œå¿…é¡» è¿”å›ä¸€ä¸ªå»¶è¿Ÿï¼ŒæœªæŒä¹…åŒ–çš„ç¼“å­˜é¡¹å¯¹è±¡ã€‚ æ•°æ® å®ç°ç±»åº“ å¿…é¡» æ”¯æŒæ‰€æœ‰çš„å¯åºåˆ—åŒ–çš„ PHP æ•°æ®ç±»å‹ æ‰€æœ‰å­˜è¿›å®ç°ç±»åº“çš„æ•°æ®ï¼Œéƒ½ å¿…é¡» èƒ½åšåˆ°åŸå°ä¸åŠ¨çš„å–å‡ºã€‚è¿ç±»å‹ä¹Ÿ å¿…é¡» æ˜¯å®Œå…¨ä¸€è‡´ï¼Œå¦‚æœ å­˜è¿›ç¼“å­˜çš„æ˜¯å­—ç¬¦ä¸² 5ï¼Œå–å‡ºæ¥çš„å´æ˜¯æ•´æ•°å€¼ 5 çš„è¯ï¼Œå¯ä»¥ç®—ä½œä¸¥é‡çš„é”™è¯¯ã€‚å®ç°ç±»åº“ å¯ä»¥ ä½¿ç”¨ PHP çš„ã€Œserialize()/unserialize() æ–¹æ³•ã€ä½œä¸ºåº•å±‚å®ç°ï¼Œä¸è¿‡ä¸å¼ºè¿«è¿™æ ·åšã€‚å¯¹äºä»–ä»¬çš„å…¼å®¹æ€§ï¼Œä»¥èƒ½æ”¯æŒæ‰€æœ‰æ•°æ®ç±»å‹ä½œä¸ºåŸºå‡†çº¿ã€‚ å®åœ¨æ— æ³•ã€Œå®Œæ•´å–å‡ºã€å­˜å…¥çš„æ•°æ®çš„è¯ï¼Œå®ç°ç±»åº“ å¿…é¡» æŠŠã€Œç¼“å­˜ä¸¢å¤±ã€æ ‡ç¤ºä½œä¸ºè¿”å›ï¼Œè€Œä¸æ˜¯æŸåäº†çš„æ•°æ®ã€‚ é”™è¯¯å¤„ç† ç¼“å­˜å¯¹åº”ç”¨æ€§èƒ½èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œä½†æ˜¯ï¼Œæ— è®ºåœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œç¼“å­˜ ä¸€å®šä¸å¯ ä½œä¸ºåº”ç”¨ç¨‹åºä¸ å¯æˆ–ç¼ºçš„æ ¸å¿ƒåŠŸèƒ½ã€‚ ç¼“å­˜ç³»ç»Ÿé‡Œçš„é”™è¯¯ ä¸€å®šä¸å¯ å¯¼è‡´åº”ç”¨ç¨‹åºæ•…éšœï¼Œæ‰€ä»¥ï¼Œå®ç°ç±»åº“ ä¸€å®šä¸å¯ æŠ›å‡ºä»»ä½•é™¤äº† æ­¤æ¥å£è§„èŒƒå®šä¹‰çš„ä»¥å¤–çš„å¼‚å¸¸ï¼Œå¹¶ä¸” å¿…é¡» æ•æ‰åŒ…æ‹¬åº•å±‚å­˜å‚¨é©±åŠ¨æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸è®©å…¶å†’æ³¡è‡³è¶… å‡ºç¼“å­˜ç³»ç»Ÿå†…ã€‚ å®ç°ç±»åº“ åº”è¯¥ å¯¹æ­¤ç±»é”™è¯¯è¿›è¡Œè®°å½•ï¼Œæˆ–è€…ä»¥ä»»ä½•å½¢å¼é€šçŸ¥ç®¡ç†å‘˜ã€‚ è°ƒç”¨ç±»åº“å‘èµ·åˆ é™¤ç¼“å­˜é¡¹çš„è¯·æ±‚ï¼Œæˆ–è€…æ¸…ç©ºæ•´ä¸ªç¼“å†²æ± å­çš„è¯·æ±‚ï¼Œã€Œé”®ã€ä¸å­˜åœ¨çš„è¯ å¿…é¡» ä¸èƒ½ å½“æˆæ˜¯æœ‰é”™è¯¯å‘ç”Ÿã€‚åç½®æ¡ä»¶æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå–æ•°æ®æ—¶ï¼Œã€Œé”®ã€ä¸å­˜åœ¨çš„è¯ å¿…é¡» ä¸èƒ½å½“æˆæ˜¯æœ‰é”™è¯¯å‘ç”Ÿ å‚è€ƒèµ„æ–™PHPæ ‡å‡†è§„èŒƒ","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"PSR","slug":"PSR","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PSR/"}]},{"title":"äºŒåç§è®¾è®¡æ¨¡å¼ç®€è¦æ¦‚æ‹¬ä»¥åŠå…¶UMLå›¾ç¤ºä¾‹","date":"2017-02-20T06:24:25.000Z","path":"2017/02/20/äºŒåç§è®¾è®¡æ¨¡å¼ç®€è¦æ¦‚æ‹¬ä»¥åŠå…¶UMLå›¾ç¤ºä¾‹/","text":"å·¥å‚æ¨¡å¼Factoryï¼ˆåˆ›å»ºå‹ï¼‰å·¥å‚ï¼ˆFactoryï¼‰è´Ÿè´£ç»„è£…ç”Ÿäº§äº§å“ï¼Œå®¢æˆ·åªéœ€è¦å‘ŠçŸ¥å·¥å‚éœ€è¦ç”Ÿäº§çš„äº§å“å³å¯è·å¾—äº§å“ã€‚ å»ºé€ è€…æ¨¡å¼ï¼ˆåˆ›å»ºå‹ï¼‰å»ºé€ è€…æ¨¡å¼æ˜¯åœ¨å·¥å‚æ¨¡å¼ä¹‹ä¸Šå»ºç«‹æ›´åŠ å¤æ‚çš„å¯¹è±¡ï¼Œåœ¨å„ä¸ªå·¥å‚ç”Ÿäº§å‡ºäº§å“åå†å°†æ¯ä¸ªäº§å“è¿›è¡Œç»„åˆ å•ä¾‹æ¨¡å¼Singletonï¼ˆåˆ›å»ºå‹ï¼‰å•ä¾‹æ¨¡å¼æ¯”è¾ƒç®€å•ï¼Œä¿è¯å¯¹è±¡æ˜¯å•ä¾‹å³å¯ï¼Œåœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªç±»ä¼¼äºget_instance()çš„æ–¹æ³•è·å–å¯¹è±¡ åŸå‹æ¨¡å¼Prototypeï¼ˆåˆ›å»ºå‹ï¼‰åŸå‹æ¨¡å¼æ˜¯é€šè¿‡cloneçš„æ–¹å¼é‡‡ç”¨åŸå‹ï¼Œå‡å°‘åŠ å·¥æ‰€äº§ç”Ÿçš„èµ„æºæ¶ˆè€—å¯¹åŸå‹è¿›è¡Œcloneæ“ä½œï¼Œå¹¶åœ¨cloneä¹‹åè¿›ä¸€æ­¥å¯¹å…¶è¿›è¡ŒåŠ å·¥ç”Ÿäº§ é€‚é…å™¨æ¨¡å¼Adapterï¼ˆç»“æ„å‹ï¼‰ä¸ºäº†ä¸æ›´æ”¹adapteeä½†åˆæƒ³é€‚é…å„ç§ä¸åŒçš„ç±»è€Œé‡‡ç”¨çš„è®¾è®¡æ¨¡å¼ä¸€ä¸ªæœ‰è¶£çš„ç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­å°±æ˜¯ï¼šåˆ°ä¸åŒçš„å›½å®¶å»æ—…æ¸¸éœ€è¦è´­ä¹°ä¸ä¸€æ ·çš„å……ç”µé€‚é…å™¨æ‰å¯ä»¥å¯¹ä½ çš„è®¾å¤‡è¿›è¡Œå……ç”µ æ¡¥è¿æ¨¡å¼Bridgeï¼ˆç»“æ„å‹ï¼‰ä¸åŒçš„ä¸€ç±»å¯¹è±¡ä¸­æ ¹æ®ä¸åŒçš„å¦ä¸€ç±»å¯¹è±¡å®ç°æ¡¥è¿123$objRAbstraction = new SmallBrushPenRefinedAbstraction(); $objRAbstraction-&gt;setImplementorColor(new oncreteImplementorRed()); $objRAbstraction-&gt;operationDraw(); ç»„åˆæ¨¡å¼Compositeï¼ˆç»“æ„å‹ï¼‰ç»„åˆæ¨¡å¼å°±æ˜¯å°†éœ€è¦è¿›è¡Œæ“ä½œçš„å„ä¸ªç±»æ”¾åˆ°ä¸€ä¸ªæ“ä½œç±»ä¸­ï¼Œæ“ä½œç±»ä½œä¸ºçˆ¶èŠ‚ç‚¹ï¼Œè¢«æ“ä½œçš„ä½œä¸ºå­èŠ‚ç‚¹å½¢æˆæ ‘ç»“æ„ï¼Œæœ€åé€šè¿‡å¾ªç¯ç­‰æ–¹å¼å¯¹å­èŠ‚ç‚¹è¿›è¡Œéå†æ‰§è¡Œæ“ä½œ è£…é¥°å™¨Decoratoræ¨¡å¼ï¼ˆç»“æ„å‹ï¼‰å®¢æˆ·æ“ä½œè£…é¥°å™¨ï¼Œè£…é¥°å™¨å®ä¾‹åŒ–ç»„ä»¶å¹¶ä¸”å¯¹ç»„ä»¶è¿›è¡Œè£…é¥°ï¼Œäº§ç”Ÿè£…é¥°å™¨æ¨¡å¼ å¤–è§‚æ¨¡å¼Facadeï¼ˆç»“æ„å‹ï¼‰ç”±äºç³»ç»Ÿçš„å¢é•¿ç³»ç»Ÿå˜å¾—ååˆ†ä¹‹å¤æ‚ï¼Œå¤šå‡ºè®¸å¤šå°çš„ç±»å‡ºæ¥ï¼Œå®¢æˆ·éœ€è¦ç»„åˆè¿›è¡Œä½¿ç”¨ã€‚è€Œè¿™æ—¶å¯ä»¥åˆ›å»ºä¸€ä¸ªfacadeå…·ä½“å¯¹å­ç±»çš„ç»„åˆæ“ä½œåœ¨facadeä¸­è¿›è¡Œï¼Œå®¢æˆ·åªéœ€è¦è®¤å‡†facadeå³å¯ äº«å…ƒæ¨¡å¼Flyweightï¼ˆç»“æ„å‹ï¼‰ç”±äºéœ€è¦å¤§é‡é‡å¤åˆ›å»ºå¯¹è±¡ï¼Œä¸ºäº†èŠ‚çº¦èµ„æºæˆ‘ä»¬ä½¿ç”¨äº«å…ƒæ± ï¼ˆå³å¯¹è±¡æ± ï¼‰å­˜æ”¾äº«å…ƒï¼Œæé«˜å¯¹è±¡åˆ©ç”¨ç‡åˆ©ç”¨ä¸€ä¸ªäº«å…ƒå·¥å‚æ¥åˆ›å»ºå­˜æ”¾äº«å…ƒï¼Œå®¢æˆ·ç«¯ç›´æ¥é€šè¿‡äº«å…ƒå·¥å‚è·å–äº«å…ƒå¯¹è±¡å¹¶å¹¶ä¸”å·¥å‚å°†äº«å…ƒæ”¾å…¥å·¥å‚çš„äº«å…ƒæ± ä¸­ ä»£ç†æ¨¡å¼Proxyï¼ˆç»“æ„å‹ï¼‰å®¢æˆ·ç›´æ¥æ“ä½œçš„æ˜¯ä»£ç†å¹¶éæ“ä½œå®ç°ç±»ï¼Œä»£ç†ç±»ä¸å®ç°ç±»ç»§æ‰¿åŒä¸€ä¸ªæ¥å£ï¼Œä½†æ˜¯ä»£ç†ç±»é€šè¿‡ä»£ç†çš„æ–¹å¼è°ƒç”¨å®ç°ç±»çš„æ–¹æ³• å‘½ä»¤æ¨¡å¼Commandï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰ä¸€ä¸ªç³»åˆ—æ“ä½œå¯¹åº”ä¸€ä¸ªå‘½ä»¤ç±»ï¼Œå¹¶ä¸”è®¾ç½®ä¸€ä¸ªæ¥å—è€…ï¼Œé€šè¿‡å‘½ä»¤ç±»å»æ“ä½œæ¥å—è€…ã€‚å„ä¸ªå‘½ä»¤ç±»æ”¾åœ¨é¥æ§å™¨ç±»å½“ä¸­è¿›è¡Œå­˜å‚¨å’Œæ“ä½œ è¿­ä»£å™¨æ¨¡å¼Iteratorï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰è¿­ä»£å™¨æ¨¡å¼ååˆ†ä¹‹å®¹æ˜“ç†è§£ï¼Œå°±æ˜¯ä¸“é—¨ç”¨äºè¿­ä»£æ•°ç»„æˆ–å¯¹è±¡çš„åœ¨C++ä¸­æœ‰ä¸“é—¨çš„Iteratorï¼Œè¿™é‡Œçš„è¿­ä»£å™¨æ¨¡å¼ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯ä»¥é€šè¿‡å¾ªç¯ä¾¿åˆ©å‡ºæ‰€æœ‰çš„å…ƒç´  ä¸­ä»‹è€…æ¨¡å¼Mediatorï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…ä¿å­˜å„ä¸ªå¯¹è±¡ä¹‹é—´éœ€è¦ç›¸äº’è”ç³»çš„å…³ç³»ï¼Œè€Œå¯¹è±¡åªéœ€è¦è°ƒç”¨ä¸­ä»‹è€…å³å¯è°ƒç”¨å…¶ä»–å­å¯¹è±¡ï¼Œä»è€Œå‡å°‘å­ç±»çš„ç”Ÿæˆã€‚ è§‚å¯Ÿè€…æ¨¡å¼Observerï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰åœ¨ä¸€ä¸ªå…·ä½“å®ç°ç±»ä¸­å­˜æ”¾è§‚å¯Ÿè€…ï¼Œåœ¨å…·ä½“å®ç°ç±»è¿›è¡Œç±»ä¼¼äºâ€œupdateâ€çš„æ“ä½œçš„æ—¶å€™éå†é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œå¯¹è§‚å¯Ÿè€…è¿›è¡Œnotifyæ“ä½œ çŠ¶æ€æ¨¡å¼Stateï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰æŠŠä¸åŒçŠ¶æ€çš„æ“ä½œåˆ†æ•£åˆ°ä¸åŒçš„çŠ¶æ€å¯¹è±¡é‡Œå»å®Œæˆè¿›è¡Œæ¯ä¸€ç§æ“ä½œæ—¶æ‰¾åˆ°å½“å‰çŠ¶æ€ç±»å¹¶å‘èµ·æ“ä½œï¼Œåœ¨æ“ä½œå®Œæˆåéœ€è¦è½¬æ¢å½“å‰çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¸‹ä¸€æ¬¡æ“ä½œçš„æ˜¯è½¬æ¢åçš„çŠ¶æ€ç±»åœ¨å¤§é‡éœ€è¦ä½¿ç”¨case ifç­‰æ¡ä»¶åˆ¤æ–­è¯­å¥æ—¶ï¼ŒçŠ¶æ€æ¨¡å¼å¯ä»¥å¤§é‡å‡å°‘case ifç­‰è¯­å¥çš„ä½¿ç”¨ ç­–ç•¥æ¨¡å¼Strategyï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰æœ‰ç‚¹ç±»ä¼¼äºçŠ¶æ€æ¨¡å¼ï¼Œæ¯ä¸€ä¸ªç­–ç•¥å¯¹åº”ä¸€ä¸ªç±»ï¼Œå¹¶é€šè¿‡Contextç±»è¿›è¡Œè°ƒç”¨ã€‚ä½†ä¸åŒçš„æ˜¯ä½¿ç”¨è€…éœ€è¦çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ï¼Œå¹¶æ ¹æ®éœ€è¦ä½¿ç”¨ç›¸åº”çš„ç­–ç•¥ æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼Template methodï¼ˆç±»è¡Œä¸ºå‹ï¼‰ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ã€‚å„å­ç±»ä¸­å…¬å…±çš„è¡Œä¸ºåº”è¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ä»¥é¿å…ä»£ç é‡å¤ã€‚é¦–å…ˆè¯†åˆ«ç°æœ‰ä»£ç ä¸­çš„ä¸åŒä¹‹å¤„ï¼Œå¹¶ä¸”å°†ä¸åŒä¹‹å¤„åˆ†ç¦»ä¸ºæ–°çš„æ“ä½œã€‚æœ€åï¼Œç”¨ä¸€ä¸ªè°ƒç”¨è¿™äº›æ–°çš„æ“ä½œçš„æ¨¡æ¿æ–¹æ³•æ¥æ›¿æ¢è¿™äº›ä¸åŒçš„ä»£ç ã€‚æ§åˆ¶å­ç±»æ‰©å±•ã€‚æ¨¡æ¿æ–¹æ³•åªåœ¨ç‰¹å®šç‚¹è°ƒç”¨â€œ hookâ€æ“ä½œ ï¼Œè¿™æ ·å°±åªå…è®¸åœ¨è¿™äº›ç‚¹è¿›è¡Œæ‰©å±•ã€‚é‡ç”¨çˆ¶ç±»ä½œä¸ºæ¨¡æ¿ï¼Œéµä»çˆ¶ç±»å®ç°é€»è¾‘ï¼Œé€šè¿‡é‡å†™æ–¹æ³•å®ç°ç»†èŠ‚æ§åˆ¶ è®¿é—®è€…æ¨¡å¼Visitorï¼ˆå¯¹è±¡è¡Œä¸ºå‹ï¼‰ä¸€ä¸ªå¯¹è±¡ç»“æ„åŒ…å«å¾ˆå¤šç±»å¯¹è±¡ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„æ¥å£ï¼Œè€Œä½ æƒ³å¯¹è¿™äº›å¯¹è±¡å®æ–½ä¸€äº›ä¾èµ–äºå…¶å…·ä½“ç±»çš„æ“ä½œã€‚éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œä½ æƒ³é¿å…è®©è¿™äº›æ“ä½œâ€œæ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ã€‚ Visitorä½¿å¾—ä½ å¯ä»¥å°†ç›¸å…³çš„æ“ä½œé›†ä¸­èµ·æ¥å®šä¹‰åœ¨ä¸€ä¸ªç±»ä¸­ã€‚å½“è¯¥å¯¹è±¡ç»“æ„è¢«å¾ˆå¤šåº”ç”¨å…±äº«æ—¶ï¼Œç”¨Visitoræ¨¡å¼è®©æ¯ä¸ªåº”ç”¨ä»…åŒ…å«éœ€è¦ç”¨åˆ°çš„æ“ä½œã€‚å®šä¹‰å¯¹è±¡ç»“æ„çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚æ”¹å˜å¯¹è±¡ç»“æ„ç±»éœ€è¦é‡å®šä¹‰å¯¹æ‰€æœ‰è®¿é—®è€…çš„æ¥å£ï¼Œè¿™å¯èƒ½éœ€è¦å¾ˆå¤§çš„ä»£ä»·ã€‚å¦‚æœå¯¹è±¡ç»“æ„ç±»ç»å¸¸æ”¹å˜ï¼Œé‚£ä¹ˆå¯èƒ½è¿˜æ˜¯åœ¨è¿™äº›ç±»ä¸­å®šä¹‰è¿™äº›æ“ä½œè¾ƒå¥½ã€‚ å‚è€ƒGofã€Šè®¾è®¡æ¨¡å¼ã€‹ï¼ˆä½œè€…ï¼šguisuï¼‰","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è®¾è®¡æ¨¡å¼/"}]},{"title":"Ubuntu14.04 Dockerå‡çº§ä»¥åŠè®¾ç½®åŠ é€Ÿå™¨ï¼ˆä¸šç•Œè‰¯å¿ƒï¼‰","date":"2017-02-15T06:33:25.000Z","path":"2017/02/15/Ubuntu Dockerå‡çº§ä»¥åŠè®¾ç½®åŠ é€Ÿå™¨ï¼ˆä¸šç•Œè‰¯å¿ƒï¼‰/","text":"ç”±äºUbuntu14.04æºè‡ªå¸¦çš„Dockerç‰ˆæœ¬å¾ˆæ—§ï¼Œå¹¶ä¸”ç”±äºå›½å†…ç¯å¢ƒç‰¹æ®ŠåŸå› åœ¨DockerHubä¸ŠPullé•œåƒååˆ†ä¹‹æ…¢ï¼Œæ•…ä½œæ­¤æ–‡ ä¸‹é¢çœ‹çœ‹å®ç°çš„æ–¹æ³•ï¼Œå…ˆè¯´å‡çº§ï¼š å‡çº§apt-getçš„å®‰è£…æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯é€šè¿‡åŒ…ç®¡ç†çš„æ–¹å¼å®‰è£…äº† é¦–å…ˆæ·»åŠ dockerä»“åº“ç§˜é’¥åˆ°æœ¬åœ°ï¼š1sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 36A1D7869245C8950F966E92D8576A8BA88D21E9 å†å°†dockerä»“åº“æ·»åŠ åˆ°æœ¬åœ°çš„è½¯ä»¶æºä¸­ï¼š1sudo sh -c \"echo deb https://get.docker.io/ubuntu docker main &gt; /etc/apt/sources.list.d/docker.list\" æœ€åæ‰§è¡Œæ›´æ–°ä¸€ä¸‹è½¯ä»¶æº1sudo apt-get update æœ€åå®‰è£…dockerå³å¯ï¼š1sudo apt-get install lxc-docker è®¾ç½®åŠ é€Ÿå™¨ç”±äºå›½å†…ç½‘ç»œåŸå› ï¼Œè¿æ¥docker hubé€Ÿåº¦ç‰¹åˆ«æ…¢ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸‹åœ¨ä½¿ç”¨åŠ é€Ÿå™¨åä¸‹è½½é•œåƒæ—¶é•¿ç”±åŸæ¥çš„å‡ ä¸ªå°æ—¶åˆ°ç°åœ¨çš„å‡ ååˆ†é’Ÿï¼Œå¤§å¤§çš„æå‡äº†ä¸‹è½½é€Ÿåº¦ï¼è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å›½å†…è‰¯å¿ƒå‚å®¶DaoCloudå…è´¹æä¾›çš„åŠ é€Ÿå™¨ æ³¨å†Œé¦–å…ˆè¦åˆ°DaoCloudå…ˆæ³¨å†Œä¸€ä¸ªå¸å·ï¼Œè¿™ä¸ªæ˜¯å®˜ç½‘ä¼ é€é—¨ è®¾ç½®åŠ é€Ÿå™¨12curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://xxxxxx.m.daocloud.ioservice docker restart è¿™é‡Œä¸ªäººçš„åŠ é€Ÿå™¨è¿æ¥éœ€è¦åˆ°å®˜ç½‘å»è·å–ï¼Œè¿™ä¸ªæ˜¯å®˜ç½‘ä¼ é€é—¨è®¾ç½®å®Œæ¯•ï¼Œæå®š~! ä½¿ç”¨è¿™é‡Œè®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹åŠ é€Ÿçš„æ•ˆæœå§1docker pull mysql æ·‹æ¼“å°½è‡´ï¼","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"docker","slug":"docker","permalink":"https://github.com/kong36088/kong36088.github.io/tags/docker/"}]},{"title":"PHP builtin function strlen()å’Œcount()æ—¶é—´å¤æ‚åº¦é˜…è¯»åˆ†æ","date":"2017-01-23T06:00:25.000Z","path":"2017/01/23/PHP builtin function strlen()å’Œcount()æ—¶é—´å¤æ‚åº¦é˜…è¯»åˆ†æ/","text":"ç¿»äº†ä¸‹PHPå†…æ ¸çš„å®šä¹‰ï¼Œå¤§æ¦‚å¿ƒä¸­ä¹Ÿæœ‰äº†ç­”æ¡ˆäº† count()å’Œstrlen()éƒ½æ˜¯O(1)çš„æ—¶é—´å¤æ‚åº¦ è¯•æƒ³ä¸€ä¸‹å¦‚æœstrlen()éœ€è¦O(N)çš„å¤æ‚åº¦é‚£æœªå…ä¹Ÿå¤ªæ…¢äº†ï¼Œå­—ç¬¦ä¸²é•¿åº¦èµ·æ¥çš„è¯æœåŠ¡å™¨ä¸æ˜¯è¦ç›´æ¥æŒ‚æ‰å— è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´çš„åšæ³• æˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹zvalueçš„ç»“æ„ï¼š 1234567891011typedef union _zvalue_value &#123; long lval; /* long value */ double dval; /* double value */ struct &#123; char *val; int len; &#125; str; HashTable *ht; /* hash table value */ zend_object_value obj; zend_ast *ast;&#125; zvalue_value; è¿™é‡Œç”¨çš„æ˜¯ä¸€ä¸ªè”åˆä½“ï¼Œå½“å˜é‡ç±»å‹æ˜¯stringç±»å‹çš„æ—¶å€™é™„åŠ å­˜å‚¨å¤šäº†ä¸€ä¸ªlençš„æ•´å‹å˜é‡ï¼Œæ˜¾è€Œæ˜“è§éœ€è¦å–é•¿åº¦ç›´æ¥åˆ©ç”¨è®°å½•å€¼å°±å¯ä»¥äº†ï¼Œè‡ªç„¶å°±æ˜¯O(1) å¯¹äºcount()å¸¸ç”¨çš„å‚æ•°ç±»å‹åº”è¯¥ä¸ºæ•°ç»„ï¼Œå¯¹äºç»§æ‰¿Countableçš„ç±»æš‚ä¸ä½œè®¨è®º æ•°ç»„å®ç°æ–¹å¼ä¸ºHashtableï¼Œç›´æ¥çœ‹çœ‹ä»–çš„ç»“æ„å§ 1234567891011121314151617typedef struct _hashtable &#123; uint nTableSize; // hash Bucketçš„å¤§å°ï¼Œæœ€å°ä¸º8ï¼Œä»¥2xå¢é•¿ã€‚ uint nTableMask; // nTableSize-1 ï¼Œ ç´¢å¼•å–å€¼çš„ä¼˜åŒ– uint nNumOfElements; // hash Bucketä¸­å½“å‰å­˜åœ¨çš„å…ƒç´ ä¸ªæ•°ï¼Œcount()å‡½æ•°ä¼šç›´æ¥è¿”å›æ­¤å€¼ ulong nNextFreeElement; // ä¸‹ä¸€ä¸ªæ•°å­—ç´¢å¼•çš„ä½ç½® Bucket *pInternalPointer; // å½“å‰éå†çš„æŒ‡é’ˆï¼ˆforeachæ¯”forå¿«çš„åŸå› ä¹‹ä¸€ï¼‰ Bucket *pListHead; // å­˜å‚¨æ•°ç»„å¤´å…ƒç´ æŒ‡é’ˆ Bucket *pListTail; // å­˜å‚¨æ•°ç»„å°¾å…ƒç´ æŒ‡é’ˆ Bucket **arBuckets; // å­˜å‚¨hashæ•°ç»„ dtor_func_t pDestructor; // åœ¨åˆ é™¤å…ƒç´ æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œç”¨äºèµ„æºçš„é‡Šæ”¾ zend_bool persistent; //æŒ‡å‡ºäº†Bucketå†…å­˜åˆ†é…çš„æ–¹å¼ã€‚å¦‚æœpersisientä¸ºTRUEï¼Œåˆ™ä½¿ç”¨æ“ä½œç³»ç»Ÿæœ¬èº«çš„å†…å­˜åˆ†é…å‡½æ•°ä¸ºBucketåˆ†é…å†…å­˜ï¼Œå¦åˆ™ä½¿ç”¨PHPçš„å†…å­˜åˆ†é…å‡½æ•°ã€‚ unsigned char nApplyCount; // æ ‡è®°å½“å‰hash Bucketè¢«é€’å½’è®¿é—®çš„æ¬¡æ•°ï¼ˆé˜²æ­¢å¤šæ¬¡é€’å½’ï¼‰ zend_bool bApplyProtection;// æ ‡è®°å½“å‰hashæ¡¶å…è®¸ä¸å…è®¸å¤šæ¬¡è®¿é—®ï¼Œä¸å…è®¸æ—¶ï¼Œæœ€å¤šåªèƒ½é€’å½’3æ¬¡#if ZEND_DEBUG int inconsistent;#endif&#125; HashTable; countç›´æ¥è·å–nNumOfElementså¤§å°ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯O(1)","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"æºç ","slug":"æºç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æºç /"},{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å†…æ ¸/"}]},{"title":"PHPå†…æ ¸æºç é˜…è¯»ç¬”è®°","date":"2017-01-12T11:15:25.000Z","path":"2017/01/12/PHPå†…æ ¸æºç é˜…è¯»ç¬”è®°/","text":"è¿™ä¸ªå·¥ä½œä¸€ç›´æ‹–å»¶äº†å¾ˆä¹…ï¼Œç»ˆäºæœ‰æ—¶é—´æ‹¿å‡ºæ¥å†™å†™ã€‚æœ¬æ–‡ä¸»è¦æ˜¯æ ¹æ®â€œTIPIæ·±å…¥ç†è§£PHPå†…æ ¸â€ä¸€ä¹¦è¿›è¡Œé˜…è¯»å’Œåˆ†æ ä¸€ã€æ¦‚è¿°å¯ä»¥åˆ©ç”¨è¾…åŠ©çš„å·¥å…·è¿›è¡Œphpä»£ç é˜…è¯»ä¾‹å¦‚vimæˆ–è€…sublimetextï¼Œé‡é‡çº§çš„å¯ä»¥ç”¨eclipseæˆ–è€…phpstormè¿™æ ·çš„å·¥å…·æœ¬äººç”¨çš„æ˜¯phpstormè¿›è¡Œä»£ç é˜…è¯»ï¼ŒCTRL+é¼ æ ‡ç‚¹å‡»å¯ä»¥æ‰¾åˆ°å˜é‡çš„å®šä¹‰ä½ç½®ï¼Œååˆ†ä¹‹æ–¹ä¾¿ PG1234567#ifdef ZTS# define PG(v) TSRMG(core_globals_id, php_core_globals *, v)extern PHPAPI int core_globals_id;#else# define PG(v) (core_globals.v)extern ZEND_API struct _php_core_globals core_globals;#endif PGç”¨äºå®šä¹‰æˆ–è·å–å…¨å±€å˜é‡ZTSæ˜¯çº¿ç¨‹å®‰å…¨çš„æ ‡è®° åœ¨main/php_globalshä¸­å®šä¹‰äº†å®PGå’Œç»“æ„ä½“_php_core_globalsï¼Œç”¨äºå­˜æ”¾ä¸€äº›å¸¸ç”¨åˆ°çš„å…¨å±€å‚æ•°ä¸¾ä¾‹å¦‚ä¸‹ï¼š123456789101112131415struct _php_core_globals &#123; Â·Â·Â·Â·Â·Â·çœç•¥ char *user_ini_filename; // ç”¨æˆ·çš„iniæ–‡ä»¶å long user_ini_cache_ttl; // iniç¼“å­˜è¿‡æœŸé™åˆ¶ char *request_order; // ä¼˜å…ˆçº§æ¯”variables_orderé«˜ï¼Œåœ¨requestå˜é‡ç”Ÿæˆæ—¶ç”¨åˆ°ï¼Œä¸ªäººè§‰å¾—æ˜¯å†å²é—ç•™é—®é¢˜ zend_bool mail_x_header; // ä»…åœ¨ext/standard/mail.cæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œ char *mail_log; zend_bool in_error_log; Â·Â·Â·Â·Â·Â·Â·Â·çœç•¥&#125;; SGæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹SGçš„å®šä¹‰1234567#ifdef ZTS# define SG(v) TSRMG(sapi_globals_id, sapi_globals_struct *, v)SAPI_API extern int sapi_globals_id;#else# define SG(v) (sapi_globals.v)extern SAPI_API sapi_globals_struct sapi_globals;#endif å¦‚åŒPGä¸€æ ·ï¼ŒZTSæ˜¯çº¿ç¨‹å®‰å…¨çš„æ ‡å¿—SGä¸»è¦æ˜¯ç”¨æ¥è·å–SAPIçš„æ‰€éœ€è¦ç”¨åˆ°çš„å…¨å±€å˜é‡çš„ CGCGå®šä¹‰åœ¨Zend/zend_globals_macros.hæ–‡ä»¶ä¸­ æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹CGçš„å®šä¹‰ç›¸å…³ä»£ç ï¼š123456789/* Compiler */#ifdef ZTS# define CG(v) TSRMG(compiler_globals_id, zend_compiler_globals *, v)int zendparse(void *compiler_globals);#else# define CG(v) (compiler_globals.v)extern ZEND_API struct _zend_compiler_globals compiler_globals;int zendparse(void);#endif å¯è§CGæ˜¯ç”¨äºå­˜å–compileréœ€è¦ç”¨åˆ°çš„ä¸€äº›å…¨å±€å˜é‡çš„ EG123456#ifdef ZTS# define EG(v) TSRMG(executor_globals_id, zend_executor_globals *, v)#else# define EG(v) (executor_globals.v)extern ZEND_API zend_executor_globals executor_globals;#endif EGç”¨äºå­˜å–æ‰§è¡Œå™¨éœ€è¦ç”¨åˆ°çš„å…¨å±€å˜é‡(executor_globals) EX1#define EX(element) execute_data.element å…³äºPHPAPIåœ¨æºç ä¸­æˆ‘ä»¬ç»å¸¸èƒ½è§åˆ°PHPAPIè¿™æ ·çš„å‰ç¼€,__attribute__ ((packed)) çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å–æ¶ˆç»“æ„åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¼˜åŒ–å¯¹é½,æŒ‰ç…§å®é™…å ç”¨å­—èŠ‚æ•°è¿›è¡Œå¯¹é½ï¼Œæ˜¯GCCç‰¹æœ‰çš„è¯­æ³•ã€‚è¿™ä¸ªåŠŸèƒ½æ˜¯è·Ÿæ“ä½œç³»ç»Ÿæ²¡å…³ç³»ï¼Œè·Ÿç¼–è¯‘å™¨æœ‰å…³ï¼Œgccç¼–è¯‘å™¨ä¸æ˜¯ç´§å‡‘æ¨¡å¼çš„ï¼Œæˆ‘åœ¨windowsä¸‹ï¼Œç”¨vcçš„ç¼–è¯‘å™¨ä¹Ÿä¸æ˜¯ç´§å‡‘çš„ï¼Œç”¨tcçš„ç¼–è¯‘å™¨å°±æ˜¯ç´§å‡‘çš„ ä»–çš„å®šä¹‰å¦‚ä¸‹ï¼š12345# if defined(__GNUC__) &amp;&amp; __GNUC__ &gt;= 4# define PHPAPI __attribute__ ((visibility(\"default\")))# else# define PHPAPI# endif TSRMåœ¨PHPæºç ä¸­éšå¤„åˆ°å¯ä»¥çœ‹åˆ°TSRMè¿™ä¸ªæ ‡è®° TSRMçº¿ç¨‹å®‰å…¨èµ„æºç®¡ç†å™¨(Thread Safe Resource Manager)ï¼Œè¿™æ˜¯ä¸ªå°å°è¢«å¿½è§†ï¼Œå¹¶å¾ˆå°‘è¢«äººè¯´èµ·çš„â€œå±‚â€(layer), å®ƒåœ¨PHPæºç çš„TSRMç›®å½•ä¸‹ã€‚ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå±‚åªä¼šåœ¨è¢«æŒ‡æ˜éœ€è¦çš„æ—¶å€™æ‰ä¼šè¢«å¯ç”¨(æ¯”å¦‚,Apache2+worker MPM,ä¸€ä¸ªåŸºäºçº¿ç¨‹çš„MPM)ï¼Œå¯¹äºWin32ä¸‹çš„Apacheæ¥è¯´ï¼Œæ˜¯åŸºäºå¤šçº¿ç¨‹çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå±‚åœ¨Win32ä¸‹æ€»æ˜¯è¢«å¯ç”¨çš„ã€‚ ZTSZendçº¿ç¨‹å®‰å…¨(Zend Thread Safety)ï¼Œå½“TSRMè¢«å¯ç”¨çš„æ—¶å€™ï¼Œå°±ä¼šå®šä¹‰è¿™ä¸ªåä¸ºZTSçš„å®ã€‚ tsrm_lsTSRMå­˜å‚¨å™¨(TSRM Local Storage)ï¼Œè¿™ä¸ªæ˜¯åœ¨æ‰©å±•å’ŒZendä¸­çœŸæ­£è¢«å®é™…ä½¿ç”¨çš„æŒ‡ä»£TSRMå­˜å‚¨çš„å˜é‡åã€‚ ç›¸å…³çš„å®šä¹‰å¦‚ä¸‹123456789101112131415#ifdef ZTS#define TSRMLS_D void ***tsrm_ls#define TSRMLS_DC , TSRMLS_D#define TSRMLS_C tsrm_ls#define TSRMLS_CC , TSRMLS_C#else /* non ZTS */#define TSRMLS_D void#define TSRMLS_DC#define TSRMLS_C#define TSRMLS_CC#endif /* ZTS */ æ³¨æ„ä¸Šé¢çš„é€—å· ç›¸å…³åŸç†ä»‹ç»å¯ä»¥çœ‹ä¸€çœ‹PHPå¤§ç‰›é¸Ÿå“¥çš„è¿™ç¯‡æ–‡ç« ï¼šTSRMåˆ°åº•æ˜¯ä»€ä¹ˆ? ç®€å•æ¥è¯´TSRMå°±æ˜¯ç”¨æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨ç¼–å†™ä»£ç çš„æ—¶å€™è¦è®°å¾—åŠ ä¸Š äºŒã€ä»£ç ç”Ÿæˆä»¥åŠæ‰§è¡Œ PHPæ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸå’ŒZENDå¼•æ“PHPçš„å•è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ æ­¥éª¤å¦‚ä¸‹ï¼š å¯åŠ¨ åˆå§‹åŒ–è‹¥å¹²å…¨å±€å˜é‡ åˆå§‹åŒ–è‹¥å¹²å¸¸é‡ åˆå§‹åŒ–Zendå¼•æ“å’Œæ ¸å¿ƒç»„ä»¶ è§£æphp.ini å…¨å±€æ“ä½œå‡½æ•°çš„åˆå§‹åŒ– åˆå§‹åŒ–é™æ€æ„å»ºçš„æ¨¡å—å’Œå…±äº«æ¨¡å—(MINIT) ç¦ç”¨å‡½æ•°å’Œç±» ACTIVATION æ¿€æ´»Zendå¼•æ“ æ¿€æ´»SAPI ç¯å¢ƒåˆå§‹åŒ– æ¨¡å—è¯·æ±‚åˆå§‹åŒ– è¿è¡Œ DEACTIVATION ç»“æŸ flush å…³é—­Zendå¼•æ“ å¤šè¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ å¤šçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ å…³äºZendå¼•æ“Zendå¼•æ“æ˜¯PHPå®ç°çš„æ ¸å¿ƒï¼Œæä¾›äº†è¯­è¨€å®ç°ä¸Šçš„åŸºç¡€è®¾æ–½ã€‚ä¾‹å¦‚ï¼šPHPçš„è¯­æ³•å®ç°ï¼Œè„šæœ¬çš„ç¼–è¯‘è¿è¡Œç¯å¢ƒï¼Œ æ‰©å±•æœºåˆ¶ä»¥åŠå†…å­˜ç®¡ç†ç­‰ï¼Œå½“ç„¶è¿™é‡Œçš„PHPæŒ‡çš„æ˜¯å®˜æ–¹çš„PHPå®ç°(é™¤äº†å®˜æ–¹çš„å®ç°ï¼Œ ç›®å‰æ¯”è¾ƒçŸ¥åçš„æœ‰facebookçš„hiphopå®ç°ï¼Œä¸è¿‡åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒPHPè¿˜æ²¡æœ‰ä¸€ä¸ªæ ‡å‡†çš„è¯­è¨€è§„èŒƒ)ï¼Œ è€ŒPHPåˆ™æä¾›äº†è¯·æ±‚å¤„ç†å’Œå…¶ä»–WebæœåŠ¡å™¨çš„æ¥å£(SAPI)ã€‚ PHPçš„SAPISAPIæä¾›äº†è¯·æ±‚å¤„ç†å’Œå…¶ä»–Web Serverçš„æ¥å£ PHP SAPIç®€å•ç¤ºæ„å›¾ å¯¹åº”æºç æ–‡ä»¶åœ¨/main/SAPI.h æ•´ä¸ªSAPIç±»ä¼¼äºä¸€ä¸ªé¢å‘å¯¹è±¡ä¸­çš„æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„åº”ç”¨ã€‚ SAPI.cå’ŒSAPI.hæ–‡ä»¶æ‰€åŒ…å«çš„ä¸€äº›å‡½æ•°å°±æ˜¯æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸­çš„æŠ½è±¡æ¨¡æ¿ï¼Œ å„ä¸ªæœåŠ¡å™¨å¯¹äºsapi_moduleçš„å®šä¹‰åŠç›¸å…³å®ç°åˆ™æ˜¯ä¸€ä¸ªä¸ªå…·ä½“çš„æ¨¡æ¿ã€‚ _sapi_module_structç»“æ„ä½“çš„å®šä¹‰1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465struct _sapi_module_struct &#123; char *name; // åå­—ï¼ˆæ ‡è¯†ç”¨ï¼‰ char *pretty_name; // æ›´å¥½ç†è§£çš„åå­—ï¼ˆè‡ªå·±ç¿»è¯‘çš„ï¼‰ int (*startup)(struct _sapi_module_struct *sapi_module); // å¯åŠ¨å‡½æ•° int (*shutdown)(struct _sapi_module_struct *sapi_module); // å…³é—­æ–¹æ³• int (*activate)(TSRMLS_D); // æ¿€æ´» int (*deactivate)(TSRMLS_D); // åœç”¨ int (*ub_write)(const char *str, unsigned int str_length TSRMLS_DC); // ä¸ç¼“å­˜çš„å†™æ“ä½œ(unbuffered write) void (*flush)(void *server_context); // flush struct stat *(*get_stat)(TSRMLS_D); // get uid char *(*getenv)(char *name, size_t name_len TSRMLS_DC); // getenv void (*sapi_error)(int type, const char *error_msg, ...); /* error handler */ int (*header_handler)(sapi_header_struct *sapi_header, sapi_header_op_enum op, sapi_headers_struct *sapi_headers TSRMLS_DC); /* header handler */ /* send headers handler */ int (*send_headers)(sapi_headers_struct *sapi_headers TSRMLS_DC); void (*send_header)(sapi_header_struct *sapi_header, void *server_context TSRMLS_DC); /* send header handler */ int (*read_post)(char *buffer, uint count_bytes TSRMLS_DC); /* read POST data */ char *(*read_cookies)(TSRMLS_D); /* read Cookies */ /* register server variables */ void (*register_server_variables)(zval *track_vars_array TSRMLS_DC); void (*log_message)(char *message); /* Log message */ time_t (*get_request_time)(TSRMLS_D); /* Request Time */ void (*terminate_process)(TSRMLS_D); /* Child Terminate */ char *php_ini_path_override; // è¦†ç›–çš„iniè·¯å¾„ void (*block_interruptions)(void); void (*unblock_interruptions)(void); void (*default_post_reader)(TSRMLS_D); void (*treat_data)(int arg, char *str, zval *destArray TSRMLS_DC); char *executable_location; int php_ini_ignore; int php_ini_ignore_cwd; /* don't look for php.ini in the current directory */ int (*get_fd)(int *fd TSRMLS_DC); int (*force_http_10)(TSRMLS_D); int (*get_target_uid)(uid_t * TSRMLS_DC); int (*get_target_gid)(gid_t * TSRMLS_DC); unsigned int (*input_filter)(int arg, char *var, char **val, unsigned int val_len, unsigned int *new_val_len TSRMLS_DC); void (*ini_defaults)(HashTable *configuration_hash); int phpinfo_as_text; char *ini_entries; const zend_function_entry *additional_functions; unsigned int (*input_filter_init)(TSRMLS_D);&#125;; è¿˜æœ‰å­˜æ”¾å…¨å±€å˜é‡çš„ç»“æ„ä½“ï¼š1234567891011121314151617181920typedef struct _sapi_globals_struct &#123; void *server_context; sapi_request_info request_info; sapi_headers_struct sapi_headers; int64_t read_post_bytes; unsigned char post_read; unsigned char headers_sent; struct stat global_stat; char *default_mimetype; char *default_charset; HashTable *rfc1867_uploaded_files; long post_max_size; int options; zend_bool sapi_started; double global_request_time; HashTable known_post_content_types; zval *callback_func; zend_fcall_info_cache fci_cache; zend_bool callback_run;&#125; sapi_globals_struct; åœ¨apacheä¸­SAPIçš„å®šä¹‰123456789static sapi_module_struct apache2_sapi_module = &#123; \"apache2handler\", \"Apache 2.0 Handler\", php_apache2_startup, /* startup */ php_module_shutdown_wrapper, /* shutdown */ ...&#125; PHPè„šæœ¬çš„æ‰§è¡ŒPHPæ˜¯ä¸€è¾¹è¿è¡Œä¸€è¾¹è§£æçš„è„šæœ¬å‹è¯­è¨€ï¼Œåœ¨è§£æçš„è¿‡ç¨‹ä¸­ç”Ÿæˆäº†OPç ï¼Œå‡å°‘æ€§èƒ½çš„æŸè€— åœ¨PHPçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡cliæ–¹å¼æˆ–è€…CGIæ–¹å¼ä¼ é€’ç»™phpç¨‹åºéœ€è¦æ‰§è¡Œçš„æ–‡ä»¶ï¼Œ phpç¨‹åºå®ŒæˆåŸºæœ¬çš„å‡†å¤‡å·¥ä½œåå¯åŠ¨PHPåŠZendå¼•æ“ï¼Œ åŠ è½½æ³¨å†Œçš„æ‰©å±•æ¨¡å—ã€‚åˆå§‹åŒ–å®Œæˆåè¯»å–è„šæœ¬æ–‡ä»¶ï¼ŒZendå¼•æ“å¯¹è„šæœ¬æ–‡ä»¶è¿›è¡Œè¯æ³•åˆ†æï¼Œè¯­æ³•åˆ†æã€‚ç„¶åç¼–è¯‘æˆopcodeæ‰§è¡Œã€‚ å¦‚æœå®‰è£…äº†apcä¹‹ç±»çš„opcodeç¼“å­˜ï¼Œ ç¼–è¯‘ç¯èŠ‚å¯èƒ½ä¼šè¢«è·³è¿‡è€Œç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–opcodeæ‰§è¡Œã€‚ PHPåœ¨è¯»å–åˆ°è„šæœ¬æ–‡ä»¶åé¦–å…ˆå¯¹ä»£ç è¿›è¡Œè¯æ³•åˆ†æï¼ŒPHPçš„è¯æ³•åˆ†æå™¨æ˜¯é€šè¿‡lexç”Ÿæˆçš„ï¼Œ è¯æ³•è§„åˆ™æ–‡ä»¶åœ¨$PHP_SRC/Zend/zend_language_scanner.lï¼Œ è¿™ä¸€é˜¶æ®µlexä¼šä¼šå°†æºä»£ç æŒ‰ç…§è¯æ³•è§„åˆ™åˆ‡åˆ†ä¸€ä¸ªä¸€ä¸ªçš„æ ‡è®°(token)ã€‚PHPä¸­æä¾›äº†ä¸€ä¸ªå‡½æ•°token_get_all()ï¼Œ è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œ è¿”å›ä¸€ä¸ªæŒ‰ç…§è¯æ³•è§„åˆ™åˆ‡åˆ†å¥½çš„æ•°ç»„ã€‚ ä¾‹å¦‚å°†ä¸Šé¢çš„phpä»£ç ä½œä¸ºå‚æ•°ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°ï¼š ä¸¾ä¸ªä¾‹å­ï¼š12345678&lt;?php$code =&lt;&lt;&lt;PHP_CODE&lt;?php$str = \"Hello, Tipi\\n\";echo $str;PHP_CODE; var_dump(token_get_all($code)); è¿è¡Œä¸Šè¿°ä»£ç ï¼Œå³ä»£ç è¢«æŒ‰ç…§æ ‡å‡†åˆ†è¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849array ( 0 =&gt; array ( 0 =&gt; 368, // è„šæœ¬å¼€å§‹æ ‡è®° 1 =&gt; '&lt;?php // åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²', 2 =&gt; 1, ), 1 =&gt; array ( 0 =&gt; 371, 1 =&gt; ' ', 2 =&gt; 2, ), 2 =&gt; '=', 3 =&gt; array ( 0 =&gt; 371, 1 =&gt; ' ', 2 =&gt; 2, ), 4 =&gt; array ( 0 =&gt; 315, 1 =&gt; '\"Hello, Tipi\"', 2 =&gt; 2, ), 5 =&gt; ';', 6 =&gt; array ( 0 =&gt; 371, 1 =&gt; '', 2 =&gt; 3, ), 7 =&gt; array ( 0 =&gt; 316, 1 =&gt; 'echo', 2 =&gt; 4, ), 8 =&gt; array ( 0 =&gt; 371, 1 =&gt; ' ', 2 =&gt; 4, ), 9 =&gt; ';', PHPè„šæœ¬ç¼–è¯‘ä¸ºopcodeä¿å­˜åœ¨op_arrayä¸­ï¼Œå…¶å†…éƒ¨å­˜å‚¨çš„ç»“æ„å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627struct _zend_op_array &#123; /* Common elements */ zend_uchar type; char *function_name; // å¦‚æœæ˜¯ç”¨æˆ·å®šä¹‰çš„å‡½æ•°åˆ™ï¼Œè¿™é‡Œå°†ä¿å­˜å‡½æ•°çš„åå­— zend_class_entry *scope; zend_uint fn_flags; union _zend_function *prototype; zend_uint num_args; zend_uint required_num_args; zend_arg_info *arg_info; zend_bool pass_rest_by_reference; unsigned char return_reference; /* END of common elements */ zend_bool done_pass_two; zend_uint *refcount; zend_op *opcodes; // opcodeæ•°ç»„ zend_uint lastï¼Œsize; zend_compiled_variable *vars; int last_varï¼Œsize_var; // ...&#125; å¦‚ä¸Šé¢çš„æ³¨é‡Šï¼Œopcodesä¿å­˜åœ¨è¿™é‡Œï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ç”±ä¸‹é¢çš„executeå‡½æ•°æ‰§è¡Œï¼š1234ZEND_API void execute(zend_op_array *op_array TSRMLS_DC)&#123; // ... å¾ªç¯æ‰§è¡Œop_arrayä¸­çš„opcodeæˆ–è€…æ‰§è¡Œå…¶ä»–op_arrayä¸­çš„opcode&#125; ä¸‰ã€å˜é‡ä»¥åŠæ•°æ®ç±»å‹ä»ç±»å‹çš„ç»´åº¦æ¥çœ‹ï¼Œç¼–ç¨‹è¯­è¨€å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š é™æ€ç±»å‹è¯­è¨€ï¼Œæ¯”å¦‚ï¼šC/Javaç­‰ï¼Œåœ¨é™æ€è¯­è¨€ç±»å‹ä¸­ï¼Œç±»å‹çš„æ£€æŸ¥æ˜¯åœ¨ç¼–è¯‘æœŸ(compile-time)ç¡®å®šçš„ï¼Œ ä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡Œæ—¶å˜é‡çš„ç±»å‹æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ã€‚ åŠ¨æ€è¯­è¨€ç±»å‹ï¼Œæ¯”å¦‚ï¼šPHPï¼Œpythonç­‰å„ç§è„šæœ¬è¯­è¨€ï¼Œè¿™ç±»è¯­è¨€ä¸­çš„ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ï¼Œ é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ç±»å‹é€šå¸¸å¯ä»¥åœ¨è¿è¡Œæ—¶å‘ç”Ÿå˜åŒ– æ— ç±»å‹è¯­è¨€ï¼Œæ¯”å¦‚ï¼šæ±‡ç¼–è¯­è¨€ï¼Œæ±‡ç¼–è¯­è¨€æ“ä½œçš„æ˜¯åº•å±‚å­˜å‚¨ï¼Œä»–ä»¬å¯¹ç±»å‹æ¯«æ— æ„ŸçŸ¥ã€‚ å˜é‡ç›¸å…³ç»“æ„éƒ½åœ¨Zend/zend.hä¸­å®šä¹‰ å˜é‡ç»“æ„zvalçš„ç»“æ„å¦‚ä¸‹ï¼š1234567struct _zval_struct &#123; /* Variable information */ zvalue_value value; /* value */ zend_uint refcount__gc; zend_uchar type; /* active type */ zend_uchar is_ref__gc;&#125;; å…¶ä¸­refcount__gcæ˜¯ç”¨æ¥è®¡ç®—å˜é‡è¢«å¼•ç”¨çš„æ•°é‡ï¼Œis_ref__gcè®°å½•å˜é‡æ˜¯å¦è¢«å¼•ç”¨è¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯ç”¨æ¥è¾…åŠ©gcå³å†…å­˜å›æ”¶æœºåˆ¶çš„ï¼Œå½“refcountä¸º0çš„æ—¶å€™åˆ™å›æ”¶å†…å­˜ å…¶ä¸­zvalue_value valueç”¨äºå­˜æ”¾å˜é‡çš„å€¼ï¼Œç»“æ„å¦‚ä¸‹ï¼š1234567891011typedef union _zvalue_value &#123; long lval; /* long value */ double dval; /* double value */ struct &#123; char *val; int len; &#125; str; HashTable *ht; /* hash table value */ zend_object_value obj; zend_ast *ast;&#125; zvalue_value; unionæ˜¯å…±ç”¨ä½“å£°æ˜ï¼Œå³å…±äº«ä¸€å—å†…å­˜ï¼Œå–æœ€å¤§é•¿åº¦çš„å€¼ä½œä¸ºæ•´ä¸ªç»“æ„çš„å¤§å°ã€‚è¯¦ç»†ä»‹ç»å¯ä»¥çœ‹è¿™é‡Œï¼šå…±ç”¨å£°æ˜å’Œå…±ç”¨ä¸€å˜é‡å®šä¹‰ ä¸Šè¿°HashTableå°±æ˜¯PHPçš„arrayçš„å®ç° objectçš„ç»“æ„å¦‚ä¸‹ï¼š123456typedef struct _zend_object &#123; zend_class_entry *ce; HashTable *properties; zval **properties_table; HashTable *guards; /* protects from __get/__set ... recursion */&#125; zend_object; å­˜åœ¨çš„é—®é¢˜ PHP5çš„zvalå®šä¹‰æ˜¯éšç€Zend Engine 2è¯ç”Ÿçš„, éšç€æ—¶é—´çš„æ¨ç§», å½“æ—¶è®¾è®¡çš„å±€é™æ€§ä¹Ÿè¶Šæ¥è¶Šæ˜æ˜¾: é¦–å…ˆè¿™ä¸ªç»“æ„ä½“çš„å¤§å°æ˜¯(åœ¨64ä½ç³»ç»Ÿ)24ä¸ªå­—èŠ‚, æˆ‘ä»¬ä»”ç»†çœ‹è¿™ä¸ªzval.valueè”åˆä½“, å…¶ä¸­zend_object_valueæ˜¯æœ€å¤§çš„é•¿æ¿, å®ƒå¯¼è‡´æ•´ä¸ªvalueéœ€è¦16ä¸ªå­—èŠ‚, è¿™ä¸ªåº”è¯¥æ˜¯å¾ˆå®¹æ˜“å¯ä»¥ä¼˜åŒ–æ‰çš„, æ¯”å¦‚æŠŠå®ƒæŒªå‡ºæ¥, ç”¨ä¸ªæŒ‡é’ˆä»£æ›¿,å› ä¸ºæ¯•ç«ŸIS_OBJECTä¹Ÿä¸æ˜¯æœ€æœ€å¸¸ç”¨çš„ç±»å‹. ç¬¬äºŒ, è¿™ä¸ªç»“æ„ä½“çš„æ¯ä¸€ä¸ªå­—æ®µéƒ½æœ‰æ˜ç¡®çš„å«ä¹‰å®šä¹‰, æ²¡æœ‰é¢„ç•™ä»»ä½•çš„è‡ªå®šä¹‰å­—æ®µ, å¯¼è‡´åœ¨PHP5æ—¶ä»£åšå¾ˆå¤šçš„ä¼˜åŒ–çš„æ—¶å€™, éœ€è¦å­˜å‚¨ä¸€äº›å’Œzvalç›¸å…³çš„ä¿¡æ¯çš„æ—¶å€™, ä¸å¾—ä¸é‡‡ç”¨å…¶ä»–ç»“æ„ä½“æ˜ å°„, æˆ–è€…å¤–éƒ¨åŒ…è£…åæ‰“è¡¥ä¸çš„æ–¹å¼æ¥æ‰©å……zval ç¬¬ä¸‰, PHPçš„zvalå¤§éƒ¨åˆ†éƒ½æ˜¯æŒ‰å€¼ä¼ é€’, å†™æ—¶æ‹·è´çš„å€¼, ä½†æ˜¯æœ‰ä¿©ä¸ªä¾‹å¤–, å°±æ˜¯å¯¹è±¡å’Œèµ„æº, ä»–ä»¬æ°¸è¿œéƒ½æ˜¯æŒ‰å¼•ç”¨ä¼ é€’, è¿™æ ·å°±é€ æˆä¸€ä¸ªé—®é¢˜, å¯¹è±¡å’Œèµ„æºåœ¨é™¤äº†zvalä¸­çš„å¼•ç”¨è®¡æ•°ä»¥å¤–, è¿˜éœ€è¦ä¸€ä¸ªå…¨å±€çš„å¼•ç”¨è®¡æ•°, è¿™æ ·æ‰èƒ½ä¿è¯å†…å­˜å¯ä»¥å›æ”¶. æ‰€ä»¥åœ¨PHP5çš„æ—¶ä»£, ä»¥å¯¹è±¡ä¸ºä¾‹, å®ƒæœ‰ä¿©å¥—å¼•ç”¨è®¡æ•°, ä¸€ä¸ªæ˜¯zvalä¸­çš„, å¦å¤–ä¸€ä¸ªæ˜¯objè‡ªèº«çš„è®¡æ•° ç¬¬å››, æˆ‘ä»¬çŸ¥é“PHPä¸­, å¤§é‡çš„è®¡ç®—éƒ½æ˜¯é¢å‘å­—ç¬¦ä¸²çš„, ç„¶è€Œå› ä¸ºå¼•ç”¨è®¡æ•°æ˜¯ä½œç”¨åœ¨zvalçš„, é‚£ä¹ˆå°±ä¼šå¯¼è‡´å¦‚æœè¦æ‹·è´ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„zval, æˆ‘ä»¬åˆ«æ— ä»–æ³•åªèƒ½å¤åˆ¶è¿™ä¸ªå­—ç¬¦ä¸². å½“æˆ‘ä»¬æŠŠä¸€ä¸ªzvalçš„å­—ç¬¦ä¸²ä½œä¸ºkeyæ·»åŠ åˆ°ä¸€ä¸ªæ•°ç»„é‡Œçš„æ—¶å€™, æˆ‘ä»¬åˆ«æ— ä»–æ³•åªèƒ½å¤åˆ¶è¿™ä¸ªå­—ç¬¦ä¸². è™½ç„¶åœ¨PHP5.4çš„æ—¶å€™, æˆ‘ä»¬å¼•å…¥äº†INTERNED STRING, ä½†æ˜¯è¿˜æ˜¯ä¸èƒ½æ ¹æœ¬è§£å†³è¿™ä¸ªé—®é¢˜. ä»¥ä¸Šzvalçš„ç»“æ„æ˜¯åœ¨php5ä¸­çš„å®šä¹‰ï¼Œphp7ä¸­å‘ç”Ÿäº†å˜åŒ–å¹¶ä¸”è¿›è¡Œäº†ä¼˜åŒ–ä»¥ä¸‹æ˜¯php7ä¸­çš„zvalç»“æ„12345678910111213141516171819202122232425262728293031323334353637383940struct _zval_struct &#123; union &#123; zend_long lval; /* long value */ double dval; /* double value */ zend_refcounted *counted; zend_string *str; zend_array *arr;. zend_object *obj; zend_resource *res; zend_reference *ref; zend_ast_ref *ast; zval *zv; void *ptr; zend_class_entry *ce; zend_function *func; struct &#123; uint32_t w1; uint32_t w2; &#125; ww; &#125; value; union &#123; struct &#123; ZEND_ENDIAN_LOHI_4( zend_uchar type, /* active type */ zend_uchar type_flags, zend_uchar const_flags, zend_uchar reserved) /* call info for EX(This) */ &#125; v; uint32_t type_info; &#125; u1; union &#123; uint32_t var_flags; uint32_t next; /* hash collision chain */ uint32_t cache_slot; /* literal cache slot */ uint32_t lineno; /* line number (for ast nodes) */ uint32_t num_args; /* arguments number for EX(This) */ uint32_t fe_pos; /* foreach position */ uint32_t fe_iter_idx; /* foreach iterator index */ &#125; u2;&#125;; è™½ç„¶çœ‹èµ·æ¥å˜å¾—å¥½å¤§, ä½†å…¶å®ä»”ç»†çœ‹, å…¨éƒ¨éƒ½æ˜¯è”åˆä½“, è¿™ä¸ªæ–°çš„zvalåœ¨64ä½ç¯å¢ƒä¸‹,ç°åœ¨åªéœ€è¦16ä¸ªå­—èŠ‚(2ä¸ªæŒ‡é’ˆsize), å®ƒä¸»è¦åˆ†ä¸ºä¿©ä¸ªéƒ¨åˆ†, valueå’Œæ‰©å……å­—æ®µ, è€Œæ‰©å……å­—æ®µåˆåˆ†ä¸ºu1å’Œu2ä¿©ä¸ªéƒ¨åˆ†, å…¶ä¸­u1æ˜¯type info, u2æ˜¯å„ç§è¾…åŠ©å­—æ®µ. æ‰€æœ‰çš„å¤æ‚ç±»å‹çš„å®šä¹‰, å¼€å§‹çš„æ—¶å€™éƒ½æ˜¯zend_refcounted_hç»“æ„, è¿™ä¸ªç»“æ„é‡Œé™¤äº†å¼•ç”¨è®¡æ•°ä»¥å¤–, è¿˜æœ‰GCç›¸å…³çš„ç»“æ„. ä»è€Œåœ¨åšGCå›æ”¶çš„æ—¶å€™, GCä¸éœ€è¦å…³å¿ƒå…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆ, æ‰€æœ‰çš„å®ƒéƒ½å¯ä»¥å½“åšzend_refcounted*ç»“æ„æ¥å¤„ç†. HashTablePHPå¼ºå¤§çš„æ•°ç»„å°±æ˜¯åˆ©ç”¨HashTableå®ç°çš„ å…³äºHashTableçš„å†…å®¹åœ¨æˆ‘çš„åšå®¢ä¹‹å‰ä¹Ÿæœ‰æåŠï¼Œå¯ä»¥å»ç§ä¸€ç§ PHPå†…æ ¸ä¸­çš„HashTable å¸¸é‡å¸¸é‡çš„å®šä¹‰æ”¾åœ¨Zend/zend_constants.hä¸­1234567typedef struct _zend_constant &#123; zval value; int flags; char *name; uint name_len; int module_number;&#125; zend_constant; å®šä¹‰ç»“æ„ååˆ†ä¹‹ç®€å•define()å†…ç½®å‡½æ•°çš„å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829/* &#123;&#123;&#123; proto bool define(string constant_name, mixed value, boolean case_insensitive=false) Define a new constant */ZEND_FUNCTION(define)&#123; if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, \"sz|b\", &amp;name, &amp;name_len, &amp;val, &amp;non_cs) == FAILURE) &#123; return; &#125; ... // ç±»å¸¸é‡å®šä¹‰ æ­¤å¤„ä¸åšä»‹ç» ... // å€¼ç±»å‹åˆ¤æ–­å’Œå¤„ç† c.value = *val; zval_copy_ctor(&amp;c.value); if (val_free) &#123; zval_ptr_dtor(&amp;val_free); &#125; c.flags = case_sensitive; /* non persistent */ c.name = zend_strndup(name, name_len); c.name_len = name_len+1; c.module_number = PHP_USER_CONSTANT; if (zend_register_constant(&amp;c TSRMLS_CC) == SUCCESS) &#123; RETURN_TRUE; &#125; else &#123; RETURN_FALSE; &#125;&#125;/* &#125;&#125;&#125; */ ä¸Šé¢çš„ä»£ç å·²ç»å¯¹å¯¹è±¡å’Œç±»å¸¸é‡åšäº†ç®€åŒ–å¤„ç†ï¼Œ å…¶å®ç°ä¸Šæ˜¯ä¸€ä¸ªå°†ä¼ é€’çš„å‚æ•°ä¼ é€’ç»™æ–°å»ºçš„zend_constantç»“æ„ï¼Œå¹¶å°†è¿™ä¸ªç»“æ„ä½“æ³¨å†Œåˆ°å¸¸é‡åˆ—è¡¨ä¸­çš„è¿‡ç¨‹ã€‚ å…³äºå¤§å°å†™æ•æ„Ÿï¼Œå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦å¤§å°ä¸æ•æ„Ÿï¼Œé»˜è®¤ä¸ºfalseï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰ã€‚ è¿™ä¸ªå‚æ•°æœ€åä¼šèµ‹å€¼ç»™zend_constantç»“æ„ä½“çš„flagså­—æ®µã€‚ é¢„å®šä¹‰å˜é‡åœ¨æŸä¸ªå±€éƒ¨å‡½æ•°ä¸­ä½¿ç”¨ç±»ä¼¼äº$GLOBALSå˜é‡è¿™æ ·çš„é¢„å®šä¹‰å˜é‡ï¼Œ å¦‚æœåœ¨æ­¤å‡½æ•°ä¸­æœ‰æ”¹å˜çš„å®ƒä»¬çš„å€¼çš„è¯ï¼Œè¿™äº›å˜é‡åœ¨å…¶å®ƒå±€éƒ¨å‡½æ•°è°ƒç”¨æ—¶ä¼šå‘ç°ä¹Ÿä¼šåŒæ­¥å˜åŒ–ã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ˜¯å¦æ˜¯è¿™äº›å˜é‡å­˜æ”¾åœ¨ä¸€ä¸ªé›†ä¸­å­˜å‚¨çš„åœ°æ–¹ï¼Ÿ ä»PHPä¸­é—´ä»£ç çš„æ‰§è¡Œæ¥çœ‹ï¼Œè¿™äº›å˜é‡æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹ï¼šEG(symbol_table)ã€‚ åœ¨æ¨¡å—åˆå§‹åŒ–æ—¶ï¼Œ$GLOBALSåœ¨zend_startupå‡½æ•°ä¸­é€šè¿‡è°ƒç”¨zend_register_auto_globalå°†GLOBALSæ³¨å†Œä¸ºé¢„å®šä¹‰å˜é‡ã€‚ $_GETã€$_POSTç­‰åœ¨php_startup_auto_globalså‡½æ•°ä¸­é€šè¿‡zend_register_auto_globalå°†_GETã€_POSTç­‰æ³¨å†Œä¸ºé¢„å®šä¹‰å˜é‡ã€‚ åœ¨é€šè¿‡$è·å–å˜é‡æ—¶ï¼ŒPHPå†…æ ¸éƒ½ä¼šé€šè¿‡è¿™äº›å˜é‡ååŒºåˆ†æ˜¯å¦ä¸ºå…¨å±€å˜é‡ï¼ˆZEND_FETCH_GLOBALï¼‰ï¼Œ å…¶è°ƒç”¨çš„åˆ¤æ–­å‡½æ•°ä¸ºzend_is_auto_globalï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åœ¨ç”Ÿæˆä¸­é—´ä»£ç è¿‡ç¨‹ä¸­å®ç°çš„ã€‚ å¦‚æœæ˜¯ZEND_FETCH_GLOBALæˆ–ZEND_FETCH_GLOBAL_LOCK(globalè¯­å¥åçš„æ•ˆæœ)ï¼Œ åˆ™åœ¨è·å–è·å–å˜é‡è¡¨æ—¶(zend_get_target_symbol_table)ï¼Œ ç›´æ¥è¿”å›EG(symbol_table)ã€‚åˆ™è¿™äº›å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šåœ¨å…¨å±€å˜é‡è¡¨è¿›è¡Œã€‚ ç±»å‹æç¤ºå®ç° å˜é‡ä½œç”¨åŸŸå¯¹äºå…¨å±€å˜é‡ï¼ŒZendå¼•æ“æœ‰ä¸€ä¸ª_zend_executor_globalsç»“æ„ï¼ˆEGï¼‰ï¼Œè¯¥ç»“æ„ä¸­çš„symbol_tableå°±æ˜¯å…¨å±€ç¬¦å·è¡¨ï¼Œ å…¶ä¸­ä¿å­˜äº†åœ¨é¡¶å±‚ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚åŒæ ·ï¼Œå‡½æ•°æˆ–è€…å¯¹è±¡çš„æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶ä¼šåˆ›å»ºactive_symbol_tableæ¥ä¿å­˜å±€éƒ¨å˜é‡ã€‚ å½“ç¨‹åºåœ¨é¡¶å±‚ä¸­ä½¿ç”¨æŸä¸ªå˜é‡æ—¶ï¼ŒZend Engineå°±ä¼šåœ¨symbol_tableä¸­è¿›è¡Œéå†ï¼Œ åŒç†ï¼Œå¦‚æœç¨‹åºè¿è¡ŒäºæŸä¸ªå‡½æ•°ä¸­ï¼ŒZendå¼•æ“ä¼šéå†æŸ¥è¯¢ä¸å…¶å¯¹åº”çš„active_symbol_tableï¼Œ è€Œæ¯ä¸ªå‡½æ•°çš„active_symbol_tableæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œç”±æ­¤è€Œå®ç°çš„ä½œç”¨åŸŸçš„ç‹¬ç«‹ã€‚ 1234567891011121314151617181920struct _zend_execute_data &#123; struct _zend_op *opline; zend_function_state function_state; zend_function *fbc; /* Function Being Called */ zend_class_entry *called_scope; zend_op_array *op_array; zval *object; union _temp_variable *Ts; zval ***CVs; HashTable *symbol_table; struct _zend_execute_data *prev_execute_data; zval *old_error_reporting; zend_bool nested; zval **original_return_value; zend_class_entry *current_scope; zend_class_entry *current_called_scope; zval *current_this; zval *current_object; struct _zend_op *call_opline;&#125;; å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡å°±å­˜å‚¨åœ¨_zend_execute_dataçš„symbol_tableä¸­ï¼Œåœ¨æ‰§è¡Œå½“å‰å‡½æ•°çš„op_arrayæ—¶ï¼Œ å…¨å±€zend_executor_globalsä¸­çš„*active_symbol_tableä¼šæŒ‡å‘å½“å‰_zend_execute_dataä¸­çš„*symbol_tableã€‚ å› ä¸ºæ¯ä¸ªå‡½æ•°è°ƒç”¨å¼€å§‹æ—¶éƒ½ä¼šé‡æ–°åˆå§‹åŒ–EG(active_symbol_table)ä¸ºNULLï¼Œ åœ¨è¿™ä¸ªå‡½æ•°çš„æ‰€æœ‰opcodeçš„æ‰§è¡Œè¿‡ç¨‹ä¸­è¿™ä¸ªå…¨å±€å˜é‡ä¼šä¸€ç›´å­˜åœ¨ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å±€éƒ¨å˜é‡ä¿®æ”¹éƒ½æ˜¯åœ¨å®ƒä¸Šé¢æ“ä½œå®Œæˆçš„ï¼Œå¦‚å‰é¢çš„èµ‹å€¼æ“ä½œç­‰ã€‚ è€Œæ­¤æ—¶ï¼Œå…¶ä»–å‡½æ•°ä¸­çš„symbol_tableä¼šå­˜æ”¾åœ¨æ ˆä¸­ï¼Œå°†å½“å‰å‡½æ•°æ‰§è¡Œå®Œå¹¶è¿”å›æ—¶ï¼Œç¨‹åºä¼šå°†ä¹‹å‰ä¿å­˜çš„zend_execute_dataæ¢å¤ï¼Œ ä»è€Œå…¶ä»–å‡½æ•°ä¸­çš„å˜é‡ä¹Ÿå°±ä¸ä¼šè¢«æ‰¾åˆ°ï¼Œå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸå°±æ˜¯ä»¥è¿™ç§æ–¹å¼æ¥å®ç°çš„ã€‚ ç±»å‹è½¬æ¢å¯ä»¥å‚ç…§æ–‡ä»¶ext/standard/type.cï¼Œé‡Œé¢åŒ…å«äº†ç±»å‹è½¬æ¢éœ€è¦ç”¨åˆ°çš„å‡½æ•° PHPçš„æ ‡å‡†æ‰©å±•ä¸­æä¾›äº†ä¸¤ä¸ªæœ‰ç”¨çš„æ–¹æ³•settype()ä»¥åŠgettype()æ–¹æ³•ï¼Œå‰è€…å¯ä»¥åŠ¨æ€çš„æ”¹å˜å˜é‡çš„æ•°æ®ç±»å‹ï¼Œ gettype()æ–¹æ³•åˆ™æ˜¯è¿”å›å˜é‡çš„æ•°æ®ç±»å‹ å››ã€å‡½æ•°çš„å®ç°PHPå‡½æ•°åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š ç”¨æˆ·å®šä¹‰çš„å‡½æ•° å†…éƒ¨å‡½æ•°ï¼šå¦‚æˆ‘ä»¬å¸¸è§çš„countã€strposã€implodeç­‰å‡½æ•°ï¼Œè¿™äº›éƒ½æ˜¯æ ‡å‡†å‡½æ•°ï¼Œå®ƒä»¬éƒ½æ˜¯ç”±æ ‡å‡†æ‰©å±•æä¾›çš„ï¼› å¦‚æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„issetã€emptyã€evalç­‰å‡½æ•°ï¼Œè¿™äº›ç»“æ„è¢«ç§°ä¹‹ä¸ºè¯­è¨€ç»“æ„ã€‚ è¿˜æœ‰ä¸€äº›å‡½æ•°éœ€è¦å’Œç‰¹å®šçš„PHPæ‰©å±•æ¨¡å—ä¸€èµ·ç¼–è¯‘å¹¶å¼€å¯ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯æœ‰äº›æ‰©å±•æ˜¯å¯é€‰çš„ã€‚ åŒ¿åå‡½æ•°ï¼šClosure å˜é‡å‡½æ•°ï¼š 12$func = 'print_r';$func('i am print_r function.'); zend_functionå¯ä»¥ä¸zend_op_arrayäº’æ¢ zend_functionå¯ä»¥ä¸zend_internal_functionäº’æ¢ ä½†æ˜¯ä¸€ä¸ªzend_op_arrayç»“æ„è½¬æ¢æˆzend_functionæ˜¯ä¸èƒ½å†æ¬¡è½¬å˜æˆzend_internal_functionç»“æ„çš„ï¼Œåä¹‹äº¦ç„¶ã€‚å…¶å®zend_functionå°±æ˜¯ä¸€ä¸ªæ··åˆçš„æ•°æ®ç»“æ„ï¼Œè¿™ç§ç»“æ„åœ¨ä¸€å®šç¨‹åºä¸ŠèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚ å‡½æ•°çš„ç»“æ„ä½“åŒ…å«ä¸€äº›å…¬å…±çš„å…ƒç´ ï¼Œå³Common elementsï¼Œæ‰€ä»¥å®ƒä»¬ä¹‹é—´å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿åœ°å®ç°è½¬æ¢ å‡½æ•°å®šä¹‰è¯æ³•åˆ†æ-&gt;è¯­æ³•åˆ†æ-&gt;ç”Ÿæˆä¸­é—´ä»£ç (zend_op)-&gt;æ‰§è¡Œä¸­é—´ä»£ç æ‰§è¡Œä»£ç çš„è¿‡ç¨‹åœ¨æ–‡ä»¶Zend/zend_vm_execute.h å…¶ä¸­zend_opçš„å®šä¹‰å¦‚ä¸‹ï¼š123456789101112struct _zend_op &#123; opcode_handler_t handler; znode_op op1; znode_op op2; znode_op result; ulong extended_value; uint lineno; zend_uchar opcode; zend_uchar op1_type; zend_uchar op2_type; zend_uchar result_type;&#125;; å‡½æ•°çš„å‚æ•°å‡½æ•°çš„å‚æ•°å­˜æ”¾åœ¨zend_arg_infoä¸­ï¼Œå…¶å®šä¹‰æ”¾åœ¨æ–‡ä»¶Zend/zend.compile.hä¸­ 1234567891011typedef struct _zend_arg_info &#123; const char *name; /* å‚æ•°çš„åç§°*/ zend_uint name_len; /* å‚æ•°åç§°çš„é•¿åº¦*/ const char *class_name; /* ç±»å */ zend_uint class_name_len; /* ç±»åé•¿åº¦*/ zend_bool array_type_hint; /* æ•°ç»„ç±»å‹æç¤º */ zend_bool allow_null; /* æ˜¯å¦å…è®¸ä¸ºNULL */ zend_bool pass_by_reference; /* æ˜¯å¦å¼•ç”¨ä¼ é€’ */ zend_bool return_reference; int required_num_args; &#125; zend_arg_info; å‡½æ•°çš„è¿”å›å€¼åœ¨PHPä¸­ï¼Œå‡½æ•°éƒ½æœ‰è¿”å›å€¼ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼Œä½¿ç”¨returnè¯­å¥æ˜ç¡®çš„è¿”å›å’Œæ²¡æœ‰returnè¯­å¥è¿”å›NULLã€‚ å‡½æ•°ç»“æŸæ—¶éœ€è¦è°ƒç”¨zend_do_returnï¼š12345678910111213141516171819202122232425262728293031void zend_do_return(znode *expr, int do_end_vparse TSRMLS_DC) /* &#123;&#123;&#123; */&#123; zend_op *opline; int start_op_number, end_op_number; if (do_end_vparse) &#123; if (CG(active_op_array)-&gt;return_reference &amp;&amp; !zend_is_function_or_method_call(expr)) &#123; zend_do_end_variable_parse(expr, BP_VAR_W, 0 TSRMLS_CC);/* å¤„ç†è¿”å›å¼•ç”¨ */ &#125; else &#123; zend_do_end_variable_parse(expr, BP_VAR_R, 0 TSRMLS_CC);/* å¤„ç†å¸¸è§„å˜é‡è¿”å› */ &#125; &#125; ...// çœç•¥ å–å…¶å®ƒä¸­é—´ä»£ç æ“ä½œ opline-&gt;opcode = ZEND_RETURN; if (expr) &#123; opline-&gt;op1 = *expr; if (do_end_vparse &amp;&amp; zend_is_function_or_method_call(expr)) &#123; opline-&gt;extended_value = ZEND_RETURNS_FUNCTION; &#125; &#125; else &#123; opline-&gt;op1.op_type = IS_CONST; INIT_ZVAL(opline-&gt;op1.u.constant); &#125; SET_UNUSED(opline-&gt;op2);&#125; å¯è§ç”Ÿæˆçš„ä¸­é—´ä»£ç ä¸ºZEND_RETURN ZEND_RETURNä¸­é—´ä»£ç ä¼šæ‰§è¡Œ ZEND_RETURN_SPEC_CONST_HANDLERï¼Œ ZEND_RETURN_SPEC_TMP_HANDLERæˆ–ZEND_RETURN_SPEC_TMP_HANDLERã€‚ è¿™ä¸‰ä¸ªå‡½æ•°çš„æ‰§è¡Œæµç¨‹åŸºæœ¬ç±»ä¼¼ï¼ŒåŒ…æ‹¬å¯¹ä¸€äº›é”™è¯¯çš„å¤„ç†ã€‚ è¿™é‡Œæˆ‘ä»¬çœ‹çœ‹ZEND_RETURN_SPEC_CONST_HANDLERæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778static int ZEND_FASTCALL ZEND_RETURN_SPEC_CONST_HANDLER(ZEND_OPCODE_HANDLER_ARGS)&#123; zend_op *opline = EX(opline); zval *retval_ptr; zval **retval_ptr_ptr; if (EG(active_op_array)-&gt;return_reference == ZEND_RETURN_REF) &#123; // è¿”å›å¼•ç”¨æ—¶ä¸å…è®¸å¸¸é‡å’Œä¸´æ—¶å˜é‡ if (IS_CONST == IS_CONST || IS_CONST == IS_TMP_VAR) &#123; /* Not supposed to happen, but we'll allow it */ zend_error(E_NOTICE, \"Only variable references \\ should be returned by reference\"); goto return_by_value; &#125; retval_ptr_ptr = NULL; // è¿”å›å€¼ if (IS_CONST == IS_VAR &amp;&amp; !retval_ptr_ptr) &#123; zend_error_noreturn(E_ERROR, \"Cannot return string offsets by reference\"); &#125; if (IS_CONST == IS_VAR &amp;&amp; !Z_ISREF_PP(retval_ptr_ptr)) &#123; if (opline-&gt;extended_value == ZEND_RETURNS_FUNCTION &amp;&amp; EX_T(opline-&gt;op1.u.var).var.fcall_returned_reference) &#123; &#125; else if (EX_T(opline-&gt;op1.u.var).var.ptr_ptr == &amp;EX_T(opline-&gt;op1.u.var).var.ptr) &#123; if (IS_CONST == IS_VAR &amp;&amp; !0) &#123; /* undo the effect of get_zval_ptr_ptr() */ PZVAL_LOCK(*retval_ptr_ptr); &#125; zend_error(E_NOTICE, \"Only variable references \\ should be returned by reference\"); goto return_by_value; &#125; &#125; if (EG(return_value_ptr_ptr)) &#123; // è¿”å›å¼•ç”¨ SEPARATE_ZVAL_TO_MAKE_IS_REF(retval_ptr_ptr); // is_ref__gcè®¾ç½®ä¸º1 Z_ADDREF_PP(retval_ptr_ptr); // refcount__gcè®¡æ•°åŠ 1 (*EG(return_value_ptr_ptr)) = (*retval_ptr_ptr); &#125; &#125; else &#123;return_by_value: retval_ptr = &amp;opline-&gt;op1.u.constant; if (!EG(return_value_ptr_ptr)) &#123; if (IS_CONST == IS_TMP_VAR) &#123; &#125; &#125; else if (!0) &#123; /* Not a temp var */ if (IS_CONST == IS_CONST || EG(active_op_array)-&gt;return_reference == ZEND_RETURN_REF || (PZVAL_IS_REF(retval_ptr) &amp;&amp; Z_REFCOUNT_P(retval_ptr) &gt; 0)) &#123; zval *ret; ALLOC_ZVAL(ret); INIT_PZVAL_COPY(ret, retval_ptr); // å¤åˆ¶ä¸€ä»½ç»™è¿”å›å€¼ zval_copy_ctor(ret); *EG(return_value_ptr_ptr) = ret; &#125; else &#123; *EG(return_value_ptr_ptr) = retval_ptr; // ç›´æ¥èµ‹å€¼ Z_ADDREF_P(retval_ptr); &#125; &#125; else &#123; zval *ret; ALLOC_ZVAL(ret); INIT_PZVAL_COPY(ret, retval_ptr); // å¤åˆ¶ä¸€ä»½ç»™è¿”å›å€¼ *EG(return_value_ptr_ptr) = ret; &#125; &#125; return zend_leave_helper_SPEC(ZEND_OPCODE_HANDLER_ARGS_PASSTHRU); // è¿”å›å‰æ‰§è¡Œæ”¶å°¾å·¥ä½œ&#125; åœ¨æ²¡æœ‰å£°æ˜è¿”å›å€¼æ—¶ï¼š1zend_do_return(NULL, 0 TSRMLS_CC); zendå¼•æ“â€œè‡ªåŠ¨â€è¿”å›ä¸€ä¸ªNULL å‡½æ•°çš„è°ƒç”¨ä¸æ‰§è¡Œå‡½æ•°çš„è°ƒç”¨Zendåœ¨è°ƒç”¨æ‰§è¡ŒPHPä»£ç ä¹‹å‰å…ˆè¦æŠŠä»£ç è½¬æ¢ä¸ºopcodeï¼Œç„¶åå†è¿›è¡Œæ‰§è¡Œã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªPHPå®ä¾‹ä»¥åŠå…¶ç”Ÿæˆçš„opcode123456&lt;?php function foo()&#123; echo \"I'm foo!\"; &#125; foo();?&gt; 123456789101112function name: (null)line # * op fetch ext return operands--------------------------------------------------------------------------------- DO_FCALL 0 'foo' NOP &gt; RETURN 1 function name: fooline # * op fetch ext return operands--------------------------------------------------------------------------------- 4 0 &gt; ECHO 'I%27m+foo%21' 5 1 &gt; RETURN å¯ä»¥çœ‹åˆ°ï¼Œä¸Šéƒ¨ä¸»è¦é›†ä¸­åœ¨è°ƒç”¨å‡½æ•°fooä¸Šé¢ï¼ŒPHPå¯¹å‡½æ•°åç»Ÿä¸€é‡‡ç”¨strtoloweræ“ä½œï¼Œæ‰€ä»¥å¯¹å¤§å°å†™æ˜¯ä¸æ•æ„Ÿçš„Zend Engineä¼šåœ¨function_tableä¸­æ ¹æ®å‡½æ•°åï¼Œè‹¥æ‰¾ä¸åˆ°ï¼Œåˆ™æŠ›å‡ºé”™è¯¯æç¤ºï¼›è‹¥æ‰¾åˆ°è¯¥åï¼Œåˆ™è¿”å›å‡½æ•°zend_functionçš„ç»“æ„æŒ‡é’ˆï¼Œç„¶åé€šè¿‡function.typeçš„å€¼æ¥åˆ¤æ–­å‡½æ•°æ˜¯å†…éƒ¨å‡½æ•°è¿˜æ˜¯ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œè°ƒç”¨zend_execute_internalï¼ˆzend_internal_function.handlerï¼‰æˆ–è€…ç›´æ¥ è°ƒç”¨zend_executeæ¥æ‰§è¡Œè¿™ä¸ªå‡½æ•°åŒ…å«çš„zend_op_array å‡½æ•°çš„æ‰§è¡Œå†…éƒ¨å‡½æ•°çš„æ‰§è¡Œä¸ç”¨æˆ·å‡½æ•°ä¸åŒã€‚ç”¨æˆ·å‡½æ•°æ˜¯phpè¯­å¥ä¸€æ¡æ¡â€œç¿»è¯‘â€æˆop_lineç»„æˆçš„ä¸€ä¸ªop_arrayï¼Œè€Œå†…éƒ¨å‡½æ•°åˆ™æ˜¯ç”¨Cæ¥å®ç°çš„ï¼Œå› ä¸ºæ‰§è¡Œç¯å¢ƒä¹Ÿæ˜¯Cç¯å¢ƒï¼Œ æ‰€ä»¥å¯ä»¥ç›´æ¥è°ƒç”¨ çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š1234&lt;?php $foo = 'test'; print_r($foo);?&gt; å…¶å¯¹åº”çš„opcode123456line # * op fetch ext return operands--------------------------------------------------------------------------------- 2 0 &gt; ASSIGN !0, 'test' 3 1 SEND_VAR !0 2 DO_FCALL 1 'print_r' 4 3 &gt; RETURN 1 å…ˆå°†EGä¸‹çš„Thisï¼Œscopeç­‰æš‚æ—¶ç¼“å­˜èµ·æ¥ï¼ˆè¿™äº›åœ¨åé¢ä¼šéƒ½æ¢å¤åˆ°æ­¤æ—¶ç¼“å­˜çš„æ•°æ®ï¼‰ã€‚åœ¨æ­¤ä¹‹åï¼Œå¯¹äºç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œ ç¨‹åºä¼šä¾æ®zend_executeæ˜¯å¦ç­‰äºexecuteå¹¶ä¸”æ˜¯å¦ä¸ºå¼‚å¸¸æ¥åˆ¤æ–­æ˜¯è¿”å›ï¼Œè¿˜æ˜¯ç›´æ¥æ‰§è¡Œå‡½æ•°å®šä¹‰çš„op_arrayï¼š 123456if (zend_execute == execute &amp;&amp; !EG(exception)) &#123; EX(call_opline) = opline; ZEND_VM_ENTER();&#125; else &#123; zend_execute(EG(active_op_array) TSRMLS_CC);&#125; è€Œåœ¨Zend/zend.cæ–‡ä»¶çš„zend_startupå‡½æ•°ä¸­ï¼Œå·²å°†zend_executeèµ‹å€¼ä¸ºï¼š1ret = EX(opline)-&gt;handler(execute_data TSRMLS_CC) è°ƒç”¨æ¯ä¸ªopcodeçš„å¤„ç†å‡½æ•°ã€‚è€Œexecute_dataåœ¨executeå‡½æ•°å¼€å§‹æ—¶å°±å·²ç»ç»™å…¶åˆ†é…äº†ç©ºé—´ï¼Œè¿™å°±æ˜¯è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒã€‚ åŒ¿åå‡½æ•°PHPåŒ¿åå‡½æ•°çš„å®ç°ä¸»è¦æœ‰ï¼šcreate_function()å‡½æ•°çš„ä½¿ç”¨ã€__invokeã€é—­åŒ… create_functionå…ˆä»‹ç»ä¸€ä¸‹create_function() create_function()å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•° çœ‹çœ‹å®˜æ–¹æ‰‹å†Œä¸Šå…³äºcreate_functionçš„ä»‹ç»ï¼š string create_function ( string $args , string $code )create_function â€” Create an anonymous (lambda-style) functionè¯¥å‡½æ•°ä¸»è¦å°±æ˜¯ç”¨äºåˆ›å»ºåŒ¿åå‡½æ•°ç”¨çš„ æˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹ä¸€ä¸ªä¾‹å­123456789&lt;?php$func = create_function('', 'echo \"Function created dynamic\";');echo $func; // lambda_1 $func(); // Function created dynamic $my_func = 'lambda_1';$my_func(); // ä¸å­˜åœ¨è¿™ä¸ªå‡½æ•°lambda_1(); // ä¸å­˜åœ¨è¿™ä¸ªå‡½æ•° ä»ä¸Šé¢ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°å…¶å®ä»–æ˜¯â€œæœ‰åâ€çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿™é‡Œä¼šæç¤ºæ‰¾ä¸åˆ°å‡½æ•°å‘¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹debug_zval_dumpçš„ç»“æœ123456&lt;?php$func = create_function('', 'echo \"Hello\";'); $my_func_name = 'lambda_1';debug_zval_dump($func); // string(9) \"lambda_1\" refcount(2)debug_zval_dump($my_func_name); // string(8) \"lambda_1\" refcount(2) å¯è§åŒ¿åå‡½æ•°çš„é•¿åº¦æ˜¯9è€Œå®é™…ä¸Šlambda_1çš„é•¿åº¦åªæœ‰8 12345678910111213#define LAMBDA_TEMP_FUNCNAME \"__lambda_func\" ZEND_FUNCTION(create_function)&#123; // ... çœå»æ— å…³ä»£ç  function_name = (char *) emalloc(sizeof(\"0lambda_\")+MAX_LENGTH_OF_LONG); function_name[0] = '\\0'; // &lt;--- è¿™é‡Œ do &#123; function_name_length = 1 + sprintf(function_name + 1, \"lambda_%d\", ++EG(lambda_count)); &#125; while (zend_hash_add(EG(function_table), function_name, function_name_length+1, &amp;new_function, sizeof(zend_function), NULL)==FAILURE); zend_hash_del(EG(function_table), LAMBDA_TEMP_FUNCNAME, sizeof(LAMBDA_TEMP_FUNCNAME)); RETURN_STRINGL(function_name, function_name_length, 0);&#125; å¯ä»¥è§åˆ°å‡½æ•°åœ¨åå­—çš„å‰é¢å¤šåŠ äº†ä¸€ä¸ª&#39;\\0&#39;çš„ç©ºå­—ç¬¦ï¼Œå¹¶ä¸”åˆ©ç”¨countæ¥è¿›è¡Œå‡½æ•°åçš„ç¼–å·æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å‡½æ•°åå‰åŠ ä¸€ä¸ªâ€œç©ºå­—ç¬¦â€æ¥è°ƒç”¨åŒ¿åå‡½æ•°ï¼š1234&lt;?php $my_func = chr(0) . \"lambda_1\"; //chr()å¯ä»¥è½¬æ¢ç”Ÿæˆasciiå­—ç¬¦$my_func(); // Hello è¿™ç§åˆ›å»ºâ€åŒ¿åå‡½æ•°â€çš„æ–¹å¼æœ‰ä¸€äº›ç¼ºç‚¹: å‡½æ•°çš„å®šä¹‰æ˜¯é€šè¿‡å­—ç¬¦ä¸²åŠ¨æ€evalçš„ï¼Œ è¿™å°±æ— æ³•è¿›è¡ŒåŸºæœ¬çš„è¯­æ³•æ£€æŸ¥; è¿™ç±»å‡½æ•°å’Œæ™®é€šå‡½æ•°æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œ æ— æ³•å®ç°é—­åŒ…çš„æ•ˆæœ. çœŸæ­£çš„åŒ¿åå‡½æ•°__invokeå¦‚æœå®šä¹‰äº†__invoke()é­”æœ¯æ–¹æ³•çš„è¯é‚£ä¹ˆåœ¨å¯¹è±¡è¢«å½“ä½œå‡½æ•°è°ƒç”¨æ—¶åˆ™ä¼šè¢«è°ƒç”¨è¿™ä¸ªå’ŒC++ä¸­çš„é‡è½½æœ‰ç‚¹ç±»ä¼¼123456789&lt;?phpclass Callme &#123; public function __invoke($phone_num) &#123; echo \"Hello: $phone_num\"; &#125;&#125; $call = new Callme();$call(13810688888); // \"Hello: 13810688888 åŒ¿åå‡½æ•°çš„å®ç°å…¶å®åŒ¿åå‡½æ•°ä¹Ÿåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ç±»è€Œå·²1234567&lt;?php$func = function() &#123; echo \"Hello, anonymous function\";&#125; echo gettype($func); // objectecho get_class($func); // Closure é—­åŒ…çš„å®ç°çœ‹çœ‹ä¸€æ®µPHPé—­åŒ…ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å§ï¼š1234567&lt;?php$i=100;$counter = function() use($i) &#123; debug_zval_dump($i);&#125;; $counter(); å†çœ‹çœ‹VLDç”Ÿæˆçš„ç»“æœ12345678910111213141516171819202122$ php -dvld.active=1 closure.php vars: !0 = $i, !1 = $counter# * op fetch ext return operands------------------------------------------------------------------------0 &gt; ASSIGN !0, 1001 ZEND_DECLARE_LAMBDA_FUNCTION '%00%7Bclosure2 ASSIGN !1, ~13 INIT_FCALL_BY_NAME !14 DO_FCALL_BY_NAME 0 5 &gt; RETURN 1 function name: &#123;closure&#125;number of ops: 5compiled vars: !0 = $iline # * op fetch ext return operands-------------------------------------------------------------------------------- 3 0 &gt; FETCH_R static $0 'i' 1 ASSIGN !0, $0 4 2 SEND_VAR !0 3 DO_FCALL 1 'debug_zval_dump' 5 4 &gt; RETURN null ä¸Šé¢æ ¹æ®æƒ…å†µå»æ‰äº†ä¸€äº›æ— å…³çš„è¾“å‡ºï¼Œ ä»ä¸Šåˆ°ä¸‹ï¼Œ ç¬¬1å¼€å§‹å°†100èµ‹å€¼ç»™!0ä¹Ÿå°±æ˜¯å˜é‡$iï¼Œ éšåæ‰§è¡ŒZEND_DECLARE_LAMBDA_FUNCTIONï¼Œ é‚£æˆ‘ä»¬å»ç›¸å…³çš„opcodeæ‰§è¡Œå‡½æ•°ä¸­çœ‹çœ‹è¿™é‡Œæ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œ è¿™ä¸ªopcodeçš„å¤„ç†å‡½æ•°ä½äºZend/zend_vm_execute.hä¸­:123456789101112131415static int ZEND_FASTCALL ZEND_DECLARE_LAMBDA_FUNCTION_SPEC_CONST_CONST_HANDLER(ZEND_OPCODE_HANDLER_ARGS)&#123; zend_op *opline = EX(opline); zend_function *op_array; if (zend_hash_quick_find(EG(function_table), Z_STRVAL(opline-&gt;op1.u.constant), Z_STRLEN(opline-&gt;op1.u.constant), Z_LVAL(opline-&gt;op2.u.constant), (void *) &amp;op_array) == FAILURE || op_array-&gt;type != ZEND_USER_FUNCTION) &#123; zend_error_noreturn(E_ERROR, \"Base lambda function for closure not found\"); &#125; zend_create_closure(&amp;EX_T(opline-&gt;result.u.var).tmp_var, op_array TSRMLS_CC); ZEND_VM_NEXT_OPCODE();&#125; çœ‹çœ‹åˆ›å»ºé—­åŒ…çš„å‡½æ•°ï¼Œåœ¨Zend/zend_closures.cä¸­ï¼š1234567891011121314151617181920212223242526ZEND_API void zend_create_closure(zval *res, zend_function *func TSRMLS_DC)&#123; zend_closure *closure; object_init_ex(res, zend_ce_closure); closure = (zend_closure *)zend_object_store_get_object(res TSRMLS_CC); closure-&gt;func = *func; if (closure-&gt;func.type == ZEND_USER_FUNCTION) &#123; // å¦‚æœæ˜¯ç”¨æˆ·å®šä¹‰çš„åŒ¿åå‡½æ•° if (closure-&gt;func.op_array.static_variables) &#123; HashTable *static_variables = closure-&gt;func.op_array.static_variables; // ä¸ºå‡½æ•°ç”³è¯·å­˜å‚¨é™æ€å˜é‡çš„å“ˆå¸Œè¡¨ç©ºé—´ ALLOC_HASHTABLE(closure-&gt;func.op_array.static_variables); zend_hash_init(closure-&gt;func.op_array.static_variables, zend_hash_num_elements(static_variables), NULL, ZVAL_PTR_DTOR, 0); // å¾ªç¯å½“å‰é™æ€å˜é‡åˆ—è¡¨ï¼Œ ä½¿ç”¨zval_copy_static_varæ–¹æ³•å¤„ç† zend_hash_apply_with_arguments(static_variables TSRMLS_CC, (apply_func_args_t)zval_copy_static_var, 1, closure-&gt;func.op_array.static_variables); &#125; (*closure-&gt;func.op_array.refcount)++; &#125; closure-&gt;func.common.scope = NULL;&#125; ç±»å’Œé¢å‘å¯¹è±¡ç±»çš„ç»“æ„å’Œå®ç°ç±»çš„ç»“æ„123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778struct _zend_class_entry &#123; char type; // ç±»å‹ï¼šZEND_INTERNAL_CLASS / ZEND_USER_CLASS char *name;// ç±»åç§° zend_uint name_length; // å³sizeof(name) - 1 struct _zend_class_entry *parent; // ç»§æ‰¿çš„çˆ¶ç±» int refcount; // å¼•ç”¨æ•° zend_bool constants_updated; zend_uint ce_flags; // ZEND_ACC_IMPLICIT_ABSTRACT_CLASS: ç±»å­˜åœ¨abstractæ–¹æ³• // ZEND_ACC_EXPLICIT_ABSTRACT_CLASS: åœ¨ç±»åç§°å‰åŠ äº†abstractå…³é”®å­— // ZEND_ACC_FINAL_CLASS // ZEND_ACC_INTERFACE HashTable function_table; // æ–¹æ³• HashTable default_properties; // é»˜è®¤å±æ€§ HashTable properties_info; // å±æ€§ä¿¡æ¯ HashTable default_static_members;// ç±»æœ¬èº«æ‰€å…·æœ‰çš„é™æ€å˜é‡ HashTable *static_members; // type == ZEND_USER_CLASSæ—¶ï¼Œå–&amp;default_static_members; // type == ZEND_INTERAL_CLASSæ—¶ï¼Œè®¾ä¸ºNULL HashTable constants_table; // å¸¸é‡ struct _zend_function_entry *builtin_functions;// æ–¹æ³•å®šä¹‰å…¥å£ union _zend_function *constructor; union _zend_function *destructor; union _zend_function *clone; /* é­”æœ¯æ–¹æ³• */ union _zend_function *__get; union _zend_function *__set; union _zend_function *__unset; union _zend_function *__isset; union _zend_function *__call; union _zend_function *__tostring; union _zend_function *serialize_func; union _zend_function *unserialize_func; zend_class_iterator_funcs iterator_funcs;// è¿­ä»£ /* ç±»å¥æŸ„ */ zend_object_value (*create_object)(zend_class_entry *class_type TSRMLS_DC); zend_object_iterator *(*get_iterator)(zend_class_entry *ce, zval *object, intby_ref TSRMLS_DC); /* ç±»å£°æ˜çš„æ¥å£ */ int(*interface_gets_implemented)(zend_class_entry *iface, zend_class_entry *class_type TSRMLS_DC); /* åºåˆ—åŒ–å›è°ƒå‡½æ•°æŒ‡é’ˆ */ int(*serialize)(zval *objectï¼Œ unsignedchar**buffer, zend_uint *buf_len, zend_serialize_data *data TSRMLS_DC); int(*unserialize)(zval **object, zend_class_entry *ce, constunsignedchar*buf, zend_uint buf_len, zend_unserialize_data *data TSRMLS_DC); zend_class_entry **interfaces; // ç±»å®ç°çš„æ¥å£ zend_uint num_interfaces; // ç±»å®ç°çš„æ¥å£æ•° zend_class_entry **traits; zend_uint num_traits; zend_trait_alias **trait_aliases; zend_trait_precedence **trait_precedences; union &#123; struct &#123; const char *filename; zend_uint line_start; zend_uint line_end; const char *doc_comment; zend_uint doc_comment_len; &#125; user; struct &#123; const struct _zend_function_entry *builtin_functions; struct _zend_module_entry *module; &#125; internal; &#125; info;&#125;; ç±»çš„å®ç°å‚è€ƒTIPIæ·±å…¥ç†è§£PHPå†…æ ¸æ·±å…¥ç†è§£PHP7ä¹‹zvalTSRMåˆ°åº•æ˜¯ä»€ä¹ˆ?","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"æºç ","slug":"æºç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æºç /"},{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å†…æ ¸/"}]},{"title":"CodeIgniteræºç é˜…è¯»ç¬”è®°","date":"2016-12-12T13:00:25.000Z","path":"2016/12/12/CodeIgniteræºç é˜…è¯»ç¬”è®°/","text":"å…¥å£æ–‡ä»¶index.phpå…¥å£æ–‡ä»¶index.phpä¸­ä¸»è¦å®šä¹‰äº†ä¸€äº›å…¨å±€è·¯å¾„å˜é‡å¦‚BASEPATHå’ŒAPPPATHè¿™ç§å¸¸ç”¨çš„å˜é‡å¹¶ä¸”å¯ä»¥é…ç½®ä»£ç çš„éƒ¨ç½²ç¯å¢ƒï¼Œæœ€årequireçœŸæ­£çš„æ ¸å¿ƒæ–‡ä»¶CodeIgniter.php CodeIgniter.phpä½äºsystem/core/ç›®å½•ä¸‹ï¼Œè¯¥æ–‡ä»¶æ˜¯æœ€ä¸»è¦çš„æ ¸å¿ƒæ–‡ä»¶ï¼Œä»–è´Ÿè´£å¼•å…¥å…¨å±€éœ€è¦ç”¨åˆ°çš„ä¸€äº›å…³é”®çš„ç±»ï¼Œæ¯”å¦‚Common.phpå’ŒController.phpï¼Œè¿™äº›ç±»å¤„äºsystem/coreç›®å½•ä¸‹CodeIgniter.phpæœ‰ç‚¹ç­–ç•¥æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„æ„å‘³äº†ï¼Œå¾ˆå¥½çš„è§£å†³äº†ä»£ç è€¦åˆçš„é—®é¢˜ï¼Œä»£ç å¯æ‹“å±•æ€§å¾ˆé«˜ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘å–œæ¬¢CIçš„ä¸€ä¸ªåœ°æ–¹CIçš„å¼‚å¸¸å¤„ç†æœºåˆ¶æ˜¯åˆ©ç”¨PHPçš„error_handlerå’Œexception_handlerè¿›è¡Œå¤„ç†ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š 1234//å…¨å±€çš„å¼‚å¸¸å¤„ç†éƒ½åœ¨è¿™é‡Œè¿›è¡Œset_error_handler('_error_handler');set_exception_handler('_exception_handler');register_shutdown_function('_shutdown_handler'); è¿™é‡Œçš„error_handlerå’Œexception_handleréƒ½æ˜¯åˆ©ç”¨CIçš„Loaderè¿›è¡ŒExceptionç±»çš„å®ä¾‹åŒ–å¹¶ä¸”è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼ŒåŒæ—¶LoaderåŠ è½½Logç±»è¿›è¡Œæ—¥å¿—è®°å½• æ ¸å¿ƒç±»åº“Common.phpè¯¥æ–‡ä»¶å®šä¹‰äº†ä¸€äº›å…¨å±€å½“ä¸­éœ€è¦ç”¨åˆ°çš„å‡½æ•°ï¼Œè¾…åŠ©æ¡†æ¶è¿è¡Œï¼Œå¦‚is_cli()åˆ¤æ–­æ¥åˆ¤æ–­æ˜¯å¦cliè¿è¡Œç¯å¢ƒ DB_query_builder.phpåˆ†æORMçš„è¯­æ³•ï¼Œä¸»è¦åˆ©ç”¨explodeå‡½æ•°è¿›è¡Œè¯è¯­åˆ†å‰²è¿™é‡Œæˆ‘ä»¬çœ‹çœ‹selectæ–¹æ³•çš„å®ç°12345678910111213141516171819202122232425262728293031//è§£æselectä¸­çš„æ•°æ®ï¼Œæ”¾å…¥æ•°ç»„ï¼Œä¾¿äºdriverä½¿ç”¨public function select($select = '*', $escape = NULL)&#123; if (is_string($select)) &#123; $select = explode(',', $select); &#125; // If the escape value was not set, we will base it on the global setting is_bool($escape) OR $escape = $this-&gt;_protect_identifiers; foreach ($select as $val) &#123; $val = trim($val); if ($val !== '') &#123; $this-&gt;qb_select[] = $val; $this-&gt;qb_no_escape[] = $escape; if ($this-&gt;qb_caching === TRUE) &#123; $this-&gt;qb_cache_select[] = $val; $this-&gt;qb_cache_exists[] = 'select'; $this-&gt;qb_cache_no_escape[] = $escape; &#125; &#125; &#125; return $this;&#125; é€šè¿‡explodeåˆ†å‰²selecté‡Œé¢çš„å‚æ•°ï¼Œå¹¶æ”¾å…¥æ•°ç»„å½“ä¸­ï¼Œåˆ©ç”¨qb_cache_existsè®°å½•å·²æœ‰çš„æ“ä½œç±»å‹ï¼Œqb_cache_selectè®°å½•éœ€è¦selectçš„æ•°æ®ï¼Œæœ€åå¯ä»¥é€šè¿‡è¿™äº›æ•°æ®å½“ä¸­çš„æ•°æ®è¿›è¡Œä¸åŒæ•°æ®åº“dialectä¸‹SQLè¯­å¥çš„ç”Ÿæˆå¦å¤–query_builderä¸­æ¯ä¸ªæ–¹æ³•éƒ½è¿”å›ä¸€ä¸ª$thisæŒ‡é’ˆï¼Œå®ç°äº†CIä¸­ORMâ€object-&gt;method()-&gt;method()â€è¿™æ ·çš„é“¾å¼æ“ä½œã€‚ åœ¨databaseç›®å½•ä¸‹çš„éƒ½æ˜¯ä¸»è¦çš„db driverï¼Œæ˜¯ä¸€ä¸ªä¸€ä¸ªçš„abstractç±»ï¼Œç”¨äºè¢«ä¸åŒçš„æ•°æ®åº“ç±»å‹db drvierç»§æ‰¿ã€‚ Loader.phpLoaderå°±æœ‰ç‚¹å•ä¾‹æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„æ„å‘³åœ¨é‡Œé¢äº†123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172/** * Nesting level of the output buffering mechanism * * @var int */protected $_ci_ob_level;/** * List of paths to load views from * * @var array */protected $_ci_view_paths = array(VIEWPATH =&gt; TRUE);/** * List of paths to load libraries from * * @var array */protected $_ci_library_paths = array(APPPATH, BASEPATH);/** * List of paths to load models from * * @var array */protected $_ci_model_paths = array(APPPATH);/** * List of paths to load helpers from * * @var array */protected $_ci_helper_paths = array(APPPATH, BASEPATH);/** * List of cached variables * * @var array */protected $_ci_cached_vars = array();/** * List of loaded classes * * @var array */protected $_ci_classes = array();/** * List of loaded models * * @var array */protected $_ci_models = array();/** * List of loaded helpers * * @var array */protected $_ci_helpers = array();/** * List of class name mappings * * @var array */protected $_ci_varmap = array( 'unit_test' =&gt; 'unit', 'user_agent' =&gt; 'agent'); ä¸Šé¢æ˜¯Loaderçš„å±æ€§ï¼Œç”¨æ¥ä¿å­˜å·²ç»åŠ è½½è¿‡çš„å·¥å…·ï¼Œä½¿å®ä¾‹åŒ–å‡ºæ¥çš„å·¥å…·ç±»æˆ–è€…æ–¹æ³•ä¿æŒå•ä¸€æ€§ï¼Œä¸ä¼šé‡å¤ç”Ÿæˆé€ æˆæµªè´¹ã€‚ä¾‹å¦‚$_ci_modelsï¼Œåœ¨æ§åˆ¶å™¨ä¸­åˆ©ç”¨ä»£ç $this-&gt;load-&gt;model(&#39;Model_name&#39;)å°±æ˜¯é¦–å…ˆåˆ¤æ–­$_ci_modelsä¸­æ˜¯å¦å­˜åœ¨Model_nameè¿™ä¸€modelï¼Œå¦‚ä¸å­˜åœ¨åˆ™è¿›è¡ŒåŠ è½½å¹¶ä¿å­˜åˆ°å·²åŠ è½½modelçš„æ•°ç»„å½“ä¸­ï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½å’Œå†…å­˜çš„åˆ©ç”¨ç‡ã€‚$this-&gt;loadä¾¿æ˜¯Loaderç±»è¢«ä¿å­˜åœ¨å…¨å±€å”¯ä¸€çš„å®ä¾‹Controllerå½“ä¸­çš„loadå±æ€§ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹Loaderä¸­modelæ–¹æ³•çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135/** * Model Loader * * Loads and instantiates models. * * @param string $model Model name * @param string $name An optional object name to assign to * @param bool $db_conn An optional database connection configuration to initialize * @return object */public function model($model, $name = '', $db_conn = FALSE)&#123; if (empty($model)) &#123; return $this; &#125; elseif (is_array($model)) &#123; foreach ($model as $key =&gt; $value) &#123; is_int($key) ? $this-&gt;model($value, '', $db_conn) : $this-&gt;model($key, $value, $db_conn); &#125; return $this; &#125; $path = ''; // Is the model in a sub-folder? If so, parse out the filename and path. //è·å–åˆ¤æ–­modelæ˜¯å¦å­˜åœ¨å­è·¯å¾„ä¸­ if (($last_slash = strrpos($model, '/')) !== FALSE) &#123; // The path is in front of the last slash $path = substr($model, 0, ++$last_slash); // And the model name behind it $model = substr($model, $last_slash); &#125; if (empty($name)) &#123; $name = $model; &#125; if (in_array($name, $this-&gt;_ci_models, TRUE)) &#123; return $this; &#125; //å•ä¾‹æ¨¡å¼ $CI =&amp; get_instance(); if (isset($CI-&gt;$name)) &#123; throw new RuntimeException('The model name you are loading is the name of a resource that is already being used: '.$name); &#125; //éªŒè¯æ•°æ®åº“è¿æ¥ if ($db_conn !== FALSE &amp;&amp; ! class_exists('CI_DB', FALSE)) &#123; if ($db_conn === TRUE) &#123; $db_conn = ''; &#125; $this-&gt;database($db_conn, FALSE, TRUE); &#125; // Note: All of the code under this condition used to be just: // // load_class('Model', 'core'); // // However, load_class() instantiates classes // to cache them for later use and that prevents // MY_Model from being an abstract class and is // sub-optimal otherwise anyway. if ( ! class_exists('CI_Model', FALSE)) &#123; $app_path = APPPATH.'core'.DIRECTORY_SEPARATOR; if (file_exists($app_path.'Model.php')) &#123; require_once($app_path.'Model.php'); if ( ! class_exists('CI_Model', FALSE)) &#123; throw new RuntimeException($app_path.\"Model.php exists, but doesn't declare class CI_Model\"); &#125; &#125; elseif ( ! class_exists('CI_Model', FALSE)) &#123; require_once(BASEPATH.'core'.DIRECTORY_SEPARATOR.'Model.php'); &#125; $class = config_item('subclass_prefix').'Model'; if (file_exists($app_path.$class.'.php')) &#123; require_once($app_path.$class.'.php'); if ( ! class_exists($class, FALSE)) &#123; throw new RuntimeException($app_path.$class.\".php exists, but doesn't declare class \".$class); &#125; &#125; &#125; $model = ucfirst($model); if ( ! class_exists($model, FALSE)) &#123; foreach ($this-&gt;_ci_model_paths as $mod_path) &#123; if ( ! file_exists($mod_path.'models/'.$path.$model.'.php')) &#123; continue; &#125; require_once($mod_path.'models/'.$path.$model.'.php'); if ( ! class_exists($model, FALSE)) &#123; throw new RuntimeException($mod_path.\"models/\".$path.$model.\".php exists, but doesn't declare class \".$model); &#125; break; &#125; if ( ! class_exists($model, FALSE)) &#123; throw new RuntimeException('Unable to locate the model you have specified: '.$model); &#125; &#125; elseif ( ! is_subclass_of($model, 'CI_Model')) &#123; throw new RuntimeException(\"Class \".$model.\" already exists and doesn't extend CI_Model\"); &#125; $this-&gt;_ci_models[] = $name; $CI-&gt;$name = new $model(); return $this;&#125; Config.phpåœ¨Configç±»å½“ä¸­ï¼Œæœ€æ ¸å¿ƒçš„éƒ¨åˆ†å°±æ˜¯Configç±»çš„ä¸¤ä¸ªå±æ€§ï¼Œç”¨äºä¿å­˜å·²åŠ è½½è¿‡çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨CIä¸­è¿™ç§ä¿å­˜å˜é‡çš„æ–¹æ³•éšå¤„å¯è§ï¼Œè¿™ç§è®¾è®¡æ–¹å¼çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå¤§å¤§æé«˜äº†å†…å­˜çš„åˆ©ç”¨ç‡ï¼Œé™ä½é‡å¤åŠ è½½å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªå±æ€§çš„å®šä¹‰ä»¥åŠä»–çš„æ³¨é‡Š123456789101112131415/** * List of all loaded config values * * @var array *///ä¿å­˜åŠ è½½è¿‡çš„é…ç½®public $config = array();/** * List of all loaded config files * * @var array *///å·²åŠ è½½çš„é…ç½®æ–‡ä»¶public $is_loaded = array(); æ¯ä¸€æ¬¡åŠ è½½æ–°çš„é…ç½®çš„æ—¶å€™ï¼ŒConfigç±»å…ˆå¯¹é…ç½®æ˜¯å¦å·²åŠ è½½ç„¶åå†ä½œå‡ºç›¸åº”çš„æ“ä½œï¼Œå¦‚æœå·²åŠ è½½åˆ™åˆ©ç”¨array_merge()å‡½æ•°æ¥è¿›è¡Œå·²åŠ è½½é…ç½®æ•°ç»„çš„åˆå¹¶ Controller.phpä¹ä¸€çœ‹Controllerç±»ä¸‹æ²¡æœ‰å†™ä»€ä¹ˆï¼Œå°±åªæœ‰å‡ åè¡Œä»£ç ï¼Œç”šè‡³å¤§éƒ¨åˆ†éƒ½æ˜¯æ³¨é‡Šï¼Œä½†æ˜¯Controlleræ˜¯æ•´ä¸ªCIçš„å¿ƒè„ï¼Œåˆ©ç”¨å•ä¾‹æ¨¡å¼æ‰¿æ‹…èµ·æ•´ä¸ªåº”ç”¨çš„æ­£å¸¸è¿è¡Œã€‚æ‰€æœ‰å®ä¾‹åŒ–å‡ºæ¥çš„ç±»éƒ½ç»Ÿä¸€æ”¾åˆ°Controllerå½“ä¸­ï¼Œæ˜¯ç³»ç»Ÿæ¶æ„ä¸­çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚å…¨å±€é€šè¿‡get_instance()è¿™ä¸€ä¸ªæ–¹æ³•æ¥è·å–Controllerå•ä¾‹å®ä½“ï¼Œä¿è¯å„ä¸ªå·¥å…·ç±»çš„å•ä¾‹æ€§ã€‚æ•´ä¸ªç³»ç»Ÿå°±æ˜¯é ç€Controllerè¿™ä¸€ä¸ªæ¢çº½è¿è¡Œèµ·æ¥çš„ã€‚ è·¯ç”±åˆ†å‘æ•´ä¸ªåº”ç”¨çš„è·¯ç”±åˆ†å‘æ˜¯ç”±Routerç±»æ¥è¿›è¡Œåˆ†å‘çš„ï¼Œè”åˆURIç±»ï¼Œè¿›è¡Œurlçš„åˆ†æï¼Œåœ¨æ­¤å°±ä¸åœ¨èµ˜è¿°äº†ã€‚å¯ä»¥ä»”ç»†é˜…è¯»system/coreä¸‹çš„Router.phpå’ŒURI.php","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"CodeIgniter","slug":"CodeIgniter","permalink":"https://github.com/kong36088/kong36088.github.io/tags/CodeIgniter/"},{"name":"æºç ","slug":"æºç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æºç /"}]},{"title":"æˆ‘çš„ç™¾ä¸‡çŸ¥ä¹ç”¨æˆ·æ•°æ®åˆ†æ","date":"2016-12-01T13:19:25.000Z","path":"2016/12/01/æˆ‘çš„ç™¾ä¸‡çŸ¥ä¹ç”¨æˆ·æ•°æ®åˆ†æ/","text":"è¿™é‡Œæ˜¯å®æ—¶æ›´æ–°çš„çŸ¥ä¹æ•°æ®ç”¨æˆ·åˆ†æåœ°å€ï¼šç™¾ä¸‡çŸ¥ä¹ç”¨æˆ·æ•°æ®åˆ†æ ç”¨æˆ·æ•°æ®åˆ†ææºç åœ¨è¿™é‡Œï¼šZhihuAnalyse çˆ¬è™«é¡¹ç›®æºç æ”¾åœ¨æˆ‘çš„githubä¸Šï¼šZhihuSpiderçˆ¬è™«ä»£ç åˆ†æå¯ä»¥çœ‹æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç«  å–œæ¬¢çš„è¯å¸®å¿™ç‚¹ä¸ªstarå‘—:-D è¯´ä¸ªé¢˜å¤–è¯ï¼šä»Šå¤©ä¸‹åˆçš„æ—¶å€™çˆ¬è™«è¿˜åœ¨ç»§ç»­è·‘ï¼ŒçŸ¥ä¹ç”¨æˆ·ä¸ªäººé¦–é¡µè¿˜ç”¨çš„æ˜¯æ—§ç‰ˆåˆ°äº†æ™šä¸Š7ç‚¹å‘ç°çˆ¬è™«å±…ç„¶çˆ¬ä¸åŠ¨äº†ï¼Œååˆ†ç–‘æƒ‘ï¼ŒçŸ¥ä¹ä¸ªäººä¸­å¿ƒç«Ÿç„¶æ”¹ç‰ˆäº†ï¼Œä¸ªäººé¦–é¡µçš„urlä¹Ÿæ”¹äº†ï¼ŒåŸæ¥çš„çˆ¬è™«ç”¨ä¸äº†ï¼Œï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯çŸ¥ä¹ä¸ºäº†é˜²æ­¢æˆ‘çˆ¬æ•°æ®åšçš„æªæ–½ï¼Œå“ˆå“ˆå“ˆï¼‰ååˆ†æ‚²å‚¬ï¼Œæ–°ç‰ˆçˆ¬è™«åªèƒ½ä¹‹åæŠ½ç©ºå‡ºæ¥å†æ”¹ä¸€ä¸‹äº† æ•ˆæœå›¾ ç®€ä»‹ä¸»è¦åˆ©ç”¨SQLè¿›è¡Œç»Ÿè®¡ï¼Œå¹¶ä¸”åˆ©ç”¨redisè¿›è¡Œæ•°æ®ç¼“å­˜ï¼Œttlæ˜¯6ä¸ªå°æ—¶ï¼Œæé«˜åŠ è½½é€Ÿåº¦","tags":[{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://github.com/kong36088/kong36088.github.io/tags/çˆ¬è™«/"},{"name":"Python","slug":"Python","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Python/"}]},{"title":"æˆ‘ç”¨pythonçˆ¬äº†çŸ¥ä¹ä¸€ç™¾ä¸‡ç”¨æˆ·çš„æ•°æ®","date":"2016-11-04T13:24:25.000Z","path":"2016/11/04/æˆ‘ç”¨pythonçˆ¬äº†çŸ¥ä¹ä¸€ç™¾ä¸‡ç”¨æˆ·çš„æ•°æ®/","text":"é¡¹ç›®æºç æ”¾åœ¨æˆ‘çš„githubä¸Šï¼šZhihuSpiderå–œæ¬¢çš„è¯å¸®å¿™ç‚¹ä¸ªstarå‘—:-D æ€»ä½“æ€è·¯1.é¦–å…ˆæ˜¯æ¨¡æ‹Ÿç™»é™†çŸ¥ä¹ï¼Œåˆ©ç”¨ä¿å­˜ç™»é™†çš„cookieä¿¡æ¯2.æŠ“å–çŸ¥ä¹é¡µé¢çš„htmlä»£ç ï¼Œç•™å¾…ä¸‹ä¸€æ­¥ç»§ç»­è¿›è¡Œåˆ†ææå–ä¿¡æ¯3.åˆ†ææå–é¡µé¢ä¸­ç”¨æˆ·çš„ä¸ªæ€§åŒ–urlï¼Œæ”¾å…¥redisï¼ˆè¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸€ä¸‹redisçš„æ€è·¯ç”¨æ³•ï¼Œå°†æå–åˆ°çš„ç”¨æˆ·çš„ä¸ªæ€§åŒ–urlæ”¾å…¥redisçš„ä¸€ä¸ªåä¸ºalready_get_userçš„hash tableï¼Œè¡¨ç¤ºå·²æŠ“å–çš„ç”¨æˆ·ï¼Œå¯¹äºå·²æŠ“å–è¿‡çš„ç”¨æˆ·åˆ¤æ–­æ˜¯å¦å­˜åœ¨äºalready_get_userä»¥å»é™¤é‡å¤æŠ“å–ï¼ŒåŒæ—¶å°†ä¸ªæ€§åŒ–urlæ”¾å…¥user_queueçš„é˜Ÿåˆ—ä¸­ï¼Œéœ€è¦æŠ“å–æ–°ç”¨æˆ·æ—¶popé˜Ÿåˆ—è·å–æ–°çš„ç”¨æˆ·ï¼‰4.è·å–ç”¨æˆ·çš„å…³æ³¨åˆ—è¡¨å’Œç²‰ä¸åˆ—è¡¨ï¼Œç»§ç»­æ’å…¥åˆ°redis5.ä»redisçš„user_queueé˜Ÿåˆ—ä¸­è·å–æ–°ç”¨æˆ·ç»§ç»­é‡å¤æ­¥éª¤3 æ•ˆæœå›¾æœåŠ¡å™¨å¸¦å®½æœ‰é™ï¼Œå¹¶ä¸”çŸ¥ä¹è¿›è¡Œäº†ipå°æ€ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®ä¹ŸèŠ±äº†å¥½å‡ å¤©çš„æ—¶é—´æ‰çˆ¬ä¸‹æ¥å–œæ¬¢çš„æœ‹å‹å¸®å¿™ç‚¹ä¸ªstarå‘—â™ª(ï¼¾âˆ€ï¼¾â—)ï¾‰ ZhihuSpider æ¨¡æ‹Ÿç™»é™†çŸ¥ä¹é¦–å…ˆæ˜¯ç™»é™†ï¼Œç™»é™†åŠŸèƒ½ä½œä¸ºä¸€ä¸ªåŒ…å°è£…äº†åœ¨loginé‡Œé¢ï¼Œæ–¹ä¾¿æ•´åˆè°ƒç”¨ headeréƒ¨åˆ†ï¼Œè¿™é‡ŒConnectionæœ€å¥½è®¾ä¸ºcloseï¼Œä¸ç„¶å¯èƒ½ä¼šç¢°åˆ°max retireve exceedçš„é”™è¯¯åŸå› åœ¨äºæ™®é€šçš„è¿æ¥æ˜¯keep-aliveçš„ä½†æ˜¯å´åˆæ²¡æœ‰å…³é—­ 12345678910111213# httpè¯·æ±‚çš„headerheaders = &#123; \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.143 Safari/537.36\", \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\", \"Host\": \"www.zhihu.com\", \"Referer\": \"https://www.zhihu.com/\", \"Origin\": \"https://www.zhihu.com/\", \"Upgrade-Insecure-Requests\": \"1\", \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\", \"Pragma\": \"no-cache\", \"Accept-Encoding\": \"gzip, deflate, br\", 'Connection': 'close'&#125; 123456789101112131415# éªŒè¯æ˜¯å¦ç™»é™†def check_login(self): check_url = 'https://www.zhihu.com/settings/profile' try: login_check = self.__session.get(check_url, headers=self.headers, timeout=35) except Exception as err: print(traceback.print_exc()) print(err) print(\"éªŒè¯ç™»é™†å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ\") sys.exit() print(\"éªŒè¯ç™»é™†çš„http status codeä¸ºï¼š\" + str(login_check.status_code)) if int(login_check.status_code) == 200: return True else: return False è¿›å…¥é¦–é¡µæŸ¥çœ‹httpçŠ¶æ€ç æ¥éªŒè¯æ˜¯å¦ç™»é™†ï¼Œ200ä¸ºå·²ç»ç™»é™†ï¼Œä¸€èˆ¬304å°±æ˜¯è¢«é‡å®šå‘æ‰€ä»¥å°±æ˜¯æ²¡æœ‰ç™»é™† 123456789101112131415161718# è·å–éªŒè¯ç def get_captcha(self): t = str(time.time() * 1000) captcha_url = 'http://www.zhihu.com/captcha.gif?r=' + t + \"&amp;type=login\" r = self.__session.get(captcha_url, headers=self.headers, timeout=35) with open('captcha.jpg', 'wb') as f: f.write(r.content) f.close() # ç”¨pillow çš„ Image æ˜¾ç¤ºéªŒè¯ç  # å¦‚æœæ²¡æœ‰å®‰è£… pillow åˆ°æºä»£ç æ‰€åœ¨çš„ç›®å½•å»æ‰¾åˆ°éªŒè¯ç ç„¶åæ‰‹åŠ¨è¾“å…¥ '''try: im = Image.open('captcha.jpg') im.show() im.close() except:''' print(u'è¯·åˆ° %s ç›®å½•æ‰¾åˆ°captcha.jpg æ‰‹åŠ¨è¾“å…¥' % os.path.abspath('captcha.jpg')) captcha = input(\"è¯·è¾“å…¥éªŒè¯ç \\n&gt;\") return captcha è·å–éªŒè¯ç çš„æ–¹æ³•ã€‚å½“ç™»å½•æ¬¡æ•°å¤ªå¤šæœ‰å¯èƒ½ä¼šè¦æ±‚è¾“å…¥éªŒè¯ç ï¼Œè¿™é‡Œå®ç°è¿™ä¸ªåŠŸèƒ½ 1234567891011121314151617# è·å–xsrfdef get_xsrf(self): index_url = 'http://www.zhihu.com' # è·å–ç™»å½•æ—¶éœ€è¦ç”¨åˆ°çš„_xsrf try: index_page = self.__session.get(index_url, headers=self.headers, timeout=35) except: print('è·å–çŸ¥ä¹é¡µé¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥') sys.exit() html = index_page.text # è¿™é‡Œçš„_xsrf è¿”å›çš„æ˜¯ä¸€ä¸ªlist BS = BeautifulSoup(html, 'html.parser') xsrf_input = BS.find(attrs=&#123;'name': '_xsrf'&#125;) pattern = r'value=\\\"(.*?)\\\"' print(xsrf_input) self.__xsrf = re.findall(pattern, str(xsrf_input)) return self.__xsrf[0] è·å–xsrfï¼Œä¸ºä»€ä¹ˆè¦è·å–xsrfå‘¢ï¼Œå› ä¸ºxsrfæ˜¯ä¸€ç§é˜²æ­¢è·¨ç«™æ”»å‡»çš„æ‰‹æ®µï¼Œå…·ä½“ä»‹ç»å¯ä»¥çœ‹è¿™é‡Œcsrfåœ¨è·å–åˆ°xsrfä¹‹åæŠŠxsrfå­˜å…¥cookieå½“ä¸­ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨apiçš„æ—¶å€™å¸¦ä¸Šxsrfä½œä¸ºå¤´éƒ¨ï¼Œä¸ç„¶çš„è¯çŸ¥ä¹ä¼šè¿”å›403 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152# è¿›è¡Œæ¨¡æ‹Ÿç™»é™†def do_login(self): try: # æ¨¡æ‹Ÿç™»é™† if self.check_login(): print('æ‚¨å·²ç»ç™»å½•') return else: if self.config.get(\"zhihu_account\", \"username\") and self.config.get(\"zhihu_account\", \"password\"): self.username = self.config.get(\"zhihu_account\", \"username\") self.password = self.config.get(\"zhihu_account\", \"password\") else: self.username = input('è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å\\n&gt; ') self.password = input(\"è¯·è¾“å…¥ä½ çš„å¯†ç \\n&gt; \") except Exception as err: print(traceback.print_exc()) print(err) sys.exit() if re.match(r\"^1\\d&#123;10&#125;$\", self.username): print(\"æ‰‹æœºç™»é™†\\n\") post_url = 'http://www.zhihu.com/login/phone_num' postdata = &#123; '_xsrf': self.get_xsrf(), 'password': self.password, 'remember_me': 'true', 'phone_num': self.username, &#125; else: print(\"é‚®ç®±ç™»é™†\\n\") post_url = 'http://www.zhihu.com/login/email' postdata = &#123; '_xsrf': self.get_xsrf(), 'password': self.password, 'remember_me': 'true', 'email': self.username, &#125; try: login_page = self.__session.post(post_url, postdata, headers=self.headers, timeout=35) login_text = json.loads(login_page.text.encode('latin-1').decode('unicode-escape')) print(postdata) print(login_text) # éœ€è¦è¾“å…¥éªŒè¯ç  r = 0ä¸ºç™»é™†æˆåŠŸä»£ç  if login_text['r'] == 1: sys.exit() except: postdata['captcha'] = self.get_captcha() login_page = self.__session.post(post_url, postdata, headers=self.headers, timeout=35) print(json.loads(login_page.text.encode('latin-1').decode('unicode-escape'))) # ä¿å­˜ç™»é™†cookie self.__session.cookies.save() è¿™ä¸ªå°±æ˜¯æ ¸å¿ƒçš„ç™»é™†åŠŸèƒ½å•¦ï¼Œéå¸¸å…³é”®çš„å°±æ˜¯ç”¨åˆ°äº†requestsåº“ï¼Œéå¸¸æ–¹ä¾¿çš„ä¿å­˜åˆ°sessionæˆ‘ä»¬è¿™é‡Œå…¨å±€éƒ½æ˜¯ç”¨å•ä¾‹æ¨¡å¼ï¼Œç»Ÿä¸€ä½¿ç”¨åŒä¸€ä¸ªrequests.sessionå¯¹è±¡è¿›è¡Œè®¿é—®åŠŸèƒ½ï¼Œä¿æŒç™»å½•çŠ¶æ€çš„ä¸€è‡´æ€§ æœ€åä¸»è¦è°ƒç”¨ç™»é™†çš„ä»£ç ä¸º123456789101112131415# åˆ›å»ºloginå¯¹è±¡lo = login.login.Login(self.session)# æ¨¡æ‹Ÿç™»é™†if lo.check_login(): print('æ‚¨å·²ç»ç™»å½•')else: if self.config.get(\"zhihu_account\", \"username\") and self.config.get(\"zhihu_account\", \"username\"): username = self.config.get(\"zhihu_account\", \"username\") password = self.config.get(\"zhihu_account\", \"password\") else: username = input('è¯·è¾“å…¥ä½ çš„ç”¨æˆ·å\\n&gt; ') password = input(\"è¯·è¾“å…¥ä½ çš„å¯†ç \\n&gt; \") lo.do_login(username, password) çŸ¥ä¹æ¨¡æ‹Ÿç™»é™†åˆ°æ­¤å°±å®Œæˆå•¦ çŸ¥ä¹ç”¨æˆ·æŠ“å–1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162def __init__(self, threadID=1, name=''): # å¤šçº¿ç¨‹ print(\"çº¿ç¨‹\" + str(threadID) + \"åˆå§‹åŒ–\") threading.Thread.__init__(self) self.threadID = threadID self.name = name try: print(\"çº¿ç¨‹\" + str(threadID) + \"åˆå§‹åŒ–æˆåŠŸ\") except Exception as err: print(err) print(\"çº¿ç¨‹\" + str(threadID) + \"å¼€å¯å¤±è´¥\") self.threadLock = threading.Lock() # è·å–é…ç½® self.config = configparser.ConfigParser() self.config.read(\"config.ini\") # åˆå§‹åŒ–session requests.adapters.DEFAULT_RETRIES = 5 self.session = requests.Session() self.session.cookies = cookielib.LWPCookieJar(filename='cookie') self.session.keep_alive = False try: self.session.cookies.load(ignore_discard=True) except: print('Cookie æœªèƒ½åŠ è½½') finally: pass # åˆ›å»ºloginå¯¹è±¡ lo = Login(self.session) lo.do_login() # åˆå§‹åŒ–redisè¿æ¥ try: redis_host = self.config.get(\"redis\", \"host\") redis_port = self.config.get(\"redis\", \"port\") self.redis_con = redis.Redis(host=redis_host, port=redis_port, db=0) # åˆ·æ–°redisåº“ # self.redis_con.flushdb() except: print(\"è¯·å®‰è£…redisæˆ–æ£€æŸ¥redisè¿æ¥é…ç½®\") sys.exit() # åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ try: db_host = self.config.get(\"db\", \"host\") db_port = int(self.config.get(\"db\", \"port\")) db_user = self.config.get(\"db\", \"user\") db_pass = self.config.get(\"db\", \"password\") db_db = self.config.get(\"db\", \"db\") db_charset = self.config.get(\"db\", \"charset\") self.db = pymysql.connect(host=db_host, port=db_port, user=db_user, passwd=db_pass, db=db_db, charset=db_charset) self.db_cursor = self.db.cursor() except: print(\"è¯·æ£€æŸ¥æ•°æ®åº“é…ç½®\") sys.exit() # åˆå§‹åŒ–ç³»ç»Ÿè®¾ç½® self.max_queue_len = int(self.config.get(\"sys\", \"max_queue_len\")) è¿™ä¸ªæ˜¯get_user.pyçš„æ„é€ å‡½æ•°ï¼Œä¸»è¦åŠŸèƒ½å°±æ˜¯åˆå§‹åŒ–mysqlè¿æ¥ã€redisè¿æ¥ã€éªŒè¯ç™»é™†ã€ç”Ÿæˆå…¨å±€çš„sessionå¯¹è±¡ã€å¯¼å…¥ç³»ç»Ÿé…ç½®ã€å¼€å¯å¤šçº¿ç¨‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172# è·å–é¦–é¡µhtmldef get_index_page(self): index_url = 'https://www.zhihu.com/' try: index_html = self.session.get(index_url, headers=self.headers, timeout=35) except Exception as err: # å‡ºç°å¼‚å¸¸é‡è¯• print(\"è·å–é¡µé¢å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•......\") print(err) traceback.print_exc() return None finally: pass return index_html.text# è·å–å•ä¸ªç”¨æˆ·è¯¦æƒ…é¡µé¢def get_user_page(self, name_url): user_page_url = 'https://www.zhihu.com' + str(name_url) + '/about' try: index_html = self.session.get(user_page_url, headers=self.headers, timeout=35) except Exception as err: # å‡ºç°å¼‚å¸¸é‡è¯• print(\"å¤±è´¥name_urlï¼š\" + str(name_url) + \"è·å–é¡µé¢å¤±è´¥ï¼Œæ”¾å¼ƒè¯¥ç”¨æˆ·\") print(err) traceback.print_exc() return None finally: pass return index_html.text# è·å–ç²‰ä¸é¡µé¢def get_follower_page(self, name_url): user_page_url = 'https://www.zhihu.com' + str(name_url) + '/followers' try: index_html = self.session.get(user_page_url, headers=self.headers, timeout=35) except Exception as err: # å‡ºç°å¼‚å¸¸é‡è¯• print(\"å¤±è´¥name_urlï¼š\" + str(name_url) + \"è·å–é¡µé¢å¤±è´¥ï¼Œæ”¾å¼ƒè¯¥ç”¨æˆ·\") print(err) traceback.print_exc() return None finally: pass return index_html.textdef get_following_page(self, name_url): user_page_url = 'https://www.zhihu.com' + str(name_url) + '/followers' try: index_html = self.session.get(user_page_url, headers=self.headers, timeout=35) except Exception as err: # å‡ºç°å¼‚å¸¸é‡è¯• print(\"å¤±è´¥name_urlï¼š\" + str(name_url) + \"è·å–é¡µé¢å¤±è´¥ï¼Œæ”¾å¼ƒè¯¥ç”¨æˆ·\") print(err) traceback.print_exc() return None finally: pass return index_html.text# è·å–é¦–é¡µä¸Šçš„ç”¨æˆ·åˆ—è¡¨ï¼Œå­˜å…¥redisdef get_index_page_user(self): index_html = self.get_index_page() if not index_html: return BS = BeautifulSoup(index_html, \"html.parser\") self.get_xsrf(index_html) user_a = BS.find_all(\"a\", class_=\"author-link\") # è·å–ç”¨æˆ·çš„aæ ‡ç­¾ for a in user_a: if a: self.add_wait_user(a.get('href')) else: continue è¿™ä¸€éƒ¨åˆ†çš„ä»£ç å°±æ˜¯ç”¨äºæŠ“å–å„ä¸ªé¡µé¢çš„htmlä»£ç  12345678910111213141516171819# åŠ å…¥å¸¦æŠ“å–ç”¨æˆ·é˜Ÿåˆ—ï¼Œå…ˆç”¨redisåˆ¤æ–­æ˜¯å¦å·²è¢«æŠ“å–è¿‡def add_wait_user(self, name_url): # åˆ¤æ–­æ˜¯å¦å·²æŠ“å– self.threadLock.acquire() if not self.redis_con.hexists('already_get_user', name_url): self.counter += 1 print(name_url + \" åŠ å…¥é˜Ÿåˆ—\") self.redis_con.hset('already_get_user', name_url, 1) self.redis_con.lpush('user_queue', name_url) print(\"æ·»åŠ ç”¨æˆ· \" + name_url + \"åˆ°é˜Ÿåˆ—\") self.threadLock.release()# è·å–é¡µé¢å‡ºé”™ç§»å‡ºredisdef del_already_user(self, name_url): self.threadLock.acquire() if not self.redis_con.hexists('already_get_user', name_url): self.counter -= 1 self.redis_con.hdel('already_get_user', name_url) self.threadLock.release() ç”¨æˆ·åŠ å…¥redisçš„æ“ä½œï¼Œåœ¨æ•°æ®åº“æ’å…¥å‡ºé”™æ—¶æˆ‘ä»¬è°ƒç”¨del_already_useråˆ é™¤æ’å…¥å‡ºé”™çš„ç”¨æˆ· 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879# åˆ†æç²‰ä¸é¡µé¢è·å–ç”¨æˆ·çš„æ‰€æœ‰ç²‰ä¸ç”¨æˆ·# @param follower_page get_follower_page()ä¸­è·å–åˆ°çš„é¡µé¢ï¼Œè¿™é‡Œè·å–ç”¨æˆ·hash_idè¯·æ±‚ç²‰ä¸æ¥å£è·å–ç²‰ä¸ä¿¡æ¯def get_all_follower(self, name_url): follower_page = self.get_follower_page(name_url) # åˆ¤æ–­æ˜¯å¦è·å–åˆ°é¡µé¢ if not follower_page: return BS = BeautifulSoup(follower_page, 'html.parser') # è·å–å…³æ³¨è€…æ•°é‡ follower_num = int(BS.find('span', text='å…³æ³¨è€…').find_parent().find('strong').get_text()) # è·å–ç”¨æˆ·çš„hash_id hash_id = \\ json.loads(BS.select(\"#zh-profile-follows-list\")[0].select(\".zh-general-list\")[0].get('data-init'))[ 'params'][ 'hash_id'] # è·å–å…³æ³¨è€…åˆ—è¡¨ self.get_xsrf(follower_page) # è·å–xsrf post_url = 'https://www.zhihu.com/node/ProfileFollowersListV2' # å¼€å§‹è·å–æ‰€æœ‰çš„å…³æ³¨è€… math.ceil(follower_num/20)*20 for i in range(0, math.ceil(follower_num / 20) * 20, 20): post_data = &#123; 'method': 'next', 'params': json.dumps(&#123;\"offset\": i, \"order_by\": \"created\", \"hash_id\": hash_id&#125;) &#125; try: j = self.session.post(post_url, params=post_data, headers=self.headers, timeout=35).text.encode( 'latin-1').decode( 'unicode-escape') pattern = re.compile(r\"class=\\\"zm-item-link-avatar\\\"[^\\\"]*\\\"([^\\\"]*)\", re.DOTALL) j = pattern.findall(j) for user in j: user = user.replace('\\\\', '') self.add_wait_user(user) # ä¿å­˜åˆ°redis except Exception as err: print(\"è·å–æ­£åœ¨å…³æ³¨å¤±è´¥\") print(err) traceback.print_exc() pass# è·å–æ­£åœ¨å…³æ³¨åˆ—è¡¨def get_all_following(self, name_url): following_page = self.get_following_page(name_url) # åˆ¤æ–­æ˜¯å¦è·å–åˆ°é¡µé¢ if not following_page: return BS = BeautifulSoup(following_page, 'html.parser') # è·å–å…³æ³¨è€…æ•°é‡ following_num = int(BS.find('span', text='å…³æ³¨äº†').find_parent().find('strong').get_text()) # è·å–ç”¨æˆ·çš„hash_id hash_id = \\ json.loads(BS.select(\"#zh-profile-follows-list\")[0].select(\".zh-general-list\")[0].get('data-init'))[ 'params'][ 'hash_id'] # è·å–å…³æ³¨è€…åˆ—è¡¨ self.get_xsrf(following_page) # è·å–xsrf post_url = 'https://www.zhihu.com/node/ProfileFolloweesListV2' # å¼€å§‹è·å–æ‰€æœ‰çš„å…³æ³¨è€… math.ceil(follower_num/20)*20 for i in range(0, math.ceil(following_num / 20) * 20, 20): post_data = &#123; 'method': 'next', 'params': json.dumps(&#123;\"offset\": i, \"order_by\": \"created\", \"hash_id\": hash_id&#125;) &#125; try: j = self.session.post(post_url, params=post_data, headers=self.headers, timeout=35).text.encode( 'latin-1').decode( 'unicode-escape') pattern = re.compile(r\"class=\\\"zm-item-link-avatar\\\"[^\\\"]*\\\"([^\\\"]*)\", re.DOTALL) j = pattern.findall(j) for user in j: user = user.replace('\\\\', '') self.add_wait_user(user) # ä¿å­˜åˆ°redis except Exception as err: print(\"è·å–æ­£åœ¨å…³æ³¨å¤±è´¥\") print(err) traceback.print_exc() pass è°ƒç”¨çŸ¥ä¹çš„APIï¼Œè·å–æ‰€æœ‰çš„å…³æ³¨ç”¨æˆ·åˆ—è¡¨å’Œç²‰ä¸ç”¨æˆ·åˆ—è¡¨ï¼Œé€’å½’è·å–ç”¨æˆ·è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¤´éƒ¨è¦è®°å¾—å¸¦ä¸Šxsrfä¸ç„¶ä¼šæŠ›å‡º403 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788# åˆ†æabouté¡µé¢ï¼Œè·å–ç”¨æˆ·è¯¦ç»†èµ„æ–™def get_user_info(self, name_url): about_page = self.get_user_page(name_url) # åˆ¤æ–­æ˜¯å¦è·å–åˆ°é¡µé¢ if not about_page: print(\"è·å–ç”¨æˆ·è¯¦æƒ…é¡µé¢å¤±è´¥ï¼Œè·³è¿‡ï¼Œname_urlï¼š\" + name_url) return self.get_xsrf(about_page) BS = BeautifulSoup(about_page, 'html.parser') # è·å–é¡µé¢çš„å…·ä½“æ•°æ® try: nickname = BS.find(\"a\", class_=\"name\").get_text() if BS.find(\"a\", class_=\"name\") else '' user_type = name_url[1:name_url.index('/', 1)] self_domain = name_url[name_url.index('/', 1) + 1:] gender = 2 if BS.find(\"i\", class_=\"icon icon-profile-female\") else (1 if BS.find(\"i\", class_=\"icon icon-profile-male\") else 3) follower_num = int(BS.find('span', text='å…³æ³¨è€…').find_parent().find('strong').get_text()) following_num = int(BS.find('span', text='å…³æ³¨äº†').find_parent().find('strong').get_text()) agree_num = int(re.findall(r'&lt;strong&gt;(.*)&lt;/strong&gt;.*èµåŒ', about_page)[0]) appreciate_num = int(re.findall(r'&lt;strong&gt;(.*)&lt;/strong&gt;.*æ„Ÿè°¢', about_page)[0]) star_num = int(re.findall(r'&lt;strong&gt;(.*)&lt;/strong&gt;.*æ”¶è—', about_page)[0]) share_num = int(re.findall(r'&lt;strong&gt;(.*)&lt;/strong&gt;.*åˆ†äº«', about_page)[0]) browse_num = int(BS.find_all(\"span\", class_=\"zg-gray-normal\")[2].find(\"strong\").get_text()) trade = BS.find(\"span\", class_=\"business item\").get('title') if BS.find(\"span\", class_=\"business item\") else '' company = BS.find(\"span\", class_=\"employment item\").get('title') if BS.find(\"span\", class_=\"employment item\") else '' school = BS.find(\"span\", class_=\"education item\").get('title') if BS.find(\"span\", class_=\"education item\") else '' major = BS.find(\"span\", class_=\"education-extra item\").get('title') if BS.find(\"span\", class_=\"education-extra item\") else '' job = BS.find(\"span\", class_=\"position item\").get_text() if BS.find(\"span\", class_=\"position item\") else '' location = BS.find(\"span\", class_=\"location item\").get('title') if BS.find(\"span\", class_=\"location item\") else '' description = BS.find(\"div\", class_=\"bio ellipsis\").get('title') if BS.find(\"div\", class_=\"bio ellipsis\") else '' ask_num = int(BS.find_all(\"a\", class_='item')[1].find(\"span\").get_text()) if \\ BS.find_all(\"a\", class_='item')[ 1] else int(0) answer_num = int(BS.find_all(\"a\", class_='item')[2].find(\"span\").get_text()) if \\ BS.find_all(\"a\", class_='item')[ 2] else int(0) article_num = int(BS.find_all(\"a\", class_='item')[3].find(\"span\").get_text()) if \\ BS.find_all(\"a\", class_='item')[3] else int(0) collect_num = int(BS.find_all(\"a\", class_='item')[4].find(\"span\").get_text()) if \\ BS.find_all(\"a\", class_='item')[4] else int(0) public_edit_num = int(BS.find_all(\"a\", class_='item')[5].find(\"span\").get_text()) if \\ BS.find_all(\"a\", class_='item')[5] else int(0) replace_data = \\ (pymysql.escape_string(name_url), nickname, self_domain, user_type, gender, follower_num, following_num, agree_num, appreciate_num, star_num, share_num, browse_num, trade, company, school, major, job, location, pymysql.escape_string(description), ask_num, answer_num, article_num, collect_num, public_edit_num) replace_sql = '''REPLACE INTO user(url,nickname,self_domain,user_type, gender, follower,following,agree_num,appreciate_num,star_num,share_num,browse_num, trade,company,school,major,job,location,description, ask_num,answer_num,article_num,collect_num,public_edit_num) VALUES(%s,%s,%s,%s, %s,%s,%s,%s,%s,%s,%s,%s, %s,%s,%s,%s,%s,%s,%s, %s,%s,%s,%s,%s)''' try: print(\"è·å–åˆ°æ•°æ®ï¼š\") print(replace_data) self.db_cursor.execute(replace_sql, replace_data) self.db.commit() except Exception as err: print(\"æ’å…¥æ•°æ®åº“å‡ºé”™\") print(\"è·å–åˆ°æ•°æ®ï¼š\") print(replace_data) print(\"æ’å…¥è¯­å¥ï¼š\" + self.db_cursor._last_executed) self.db.rollback() print(err) traceback.print_exc() except Exception as err: print(\"è·å–æ•°æ®å‡ºé”™ï¼Œè·³è¿‡ç”¨æˆ·\") self.redis_con.hdel(\"already_get_user\", name_url) self.del_already_user(name_url) print(err) traceback.print_exc() pass æœ€åï¼Œåˆ°ç”¨æˆ·çš„abouté¡µé¢ï¼Œåˆ†æé¡µé¢å…ƒç´ ï¼Œåˆ©ç”¨æ­£åˆ™æˆ–è€…beatifulsoupåˆ†ææŠ“å–é¡µé¢çš„æ•°æ®è¿™é‡Œæˆ‘ä»¬SQLè¯­å¥ç”¨REPLACE INTOè€Œä¸ç”¨INSERT INTOï¼Œè¿™æ ·å¯ä»¥å¾ˆå¥½çš„é˜²æ­¢æ•°æ®é‡å¤é—®é¢˜ 123456789101112131415161718# å¼€å§‹æŠ“å–ç”¨æˆ·ï¼Œç¨‹åºæ€»å…¥å£def entrance(self): while 1: if int(self.redis_con.llen(\"user_queue\")) &lt; 1: self.get_index_page_user() else: # å‡ºé˜Ÿåˆ—è·å–ç”¨æˆ·name_url rediså–å‡ºçš„æ˜¯byteï¼Œè¦decodeæˆutf-8 name_url = str(self.redis_con.rpop(\"user_queue\").decode('utf-8')) print(\"æ­£åœ¨å¤„ç†name_urlï¼š\" + name_url) self.get_user_info(name_url) if int(self.redis_con.llen(\"user_queue\")) &lt;= int(self.max_queue_len): self.get_all_follower(name_url) self.get_all_following(name_url) self.session.cookies.save()def run(self): print(self.name + \" is running\") self.entrance() æœ€åï¼Œå…¥å£ 12345678910111213if __name__ == '__main__': login = GetUser(999, \"ç™»é™†çº¿ç¨‹\") threads = [] for i in range(0, 4): m = GetUser(i, \"thread\" + str(i)) threads.append(m) for i in range(0, 4): threads[i].start() for i in range(0, 4): threads[i].join() è¿™é‡Œå°±æ˜¯å¤šçº¿ç¨‹çš„å¼€å¯ï¼Œéœ€è¦å¼€å¯å¤šå°‘ä¸ªçº¿ç¨‹å°±æŠŠ4æ¢æˆå¤šå°‘å°±å¯ä»¥äº† æ„Ÿè°¢é˜…è¯»^_^!","tags":[{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://github.com/kong36088/kong36088.github.io/tags/çˆ¬è™«/"},{"name":"python","slug":"python","permalink":"https://github.com/kong36088/kong36088.github.io/tags/python/"}]},{"title":"PHPå†…æ ¸ä¸­çš„HashTable","date":"2016-11-01T07:24:25.000Z","path":"2016/11/01/PHPå†…æ ¸ä¸­çš„HashTable/","text":"PHPå†…æ ¸ä¸­çš„HashTableåŸç†ç®€æ˜“çš„ç»“æ„12345678910111213typedef struct _Bucket&#123; char *key; void *value; struct _Bucket *next;&#125; Bucket; typedef struct _HashTable&#123; int size; int elem_num; Bucket** buckets;&#125; HashTable; è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€åŒ–è¿‡çš„å“ˆå¸Œè¡¨ç»“æ„Bucketæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œ_HashTableç”¨äºå­˜å‚¨hashå€¼å¹¶æŒ‡å‘çœŸæ­£çš„æ•°æ®å‚¨å­˜å•ä½ è§£å†³å†²çªç®—æ³•DJBX33Aè€Œé“¾è¡¨æ˜¯ä¸ºäº†è§£å†³å†²çªç”¨çš„ï¼Œå†²çªè§£å†³é‡‡ç”¨DJBX33Aç®—æ³•ï¼Œç®—æ³•çš„å†…å®¹å¦‚ä¸‹1234567891011121314151617181920212223242526inline unsigned time33(char const*str, int len) &#123; unsigned long hash = 5381; /* variant with the hash unrolled eight times */ for (; len &gt;= 8; len -= 8) &#123; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; hash = ((hash &lt;&lt; 5) + hash) + *str++; &#125; switch (len) &#123; case 7: hash = ((hash &lt;&lt; 5) + hash) + *str++; /* fallthrough... */ case 6: hash = ((hash &lt;&lt; 5) + hash) + *str++; /* fallthrough... */ case 5: hash = ((hash &lt;&lt; 5) + hash) + *str++; /* fallthrough... */ case 4: hash = ((hash &lt;&lt; 5) + hash) + *str++; /* fallthrough... */ case 3: hash = ((hash &lt;&lt; 5) + hash) + *str++; /* fallthrough... */ case 2: hash = ((hash &lt;&lt; 5) + hash) + *str++; /* fallthrough... */ case 1: hash = ((hash &lt;&lt; 5) + hash) + *str++; break; case 0: break; &#125; return hash; &#125; HashTableçš„åˆå§‹åŒ–åˆå§‹åŒ–ï¼Œç”³è¯·ç©ºé—´å¹¶ä¸”è®¾ç½®åˆå§‹åŒ–å€¼123456789101112int hash_init(HashTable *ht)&#123; ht-&gt;size = HASH_TABLE_INIT_SIZE; ht-&gt;elem_num = 0; ht-&gt;buckets = (Bucket **)calloc(ht-&gt;size, sizeof(Bucket *)); if(ht-&gt;buckets == NULL) return FAILED; LOG_MSG(\"[init]\\tsize: %i\\n\", ht-&gt;size); return SUCCESS;&#125; HashTableçš„æ’å…¥æ’å…¥å‡½æ•°ï¼Œæ’å…¥æ—¶éªŒè¯keyæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨æ›´æ–°valueå€¼ï¼Œä¸å­˜åœ¨å¹¶å–å‘ç”Ÿå†²çªåˆ™åˆ›å»ºæ–°èŠ‚ç‚¹å¹¶æ’å…¥åˆ°åŸæœ‰é“¾è¡¨çš„å¤´éƒ¨123456789101112131415161718192021222324252627282930313233343536373839404142434445int hash_insert(HashTable *ht, char *key, void *value)&#123; // check if we need to resize the hashtable resize_hash_table_if_needed(ht); int index = HASH_INDEX(ht, key); Bucket *org_bucket = ht-&gt;buckets[index]; Bucket *tmp_bucket = org_bucket; // check if the key exits already while(tmp_bucket) &#123; if(strcmp(key, tmp_bucket-&gt;key) == 0) &#123; LOG_MSG(\"[update]\\tkey: %s\\n\", key); tmp_bucket-&gt;value = value; return SUCCESS; &#125; tmp_bucket = tmp_bucket-&gt;next; &#125; Bucket *bucket = (Bucket *)malloc(sizeof(Bucket)); bucket-&gt;key = key; bucket-&gt;value = value; bucket-&gt;next = NULL; ht-&gt;elem_num += 1; if(org_bucket != NULL) &#123; LOG_MSG(\"[collision]\\tindex:%d key:%s\\n\", index, key); bucket-&gt;next = org_bucket; &#125; ht-&gt;buckets[index]= bucket; LOG_MSG(\"[insert]\\tindex:%d key:%s\\tht(num:%d)\\n\", index, key, ht-&gt;elem_num); return SUCCESS;&#125; HashTableçš„æ‰©å®¹å½“Hashè¡¨å®¹é‡æ»¡äº†çš„æ—¶å€™ï¼ŒHashè¡¨çš„æ€§èƒ½ä¼šä¸‹é™ï¼Œè¿™æ—¶å€™éœ€è¦å¯¹Hashè¡¨è¿›è¡Œæ‰©å®¹å…ˆæŠŠåŸæ¥Hashè¡¨å®¹é‡å˜æˆä¸¤å€ï¼Œç„¶åå¯¹å…¶è¿›è¡Œé‡æ–°æ’å…¥æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)1234567891011121314151617181920212223242526272829303132333435363738394041424344static void resize_hash_table_if_needed(HashTable *ht)&#123; if(ht-&gt;size - ht-&gt;elem_num &lt; 1) &#123; hash_resize(ht); &#125;&#125; static int hash_resize(HashTable *ht)&#123; // double the size int org_size = ht-&gt;size; ht-&gt;size = ht-&gt;size * 2; ht-&gt;elem_num = 0; LOG_MSG(\"[resize]\\torg size: %i\\tnew size: %i\\n\", org_size, ht-&gt;size); Bucket **buckets = (Bucket **)calloc(ht-&gt;size, sizeof(Bucket *)); Bucket **org_buckets = ht-&gt;buckets; ht-&gt;buckets = buckets; int i = 0; for(i=0; i &lt; org_size; ++i) &#123; Bucket *cur = org_buckets[i]; Bucket *tmp; while(cur) &#123; // rehash: insert again hash_insert(ht, cur-&gt;key, cur-&gt;value); // free the org bucket, but not the element tmp = cur; cur = cur-&gt;next; free(tmp); &#125; &#125; free(org_buckets); LOG_MSG(\"[resize] done\\n\"); return SUCCESS;&#125; HashTableçš„æŸ¥æ‰¾å…ƒç´ çš„æŸ¥æ‰¾å’Œæ’å…¥é‡‡å–ç›¸åŒçš„ç­–ç•¥ï¼Œéƒ½æ˜¯å…ˆè·å¾—hashå€¼ï¼Œç„¶åå–å¾—bucketé“¾è¡¨ï¼Œéšåæ¯”è¾ƒé”®åè¿›è¡ŒæŸ¥æ‰¾12345678910111213141516171819202122232425int hash_lookup(HashTable *ht, char *key, void **result)&#123; int index = HASH_INDEX(ht, key); Bucket *bucket = ht-&gt;buckets[index]; if(bucket == NULL) goto failed; while(bucket) &#123; if(strcmp(bucket-&gt;key, key) == 0) &#123; LOG_MSG(\"[lookup]\\t found %s\\tindex:%i value: %p\\n\", key, index, bucket-&gt;value); *result = bucket-&gt;value; return SUCCESS; &#125; bucket = bucket-&gt;next; &#125; failed: LOG_MSG(\"[lookup]\\t key:%s\\tfailed\\t\\n\", key); return FAILED;&#125; å‚è€ƒå“ˆå¸Œè¡¨(HashTable)","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å†…æ ¸/"}]},{"title":"PHPå†…æ ¸å“ˆå¸Œè¡¨å®ç°","date":"2016-11-01T06:24:25.000Z","path":"2016/11/01/PHPå†…æ ¸å“ˆå¸Œè¡¨å®ç°/","text":"å“ˆå¸Œè¡¨ç»“æ„å…ˆçœ‹çœ‹å“ˆå¸Œè¡¨çš„ç»“æ„1234567891011121314151617typedef struct _hashtable &#123; uint nTableSize; // hash Bucketçš„å¤§å°ï¼Œæœ€å°ä¸º8ï¼Œä»¥2xå¢é•¿ã€‚ uint nTableMask; // nTableSize-1 ï¼Œ ç´¢å¼•å–å€¼çš„ä¼˜åŒ– uint nNumOfElements; // hash Bucketä¸­å½“å‰å­˜åœ¨çš„å…ƒç´ ä¸ªæ•°ï¼Œcount()å‡½æ•°ä¼šç›´æ¥è¿”å›æ­¤å€¼ ulong nNextFreeElement; // ä¸‹ä¸€ä¸ªæ•°å­—ç´¢å¼•çš„ä½ç½®ï¼Œå½“æ•°ç»„æˆå‘˜æ²¡æœ‰æŒ‡å®šé”®å€¼æ—¶åˆ™é‡‡ç”¨è¯¥æ•°å­—ç´¢å¼• Bucket *pInternalPointer; // å½“å‰éå†çš„æŒ‡é’ˆï¼ˆforeachæ¯”forå¿«çš„åŸå› ä¹‹ä¸€ï¼‰ Bucket *pListHead; // å­˜å‚¨æ•°ç»„å¤´å…ƒç´ æŒ‡é’ˆ Bucket *pListTail; // å­˜å‚¨æ•°ç»„å°¾å…ƒç´ æŒ‡é’ˆ Bucket **arBuckets; // å­˜å‚¨hashæ•°ç»„ dtor_func_t pDestructor; // åœ¨åˆ é™¤å…ƒç´ æ—¶æ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œç”¨äºèµ„æºçš„é‡Šæ”¾ zend_bool persistent; //æŒ‡å‡ºäº†Bucketå†…å­˜åˆ†é…çš„æ–¹å¼ã€‚å¦‚æœpersisientä¸ºTRUEï¼Œåˆ™ä½¿ç”¨æ“ä½œç³»ç»Ÿæœ¬èº«çš„å†…å­˜åˆ†é…å‡½æ•°ä¸ºBucketåˆ†é…å†…å­˜ï¼Œå¦åˆ™ä½¿ç”¨PHPçš„å†…å­˜åˆ†é…å‡½æ•°ã€‚ unsigned char nApplyCount; // æ ‡è®°å½“å‰hash Bucketè¢«é€’å½’è®¿é—®çš„æ¬¡æ•°ï¼ˆé˜²æ­¢å¤šæ¬¡é€’å½’ï¼‰ zend_bool bApplyProtection;// æ ‡è®°å½“å‰hashæ¡¶å…è®¸ä¸å…è®¸å¤šæ¬¡è®¿é—®ï¼Œä¸å…è®¸æ—¶ï¼Œæœ€å¤šåªèƒ½é€’å½’3æ¬¡#if ZEND_DEBUG int inconsistent;#endif&#125; HashTable; PHPçš„GCï¼ˆå†…å­˜å›æ”¶ï¼‰æœºåˆ¶å°±æ˜¯æ ¹æ®nNumOfElementså¤§å°æ¥è¿›è¡Œåˆ¤æ–­ï¼Œå½“é‡‡å–unset()æ—¶ï¼Œè¯¥å­—æ®µçš„å€¼å‡ä¸€ï¼Œåœ¨å­—æ®µå€¼ä¸º0æ—¶è¿›è¡Œå†…å­˜å›æ”¶é¦–å…ˆåˆå§‹åŒ–HashTableçš„å¤§å°ä¸º8 åˆå§‹åŒ–123456789101112131415161718192021222324252627282930313233ZEND_API int _zend_hash_init(HashTable *ht, uint nSize, hash_func_t pHashFunction, dtor_func_t pDestructor, zend_bool persistent ZEND_FILE_LINE_DC)&#123; uint i = 3; //... if (nSize &gt;= 0x80000000) &#123; /* prevent overflow */ ht-&gt;nTableSize = 0x80000000; &#125; else &#123; while ((1U &lt;&lt; i) &lt; nSize) &#123; i++; &#125; ht-&gt;nTableSize = 1 &lt;&lt; i; &#125; // ... ht-&gt;nTableMask = ht-&gt;nTableSize - 1; /* Uses ecalloc() so that Bucket* == NULL */ if (persistent) &#123; tmp = (Bucket **) calloc(ht-&gt;nTableSize, sizeof(Bucket *)); if (!tmp) &#123; return FAILURE; &#125; ht-&gt;arBuckets = tmp; &#125; else &#123; tmp = (Bucket **) ecalloc_rel(ht-&gt;nTableSize, sizeof(Bucket *)); if (tmp) &#123; ht-&gt;arBuckets = tmp; &#125; &#125; return SUCCESS;&#125; ä¾‹å¦‚å¦‚æœè®¾ç½®åˆå§‹å¤§å°ä¸º10ï¼Œåˆ™ä¸Šé¢çš„ç®—æ³•å°†ä¼šå°†å¤§å°è°ƒæ•´ä¸º16ã€‚ä¹Ÿå°±æ˜¯å§‹ç»ˆå°†å¤§å°è°ƒæ•´ä¸ºæ¥è¿‘åˆå§‹å¤§å°çš„2çš„æ•´æ•°æ¬¡æ–¹ã€‚ä¸ºä»€ä¹ˆä¼šåšè¿™æ ·çš„è°ƒæ•´å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹HashTableå°†å“ˆå¸Œå€¼æ˜ å°„åˆ°æ§½ä½çš„æ–¹æ³•ï¼Œä¸Šä¸€å°èŠ‚æˆ‘ä»¬ä½¿ç”¨äº†å–æ¨¡çš„æ–¹å¼æ¥å°†å“ˆå¸Œå€¼æ˜ å°„åˆ°æ§½ä½ï¼Œä¾‹å¦‚å¤§å°ä¸º8çš„å“ˆå¸Œè¡¨ï¼Œå“ˆå¸Œå€¼ä¸º100ï¼Œ åˆ™æ˜ å°„çš„æ§½ä½ç´¢å¼•ä¸º: 100 % 8 = 4ï¼Œç”±äºç´¢å¼•é€šå¸¸ä»0å¼€å§‹ï¼Œæ‰€ä»¥æ§½ä½çš„ç´¢å¼•å€¼ä¸º3ï¼Œåœ¨PHPä¸­ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼è®¡ç®—ç´¢å¼•ï¼š h = zend_inline_hash_func(arKey, nKeyLength);nIndex = h &amp; ht-&gt;nTableMask;ä»ä¸Šé¢çš„_zend_hash_init()å‡½æ•°ä¸­å¯çŸ¥ï¼Œht-&gt;nTableMaskçš„å¤§å°ä¸ºht-&gt;nTableSize -1ã€‚è¿™é‡Œä½¿ç”¨&amp;æ“ä½œè€Œä¸æ˜¯ä½¿ç”¨å–æ¨¡ï¼Œè¿™æ˜¯å› ä¸ºæ˜¯ç›¸å¯¹æ¥è¯´å–æ¨¡æ“ä½œçš„æ¶ˆè€—å’ŒæŒ‰ä½ä¸çš„æ“ä½œå¤§å¾ˆå¤šã€‚ Bucketç»“æ„123456789101112typedef struct bucket &#123; ulong h; // å¯¹char *keyè¿›è¡Œhashåçš„å€¼ï¼Œæˆ–è€…æ˜¯ç”¨æˆ·æŒ‡å®šçš„æ•°å­—ç´¢å¼•å€¼ uint nKeyLength; // hashå…³é”®å­—çš„é•¿åº¦ï¼Œå¦‚æœæ•°ç»„ç´¢å¼•ä¸ºæ•°å­—ï¼Œæ­¤å€¼ä¸º0 void *pData; // æŒ‡å‘valueï¼Œä¸€èˆ¬æ˜¯ç”¨æˆ·æ•°æ®çš„å‰¯æœ¬ï¼Œå¦‚æœæ˜¯æŒ‡é’ˆæ•°æ®ï¼Œåˆ™æŒ‡å‘pDataPtr void *pDataPtr; //å¦‚æœæ˜¯æŒ‡é’ˆæ•°æ®ï¼Œæ­¤å€¼ä¼šæŒ‡å‘çœŸæ­£çš„valueï¼ŒåŒæ—¶ä¸Šé¢pDataä¼šæŒ‡å‘æ­¤å€¼ struct bucket *pListNext; // æ•´ä¸ªhashè¡¨çš„ä¸‹ä¸€å…ƒç´  struct bucket *pListLast; // æ•´ä¸ªå“ˆå¸Œè¡¨è¯¥å…ƒç´ çš„ä¸Šä¸€ä¸ªå…ƒç´  struct bucket *pNext; // å­˜æ”¾åœ¨åŒä¸€ä¸ªhash Bucketå†…çš„ä¸‹ä¸€ä¸ªå…ƒç´  struct bucket *pLast; // åŒä¸€ä¸ªå“ˆå¸Œbucketçš„ä¸Šä¸€ä¸ªå…ƒç´  // ä¿å­˜å½“å‰å€¼æ‰€å¯¹äºçš„keyå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—æ®µåªèƒ½å®šä¹‰åœ¨æœ€åï¼Œå®ç°å˜é•¿ç»“æ„ä½“ char arKey[1]; &#125; Bucket; å¦‚ä¸Šé¢å„å­—æ®µçš„æ³¨é‡Šã€‚hå­—æ®µä¿å­˜å“ˆå¸Œè¡¨keyå“ˆå¸Œåçš„å€¼ã€‚è¿™é‡Œä¿å­˜çš„å“ˆå¸Œå€¼è€Œä¸æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•å€¼ï¼Œè¿™æ˜¯å› ä¸ºç´¢å¼•å€¼å’Œå“ˆå¸Œè¡¨çš„å®¹é‡æœ‰ç›´æ¥å…³ç³»ï¼Œå¦‚æœå“ˆå¸Œè¡¨æ‰©å®¹äº†ï¼Œé‚£ä¹ˆè¿™äº›ç´¢å¼•è¿˜å¾—é‡æ–°è¿›è¡Œå“ˆå¸Œåœ¨è¿›è¡Œç´¢å¼•æ˜ å°„ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ä¼˜åŒ–æ‰‹æ®µã€‚åœ¨PHPä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ä½œä¸ºæ•°ç»„çš„ç´¢å¼•ã€‚æ•°å­—ç´¢å¼•ç›´æ¥å°±å¯ä»¥ä½œä¸ºå“ˆå¸Œè¡¨çš„ç´¢å¼•ï¼Œæ•°å­—ä¹Ÿæ— éœ€è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚hå­—æ®µåé¢çš„nKeyLengthå­—æ®µæ˜¯ä½œä¸ºkeyé•¿åº¦çš„æ ‡ç¤ºï¼Œå¦‚æœç´¢å¼•æ˜¯æ•°å­—çš„è¯ï¼Œåˆ™nKeyLengthä¸º0ã€‚åœ¨PHPæ•°ç»„ä¸­å¦‚æœç´¢å¼•å­—ç¬¦ä¸²å¯ä»¥è¢«è½¬æ¢æˆæ•°å­—ä¹Ÿä¼šè¢«è½¬æ¢æˆæ•°å­—ç´¢å¼•ã€‚æ‰€ä»¥åœ¨PHPä¸­ä¾‹å¦‚â€™10â€™ï¼Œâ€™11â€™è¿™ç±»çš„å­—ç¬¦ç´¢å¼•å’Œæ•°å­—ç´¢å¼•10ï¼Œ 11æ²¡æœ‰åŒºåˆ«ã€‚ HashTableæ¥å£çš„è°ƒç”¨è¿™é‡Œä»‹ç»çš„æ˜¯æ’å…¥æ“ä½œï¼Œå¯¹äºæ•°ç»„çš„æ·»åŠ æ“ä½œï¼Œå…¶æœ€ç»ˆè°ƒç”¨çš„éƒ½æ˜¯è¯¥æ¥å£æ‰€ä»¥è¿™é‡Œä¸»è¦é’ˆå¯¹æ’å…¥æ¥å£è¿›è¡Œä»‹ç»1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253ZEND_API int _zend_hash_add_or_update(HashTable *ht, const char *arKey, uint nKeyLength, void *pData, uint nDataSize, void **pDest, int flag ZEND_FILE_LINE_DC)&#123; //...çœç•¥å˜é‡åˆå§‹åŒ–å’ŒnKeyLength &lt;=0 çš„å¼‚å¸¸å¤„ç† h = zend_inline_hash_func(arKey, nKeyLength); nIndex = h &amp; ht-&gt;nTableMask; p = ht-&gt;arBuckets[nIndex]; while (p != NULL) &#123; if ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength)) &#123; if (!memcmp(p-&gt;arKey, arKey, nKeyLength)) &#123; // æ›´æ–°æ“ä½œ if (flag &amp; HASH_ADD) &#123; return FAILURE; &#125; HANDLE_BLOCK_INTERRUPTIONS(); //..çœç•¥debugè¾“å‡º if (ht-&gt;pDestructor) &#123; ht-&gt;pDestructor(p-&gt;pData); &#125; UPDATE_DATA(ht, p, pData, nDataSize); if (pDest) &#123; *pDest = p-&gt;pData; &#125; HANDLE_UNBLOCK_INTERRUPTIONS(); return SUCCESS; &#125; &#125; p = p-&gt;pNext; &#125; p = (Bucket *) pemalloc(sizeof(Bucket) - 1 + nKeyLength, ht-&gt;persistent); if (!p) &#123; return FAILURE; &#125; memcpy(p-&gt;arKey, arKey, nKeyLength); p-&gt;nKeyLength = nKeyLength; INIT_DATA(ht, p, pData, nDataSize); p-&gt;h = h; CONNECT_TO_BUCKET_DLLIST(p, ht-&gt;arBuckets[nIndex]); //BucketåŒå‘é“¾è¡¨æ“ä½œ if (pDest) &#123; *pDest = p-&gt;pData; &#125; HANDLE_BLOCK_INTERRUPTIONS(); CONNECT_TO_GLOBAL_DLLIST(p, ht); // å°†æ–°çš„Bucketå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„é“¾æ¥è¡¨çš„æœ€åé¢ ht-&gt;arBuckets[nIndex] = p; HANDLE_UNBLOCK_INTERRUPTIONS(); ht-&gt;nNumOfElements++; ZEND_HASH_IF_FULL_DO_RESIZE(ht); /* å¦‚æœæ­¤æ—¶æ•°ç»„çš„å®¹é‡æ»¡äº†ï¼Œåˆ™å¯¹å…¶è¿›è¡Œæ‰©å®¹ã€‚*/ return SUCCESS;&#125; ç”Ÿæˆhashå€¼ï¼Œé€šè¿‡ä¸nTableMaskæ‰§è¡Œä¸æ“ä½œï¼Œè·å–åœ¨arBucketsæ•°ç»„ä¸­çš„Bucketã€‚ å¦‚æœBucketä¸­å·²ç»å­˜åœ¨å…ƒç´ ï¼Œåˆ™éå†æ•´ä¸ªBucketï¼ŒæŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒçš„keyå€¼å…ƒç´ ï¼Œå¦‚æœæœ‰å¹¶ä¸”æ˜¯updateè°ƒç”¨ï¼Œåˆ™æ‰§è¡Œupdateæ•°æ®æ“ä½œã€‚ åˆ›å»ºæ–°çš„Bucketå…ƒç´ ï¼Œåˆå§‹åŒ–æ•°æ®ï¼Œå¹¶å°†æ–°å…ƒç´ æ·»åŠ åˆ°å½“å‰hashå€¼å¯¹åº”çš„Bucketé“¾è¡¨çš„æœ€å‰é¢ï¼ˆCONNECT_TO_BUCKET_DLLISTï¼‰ã€‚ å°†æ–°çš„Bucketå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„é“¾æ¥è¡¨çš„æœ€åé¢ï¼ˆCONNECT_TO_GLOBAL_DLLISTï¼‰ã€‚ å°†å…ƒç´ ä¸ªæ•°åŠ 1ï¼Œå¦‚æœæ­¤æ—¶æ•°ç»„çš„å®¹é‡æ»¡äº†ï¼Œåˆ™å¯¹å…¶è¿›è¡Œæ‰©å®¹ã€‚è¿™é‡Œçš„åˆ¤æ–­æ˜¯ä¾æ®nNumOfElementså’ŒnTableSizeçš„å¤§å°ã€‚å¦‚æœnNumOfElements &gt; nTableSizeåˆ™ä¼šè°ƒç”¨zend_hash_do_resizeä»¥2Xçš„æ–¹å¼æ‰©å®¹ï¼ˆnTableSize &lt;&lt; 1ï¼‰ã€‚ æ›´å¤šHashTableçš„å…·ä½“æ¥å£æ“ä½œå¯ä»¥æŸ¥çœ‹ä¸Šä¸€èŠ‚å†…å®¹ å‚è€ƒèµ„æ–™PHPçš„å“ˆå¸Œè¡¨å®ç°","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å†…æ ¸/"}]},{"title":"å…³äºpythonçˆ¬è™«çš„æ·±å‘ï¼šrequestsæŠ›å‡ºå¼‚å¸¸Max retries exceeded with url","date":"2016-10-29T06:24:25.000Z","path":"2016/10/29/å…³äºpythonçˆ¬è™«çš„æ·±å‘ï¼šrequestsæŠ›å‡ºå¼‚å¸¸Max retries exceeded with url/","text":"1requests.packages.urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='www.zhihu.com', port=443): Max retries exceeded with url: /people/claire-98-77/about (Caused by NewConnectionError('&lt;requests.packages.urllib3.connection.VerifiedHTTPSConnection object at 0x7f2ee28c6588&gt;: Failed to establish a new connection: [Errno -3] Temporary failure in name resolution',)) åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­æŠ›å‡ºè¯¥é”™è¯¯ï¼Œåœ¨googleæŸ¥äº†å¾ˆä¹…ï¼Œæ€»ç»“å¦‚ä¸‹ï¼šhttpçš„è¿æ¥æ•°è¶…è¿‡æœ€å¤§é™åˆ¶ï¼Œé»˜è®¤çš„æƒ…å†µä¸‹è¿æ¥æ˜¯Keep-aliveçš„ï¼Œæ‰€ä»¥è¿™å°±å¯¼è‡´äº†æœåŠ¡å™¨ä¿æŒäº†å¤ªå¤šè¿æ¥è€Œä¸èƒ½å†æ–°å»ºè¿æ¥è§£å†³æ–¹æ¡ˆï¼š è§£å†³ä¸€ï¼šerror trace is misleading it should be something like â€œNo connection could be made because the target machine actively refused itâ€. å› ä¸ºç›®æ ‡åœ°å€æ‹’ç»è¿æ¥è€Œäº§ç”Ÿçš„å¼‚å¸¸1234try: page1 = requests.get(ap)except requests.exceptions.ConnectionError: r.status_code = \"Connection refused\" è§£å†³äºŒï¼š äº§ç”Ÿçš„è¿æ¥æ•°è¿‡å¤šè€Œå¯¼è‡´Max retries exceededåœ¨headerä¸­ä¸ä½¿ç”¨æŒä¹…è¿æ¥&#39;Connection&#39;: &#39;close&#39;æˆ–requests.adapters.DEFAULT_RETRIES = 5 è§£å†³ä¸‰ï¼šå…¶å®è¿™ä¸ªå¼‚å¸¸ä¹Ÿæœ‰å¦ä¸€ç§å¯èƒ½æ€§ï¼šåœ¨ä½¿ç”¨requestsåº“çš„æ—¶å€™ï¼Œç”±äºè¯·æ±‚å¤±è´¥è€Œç”±ç¨‹åºæœ¬èº«å‘é€é‡è¿è¿æ¥çš„é€Ÿåº¦è¿‡å¿«å¯¼è‡´äº§ç”Ÿè¯¥é”™è¯¯ã€‚å‡ç¼“å‡ºé”™æ—¶é‡è¿çš„é€Ÿåº¦å¯èƒ½å¯ä»¥æœ‰æ•ˆåœ°è§£å†³è¿™ä¸€ä¸ªé—®é¢˜ã€‚ å…·ä½“å¯ä»¥å‚ç…§ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š 12345678910111213import timepage = ''while page == '': try: page = requests.get(url) except: print(\"Connection refused by the server..\") print(\"Let me sleep for 5 seconds\") print(\"ZZzzzz...\") time.sleep(5) print(\"Was a nice sleep, now let me continue...\") continue é—²è¯~ åœ¨python3ä¸­rediså–å‡ºçš„å€¼æ˜¯ä»¥bâ€™â€¦â€¦.â€™çš„å½¢å¼å¯ä»¥åƒredis_con.rpop(&quot;user_queue&quot;).decode(&#39;utf-8&#39;)è¿™æ ·è½¬æ¢ä¸€ä¸‹","tags":[{"name":"Python","slug":"Python","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Python/"}]},{"title":"å¼€æºé¡¹ç›®ï¼šåˆ é™¤å¾®åšå·¥å…·","date":"2016-09-17T06:24:25.000Z","path":"2016/09/17/å¼€æºé¡¹ç›®ï¼šåˆ é™¤å¾®åšå·¥å…·/","text":"ä»‹ç»åˆ©ç”¨è¯¥å·¥å…·å¯ä»¥å®ç°åˆ é™¤ä¸ªäººæ‰€æœ‰å¾®åšåŠŸèƒ½ï¼Œä¸ç”¨å—åˆ°ç¬¬ä¸‰æ–¹è°ƒç”¨APIæ¬¡æ•°é™åˆ¶ä¸èƒ½ä¿è¯å·¥å…·é•¿æœŸæœ‰æ•ˆ GITHUBåœ°å€: https://github.com/kong36088/DeleteWeiboTool ä½¿ç”¨æ–¹æ³•é…ç½®å¥½ä»£ç æ ¹ç›®å½•ä¸‹çš„Config/config.phpä¸­è¦æ±‚å¿…å¡«çš„é¡¹ç›®$config[&#39;sina_cookie&#39;]ï¼šç™»é™†å¥½åï¼Œæ‰“å¼€F12å¼€å‘è€…å·¥å…·è·å–REQUESTä¸­çš„cookieå€¼å¡«å…¥$config[&#39;self_page_url&#39;]ï¼šæ‰“å¼€å¼€å‘è€…å·¥å…·è®¾ç½®æ¨¡æ‹ŸIPHONE6è®¿é—®é¡µé¢m.weibo.cn,ç‚¹å‡»æŸ¥çœ‹æˆ‘çš„æ‰€æœ‰å¾®åšï¼Œå¤åˆ¶é¡µé¢URL ç„¶åå¼€å§‹è¿è¡Œ cd /xxx/xxx/DelWeibo php Delete.php è®¾ç½®æ•™ç¨‹å¦‚ä¸‹ æ€»ç»“1.å°½é‡æ¨¡æ‹Ÿå¥½æ‰€æœ‰çš„headerï¼ŒåŒ…æ‹¬hostï¼Œrefererç­‰ 2.åœ¨ä¸ªäººæœåŠ¡å™¨ä¸Šç»å¸¸ä¼šå‡ºç°504 GATEWAYé”™è¯¯ï¼Œå…·ä½“è®¾ç½®æ˜¯åŠ å¤§nginxä¸­çš„buffersizeä»¥åŠPHP max_childrendçš„å¤§å° 3.å…³äºPHP CURLä¸­postæ•°æ®éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼šå¦‚æœ$dataæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™Content-Typeæ˜¯application/x-www-form-urlencodedã€‚ HTML Form URL Encoded: application/x-www-form-urlencoded Form item: â€œunameâ€ = â€œnicknameâ€ Key: uname Value: nickname å¦‚æœ$dataæ˜¯k=&gt;vçš„æ•°ç»„ï¼Œåˆ™Content-Typeæ˜¯multipart/form-data, 4.æ¨¡æ‹Ÿç™»é™†å¯ä»¥é‡‡ç”¨æ‰‹åŠ¨ç™»é™†åç›´æ¥è·å–åˆ°æµè§ˆå™¨çš„cookieæ¯æ¬¡ç™»é™†é‡‡ç”¨è¯¥cookieï¼Œcurl_setopt($ch, CURLOPT_COOKIE, $this-&gt;cookie) 5.å‡ºç°ä¹±ç ç­‰æƒ…å†µæ—¶å¯ä»¥åŠ å…¥gzipè§£æï¼Œcurl_setopt($ch, CURLOPT_ENCODING, &#39;gzip&#39;)","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"å¼€æº","slug":"å¼€æº","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å¼€æº/"}]},{"title":"ä¸€ä¸ªå¾ˆå¥½çš„epollè§£æ","date":"2016-08-28T15:24:25.000Z","path":"2016/08/28/ä¸€ä¸ªå¾ˆå¥½çš„epollè§£æ/","text":"epollä»‹ç»è½¬è‡ªçŸ¥ä¹ ä½œè€…ï¼šè“å½¢å‚ï¼ŒGeek ä¼ªæŠ€æœ¯å®… é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰æµçš„æ¦‚å¿µï¼Œä¸€ä¸ªæµå¯ä»¥æ˜¯æ–‡ä»¶ï¼Œsocketï¼Œpipeç­‰ç­‰å¯ä»¥è¿›è¡ŒI/Oæ“ä½œçš„å†…æ ¸å¯¹è±¡ã€‚ ä¸ç®¡æ˜¯æ–‡ä»¶ï¼Œè¿˜æ˜¯å¥—æ¥å­—ï¼Œè¿˜æ˜¯ç®¡é“ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æŠŠä»–ä»¬çœ‹ä½œæµã€‚ ä¹‹åæˆ‘ä»¬æ¥è®¨è®ºI/Oçš„æ“ä½œï¼Œé€šè¿‡readï¼Œæˆ‘ä»¬å¯ä»¥ä»æµä¸­è¯»å…¥æ•°æ®ï¼›é€šè¿‡writeï¼Œæˆ‘ä»¬å¯ä»¥å¾€æµå†™å…¥æ•°æ®ã€‚ç°åœ¨å‡å®šä¸€ä¸ªæƒ…å½¢ï¼Œæˆ‘ä»¬éœ€è¦ä»æµä¸­è¯»æ•°æ®ï¼Œä½†æ˜¯æµä¸­è¿˜æ²¡æœ‰æ•°æ®ï¼Œï¼ˆå…¸å‹çš„ä¾‹å­ä¸ºï¼Œå®¢æˆ·ç«¯è¦ä»socketè¯»å¦‚æ•°æ®ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿˜æ²¡æœ‰æŠŠæ•°æ®ä¼ å›æ¥ï¼‰ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠï¼Ÿ é˜»å¡ï¼šé˜»å¡æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿæ¯”å¦‚æŸä¸ªæ—¶å€™ä½ åœ¨ç­‰å¿«é€’ï¼Œä½†æ˜¯ä½ ä¸çŸ¥é“å¿«é€’ä»€ä¹ˆæ—¶å€™è¿‡æ¥ï¼Œè€Œä¸”ä½ æ²¡æœ‰åˆ«çš„äº‹å¯ä»¥å¹²ï¼ˆæˆ–è€…è¯´æ¥ä¸‹æ¥çš„äº‹è¦ç­‰å¿«é€’æ¥äº†æ‰èƒ½åšï¼‰ï¼›é‚£ä¹ˆä½ å¯ä»¥å»ç¡è§‰äº†ï¼Œå› ä¸ºä½ çŸ¥é“å¿«é€’æŠŠè´§é€æ¥æ—¶ä¸€å®šä¼šç»™ä½ æ‰“ä¸ªç”µè¯ï¼ˆå‡å®šä¸€å®šèƒ½å«é†’ä½ ï¼‰ã€‚ éé˜»å¡å¿™è½®è¯¢ï¼šæ¥ç€ä¸Šé¢ç­‰å¿«é€’çš„ä¾‹å­ï¼Œå¦‚æœç”¨å¿™è½®è¯¢çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä½ éœ€è¦çŸ¥é“å¿«é€’å‘˜çš„æ‰‹æœºå·ï¼Œç„¶åæ¯åˆ†é’Ÿç»™ä»–æŒ‚ä¸ªç”µè¯ï¼šâ€œä½ åˆ°äº†æ²¡ï¼Ÿâ€ å¾ˆæ˜æ˜¾ä¸€èˆ¬äººä¸ä¼šç”¨ç¬¬äºŒç§åšæ³•ï¼Œä¸ä»…æ˜¾å¾ˆæ— è„‘ï¼Œæµªè´¹è¯è´¹ä¸è¯´ï¼Œè¿˜å ç”¨äº†å¿«é€’å‘˜å¤§é‡çš„æ—¶é—´ã€‚ å¤§éƒ¨åˆ†ç¨‹åºä¹Ÿä¸ä¼šç”¨ç¬¬äºŒç§åšæ³•ï¼Œå› ä¸ºç¬¬ä¸€ç§æ–¹æ³•ç»æµè€Œç®€å•ï¼Œç»æµæ˜¯æŒ‡æ¶ˆè€—å¾ˆå°‘çš„CPUæ—¶é—´ï¼Œå¦‚æœçº¿ç¨‹ç¡çœ äº†ï¼Œå°±æ‰å‡ºäº†ç³»ç»Ÿçš„è°ƒåº¦é˜Ÿåˆ—ï¼Œæš‚æ—¶ä¸ä¼šå»ç“œåˆ†CPUå®è´µçš„æ—¶é—´ç‰‡äº†ã€‚ ä¸ºäº†äº†è§£é˜»å¡æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œæˆ‘ä»¬æ¥è®¨è®ºç¼“å†²åŒºï¼Œä»¥åŠå†…æ ¸ç¼“å†²åŒºï¼Œæœ€ç»ˆæŠŠI/Oäº‹ä»¶è§£é‡Šæ¸…æ¥šã€‚ç¼“å†²åŒºçš„å¼•å…¥æ˜¯ä¸ºäº†å‡å°‘é¢‘ç¹I/Oæ“ä½œè€Œå¼•èµ·é¢‘ç¹çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆä½ çŸ¥é“å®ƒå¾ˆæ…¢çš„ï¼‰ï¼Œå½“ä½ æ“ä½œä¸€ä¸ªæµæ—¶ï¼Œæ›´å¤šçš„æ˜¯ä»¥ç¼“å†²åŒºä¸ºå•ä½è¿›è¡Œæ“ä½œï¼Œè¿™æ˜¯ç›¸å¯¹äºç”¨æˆ·ç©ºé—´è€Œè¨€ã€‚å¯¹äºå†…æ ¸æ¥è¯´ï¼Œä¹Ÿéœ€è¦ç¼“å†²åŒºã€‚ å‡è®¾æœ‰ä¸€ä¸ªç®¡é“ï¼Œè¿›ç¨‹Aä¸ºç®¡é“çš„å†™å…¥æ–¹ï¼Œï¼¢ä¸ºç®¡é“çš„è¯»å‡ºæ–¹ã€‚ å‡è®¾ä¸€å¼€å§‹å†…æ ¸ç¼“å†²åŒºæ˜¯ç©ºçš„ï¼ŒBä½œä¸ºè¯»å‡ºæ–¹ï¼Œè¢«é˜»å¡ç€ã€‚ç„¶åé¦–å…ˆAå¾€ç®¡é“å†™å…¥ï¼Œè¿™æ—¶å€™å†…æ ¸ç¼“å†²åŒºç”±ç©ºçš„çŠ¶æ€å˜åˆ°éç©ºçŠ¶æ€ï¼Œå†…æ ¸å°±ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å‘Šè¯‰ï¼¢è¯¥é†’æ¥äº†ï¼Œè¿™ä¸ªäº‹ä»¶å§‘ä¸”ç§°ä¹‹ä¸ºâ€œç¼“å†²åŒºéç©ºâ€ã€‚ ä½†æ˜¯â€œç¼“å†²åŒºéç©ºâ€äº‹ä»¶é€šçŸ¥Båï¼ŒBå´è¿˜æ²¡æœ‰è¯»å‡ºæ•°æ®ï¼›ä¸”å†…æ ¸è®¸è¯ºäº†ä¸èƒ½æŠŠå†™å…¥ç®¡é“ä¸­çš„æ•°æ®ä¸¢æ‰è¿™ä¸ªæ—¶å€™ï¼Œï¼¡å†™å…¥çš„æ•°æ®ä¼šæ»ç•™åœ¨å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œå¦‚æœå†…æ ¸ä¹Ÿç¼“å†²åŒºæ»¡äº†ï¼ŒBä»æœªå¼€å§‹è¯»æ•°æ®ï¼Œæœ€ç»ˆå†…æ ¸ç¼“å†²åŒºä¼šè¢«å¡«æ»¡ï¼Œè¿™ä¸ªæ—¶å€™ä¼šäº§ç”Ÿä¸€ä¸ªI/Oäº‹ä»¶ï¼Œå‘Šè¯‰è¿›ç¨‹Aï¼Œä½ è¯¥ç­‰ç­‰ï¼ˆé˜»å¡ï¼‰äº†ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªäº‹ä»¶å®šä¹‰ä¸ºâ€œç¼“å†²åŒºæ»¡â€ã€‚ å‡è®¾åæ¥ï¼¢ç»ˆäºå¼€å§‹è¯»æ•°æ®äº†ï¼Œäºæ˜¯å†…æ ¸çš„ç¼“å†²åŒºç©ºäº†å‡ºæ¥ï¼Œè¿™æ—¶å€™å†…æ ¸ä¼šå‘Šè¯‰Aï¼Œå†…æ ¸ç¼“å†²åŒºæœ‰ç©ºä½äº†ï¼Œä½ å¯ä»¥ä»é•¿çœ ä¸­é†’æ¥äº†ï¼Œç»§ç»­å†™æ•°æ®äº†ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªäº‹ä»¶å«åšâ€œç¼“å†²åŒºéæ»¡â€ ä¹Ÿè®¸äº‹ä»¶Y1å·²ç»é€šçŸ¥äº†Aï¼Œä½†æ˜¯Aä¹Ÿæ²¡æœ‰æ•°æ®å†™å…¥äº†ï¼Œè€Œï¼¢ç»§ç»­è¯»å‡ºæ•°æ®ï¼ŒçŸ¥é“å†…æ ¸ç¼“å†²åŒºç©ºäº†ã€‚è¿™ä¸ªæ—¶å€™å†…æ ¸å°±å‘Šè¯‰Bï¼Œä½ éœ€è¦é˜»å¡äº†ï¼ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ—¶é—´å®šä¸ºâ€œç¼“å†²åŒºç©ºâ€ã€‚ è¿™å››ä¸ªæƒ…å½¢æ¶µç›–äº†å››ä¸ªI/Oäº‹ä»¶ï¼Œç¼“å†²åŒºæ»¡ï¼Œç¼“å†²åŒºç©ºï¼Œç¼“å†²åŒºéç©ºï¼Œç¼“å†²åŒºéæ»¡ï¼ˆæ³¨éƒ½æ˜¯è¯´çš„å†…æ ¸ç¼“å†²åŒºï¼Œä¸”è¿™å››ä¸ªæœ¯è¯­éƒ½æ˜¯æˆ‘ç”Ÿé€ çš„ï¼Œä»…ä¸ºè§£é‡Šå…¶åŸç†è€Œé€ ï¼‰ã€‚è¿™å››ä¸ªI/Oäº‹ä»¶æ˜¯è¿›è¡Œé˜»å¡åŒæ­¥çš„æ ¹æœ¬ã€‚ï¼ˆå¦‚æœä¸èƒ½ç†è§£â€œåŒæ­¥â€æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Œè¯·å­¦ä¹ æ“ä½œç³»ç»Ÿçš„é”ï¼Œä¿¡å·é‡ï¼Œæ¡ä»¶å˜é‡ç­‰ä»»åŠ¡åŒæ­¥æ–¹é¢çš„ç›¸å…³çŸ¥è¯†ï¼‰ã€‚ ç„¶åæˆ‘ä»¬æ¥è¯´è¯´é˜»å¡I/Oçš„ç¼ºç‚¹ã€‚ä½†æ˜¯é˜»å¡I/Oæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å¤„ç†ä¸€ä¸ªæµçš„I/Oäº‹ä»¶ã€‚å¦‚æœæƒ³è¦åŒæ—¶å¤„ç†å¤šä¸ªæµï¼Œè¦ä¹ˆå¤šè¿›ç¨‹(fork)ï¼Œè¦ä¹ˆå¤šçº¿ç¨‹(pthread_create)ï¼Œå¾ˆä¸å¹¸è¿™ä¸¤ç§æ–¹æ³•æ•ˆç‡éƒ½ä¸é«˜ã€‚ äºæ˜¯å†æ¥è€ƒè™‘éé˜»å¡å¿™è½®è¯¢çš„I/Oæ–¹å¼ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæµäº†ï¼ˆæŠŠä¸€ä¸ªæµä»é˜»å¡æ¨¡å¼åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼å†æ­¤ä¸äºˆè®¨è®ºï¼‰ï¼š 123456while true &#123; for i in stream[]; &#123; if i has data read until unavailable &#125;&#125; æˆ‘ä»¬åªè¦ä¸åœçš„æŠŠæ‰€æœ‰æµä»å¤´åˆ°å°¾é—®ä¸€éï¼Œåˆä»å¤´å¼€å§‹ã€‚è¿™æ ·å°±å¯ä»¥å¤„ç†å¤šä¸ªæµäº†ï¼Œä½†è¿™æ ·çš„åšæ³•æ˜¾ç„¶ä¸å¥½ï¼Œå› ä¸ºå¦‚æœæ‰€æœ‰çš„æµéƒ½æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆåªä¼šç™½ç™½æµªè´¹CPUã€‚è¿™é‡Œè¦è¡¥å……ä¸€ç‚¹ï¼Œé˜»å¡æ¨¡å¼ä¸‹ï¼Œå†…æ ¸å¯¹äºI/Oäº‹ä»¶çš„å¤„ç†æ˜¯é˜»å¡æˆ–è€…å”¤é†’ï¼Œè€Œéé˜»å¡æ¨¡å¼ä¸‹åˆ™æŠŠI/Oäº‹ä»¶äº¤ç»™å…¶ä»–å¯¹è±¡ï¼ˆåæ–‡ä»‹ç»çš„selectä»¥åŠepollï¼‰å¤„ç†ç”šè‡³ç›´æ¥å¿½ç•¥ã€‚ ä¸ºäº†é¿å…CPUç©ºè½¬ï¼Œå¯ä»¥å¼•è¿›äº†ä¸€ä¸ªä»£ç†ï¼ˆä¸€å¼€å§‹æœ‰ä¸€ä½å«åšselectçš„ä»£ç†ï¼Œåæ¥åˆæœ‰ä¸€ä½å«åšpollçš„ä»£ç†ï¼Œä¸è¿‡ä¸¤è€…çš„æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼‰ã€‚è¿™ä¸ªä»£ç†æ¯”è¾ƒå‰å®³ï¼Œå¯ä»¥åŒæ—¶è§‚å¯Ÿè®¸å¤šæµçš„I/Oäº‹ä»¶ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰çº¿ç¨‹é˜»å¡æ‰ï¼Œå½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµæœ‰I/Oäº‹ä»¶æ—¶ï¼Œå°±ä»é˜»å¡æ€ä¸­é†’æ¥ï¼Œäºæ˜¯æˆ‘ä»¬çš„ç¨‹åºå°±ä¼šè½®è¯¢ä¸€éæ‰€æœ‰çš„æµï¼ˆäºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠâ€œå¿™â€å­—å»æ‰äº†ï¼‰ã€‚ä»£ç é•¿è¿™æ ·: 1234567while true &#123; select(streams[]) for i in streams[] &#123; if i has data read until unavailable &#125;&#125; äºæ˜¯ï¼Œå¦‚æœæ²¡æœ‰I/Oäº‹ä»¶äº§ç”Ÿï¼Œæˆ‘ä»¬çš„ç¨‹åºå°±ä¼šé˜»å¡åœ¨selectå¤„ã€‚ä½†æ˜¯ä¾ç„¶æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä»selecté‚£é‡Œä»…ä»…çŸ¥é“äº†ï¼Œæœ‰I/Oäº‹ä»¶å‘ç”Ÿäº†ï¼Œä½†å´å¹¶ä¸çŸ¥é“æ˜¯é‚£å‡ ä¸ªæµï¼ˆå¯èƒ½æœ‰ä¸€ä¸ªï¼Œå¤šä¸ªï¼Œç”šè‡³å…¨éƒ¨ï¼‰ï¼Œæˆ‘ä»¬åªèƒ½æ— å·®åˆ«è½®è¯¢æ‰€æœ‰æµï¼Œæ‰¾å‡ºèƒ½è¯»å‡ºæ•°æ®ï¼Œæˆ–è€…å†™å…¥æ•°æ®çš„æµï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ“ä½œã€‚ ä½†æ˜¯ä½¿ç”¨selectï¼Œæˆ‘ä»¬æœ‰O(n)çš„æ— å·®åˆ«è½®è¯¢å¤æ‚åº¦ï¼ŒåŒæ—¶å¤„ç†çš„æµè¶Šå¤šï¼Œæ²¡ä¸€æ¬¡æ— å·®åˆ«è½®è¯¢æ—¶é—´å°±è¶Šé•¿ã€‚å†æ¬¡è¯´äº†è¿™ä¹ˆå¤šï¼Œç»ˆäºèƒ½å¥½å¥½è§£é‡Šepolläº† epollå¯ä»¥ç†è§£ä¸ºevent pollï¼Œä¸åŒäºå¿™è½®è¯¢å’Œæ— å·®åˆ«è½®è¯¢ï¼Œepollä¹‹ä¼šæŠŠå“ªä¸ªæµå‘ç”Ÿäº†æ€æ ·çš„I/Oäº‹ä»¶é€šçŸ¥æˆ‘ä»¬ã€‚æ­¤æ—¶æˆ‘ä»¬å¯¹è¿™äº›æµçš„æ“ä½œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚ï¼ˆå¤æ‚åº¦é™ä½åˆ°äº†O(1)ï¼‰ åœ¨è®¨è®ºepollçš„å®ç°ç»†èŠ‚ä¹‹å‰ï¼Œå…ˆæŠŠepollçš„ç›¸å…³æ“ä½œåˆ—å‡ºï¼š epoll_create åˆ›å»ºä¸€ä¸ªepollå¯¹è±¡ï¼Œä¸€èˆ¬epollfd = epoll_create() epoll_ctl ï¼ˆepoll_add/epoll_delçš„åˆä½“ï¼‰ï¼Œå¾€epollå¯¹è±¡ä¸­å¢åŠ /åˆ é™¤æŸä¸€ä¸ªæµçš„æŸä¸€ä¸ªäº‹ä»¶ æ¯”å¦‚ epoll_ctl(epollfd, EPOLL_CTL_ADD, socket, EPOLLIN);//æ³¨å†Œç¼“å†²åŒºéç©ºäº‹ä»¶ï¼Œå³æœ‰æ•°æ®æµå…¥ epoll_ctl(epollfd, EPOLL_CTL_DEL, socket, EPOLLOUT);//æ³¨å†Œç¼“å†²åŒºéæ»¡äº‹ä»¶ï¼Œå³æµå¯ä»¥è¢«å†™å…¥ epoll_wait(epollfd,...)ç­‰å¾…ç›´åˆ°æ³¨å†Œçš„äº‹ä»¶å‘ç”Ÿ ï¼ˆæ³¨ï¼šå½“å¯¹ä¸€ä¸ªéé˜»å¡æµçš„è¯»å†™å‘ç”Ÿç¼“å†²åŒºæ»¡æˆ–ç¼“å†²åŒºç©ºï¼Œwrite/readä¼šè¿”å›-1ï¼Œå¹¶è®¾ç½®errno=EAGAINã€‚è€Œepollåªå…³å¿ƒç¼“å†²åŒºéæ»¡å’Œç¼“å†²åŒºéç©ºäº‹ä»¶ï¼‰ã€‚ ä¸€ä¸ªepollæ¨¡å¼çš„ä»£ç å¤§æ¦‚çš„æ ·å­æ˜¯ï¼š 123456while true &#123; active_stream[] = epoll_wait(epollfd) for i in active_stream[] &#123; read or write till &#125;&#125; é™äºç¯‡å¹…ï¼Œæˆ‘åªè¯´è¿™ä¹ˆå¤šï¼Œä»¥æ­ç¤ºåŸç†æ€§çš„ä¸œè¥¿ï¼Œè‡³äºepollçš„ä½¿ç”¨ç»†èŠ‚ï¼Œè¯·å‚è€ƒmanå’Œgoogleï¼Œå®ç°ç»†èŠ‚ï¼Œè¯·å‚é˜…linux kernel sourceã€‚ ä¸ªäººæ€»ç»“çœ‹å®Œä»¥ä¸Šå¯¹äºepollçš„ä»‹ç»ï¼Œå¯¹äºlinuxä¸­çš„IOæ¨¡å‹æœ‰äº†ä¸€å®šçš„è®¤çŸ¥ç›¸æ¯”äºä¼ ç»Ÿçš„select/pollæ¨¡å‹ï¼Œepollåˆ©ç”¨äº†äº‹ä»¶é€šçŸ¥çš„å½¢å¼ï¼Œå‡å°‘äº†æ¥å—IOä¿¡å·åå¯¹æ‰€æœ‰socketè¿›è¡Œè½®è¯¢çš„å¼€é”€ï¼Œå¤§å¤§æå‡æ•ˆç‡ epollæ˜¯linuxæ‰€ç‰¹æœ‰ï¼Œè€Œselectæ˜¯POSIXæ‰€è§„å®šï¼Œä¸€èˆ¬æ“ä½œç³»ç»Ÿå‡æœ‰å®ç°ã€‚ å…³äºlinuxä¸­çš„å‡ ç§IOæ¨¡å‹ä»‹ç»ï¼š selectï¼šæŸ¥æ‰¾selectæœ¬è´¨æ˜¯é€šè¿‡è®¾ç½®æˆ–æ£€æŸ¥å­˜æ”¾fdæ ‡å¿—ä½çš„æ•°æ®ç»“æ„æ¥è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚ç¼ºç‚¹æ˜¯ï¼š 1ã€å•ä¸ªè¿›ç¨‹å¯ç›‘è§†çš„fdæ•°é‡è¢«é™åˆ¶ï¼Œå³èƒ½ç›‘å¬ç«¯å£çš„å¤§å°æœ‰é™ã€‚ ä¸€èˆ¬æ¥è¯´å’Œç³»ç»Ÿå†…å­˜æœ‰å…³ï¼Œå…·ä½“æ•°ç›®å¯ä»¥cat /proc/sys/fs/file-maxå¯Ÿçœ‹ã€‚32ä½é»˜è®¤æ˜¯1024ä¸ªï¼Œ64ä½é»˜è®¤ä¸º2048ä¸ª 2ã€å¯¹socketè¿›è¡Œæ‰«ææ—¶æ˜¯çº¿æ€§æ‰«æï¼Œå³é‡‡ç”¨è½®è¯¢æ–¹æ³•ï¼Œæ•ˆç‡ä½ã€‚ å½“å¥—æ¥å­—æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ¯æ¬¡select()éƒ½è¦éå†FD_SETSIZEä¸ªsocketæ¥å®Œæˆè°ƒåº¦ï¼Œä¸ç®¡socketæ˜¯å¦æ´»è·ƒéƒ½éå†ä¸€éã€‚ä¼šæµªè´¹å¾ˆå¤šCPUæ—¶é—´ã€‚å¦‚æœèƒ½ç»™å¥—æ¥å­—æ³¨å†ŒæŸä¸ªå›è°ƒå‡½æ•°ï¼Œå½“ä»–ä»¬æ´»è·ƒæ—¶ï¼Œè‡ªåŠ¨å®Œæˆç›¸å…³æ“ä½œï¼Œå°±é¿å…äº†è½®è¯¢ï¼Œè¿™æ­£æ˜¯epollä¸kqueueåšçš„ 3ã€éœ€è¦ç»´æŠ¤ä¸€ä¸ªç”¨æ¥å­˜æ”¾å¤§é‡fdçš„æ•°æ®ç»“æ„ï¼Œä¼šä½¿å¾—ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´åœ¨ä¼ é€’è¯¥ç»“æ„æ—¶å¤åˆ¶å¼€é”€å¤§ pollï¼špollæœ¬è´¨å’Œselectç›¸åŒï¼Œå°†ç”¨æˆ·ä¼ å…¥çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œç„¶åæŸ¥è¯¢æ¯ä¸ªfdå¯¹åº”çš„è®¾å¤‡çŠ¶æ€ï¼Œå¦‚æœè®¾å¤‡å°±ç»ªåˆ™åœ¨è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­åŠ å…¥ä¸€é¡¹å¹¶ç»§ç»­éå†ï¼Œå¦‚æœéå†æ‰€æœ‰fdåæ²¡æœ‰å‘ç°å°±ç»ªè®¾å¤‡ï¼Œåˆ™æŒ‚èµ·å½“å‰è¿›ç¨‹ï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªæˆ–ä¸»åŠ¨è¶…æ—¶ï¼Œè¢«å”¤é†’ååˆè¦å†æ¬¡éå†fd å®ƒæ²¡æœ‰æœ€å¤§è¿æ¥æ•°çš„é™åˆ¶ï¼ŒåŸå› æ˜¯å®ƒæ˜¯åŸºäºé“¾è¡¨æ¥å­˜å‚¨çš„ï¼Œä½†ç¼ºç‚¹æ˜¯ï¼š 1ã€å¤§é‡çš„fdçš„æ•°ç»„è¢«æ•´ä½“å¤åˆ¶åˆ°ç”¨æˆ·æ€å’Œå†…æ ¸ç©ºé—´ä¹‹é—´ï¼Œä¸ç®¡æœ‰æ— æ„ä¹‰ã€‚ 2ã€pollè¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹â€œæ°´å¹³è§¦å‘â€ï¼Œå¦‚æœæŠ¥å‘Šäº†fdåï¼Œæ²¡æœ‰è¢«å¤„ç†ï¼Œé‚£ä¹ˆä¸‹æ¬¡pollæ—¶å†æ¬¡æŠ¥å‘Šè¯¥ffdã€‚ epollï¼šepollæ”¯æŒæ°´å¹³è§¦å‘å’Œè¾¹ç¼˜è§¦å‘ï¼Œæœ€å¤§ç‰¹ç‚¹åœ¨äºè¾¹ç¼˜è§¦å‘ï¼Œåªå‘Šè¯‰å“ªäº›fdåˆšåˆšå˜ä¸ºå°±ç»ªæ€ï¼Œå¹¶ä¸”åªé€šçŸ¥ä¸€æ¬¡ã€‚è¿˜æœ‰ä¸€ç‰¹ç‚¹æ˜¯ï¼Œepollä½¿ç”¨â€œäº‹ä»¶â€çš„å°±ç»ªé€šçŸ¥æ–¹å¼ï¼Œé€šè¿‡epoll_ctlæ³¨å†Œfdï¼Œä¸€é‡è¯¥fdå°±ç»ªï¼Œå†…æ ¸å°±ä¼šé‡‡ç”¨ç±»ä¼¼callbackçš„å›è°ƒæœºåˆ¶æ¥æ¿€æ´»è¯¥fdï¼Œepoll_waitä¾¿å¯ä»¥æ”¶åˆ°é€šçŸ¥ã€‚ epollçš„ä¼˜ç‚¹ï¼š 1ã€æ²¡æœ‰æœ€å¤§å¹¶å‘è¿æ¥çš„é™åˆ¶ 2ã€æ•ˆç‡æå‡ï¼Œåªæœ‰æ´»è·ƒå¯ç”¨çš„FDæ‰ä¼šè°ƒç”¨callbackå‡½æ•° 3ã€å†…å­˜æ‹·è´ï¼Œåˆ©ç”¨mmap()æ–‡ä»¶æ˜ å°„å†…å­˜åŠ é€Ÿä¸å†…æ ¸ç©ºé—´çš„æ¶ˆæ¯ä¼ é€’ã€‚ selectã€pollã€epollåŒºåˆ«æ€»ç»“ï¼š 1ã€æ”¯æŒä¸€ä¸ªè¿›ç¨‹æ‰“å¼€è¿æ¥æ•° selectï¼š32ä½æœºå™¨1024ä¸ªï¼Œ64ä½2048ä¸ª pollï¼šæ— é™åˆ¶ï¼ŒåŸå› åŸºäºé“¾è¡¨å­˜å‚¨ epollï¼šæœ‰ä¸Šé™ï¼Œä½†å¾ˆå¤§ï¼Œ2Gå†…å­˜20Wå·¦å³ 2ã€IOæ•ˆç‡ selectï¼šIOæ•ˆç‡ä½ pollï¼šIOæ•ˆç‡ä½ epollï¼šåªæœ‰æ´»è·ƒçš„socketæ‰è°ƒç”¨callbackï¼ŒIOæ•ˆç‡é«˜ã€‚ 3ã€æ¶ˆæ¯ä¼ é€’æ–¹å¼ selectï¼šå†…æ ¸éœ€è¦å°†æ¶ˆæ¯ä¼ é€’åˆ°ç”¨æˆ·ç©ºé—´ï¼Œéƒ½éœ€è¦å†…æ ¸æ‹·è´åŠ¨ä½œ pollï¼šåŒä¸Š epollï¼šé€šè¿‡å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å…±äº«ä¸€å—å†…å­˜æ¥å®ç°ã€‚","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"Swooleä¸­çš„å‡ ä¸ªè¿›ç¨‹ï¼šReactorã€Workerã€Task","date":"2016-08-28T06:24:25.000Z","path":"2016/08/28/Swooleä¸­çš„å‡ ä¸ªè¿›ç¨‹ï¼šReactorã€Workerã€Task/","text":"Swooleçš„è¿›ç¨‹Swooleä¸­æœ‰å‡ ç§è¿›ç¨‹ï¼Œåˆ†åˆ«æ˜¯ï¼šManagerã€Reactorçº¿ç¨‹ã€Workerã€TaskWokeræ ¹æ®å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼Œåˆ†åˆ«ä»‹ç» Managerè¿›ç¨‹swooleä¸­worker/taskè¿›ç¨‹éƒ½æ˜¯ç”±Managerè¿›ç¨‹Forkå¹¶ç®¡ç†çš„ã€‚å­è¿›ç¨‹ç»“æŸè¿è¡Œæ—¶ï¼Œmanagerè¿›ç¨‹è´Ÿè´£å›æ”¶æ­¤å­è¿›ç¨‹ï¼Œé¿å…æˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚å¹¶åˆ›å»ºæ–°çš„å­è¿›ç¨‹æœåŠ¡å™¨å…³é—­æ—¶ï¼Œmanagerè¿›ç¨‹å°†å‘é€ä¿¡å·ç»™æ‰€æœ‰å­è¿›ç¨‹ï¼Œé€šçŸ¥å­è¿›ç¨‹å…³é—­æœåŠ¡æœåŠ¡å™¨reloadæ—¶ï¼Œmanagerè¿›ç¨‹ä¼šé€ä¸ªå…³é—­/é‡å¯å­è¿›ç¨‹ Reactorçº¿ç¨‹è´Ÿè´£ç»´æŠ¤å®¢æˆ·ç«¯æœºå™¨çš„TCPè¿æ¥ã€å¤„ç†ç½‘ç»œIOã€æ”¶å‘æ•°æ®å®Œå…¨æ˜¯å¼‚æ­¥éé˜»å¡çš„æ¨¡å¼å…¨éƒ¨ä¸ºCä»£ç ï¼Œé™¤Start/Shudownäº‹ä»¶å›è°ƒå¤–ï¼Œä¸æ‰§è¡Œä»»ä½•PHPä»£ç å°†TCPå®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ç¼“å†²ã€æ‹¼æ¥ã€æ‹†åˆ†æˆå®Œæ•´çš„ä¸€ä¸ªè¯·æ±‚æ•°æ®åŒ…Reactorä»¥å¤šçº¿ç¨‹çš„æ–¹å¼è¿è¡Œ Workerè¿›ç¨‹æ¥å—ç”±Reactorçº¿ç¨‹æŠ•é€’çš„è¯·æ±‚æ•°æ®åŒ…ï¼Œå¹¶æ‰§è¡ŒPHPå›è°ƒå‡½æ•°å¤„ç†æ•°æ®ç”Ÿæˆå“åº”æ•°æ®å¹¶å‘ç»™Reactorçº¿ç¨‹ï¼Œç”±Reactorçº¿ç¨‹å‘é€ç»™TCPå®¢æˆ·ç«¯å¯ä»¥æ˜¯å¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒæ­¥é˜»å¡æ¨¡å¼Workerä»¥å¤šè¿›ç¨‹çš„æ–¹å¼è¿è¡Œå½“ä¸€ä¸ªWorkerè¿›ç¨‹è¢«æˆåŠŸåˆ›å»ºåï¼Œä¼šè°ƒç”¨onWorkerStartå›è°ƒï¼Œéšåè¿›å…¥äº‹ä»¶å¾ªç¯ç­‰å¾…æ•°æ®ã€‚å½“é€šè¿‡å›è°ƒå‡½æ•°æ¥æ”¶åˆ°æ•°æ®åï¼Œå¼€å§‹å¤„ç†æ•°æ®ã€‚å¦‚æœå¤„ç†æ•°æ®è¿‡ç¨‹ä¸­å‡ºç°ä¸¥é‡é”™è¯¯å¯¼è‡´è¿›ç¨‹é€€å‡ºï¼Œæˆ–è€…Workerè¿›ç¨‹å¤„ç†çš„æ€»è¯·æ±‚æ•°è¾¾åˆ°æŒ‡å®šä¸Šé™ï¼Œåˆ™Workerè¿›ç¨‹è°ƒç”¨onWorkerStopå›è°ƒå¹¶ç»“æŸè¿›ç¨‹ã€‚ Taskè¿›ç¨‹æ¥å—ç”±Workerè¿›ç¨‹é€šè¿‡swoole_server-&gt;task/taskwaitæ–¹æ³•æŠ•é€’çš„ä»»åŠ¡å¤„ç†ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœæ•°æ®è¿”å›ç»™Workerè¿›ç¨‹å®Œå…¨æ˜¯åŒæ­¥é˜»å¡æ¨¡å¼Taskä»¥å¤šè¿›ç¨‹çš„æ–¹å¼è¿è¡Œ Taskã€Workerã€Reatorçš„å…³ç³»å¯ä»¥ç†è§£ä¸ºreactorå°±æ˜¯nginxï¼Œworkerå°±æ˜¯php-fpmã€‚reactorçº¿ç¨‹å¼‚æ­¥å¹¶è¡Œåœ°å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œç„¶åå†è½¬å‘ç»™workerè¿›ç¨‹ä¸­å»å¤„ç†ã€‚reactorå’Œworkeré—´é€šè¿‡IPCæ–¹å¼é€šä¿¡ã€‚swooleçš„reactorï¼Œworkerï¼Œtask_workerä¹‹é—´å¯ä»¥ç´§å¯†çš„ç»“åˆèµ·æ¥ï¼Œæä¾›æ›´é«˜çº§çš„ä½¿ç”¨æ–¹å¼ã€‚ ä¸€ä¸ªæ›´é€šä¿—çš„æ¯”å–»ï¼Œå‡è®¾Serverå°±æ˜¯ä¸€ä¸ªå·¥å‚ï¼Œé‚£reactorå°±æ˜¯é”€å”®ï¼Œå¸®ä½ æ¥é¡¹ç›®è®¢å•ã€‚è€Œworkerå°±æ˜¯å·¥äººï¼Œå½“é”€å”®æ¥åˆ°è®¢å•åï¼Œworkerå»å·¥ä½œç”Ÿäº§å‡ºå®¢æˆ·è¦çš„ä¸œè¥¿ã€‚è€Œtask_workerå¯ä»¥ç†è§£ä¸ºè¡Œæ”¿äººå‘˜ï¼Œå¯ä»¥å¸®åŠ©workerå¹²äº›æ‚äº‹ï¼Œè®©workerä¸“å¿ƒå·¥ä½œã€‚ åº•å±‚ä¼šä¸ºWorkerè¿›ç¨‹ã€Taskè¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDä¸åŒçš„task/workerè¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡sendMessageæ¥å£è¿›è¡Œé€šä¿¡ ç”Ÿå‘½å‘¨æœŸç¨‹åºå…¨å±€æœŸåœ¨swoole_server-&gt;startä¹‹å‰å°±åˆ›å»ºå¥½çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç¨‹åºå…¨å±€ç”Ÿå‘½å‘¨æœŸã€‚è¿™äº›å˜é‡åœ¨ç¨‹åºå¯åŠ¨åå°±ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ•´ä¸ªç¨‹åºç»“æŸè¿è¡Œæ‰ä¼šé”€æ¯ã€‚ æœ‰ä¸€äº›æœåŠ¡å™¨ç¨‹åºå¯èƒ½ä¼šè¿ç»­è¿è¡Œæ•°æœˆç”šè‡³æ•°å¹´æ‰ä¼šå…³é—­/é‡å¯ï¼Œé‚£ä¹ˆç¨‹åºå…¨å±€æœŸçš„å¯¹è±¡åœ¨è¿™æ®µæ—¶é—´æŒç»­é©»ç•™åœ¨å†…å­˜ä¸­çš„ã€‚ ç”±äºswooleæ˜¯å¤šè¿›ç¨‹çš„ï¼Œæ‰€ä»¥ç¨‹åºå…¨å±€å¯¹è±¡åœ¨ä»£ç ä¸­ä»…æ˜¯å¯è¯»çš„ç¨‹åºå…¨å±€å¯¹è±¡æ‰€åœ¨ç”¨çš„å†…å­˜æ˜¯å…±äº«çš„ï¼Œä¸ä¼šé¢å¤–å ç”¨å†…å­˜ è¿›ç¨‹å…¨å±€æœŸswooleæ‹¥æœ‰è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸæ§åˆ¶çš„æœºåˆ¶ï¼Œä¸€ä¸ªworkerå­è¿›ç¨‹å¤„ç†çš„è¯·æ±‚æ•°è¶…è¿‡max_requesté…ç½®åï¼Œå°±ä¼šè‡ªåŠ¨é”€æ¯ã€‚workerè¿›ç¨‹å¯åŠ¨ååˆ›å»ºçš„å¯¹è±¡ï¼ˆonWorkerStartä¸­åˆ›å»ºçš„å¯¹è±¡ï¼‰ï¼Œåœ¨è¿™ä¸ªå­è¿›ç¨‹å­˜æ´»å‘¨æœŸä¹‹å†…ï¼Œæ˜¯å¸¸é©»å†…å­˜çš„ã€‚onConnect/onReceive/onClose ä¸­éƒ½å¯ä»¥å»è®¿é—®å®ƒã€‚ è¿›ç¨‹å…¨å±€å¯¹è±¡æ‰€åœ¨ç”¨çš„å†…å­˜æ˜¯åœ¨å½“å‰å­è¿›ç¨‹å†…å­˜å †çš„ï¼Œå¹¶éå…±äº«å†…å­˜ã€‚å¯¹æ­¤å¯¹è±¡çš„ä¿®æ”¹ä»…åœ¨å½“å‰workerè¿›ç¨‹ä¸­æœ‰æ•ˆè¿›ç¨‹æœŸinclude/requireçš„æ–‡ä»¶ï¼Œåœ¨reloadåå°±ä¼šé‡æ–°åŠ è½½ ä¼šè¯æœŸä¼šè¯æœŸæ˜¯åœ¨onConnectååˆ›å»ºï¼Œæˆ–è€…åœ¨ç¬¬ä¸€æ¬¡onReceiveæ—¶åˆ›å»ºï¼ŒonCloseæ—¶é”€æ¯ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥è¿›å…¥åï¼Œåˆ›å»ºçš„å¯¹è±¡ä¼šå¸¸é©»å†…å­˜ï¼Œç›´åˆ°æ­¤å®¢æˆ·ç«¯ç¦»å¼€æ‰ä¼šé”€æ¯ã€‚ åœ¨LAMPä¸­ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®å¤šæ¬¡ç½‘ç«™ï¼Œå°±å¯ä»¥ç†è§£ä¸ºä¼šè¯æœŸã€‚ä½†ä¼ ç»ŸPHPç¨‹åºï¼Œå¹¶ä¸èƒ½æ„ŸçŸ¥åˆ°ã€‚åªæœ‰å•æ¬¡è®¿é—®æ—¶ä½¿ç”¨session_startï¼Œè®¿é—®$_SESSIONå…¨å±€å˜é‡æ‰èƒ½å¾—åˆ°ä¼šè¯æœŸçš„ä¸€äº›ä¿¡æ¯ã€‚ swooleä¸­ä¼šè¯æœŸçš„å¯¹è±¡ç›´æ¥æ˜¯å¸¸é©»å†…å­˜ï¼Œä¸éœ€è¦session_startä¹‹ç±»æ“ä½œã€‚å¯ä»¥ç›´æ¥è®¿é—®å¯¹è±¡ï¼Œå¹¶æ‰§è¡Œå¯¹è±¡çš„æ–¹æ³•ã€‚ è¯·æ±‚æœŸè¯·æ±‚æœŸå°±æ˜¯æŒ‡ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚å‘æ¥ï¼Œä¹Ÿå°±æ˜¯onReceiveæ”¶åˆ°è¯·æ±‚å¼€å§‹å¤„ç†ï¼Œç›´åˆ°è¿”å›ç»“æœå‘é€responseã€‚è¿™ä¸ªå‘¨æœŸæ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œä¼šåœ¨è¯·æ±‚å®Œæˆåé”€æ¯ã€‚ swooleä¸­è¯·æ±‚æœŸå¯¹è±¡ä¸æ™®é€šPHPç¨‹åºä¸­çš„å¯¹è±¡å°±æ˜¯ä¸€æ ·çš„ã€‚è¯·æ±‚åˆ°æ¥æ—¶åˆ›å»ºï¼Œè¯·æ±‚ç»“æŸåé”€æ¯ã€‚ å‚è€ƒswoole_serverä¸­å¯¹è±¡çš„4å±‚ç”Ÿå‘½å‘¨æœŸ","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"Swoole","slug":"Swoole","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Swoole/"}]},{"title":"linuxâ€”â€”awkã€sedã€grepï¼ˆé¸Ÿå“¥çš„ç§æˆ¿èœï¼‰","date":"2016-08-19T06:24:25.000Z","path":"2016/08/19/linuxâ€”â€”awkã€sedã€grepï¼ˆé¸Ÿå“¥çš„ç§æˆ¿èœï¼‰/","text":"grep[dmtsai@study ~]$ grep [-A] [-B] [--color=auto] 'æœå°‹å­—ä¸²' filename é¸é …èˆ‡åƒæ•¸ï¼š -A ï¼šå¾Œé¢å¯åŠ æ•¸å­—ï¼Œç‚º after çš„æ„æ€ï¼Œé™¤äº†åˆ—å‡ºè©²è¡Œå¤–ï¼Œå¾ŒçºŒçš„ n è¡Œä¹Ÿåˆ—å‡ºä¾†ï¼› -B ï¼šå¾Œé¢å¯åŠ æ•¸å­—ï¼Œç‚º befer çš„æ„æ€ï¼Œé™¤äº†åˆ—å‡ºè©²è¡Œå¤–ï¼Œå‰é¢çš„ n è¡Œä¹Ÿåˆ—å‡ºä¾†ï¼› --color=auto å¯å°‡æ­£ç¢ºçš„é‚£å€‹æ“·å–è³‡æ–™åˆ—å‡ºé¡è‰² ç¯„ä¾‹ä¸€ï¼šç”¨ dmesg åˆ—å‡ºæ ¸å¿ƒè¨Šæ¯ï¼Œå†ä»¥ grep æ‰¾å‡ºå…§å« qxl é‚£è¡Œ [dmtsai@study ~]$ dmesg | grep 'qxl' [ 0.522749] [drm] qxl: 16M of VRAM memory size [ 0.522750] [drm] qxl: 63M of IO pages memory ready (VRAM domain) [ 0.522750] [drm] qxl: 32M of Surface memory size [ 0.650714] fbcon: qxldrmfb (fb0) is primary device [ 0.668487] qxl 0000:00:02.0: fb0: qxldrmfb frame buffer device # dmesg å¯åˆ—å‡ºæ ¸å¿ƒç”¢ç”Ÿçš„è¨Šæ¯ï¼åŒ…æ‹¬ç¡¬é«”åµæ¸¬çš„æµç¨‹ä¹Ÿæœƒé¡¯ç¤ºå‡ºä¾†ã€‚ # é³¥å“¥ä½¿ç”¨çš„é¡¯å¡æ˜¯ QXL é€™å€‹è™›æ“¬å¡ï¼Œé€é grep ä¾† qxl çš„ç›¸é—œè³‡è¨Šï¼Œå¯ç™¼ç¾å¦‚ä¸Šè³‡è¨Šã€‚ ç¯„ä¾‹äºŒï¼šæ‰¿ä¸Šé¡Œï¼Œè¦å°‡æ‰åˆ°çš„é—œéµå­—é¡¯è‰²ï¼Œä¸”åŠ ä¸Šè¡Œè™Ÿä¾†è¡¨ç¤ºï¼š [dmtsai@study ~]$ dmesg | grep -n --color=auto 'qxl' 515:[ 0.522749] [drm] qxl: 16M of VRAM memory size 516:[ 0.522750] [drm] qxl: 63M of IO pages memory ready (VRAM domain) 517:[ 0.522750] [drm] qxl: 32M of Surface memory size 529:[ 0.650714] fbcon: qxldrmfb (fb0) is primary device 539:[ 0.668487] qxl 0000:00:02.0: fb0: qxldrmfb frame buffer device # é™¤äº† qxl æœƒæœ‰ç‰¹æ®Šé¡è‰²ä¾†è¡¨ç¤ºä¹‹å¤–ï¼Œæœ€å‰é¢é‚„æœ‰è¡Œè™Ÿå–”ï¼å…¶å¯¦é¡è‰²é¡¯ç¤ºå·²ç¶“æ˜¯é è¨­åœ¨ alias ç•¶ä¸­äº†ï¼ ç¯„ä¾‹ä¸‰ï¼šæ‰¿ä¸Šé¡Œï¼Œåœ¨é—œéµå­—æ‰€åœ¨è¡Œçš„å‰å…©è¡Œèˆ‡å¾Œä¸‰è¡Œä¹Ÿä¸€èµ·æ‰å‡ºä¾†é¡¯ç¤º [dmtsai@study ~]$ dmesg | grep -n -A3 -B2 --color=auto 'qxl' # ä½ æœƒç™¼ç¾é—œéµå­—ä¹‹å‰èˆ‡ä¹‹å¾Œçš„æ•¸è¡Œä¹Ÿè¢«é¡¯ç¤ºå‡ºä¾†ï¼é€™æ¨£å¯ä»¥è®“ä½ å°‡é—œéµå­—å‰å¾Œè³‡æ–™æ‰å‡ºä¾†é€²è¡Œåˆ†æå•¦ï¼ grep æ˜¯ä¸€å€‹å¾ˆå¸¸è¦‹ä¹Ÿå¾ˆå¸¸ç”¨çš„æŒ‡ä»¤ï¼Œä»–æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯é€²è¡Œå­—ä¸²è³‡æ–™çš„æ¯”å°ï¼Œç„¶å¾Œå°‡ç¬¦åˆä½¿ç”¨è€…éœ€æ±‚çš„å­—ä¸²åˆ—å°å‡ºä¾†ã€‚ éœ€è¦èªªæ˜çš„æ˜¯ã€grep åœ¨è³‡æ–™ä¸­æŸ¥å°‹ä¸€å€‹å­—ä¸²æ™‚ï¼Œæ˜¯ä»¥ \"æ•´è¡Œ\" ç‚ºå–®ä½ä¾†é€²è¡Œè³‡æ–™çš„æ“·å–çš„ï¼ã€ä¹Ÿå°±æ˜¯èªªï¼Œå‡å¦‚ä¸€å€‹æª”æ¡ˆå…§æœ‰ 10 è¡Œï¼Œå…¶ä¸­æœ‰å…©è¡Œå…·æœ‰ä½ æ‰€æœå°‹çš„å­—ä¸²ï¼Œå‰‡å°‡é‚£å…©è¡Œé¡¯ç¤ºåœ¨è¢å¹•ä¸Šï¼Œå…¶ä»–çš„å°±ä¸Ÿæ£„äº†ï¼ åœ¨ CentOS 7 ç•¶ä¸­ï¼Œé è¨­å·²ç¶“å°‡ â€“color=auto åŠ å…¥åœ¨ alias ç•¶ä¸­äº†ï¼ä½¿ç”¨è€…å°±å¯ä»¥ç›´æ¥ä½¿ç”¨æœ‰é—œéµå­—é¡¯è‰²çš„ grep å›‰ï¼éå¸¸æ–¹ä¾¿ï¼ sedåœ¨ç­è§£äº†ä¸€äº›æ­£è¦è¡¨ç¤ºæ³•çš„åŸºç¤æ‡‰ç”¨ä¹‹å¾Œï¼Œå†ä¾†å‘¢ï¼Ÿå‘µå‘µï½å…©å€‹æ±è¥¿å¯ä»¥ç©ä¸€ç©çš„ï¼Œé‚£å°±æ˜¯ sed è·Ÿåº•ä¸‹æœƒä»‹ç´¹çš„ awk äº†ï¼ é€™å…©å€‹å‚¢ä¼™å¯æ˜¯ç›¸ç•¶çš„æœ‰ç”¨çš„å•Šï¼èˆ‰ä¾‹ä¾†èªªï¼Œé³¥å“¥å¯«çš„ logfile.sh åˆ†æç™»éŒ„æª”çš„å°ç¨‹å¼ (ç¬¬åå…«ç« æœƒè«‡åˆ°)ï¼Œçµ•å¤§éƒ¨åˆ†åˆ†æé—œéµå­—çš„å–ç”¨ã€çµ±è¨ˆç­‰ç­‰ï¼Œå°±æ˜¯ç”¨é€™å…©å€‹å¯¶è²è›‹ä¾†å¹«æˆ‘å®Œæˆçš„ï¼é‚£éº¼ä½ èªªï¼Œè¦ä¸è¦ç©ä¸€ç©å•Šï¼Ÿ^_^ æˆ‘å€‘å…ˆä¾†è«‡ä¸€è«‡ sed å¥½äº†ï¼Œ sed æœ¬èº«ä¹Ÿæ˜¯ä¸€å€‹ç®¡ç·šå‘½ä»¤ï¼Œå¯ä»¥åˆ†æ standard input çš„å•¦ï¼ è€Œä¸” sed é‚„å¯ä»¥å°‡è³‡æ–™é€²è¡Œå–ä»£ã€åˆªé™¤ã€æ–°å¢ã€æ“·å–ç‰¹å®šè¡Œç­‰ç­‰çš„åŠŸèƒ½å‘¢ï¼å¾ˆä¸éŒ¯å§ï½ æˆ‘å€‘å…ˆä¾†ç­è§£ä¸€ä¸‹ sed çš„ç”¨æ³•ï¼Œå†ä¾†èŠä»–çš„ç”¨é€”å¥½äº†ï¼ [dmtsai@study ~]$ sed [-nefr] [å‹•ä½œ] é¸é …èˆ‡åƒæ•¸ï¼š -n ï¼šä½¿ç”¨å®‰éœ(silent)æ¨¡å¼ã€‚åœ¨ä¸€èˆ¬ sed çš„ç”¨æ³•ä¸­ï¼Œæ‰€æœ‰ä¾†è‡ª STDIN çš„è³‡æ–™ä¸€èˆ¬éƒ½æœƒè¢«åˆ—å‡ºåˆ°è¢å¹•ä¸Šã€‚ ä½†å¦‚æœåŠ ä¸Š -n åƒæ•¸å¾Œï¼Œå‰‡åªæœ‰ç¶“é sed ç‰¹æ®Šè™•ç†çš„é‚£ä¸€è¡Œ(æˆ–è€…å‹•ä½œ)æ‰æœƒè¢«åˆ—å‡ºä¾†ã€‚ -e ï¼šç›´æ¥åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¸Šé€²è¡Œ sed çš„å‹•ä½œç·¨è¼¯ï¼› -f ï¼šç›´æ¥å°‡ sed çš„å‹•ä½œå¯«åœ¨ä¸€å€‹æª”æ¡ˆå…§ï¼Œ -f filename å‰‡å¯ä»¥åŸ·è¡Œ filename å…§çš„ sed å‹•ä½œï¼› -r ï¼šsed çš„å‹•ä½œæ”¯æ´çš„æ˜¯å»¶ä¼¸å‹æ­£è¦è¡¨ç¤ºæ³•çš„èªæ³•ã€‚(é è¨­æ˜¯åŸºç¤æ­£è¦è¡¨ç¤ºæ³•èªæ³•) -i ï¼šç›´æ¥ä¿®æ”¹è®€å–çš„æª”æ¡ˆå…§å®¹ï¼Œè€Œä¸æ˜¯ç”±è¢å¹•è¼¸å‡ºã€‚ å‹•ä½œèªªæ˜ï¼š [n1[,n2]]function n1, n2 ï¼šä¸è¦‹å¾—æœƒå­˜åœ¨ï¼Œä¸€èˆ¬ä»£è¡¨ã€é¸æ“‡é€²è¡Œå‹•ä½œçš„è¡Œæ•¸ã€ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘çš„å‹•ä½œ æ˜¯éœ€è¦åœ¨ 10 åˆ° 20 è¡Œä¹‹é–“é€²è¡Œçš„ï¼Œå‰‡ã€ 10,20[å‹•ä½œè¡Œç‚º] ã€ function æœ‰åº•ä¸‹é€™äº›å’šå’šï¼š a ï¼šæ–°å¢ï¼Œ a çš„å¾Œé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œé€™äº›å­—ä¸²æœƒåœ¨æ–°çš„ä¸€è¡Œå‡ºç¾(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½ c ï¼šå–ä»£ï¼Œ c çš„å¾Œé¢å¯ä»¥æ¥å­—ä¸²ï¼Œé€™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é–“çš„è¡Œï¼ d ï¼šåˆªé™¤ï¼Œå› ç‚ºæ˜¯åˆªé™¤å•Šï¼Œæ‰€ä»¥ d å¾Œé¢é€šå¸¸ä¸æ¥ä»»ä½•å’šå’šï¼› i ï¼šæ’å…¥ï¼Œ i çš„å¾Œé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œé€™äº›å­—ä¸²æœƒåœ¨æ–°çš„ä¸€è¡Œå‡ºç¾(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼› p ï¼šåˆ—å°ï¼Œäº¦å³å°‡æŸå€‹é¸æ“‡çš„è³‡æ–™å°å‡ºã€‚é€šå¸¸ p æœƒèˆ‡åƒæ•¸ sed -n ä¸€èµ·é‹ä½œï½ s ï¼šå–ä»£ï¼Œå¯ä»¥ç›´æ¥é€²è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸é€™å€‹ s çš„å‹•ä½œå¯ä»¥æ­é…æ­£è¦è¡¨ç¤ºæ³•ï¼ ä¾‹å¦‚ 1,20s/old/new/g å°±æ˜¯å•¦ï¼ ä»¥è¡Œç‚ºå–®ä½çš„æ–°å¢/åˆªé™¤åŠŸèƒ½ sed å…‰æ˜¯ç”¨çœ‹çš„æ˜¯çœ‹ä¸æ‡‚çš„å•¦ï¼æ‰€ä»¥åˆè¦ä¾†ç·´ç¿’äº†ï¼å…ˆä¾†ç©ç©åˆªé™¤èˆ‡æ–°å¢çš„åŠŸèƒ½å§ï¼ ç¯„ä¾‹ä¸€ï¼šå°‡ /etc/passwd çš„å…§å®¹åˆ—å‡ºä¸¦ä¸”åˆ—å°è¡Œè™Ÿï¼ŒåŒæ™‚ï¼Œè«‹å°‡ç¬¬ 2~5 è¡Œåˆªé™¤ï¼ [dmtsai@study ~]$ nl /etc/passwd | sed '2,5d' 1 root:x:0:0:root:/root:/bin/bash 6 sync:x:5:0:sync:/sbin:/bin/sync 7 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown .....(å¾Œé¢çœç•¥)..... çœ‹åˆ°äº†å§ï¼Ÿsed çš„å‹•ä½œç‚º â€˜2,5dâ€™ ï¼Œé‚£å€‹ d å°±æ˜¯åˆªé™¤ï¼å› ç‚º 2-5 è¡Œçµ¦ä»–åˆªé™¤äº†ï¼Œæ‰€ä»¥é¡¯ç¤ºçš„è³‡æ–™å°±æ²’æœ‰ 2-5 è¡Œå›‰ï½ å¦å¤–ï¼Œæ³¨æ„ä¸€ä¸‹ï¼ŒåŸæœ¬æ‡‰è©²æ˜¯è¦ä¸‹é” sed -e æ‰å°ï¼Œæ²’æœ‰ -e ä¹Ÿè¡Œå•¦ï¼åŒæ™‚ä¹Ÿè¦æ³¨æ„çš„æ˜¯ï¼Œ sed å¾Œé¢æ¥çš„å‹•ä½œï¼Œè«‹å‹™å¿…ä»¥ â€˜â€™ å…©å€‹å–®å¼•è™Ÿæ‹¬ä½å–”ï¼ å¦‚æœé¡Œå‹è®ŠåŒ–ä¸€ä¸‹ï¼Œèˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœåªè¦åˆªé™¤ç¬¬ 2 è¡Œï¼Œå¯ä»¥ä½¿ç”¨ã€ nl /etc/passwd | sed â€˜2dâ€™ ã€ä¾†é”æˆï¼Œ è‡³æ–¼è‹¥æ˜¯è¦åˆªé™¤ç¬¬ 3 åˆ°æœ€å¾Œä¸€è¡Œï¼Œå‰‡æ˜¯ã€ nl /etc/passwd | sed â€˜3,$dâ€™ ã€çš„å•¦ï¼Œé‚£å€‹éŒ¢å­—è™Ÿã€ $ ã€ä»£è¡¨æœ€å¾Œä¸€è¡Œï¼ ç¯„ä¾‹äºŒï¼šæ‰¿ä¸Šé¡Œï¼Œåœ¨ç¬¬äºŒè¡Œå¾Œ(äº¦å³æ˜¯åŠ åœ¨ç¬¬ä¸‰è¡Œ)åŠ ä¸Šã€drink tea?ã€å­—æ¨£ï¼ [dmtsai@study ~]$ nl /etc/passwd | sed '2a drink tea' 1 root:x:0:0:root:/root:/bin/bash 2 bin:x:1:1:bin:/bin:/sbin/nologin drink tea 3 daemon:x:2:2:daemon:/sbin:/sbin/nologin .....(å¾Œé¢çœç•¥)..... å˜¿å˜¿ï¼åœ¨ a å¾Œé¢åŠ ä¸Šçš„å­—ä¸²å°±å·²å°‡å‡ºç¾åœ¨ç¬¬äºŒè¡Œå¾Œé¢å›‰ï¼é‚£å¦‚æœæ˜¯è¦åœ¨ç¬¬äºŒè¡Œå‰å‘¢ï¼Ÿã€ nl /etc/passwd | sed â€˜2i drink teaâ€™ ã€å°±å°å•¦ï¼å°±æ˜¯å°‡ã€ a ã€è®Šæˆã€ i ã€å³å¯ã€‚ å¢åŠ ä¸€è¡Œå¾ˆç°¡å–®ï¼Œé‚£å¦‚æœæ˜¯è¦å¢å°‡å…©è¡Œä»¥ä¸Šå‘¢ï¼Ÿ ç¯„ä¾‹ä¸‰ï¼šåœ¨ç¬¬äºŒè¡Œå¾Œé¢åŠ å…¥å…©è¡Œå­—ï¼Œä¾‹å¦‚ã€Drink tea or â€¦..ã€èˆ‡ã€drink beer?ã€ [dmtsai@study ~]$ nl /etc/passwd | sed '2a Drink tea or ......\\ &gt; drink beer ?' 1 root:x:0:0:root:/root:/bin/bash 2 bin:x:1:1:bin:/bin:/sbin/nologin Drink tea or ...... drink beer ? 3 daemon:x:2:2:daemon:/sbin:/sbin/nologin .....(å¾Œé¢çœç•¥)..... é€™å€‹ç¯„ä¾‹çš„é‡é»æ˜¯ã€æˆ‘å€‘å¯ä»¥æ–°å¢ä¸åªä¸€è¡Œå–”ï¼å¯ä»¥æ–°å¢å¥½å¹¾è¡Œã€ä½†æ˜¯æ¯ä¸€è¡Œä¹‹é–“éƒ½å¿…é ˆè¦ä»¥åæ–œç·šã€ \\ ã€ä¾†é€²è¡Œæ–°è¡Œçš„å¢åŠ å–”ï¼æ‰€ä»¥ï¼Œä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾åœ¨ç¬¬ä¸€è¡Œçš„æœ€å¾Œé¢å°±æœ‰ \\ å­˜åœ¨å•¦ï¼åœ¨å¤šè¡Œæ–°å¢çš„æƒ…æ³ä¸‹ï¼Œ \\ æ˜¯ä¸€å®šè¦çš„å–”ï¼ ä»¥è¡Œç‚ºå–®ä½çš„å–ä»£èˆ‡é¡¯ç¤ºåŠŸèƒ½å‰›å‰›æ˜¯ä»‹ç´¹å¦‚ä½•æ–°å¢èˆ‡åˆªé™¤ï¼Œé‚£éº¼å¦‚æœè¦æ•´è¡Œå–ä»£å‘¢ï¼Ÿçœ‹çœ‹åº•ä¸‹çš„ç¯„ä¾‹å§ï¼š ç¯„ä¾‹å››ï¼šæˆ‘æƒ³å°‡ç¬¬2-5è¡Œçš„å…§å®¹å–ä»£æˆç‚ºã€No 2-5 numberã€å‘¢ï¼Ÿ [dmtsai@study ~]$ nl /etc/passwd | sed '2,5c No 2-5 number' 1 root:x:0:0:root:/root:/bin/bash No 2-5 number 6 sync:x:5:0:sync:/sbin:/bin/sync .....(å¾Œé¢çœç•¥)..... é€éé€™å€‹æ–¹æ³•æˆ‘å€‘å°±èƒ½å¤ å°‡è³‡æ–™æ•´è¡Œå–ä»£äº†ï¼éå¸¸å®¹æ˜“å§ï¼sed é‚„æœ‰æ›´å¥½ç”¨çš„æ±æ±ï¼æˆ‘å€‘ä»¥å‰æƒ³è¦åˆ—å‡ºç¬¬ 11~20 è¡Œï¼Œ å¾—è¦é€éã€head -n 20 | tail -n 10ã€ä¹‹é¡çš„æ–¹æ³•ä¾†è™•ç†ï¼Œå¾ˆéº»ç…©å•¦ï½ sed å‰‡å¯ä»¥ç°¡å–®çš„ç›´æ¥å–å‡ºä½ æƒ³è¦çš„é‚£å¹¾è¡Œï¼æ˜¯é€éè¡Œè™Ÿä¾†æ‰çš„å–”ï¼çœ‹çœ‹åº•ä¸‹çš„ç¯„ä¾‹å…ˆï¼š ç¯„ä¾‹äº”ï¼šåƒ…åˆ—å‡º /etc/passwd æª”æ¡ˆå…§çš„ç¬¬ 5-7 è¡Œ [dmtsai@study ~]$ nl /etc/passwd | sed -n '5,7p' 5 lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin 6 sync:x:5:0:sync:/sbin:/bin/sync 7 shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown ä¸Šè¿°çš„æŒ‡ä»¤ä¸­æœ‰å€‹é‡è¦çš„é¸é …ã€ -n ã€ï¼ŒæŒ‰ç…§èªªæ˜æ–‡ä»¶ï¼Œé€™å€‹ -n ä»£è¡¨çš„æ˜¯ã€å®‰éœæ¨¡å¼ã€ï¼ é‚£éº¼ç‚ºä»€éº¼è¦ä½¿ç”¨å®‰éœæ¨¡å¼å‘¢ï¼Ÿä½ å¯ä»¥è‡ªè¡Œä¸‹é” sed â€˜5,7pâ€™ å°±çŸ¥é“äº† (5-7 è¡Œæœƒé‡è¤‡è¼¸å‡º)ï¼ æœ‰æ²’æœ‰åŠ ä¸Š -n çš„åƒæ•¸æ™‚ï¼Œè¼¸å‡ºçš„è³‡æ–™å¯æ˜¯å·®å¾ˆå¤šçš„å–”ï¼ä½ å¯ä»¥é€éé€™å€‹ sed çš„ä»¥è¡Œç‚ºå–®ä½çš„é¡¯ç¤ºåŠŸèƒ½ï¼Œ å°±èƒ½å¤ å°‡æŸä¸€å€‹æª”æ¡ˆå…§çš„æŸäº›è¡Œè™Ÿæ‰å‡ºä¾†æŸ¥é–±ï¼å¾ˆæ£’çš„åŠŸèƒ½ï¼ä¸æ˜¯å—ï¼Ÿ éƒ¨åˆ†è³‡æ–™çš„æœå°‹ä¸¦å–ä»£çš„åŠŸèƒ½é™¤äº†æ•´è¡Œçš„è™•ç†æ¨¡å¼ä¹‹å¤–ï¼Œ sed é‚„å¯ä»¥ç”¨è¡Œç‚ºå–®ä½é€²è¡Œéƒ¨åˆ†è³‡æ–™çš„æœå°‹ä¸¦å–ä»£çš„åŠŸèƒ½å–”ï¼ åŸºæœ¬ä¸Š sed çš„æœå°‹èˆ‡å–ä»£çš„èˆ‡ vi ç›¸ç•¶çš„é¡ä¼¼ï¼ä»–æœ‰é»åƒé€™æ¨£ï¼š sed â€˜s/è¦è¢«å–ä»£çš„å­—ä¸²/æ–°çš„å­—ä¸²/gâ€™ä¸Šè¡¨ä¸­ç‰¹æ®Šå­—é«”çš„éƒ¨åˆ†ç‚ºé—œéµå­—ï¼Œè«‹è¨˜ä¸‹ä¾†ï¼è‡³æ–¼ä¸‰å€‹æ–œç·šåˆ†æˆå…©æ¬„å°±æ˜¯æ–°èˆŠå­—ä¸²çš„æ›¿æ›å•¦ï¼ æˆ‘å€‘ä½¿ç”¨åº•ä¸‹é€™å€‹å–å¾— IP æ•¸æ“šçš„ç¯„ä¾‹ï¼Œä¸€æ®µä¸€æ®µçš„ä¾†è™•ç†çµ¦æ‚¨ç§ç§ï¼Œè®“ä½ ç­è§£ä¸€ä¸‹ä»€éº¼æ˜¯å’±å€‘æ‰€è¬‚çš„æœå°‹ä¸¦å–ä»£å§ï¼ æ­¥é©Ÿä¸€ï¼šå…ˆè§€å¯ŸåŸå§‹è¨Šæ¯ï¼Œåˆ©ç”¨ /sbin/ifconfig æŸ¥è©¢ IP ç‚ºä½•ï¼Ÿ [dmtsai@study ~]$ /sbin/ifconfig eth0 eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 192.168.1.100 netmask 255.255.255.0 broadcast 192.168.1.255 inet6 fe80::5054:ff:fedf:e174 prefixlen 64 scopeid 0x20&lt;link&gt; ether 52:54:00:df:e1:74 txqueuelen 1000 (Ethernet) .....(ä»¥ä¸‹çœç•¥)..... å› ç‚ºæˆ‘å€‘é‚„æ²’æœ‰è¬›åˆ° IP ï¼Œé€™è£¡ä½ å…ˆæœ‰å€‹æ¦‚å¿µå³å¯å•Šï¼æˆ‘å€‘çš„é‡é»åœ¨ç¬¬äºŒè¡Œï¼Œä¹Ÿå°±æ˜¯ 192.168.1.100 é‚£ä¸€è¡Œè€Œå·²ï¼å…ˆåˆ©ç”¨é—œéµå­—æ‰å‡ºé‚£ä¸€è¡Œï¼ æ­¥é©ŸäºŒï¼šåˆ©ç”¨é—œéµå­—é…åˆ grep æ“·å–å‡ºé—œéµçš„ä¸€è¡Œè³‡æ–™ [dmtsai@study ~]$ /sbin/ifconfig eth0 | grep 'inet ' inet 192.168.1.100 netmask 255.255.255.0 broadcast 192.168.1.255 ç•¶å ´åƒ…å‰©ä¸‹ä¸€è¡Œï¼è¦æ³¨æ„ï¼Œ CentOS 7 èˆ‡ CentOS 6 ä»¥å‰çš„ ifconfig æŒ‡ä»¤è¼¸å‡ºçµæœä¸å¤ªç›¸åŒï¼Œé³¥å“¥é€™å€‹ç¯„ä¾‹ä¸»è¦æ˜¯é‡å° CentOS 7 ä»¥å¾Œçš„å–”ï¼æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘è¦å°‡é–‹å§‹åˆ° addr: é€šé€šåˆªé™¤ï¼Œå°±æ˜¯åƒåº•ä¸‹é€™æ¨£ï¼šinet 192.168.1.100 netmask 255.255.255.0 broadcast 192.168.1.255ä¸Šé¢çš„åˆªé™¤é—œéµåœ¨æ–¼ã€ ^.inet ã€å•¦ï¼æ­£è¦è¡¨ç¤ºæ³•å‡ºç¾ï¼ ^_^* æ­¥é©Ÿä¸‰ï¼šå°‡ IP å‰é¢çš„éƒ¨åˆ†äºˆä»¥åˆªé™¤ [dmtsai@study ~]$ /sbin/ifconfig eth0 | grep 'inet ' | sed 's/^.*inet //g' 192.168.1.100 netmask 255.255.255.0 broadcast 192.168.1.255 # ä»”ç´°èˆ‡ä¸Šå€‹æ­¥é©Ÿæ¯”è¼ƒä¸€ä¸‹ï¼Œå‰é¢çš„éƒ¨åˆ†ä¸è¦‹äº†ï¼æ¥ä¸‹ä¾†å‰‡æ˜¯åˆªé™¤å¾ŒçºŒçš„éƒ¨åˆ†ï¼Œäº¦å³ï¼š 192.168.1.100 netmask 255.255.255.0 broadcast 192.168.1.255 # æ­¤æ™‚æ‰€éœ€çš„æ­£è¦è¡¨ç¤ºæ³•ç‚ºï¼šã€ ' *netmask.*$ ã€å°±æ˜¯å•¦ï¼ æ­¥é©Ÿå››ï¼šå°‡ IP å¾Œé¢çš„éƒ¨åˆ†äºˆä»¥åˆªé™¤ [dmtsai@study ~]$ /sbin/ifconfig eth0 | grep 'inet ' | sed 's/^.*inet //g' \\ &gt; | sed 's/ *netmask.*$//g' 192.168.1.100 é€éé€™å€‹ç¯„ä¾‹çš„ç·´ç¿’ä¹Ÿå»ºè­°æ‚¨ä¾æ“šæ­¤ä¸€æ­¥é©Ÿä¾†ç ”ç©¶ä½ çš„æŒ‡ä»¤ï¼å°±æ˜¯å…ˆè§€å¯Ÿï¼Œç„¶å¾Œå†ä¸€å±¤ä¸€å±¤çš„è©¦åšï¼Œ å¦‚æœæœ‰åšä¸å°çš„åœ°æ–¹ï¼Œå°±å…ˆäºˆä»¥ä¿®æ”¹ï¼Œæ”¹å®Œä¹‹å¾Œæ¸¬è©¦ï¼ŒæˆåŠŸå¾Œå†å¾€ä¸‹ç¹¼çºŒæ¸¬è©¦ã€‚ä»¥é³¥å“¥ä¸Šé¢çš„ä»‹ç´¹ä¸­ï¼Œ é‚£ä¸€å¤§ä¸²æŒ‡ä»¤å°±åšäº†å››å€‹æ­¥é©Ÿï¼å°å§ï¼ ^_^ è®“æˆ‘å€‘å†ä¾†ç¹¼çºŒç ”ç©¶ sed èˆ‡æ­£è¦è¡¨ç¤ºæ³•çš„é…åˆç·´ç¿’ï¼å‡è¨­æˆ‘åªè¦ MAN å­˜åœ¨çš„é‚£å¹¾è¡Œè³‡æ–™ï¼Œ ä½†æ˜¯å«æœ‰ # åœ¨å…§çš„è¨»è§£æˆ‘ä¸æƒ³è¦ï¼Œè€Œä¸”ç©ºç™½è¡Œæˆ‘ä¹Ÿä¸è¦ï¼æ­¤æ™‚è©²å¦‚ä½•è™•ç†å‘¢ï¼Ÿå¯ä»¥é€éé€™å¹¾å€‹æ­¥é©Ÿä¾†å¯¦ä½œçœ‹çœ‹ï¼š æ­¥é©Ÿä¸€ï¼šå…ˆä½¿ç”¨ grep å°‡é—œéµå­— MAN æ‰€åœ¨è¡Œå–å‡ºä¾† [dmtsai@study ~]$ cat /etc/man_db.conf | grep 'MAN' # MANDATORY_MANPATH manpath_element # MANPATH_MAP path_element manpath_element # MANDB_MAP global_manpath [relative_catpath] # every automatically generated MANPATH includes these fields ....(å¾Œé¢çœç•¥).... æ­¥é©ŸäºŒï¼šåˆªé™¤æ‰è¨»è§£ä¹‹å¾Œçš„è³‡æ–™ï¼ [dmtsai@study ~]$ cat /etc/man_db.conf | grep 'MAN'| sed 's/#.*$//g' MANDATORY_MANPATH /usr/man ....(å¾Œé¢çœç•¥).... # å¾ä¸Šé¢å¯ä»¥çœ‹å‡ºä¾†ï¼ŒåŸæœ¬è¨»è§£çš„è³‡æ–™éƒ½è®Šæˆç©ºç™½è¡Œå•¦ï¼æ‰€ä»¥ï¼Œæ¥ä¸‹ä¾†è¦åˆªé™¤æ‰ç©ºç™½è¡Œ [dmtsai@study ~]$ cat /etc/man_db.conf | grep 'MAN'| sed 's/#.*$//g' | sed '/^$/d' MANDATORY_MANPATH /usr/man MANDATORY_MANPATH /usr/share/man MANDATORY_MANPATH /usr/local/share/man ....(å¾Œé¢çœç•¥).... ç›´æ¥ä¿®æ”¹æª”æ¡ˆå…§å®¹(å±éšªå‹•ä½œ)ä½ ä»¥ç‚º sed åªæœ‰é€™æ¨£çš„èƒ½è€å—ï¼Ÿé‚£å¯ä¸ï¼ sed ç”šè‡³å¯ä»¥ç›´æ¥ä¿®æ”¹æª”æ¡ˆçš„å…§å®¹å‘¢ï¼è€Œä¸å¿…ä½¿ç”¨ç®¡ç·šå‘½ä»¤æˆ–è³‡æ–™æµé‡å°å‘ï¼ ä¸éï¼Œç”±æ–¼é€™å€‹å‹•ä½œæœƒç›´æ¥ä¿®æ”¹åˆ°åŸå§‹çš„æª”æ¡ˆï¼Œæ‰€ä»¥è«‹ä½ åƒè¬ä¸è¦éš¨ä¾¿æ‹¿ç³»çµ±è¨­å®šæª”ä¾†æ¸¬è©¦å–”ï¼ æˆ‘å€‘é‚„æ˜¯ä½¿ç”¨ä½ ä¸‹è¼‰çš„ regular_express.txt æª”æ¡ˆä¾†æ¸¬è©¦çœ‹çœ‹å§ï¼ ç¯„ä¾‹å…­ï¼šåˆ©ç”¨ sed å°‡ regular_express.txt å…§æ¯ä¸€è¡Œçµå°¾è‹¥ç‚º . å‰‡æ›æˆ ! [dmtsai@study ~]$ sed -i 's/\\.$/\\!/g' regular_express.txt # ä¸Šé ­çš„ -i é¸é …å¯ä»¥è®“ä½ çš„ sed ç›´æ¥å»ä¿®æ”¹å¾Œé¢æ¥çš„æª”æ¡ˆå…§å®¹è€Œä¸æ˜¯ç”±è¢å¹•è¼¸å‡ºå–”ï¼ # é€™å€‹ç¯„ä¾‹æ˜¯ç”¨åœ¨å–ä»£ï¼è«‹æ‚¨è‡ªè¡Œ cat è©²æª”æ¡ˆå»æŸ¥é–±çµæœå›‰ï¼ ç¯„ä¾‹ä¸ƒï¼šåˆ©ç”¨ sed ç›´æ¥åœ¨ regular_express.txt æœ€å¾Œä¸€è¡ŒåŠ å…¥ã€# This is a testã€ [dmtsai@study ~]$ sed -i '$a # This is a test' regular_express.txt # ç”±æ–¼ $ ä»£è¡¨çš„æ˜¯æœ€å¾Œä¸€è¡Œï¼Œè€Œ a çš„å‹•ä½œæ˜¯æ–°å¢ï¼Œå› æ­¤è©²æª”æ¡ˆæœ€å¾Œæ–°å¢å›‰ï¼ sed çš„ã€ -i ã€é¸é …å¯ä»¥ç›´æ¥ä¿®æ”¹æª”æ¡ˆå…§å®¹ï¼Œé€™åŠŸèƒ½éå¸¸æœ‰å¹«åŠ©ï¼èˆ‰ä¾‹ä¾†èªªï¼Œå¦‚æœä½ æœ‰ä¸€å€‹ 100 è¬è¡Œçš„æª”æ¡ˆï¼Œä½ è¦åœ¨ç¬¬ 100 è¡ŒåŠ æŸäº›æ–‡å­—ï¼Œæ­¤æ™‚ä½¿ç”¨ vim å¯èƒ½æœƒç˜‹æ‰ï¼å› ç‚ºæª”æ¡ˆå¤ªå¤§äº†ï¼é‚£æ€è¾¦ï¼Ÿå°±åˆ©ç”¨ sed å•Šï¼é€é sed ç›´æ¥ä¿®æ”¹/å–ä»£çš„åŠŸèƒ½ï¼Œä½ ç”šè‡³ä¸éœ€è¦ä½¿ç”¨ vim å»ä¿®è¨‚ï¼å¾ˆæ£’å§ï¼ ç¸½ä¹‹ï¼Œé€™å€‹ sed ä¸éŒ¯ç”¨å•¦ï¼è€Œä¸”å¾ˆå¤šçš„ shell script éƒ½æœƒä½¿ç”¨åˆ°é€™å€‹æŒ‡ä»¤çš„åŠŸèƒ½ï½ sed å¯ä»¥å¹«åŠ©ç³»çµ±ç®¡ç†å“¡ç®¡ç†å¥½æ—¥å¸¸çš„å·¥ä½œå–”ï¼è¦ä»”ç´°çš„å­¸ç¿’å‘¢ï¼ awkawk ä¹Ÿæ˜¯ä¸€å€‹éå¸¸æ£’çš„è³‡æ–™è™•ç†å·¥å…·ï¼ç›¸è¼ƒæ–¼ sed å¸¸å¸¸ä½œç”¨æ–¼ä¸€æ•´å€‹è¡Œçš„è™•ç†ï¼Œ awk å‰‡æ¯”è¼ƒå‚¾å‘æ–¼ä¸€è¡Œç•¶ä¸­åˆ†æˆæ•¸å€‹ã€æ¬„ä½ã€ä¾†è™•ç†ã€‚å› æ­¤ï¼Œawkç›¸ç•¶çš„é©åˆè™•ç†å°å‹çš„æ•¸æ“šè³‡æ–™è™•ç†å‘¢ï¼awk é€šå¸¸é‹ä½œçš„æ¨¡å¼æ˜¯é€™æ¨£çš„ï¼š [dmtsai@study ~]$ awk &#39;æ¢ä»¶é¡å‹1{å‹•ä½œ1} æ¢ä»¶é¡å‹2{å‹•ä½œ2} ...&#39; filenameawk å¾Œé¢æ¥å…©å€‹å–®å¼•è™Ÿä¸¦åŠ ä¸Šå¤§æ‹¬è™Ÿ {} ä¾†è¨­å®šæƒ³è¦å°è³‡æ–™é€²è¡Œçš„è™•ç†å‹•ä½œã€‚ awk å¯ä»¥è™•ç†å¾ŒçºŒæ¥çš„æª”æ¡ˆï¼Œä¹Ÿå¯ä»¥è®€å–ä¾†è‡ªå‰å€‹æŒ‡ä»¤çš„ standard output ã€‚ ä½†å¦‚å‰é¢èªªçš„ï¼Œ awk ä¸»è¦æ˜¯è™•ç†ã€æ¯ä¸€è¡Œçš„æ¬„ä½å…§çš„è³‡æ–™ã€ï¼Œè€Œé è¨­çš„ã€æ¬„ä½çš„åˆ†éš”ç¬¦è™Ÿç‚º â€œç©ºç™½éµâ€ æˆ– â€œ[tab]éµâ€ ã€ï¼èˆ‰ä¾‹ä¾†èªªï¼Œæˆ‘å€‘ç”¨ last å¯ä»¥å°‡ç™»å…¥è€…çš„è³‡æ–™å–å‡ºä¾†ï¼Œçµæœå¦‚ä¸‹æ‰€ç¤ºï¼š [dmtsai@study ~]$ last -n 5 &lt;==åƒ…å–å‡ºå‰äº”è¡Œ dmtsai pts/0 192.168.1.100 Tue Jul 14 17:32 still logged in dmtsai pts/0 192.168.1.100 Thu Jul 9 23:36 - 02:58 (03:22) dmtsai pts/0 192.168.1.100 Thu Jul 9 17:23 - 23:36 (06:12) dmtsai pts/0 192.168.1.100 Thu Jul 9 08:02 - 08:17 (00:14) dmtsai tty1 Fri May 29 11:55 - 12:11 (00:15) è‹¥æˆ‘æƒ³è¦å–å‡ºå¸³è™Ÿèˆ‡ç™»å…¥è€…çš„ IP ï¼Œä¸”å¸³è™Ÿèˆ‡ IP ä¹‹é–“ä»¥ [tab] éš”é–‹ï¼Œå‰‡æœƒè®Šæˆé€™æ¨£ï¼š [dmtsai@study ~]$ last -n 5 | awk '{print $1 \"\\t\" $3}' dmtsai 192.168.1.100 dmtsai 192.168.1.100 dmtsai 192.168.1.100 dmtsai 192.168.1.100 dmtsai Fri ä¸Šè¡¨æ˜¯ awk æœ€å¸¸ä½¿ç”¨çš„å‹•ä½œï¼é€é print çš„åŠŸèƒ½å°‡æ¬„ä½è³‡æ–™åˆ—å‡ºä¾†ï¼æ¬„ä½çš„åˆ†éš”å‰‡ä»¥ç©ºç™½éµæˆ– [tab] æŒ‰éµä¾†éš”é–‹ã€‚ å› ç‚ºä¸è«–å“ªä¸€è¡Œæˆ‘éƒ½è¦è™•ç†ï¼Œå› æ­¤ï¼Œå°±ä¸éœ€è¦æœ‰ â€œæ¢ä»¶é¡å‹â€ çš„é™åˆ¶ï¼æˆ‘æ‰€æƒ³è¦çš„æ˜¯ç¬¬ä¸€æ¬„ä»¥åŠç¬¬ä¸‰æ¬„ï¼Œ ä½†æ˜¯ï¼Œç¬¬äº”è¡Œçš„å…§å®¹æ€ªæ€ªçš„ï½é€™æ˜¯å› ç‚ºè³‡æ–™æ ¼å¼çš„å•é¡Œå•Šï¼æ‰€ä»¥å›‰ï½ä½¿ç”¨ awk çš„æ™‚å€™ï¼Œè«‹å…ˆç¢ºèªä¸€ä¸‹ä½ çš„è³‡æ–™ç•¶ä¸­ï¼Œå¦‚æœæ˜¯é€£çºŒæ€§çš„è³‡æ–™ï¼Œè«‹ä¸è¦æœ‰ç©ºæ ¼æˆ– [tab] åœ¨å…§ï¼Œå¦å‰‡ï¼Œå°±æœƒåƒé€™å€‹ä¾‹å­é€™æ¨£ï¼Œæœƒç™¼ç”Ÿèª¤åˆ¤å–”ï¼ å¦å¤–ï¼Œç”±ä¸Šé¢é€™å€‹ä¾‹å­ä½ ä¹ŸæœƒçŸ¥é“ï¼Œåœ¨ awk çš„æ‹¬è™Ÿå…§ï¼Œæ¯ä¸€è¡Œçš„æ¯å€‹æ¬„ä½éƒ½æ˜¯æœ‰è®Šæ•¸åç¨±çš„ï¼Œé‚£å°±æ˜¯ $1, $2â€¦ ç­‰è®Šæ•¸åç¨±ã€‚ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œ dmtsai æ˜¯ $1 ï¼Œå› ç‚ºä»–æ˜¯ç¬¬ä¸€æ¬„å˜›ï¼è‡³æ–¼ 192.168.1.100 æ˜¯ç¬¬ä¸‰æ¬„ï¼Œ æ‰€ä»¥ä»–å°±æ˜¯ $3 å•¦ï¼å¾Œé¢ä»¥æ­¤é¡æ¨ï½å‘µå‘µï¼é‚„æœ‰å€‹è®Šæ•¸å–”ï¼é‚£å°±æ˜¯ $0 ï¼Œ$0 ä»£è¡¨ã€ä¸€æ•´åˆ—è³‡æ–™ã€çš„æ„æ€ï½ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œç¬¬ä¸€è¡Œçš„ $0 ä»£è¡¨çš„å°±æ˜¯ã€dmtsai â€¦. ã€é‚£ä¸€è¡Œå•Šï¼ ç”±æ­¤å¯çŸ¥ï¼Œå‰›å‰›ä¸Šé¢äº”è¡Œç•¶ä¸­ï¼Œæ•´å€‹ awk çš„è™•ç†æµç¨‹æ˜¯ï¼š è®€å…¥ç¬¬ä¸€è¡Œï¼Œä¸¦å°‡ç¬¬ä¸€è¡Œçš„è³‡æ–™å¡«å…¥ $0, $1, $2â€¦. ç­‰è®Šæ•¸ç•¶ä¸­ï¼›ä¾æ“š â€œæ¢ä»¶é¡å‹â€ çš„é™åˆ¶ï¼Œåˆ¤æ–·æ˜¯å¦éœ€è¦é€²è¡Œå¾Œé¢çš„ â€œå‹•ä½œâ€ï¼›åšå®Œæ‰€æœ‰çš„å‹•ä½œèˆ‡æ¢ä»¶é¡å‹ï¼›è‹¥é‚„æœ‰å¾ŒçºŒçš„ã€è¡Œã€çš„è³‡æ–™ï¼Œå‰‡é‡è¤‡ä¸Šé¢ 1~3 çš„æ­¥é©Ÿï¼Œç›´åˆ°æ‰€æœ‰çš„è³‡æ–™éƒ½è®€å®Œç‚ºæ­¢ã€‚ç¶“éé€™æ¨£çš„æ­¥é©Ÿï¼Œä½ æœƒæ›‰å¾—ï¼Œ awk æ˜¯ã€ä»¥è¡Œç‚ºä¸€æ¬¡è™•ç†çš„å–®ä½ã€ï¼Œ è€Œã€ä»¥æ¬„ä½ç‚ºæœ€å°çš„è™•ç†å–®ä½ã€ã€‚å¥½äº†ï¼Œé‚£éº¼ awk æ€éº¼çŸ¥é“æˆ‘åˆ°åº•é€™å€‹è³‡æ–™æœ‰å¹¾è¡Œï¼Ÿæœ‰å¹¾æ¬„å‘¢ï¼Ÿé€™å°±éœ€è¦ awk çš„å…§å»ºè®Šæ•¸çš„å¹«å¿™å•¦ï½ è®Šæ•¸åç¨± ä»£è¡¨æ„ç¾© NF æ¯ä¸€è¡Œ ($0) æ“æœ‰çš„æ¬„ä½ç¸½æ•¸NR ç›®å‰ awk æ‰€è™•ç†çš„æ˜¯ã€ç¬¬å¹¾è¡Œã€è³‡æ–™FS ç›®å‰çš„åˆ†éš”å­—å…ƒï¼Œé è¨­æ˜¯ç©ºç™½éµ æˆ‘å€‘ç¹¼çºŒä»¥ä¸Šé¢ last -n 5 çš„ä¾‹å­ä¾†åšèªªæ˜ï¼Œå¦‚æœæˆ‘æƒ³è¦ï¼š åˆ—å‡ºæ¯ä¸€è¡Œçš„å¸³è™Ÿ(å°±æ˜¯ $1)ï¼›åˆ—å‡ºç›®å‰è™•ç†çš„è¡Œæ•¸(å°±æ˜¯ awk å…§çš„ NR è®Šæ•¸)ä¸¦ä¸”èªªæ˜ï¼Œè©²è¡Œæœ‰å¤šå°‘æ¬„ä½(å°±æ˜¯ awk å…§çš„ NF è®Šæ•¸)å‰‡å¯ä»¥é€™æ¨£ï¼š Tipsé³¥å“¥çš„åœ–ç¤º è¦æ³¨æ„å–”ï¼Œawk å¾ŒçºŒçš„æ‰€æœ‰å‹•ä½œæ˜¯ä»¥å–®å¼•è™Ÿã€ â€˜ ã€æ‹¬ä½çš„ï¼Œç”±æ–¼å–®å¼•è™Ÿèˆ‡é›™å¼•è™Ÿéƒ½å¿…é ˆæ˜¯æˆå°çš„ï¼Œ æ‰€ä»¥ï¼Œ awk çš„æ ¼å¼å…§å®¹å¦‚æœæƒ³è¦ä»¥ print åˆ—å°æ™‚ï¼Œè¨˜å¾—éè®Šæ•¸çš„æ–‡å­—éƒ¨åˆ†ï¼ŒåŒ…å«ä¸Šä¸€å°ç¯€ printf æåˆ°çš„æ ¼å¼ä¸­ï¼Œéƒ½éœ€è¦ä½¿ç”¨é›™å¼•è™Ÿä¾†å®šç¾©å‡ºä¾†å–”ï¼å› ç‚ºå–®å¼•è™Ÿå·²ç¶“æ˜¯ awk çš„æŒ‡ä»¤å›ºå®šç”¨æ³•äº†ï¼ [dmtsai@study ~]$ last -n 5| awk '{print $1 \"\\t lines: \" NR \"\\t columns: \" NF}' dmtsai lines: 1 columns: 10 dmtsai lines: 2 columns: 10 dmtsai lines: 3 columns: 10 dmtsai lines: 4 columns: 10 dmtsai lines: 5 columns: 9 æ³¨æ„å–”ï¼Œåœ¨ awk å…§çš„ NR, NF ç­‰è®Šæ•¸è¦ç”¨å¤§å¯«ï¼Œä¸”ä¸éœ€è¦æœ‰éŒ¢å­—è™Ÿ $ å•¦ï¼é€™æ¨£å¯ä»¥ç­è§£ NR èˆ‡ NF çš„å·®åˆ¥äº†å§ï¼Ÿå¥½äº†ï¼Œåº•ä¸‹ä¾†è«‡ä¸€è«‡æ‰€è¬‚çš„ â€œæ¢ä»¶é¡å‹â€ äº†å§ï¼ awk çš„é‚è¼¯é‹ç®—å­—å…ƒæ—¢ç„¶æœ‰éœ€è¦ç”¨åˆ° â€œæ¢ä»¶â€ çš„é¡åˆ¥ï¼Œè‡ªç„¶å°±éœ€è¦ä¸€äº›é‚è¼¯é‹ç®—å›‰ï½ä¾‹å¦‚åº•ä¸‹é€™äº›ï¼š é‹ç®—å–®å…ƒ ä»£è¡¨æ„ç¾© å¤§æ–¼&lt; å°æ–¼= å¤§æ–¼æˆ–ç­‰æ–¼&lt;= å°æ–¼æˆ–ç­‰æ–¼== ç­‰æ–¼!= ä¸ç­‰æ–¼ å€¼å¾—æ³¨æ„çš„æ˜¯é‚£å€‹ã€ == ã€çš„ç¬¦è™Ÿï¼Œå› ç‚ºï¼š é‚è¼¯é‹ç®—ä¸Šé¢äº¦å³æ‰€è¬‚çš„å¤§æ–¼ã€å°æ–¼ã€ç­‰æ–¼ç­‰åˆ¤æ–·å¼ä¸Šé¢ï¼Œç¿’æ…£ä¸Šæ˜¯ä»¥ã€ == ã€ä¾†è¡¨ç¤ºï¼›å¦‚æœæ˜¯ç›´æ¥çµ¦äºˆä¸€å€‹å€¼ï¼Œä¾‹å¦‚è®Šæ•¸è¨­å®šæ™‚ï¼Œå°±ç›´æ¥ä½¿ç”¨ = è€Œå·²ã€‚å¥½äº†ï¼Œæˆ‘å€‘å¯¦éš›ä¾†é‹ç”¨ä¸€ä¸‹é‚è¼¯åˆ¤æ–·å§ï¼èˆ‰ä¾‹ä¾†èªªï¼Œåœ¨ /etc/passwd ç•¶ä¸­æ˜¯ä»¥å†’è™Ÿ â€œ:â€ ä¾†ä½œç‚ºæ¬„ä½çš„åˆ†éš”ï¼Œ è©²æª”æ¡ˆä¸­ç¬¬ä¸€æ¬„ä½ç‚ºå¸³è™Ÿï¼Œç¬¬ä¸‰æ¬„ä½å‰‡æ˜¯ UIDã€‚é‚£å‡è¨­æˆ‘è¦æŸ¥é–±ï¼Œç¬¬ä¸‰æ¬„å°æ–¼ 10 ä»¥ä¸‹çš„æ•¸æ“šï¼Œä¸¦ä¸”åƒ…åˆ—å‡ºå¸³è™Ÿèˆ‡ç¬¬ä¸‰æ¬„ï¼Œ é‚£éº¼å¯ä»¥é€™æ¨£åšï¼š [dmtsai@study ~]$ cat /etc/passwd | awk '{FS=\":\"} $3 &lt; 10 {print $1 \"\\t \" $3}' root:x:0:0:root:/root:/bin/bash bin 1 daemon 2 ....(ä»¥ä¸‹çœç•¥).... æœ‰è¶£å§ï¼ä¸éï¼Œæ€éº¼ç¬¬ä¸€è¡Œæ²’æœ‰æ­£ç¢ºçš„é¡¯ç¤ºå‡ºä¾†å‘¢ï¼Ÿé€™æ˜¯å› ç‚ºæˆ‘å€‘è®€å…¥ç¬¬ä¸€è¡Œçš„æ™‚å€™ï¼Œé‚£äº›è®Šæ•¸ $1, $2â€¦ é è¨­é‚„æ˜¯ä»¥ç©ºç™½éµç‚ºåˆ†éš”çš„ï¼Œæ‰€ä»¥é›–ç„¶æˆ‘å€‘å®šç¾©äº† FS=â€:â€ äº†ï¼Œ ä½†æ˜¯å»åƒ…èƒ½åœ¨ç¬¬äºŒè¡Œå¾Œæ‰é–‹å§‹ç”Ÿæ•ˆã€‚é‚£éº¼æ€éº¼è¾¦å‘¢ï¼Ÿæˆ‘å€‘å¯ä»¥é å…ˆè¨­å®š awk çš„è®Šæ•¸å•Šï¼ åˆ©ç”¨ BEGIN é€™å€‹é—œéµå­—å–”ï¼é€™æ¨£åšï¼š [dmtsai@study ~]$ cat /etc/passwd | awk 'BEGIN {FS=\":\"} $3 &lt; 10 {print $1 \"\\t \" $3}' root 0 bin 1 daemon 2 ......(ä»¥ä¸‹çœç•¥)...... å¾ˆæœ‰è¶£å§ï¼è€Œé™¤äº† BEGIN ä¹‹å¤–ï¼Œæˆ‘å€‘é‚„æœ‰ END å‘¢ï¼å¦å¤–ï¼Œå¦‚æœè¦ç”¨ awk ä¾†é€²è¡Œã€è¨ˆç®—åŠŸèƒ½ã€å‘¢ï¼Ÿä»¥åº•ä¸‹çš„ä¾‹å­ä¾†çœ‹ï¼Œ å‡è¨­æˆ‘æœ‰ä¸€å€‹è–ªè³‡è³‡æ–™è¡¨æª”åç‚º pay.txt ï¼Œå…§å®¹æ˜¯é€™æ¨£çš„ï¼š Name 1st 2nd 3th VBird 23000 24000 25000 DMTsai 21000 20000 23000 Bird2 43000 42000 41000 å¦‚ä½•å¹«æˆ‘è¨ˆç®—æ¯å€‹äººçš„ç¸½é¡å‘¢ï¼Ÿè€Œä¸”æˆ‘é‚„æƒ³è¦æ ¼å¼åŒ–è¼¸å‡ºå–”ï¼æˆ‘å€‘å¯ä»¥é€™æ¨£è€ƒæ…®ï¼š ç¬¬ä¸€è¡Œåªæ˜¯èªªæ˜ï¼Œæ‰€ä»¥ç¬¬ä¸€è¡Œä¸è¦é€²è¡ŒåŠ ç¸½ (NR==1 æ™‚è™•ç†)ï¼›ç¬¬äºŒè¡Œä»¥å¾Œå°±æœƒæœ‰åŠ ç¸½çš„æƒ…æ³å‡ºç¾ (NR&gt;=2 ä»¥å¾Œè™•ç†) [dmtsai@study ~]$ cat pay.txt | \\ &gt; awk 'NR==1{printf \"%10s %10s %10s %10s %10s\\n\",$1,$2,$3,$4,\"Total\" } &gt; NR&gt;=2{total = $2 + $3 + $4 &gt; printf \"%10s %10d %10d %10d %10.2f\\n\", $1, $2, $3, $4, total}' Name 1st 2nd 3th Total VBird 23000 24000 25000 72000.00 DMTsai 21000 20000 23000 64000.00 Bird2 43000 42000 41000 126000.00 ä¸Šé¢çš„ä¾‹å­æœ‰å¹¾å€‹é‡è¦äº‹é …æ‡‰è©²è¦å…ˆèªªæ˜çš„ï¼š awk çš„æŒ‡ä»¤é–“éš”ï¼šæ‰€æœ‰ awk çš„å‹•ä½œï¼Œäº¦å³åœ¨ {} å…§çš„å‹•ä½œï¼Œå¦‚æœæœ‰éœ€è¦å¤šå€‹æŒ‡ä»¤è¼”åŠ©æ™‚ï¼Œå¯åˆ©ç”¨åˆ†è™Ÿã€;ã€é–“éš”ï¼Œ æˆ–è€…ç›´æ¥ä»¥ [Enter] æŒ‰éµä¾†éš”é–‹æ¯å€‹æŒ‡ä»¤ï¼Œä¾‹å¦‚ä¸Šé¢çš„ç¯„ä¾‹ä¸­ï¼Œé³¥å“¥å…±æŒ‰äº†ä¸‰æ¬¡ [enter] å–”ï¼é‚è¼¯é‹ç®—ç•¶ä¸­ï¼Œå¦‚æœæ˜¯ã€ç­‰æ–¼ã€çš„æƒ…æ³ï¼Œå‰‡å‹™å¿…ä½¿ç”¨å…©å€‹ç­‰è™Ÿã€==ã€ï¼æ ¼å¼åŒ–è¼¸å‡ºæ™‚ï¼Œåœ¨ printf çš„æ ¼å¼è¨­å®šç•¶ä¸­ï¼Œå‹™å¿…åŠ ä¸Š \\n ï¼Œæ‰èƒ½é€²è¡Œåˆ†è¡Œï¼èˆ‡ bash shell çš„è®Šæ•¸ä¸åŒï¼Œåœ¨ awk ç•¶ä¸­ï¼Œè®Šæ•¸å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€åŠ ä¸Š $ ç¬¦è™Ÿã€‚åˆ©ç”¨ awk é€™å€‹ç©æ„å…’ï¼Œå°±å¯ä»¥å¹«æˆ‘å€‘è™•ç†å¾ˆå¤šæ—¥å¸¸å·¥ä½œäº†å‘¢ï¼çœŸæ˜¯å¥½ç”¨çš„å¾ˆï½ æ­¤å¤–ï¼Œ awk çš„è¼¸å‡ºæ ¼å¼ç•¶ä¸­ï¼Œå¸¸å¸¸æœƒä»¥ printf ä¾†è¼”åŠ©ï¼Œæ‰€ä»¥ï¼Œ æœ€å¥½ä½ å° printf ä¹Ÿç¨å¾®ç†Ÿæ‚‰ä¸€ä¸‹æ¯”è¼ƒå¥½å•¦ï¼å¦å¤–ï¼Œ awk çš„å‹•ä½œå…§ {} ä¹Ÿæ˜¯æ”¯æ´ if (æ¢ä»¶) çš„å–”ï¼ èˆ‰ä¾‹ä¾†èªªï¼Œä¸Šé¢çš„æŒ‡ä»¤å¯ä»¥ä¿®è¨‚æˆç‚ºé€™æ¨£ï¼š [dmtsai@study ~]$ cat pay.txt | \\ &gt; awk '{if(NR==1) printf \"%10s %10s %10s %10s %10s\\n\",$1,$2,$3,$4,\"Total\"} &gt; NR&gt;=2{total = $2 + $3 + $4 &gt; printf \"%10s %10d %10d %10d %10.2f\\n\", $1, $2, $3, $4, total}' ä½ å¯ä»¥ä»”ç´°çš„æ¯”å°ä¸€ä¸‹ä¸Šé¢å…©å€‹è¼¸å…¥æœ‰å•¥ä¸åŒï½å¾ä¸­å»ç­è§£å…©ç¨®èªæ³•å§ï¼æˆ‘å€‹äººæ˜¯æ¯”è¼ƒå‚¾å‘æ–¼ä½¿ç”¨ç¬¬ä¸€ç¨®èªæ³•ï¼Œ å› ç‚ºæœƒæ¯”è¼ƒæœ‰çµ±ä¸€æ€§å•Šï¼ ^_^ é™¤æ­¤ä¹‹å¤–ï¼Œ awk é‚„å¯ä»¥å¹«æˆ‘å€‘é€²è¡Œè¿´åœˆè¨ˆç®—å–”ï¼çœŸæ˜¯ç›¸ç•¶çš„å¥½ç”¨ï¼ä¸éï¼Œé‚£å±¬æ–¼æ¯”è¼ƒé€²éšçš„å–®ç¨èª²ç¨‹äº†ï¼Œ æˆ‘å€‘é€™è£¡å°±ä¸å†å¤šåŠ ä»‹ç´¹ã€‚å¦‚æœä½ æœ‰èˆˆè¶£çš„è©±ï¼Œè«‹å‹™å¿…åƒè€ƒå»¶ä¼¸é–±è®€ä¸­çš„ç›¸é—œé€£çµå–” é“¾æ¥é¸Ÿå“¥çš„ç§æˆ¿èœï¼šç¬¬åä¸€ç« ã€æ­£è¦è¡¨ç¤ºæ³•èˆ‡æ–‡ä»¶æ ¼å¼åŒ–è™•ç†","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"}]},{"title":"Shellè„šæœ¬é”™è¯¯æç¤ºâ€”â€”binsh^Mbad interpreter","date":"2016-08-19T06:24:25.000Z","path":"2016/08/19/Shellè„šæœ¬é”™è¯¯æç¤ºâ€”â€”binsh^Mbad interpreter/","text":"æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ä¸€ç›´å‘ç°æ‰§è¡Œå¤±è´¥ï¼Œå‘½ä»¤æ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœ /bin/sh^M:bad interpreter: No such file or directory è¿™ä¸ªé”™è¯¯å‘ç”Ÿåœ¨ä½ åœ¨windowsä¸‹ç¼–å†™æ–‡ä»¶ä¸Šä¼ åˆ°linuxæœåŠ¡å™¨å»è¿è¡Œçš„æ—¶å€™ã€‚é”™è¯¯åŸå› ï¼šwindowså’Œlinuxçš„æ–‡ä»¶ä¸ä¸€æ ·ã€‚è§£å†³åŠæ³•:viè¯¥æ–‡ä»¶ åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥ :set ff=unix å›è½¦ä¾‹å¦‚ a.sh vi a.sh è¿›å…¥è¾“å…¥ :set ff=unix å›è½¦è¾“å…¥:wq å›è½¦ å†æ¬¡æ‰§è¡Œå°±ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜äº†ã€‚","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"}]},{"title":"BucketSortæ¡¶æ’åº","date":"2016-08-14T07:24:25.000Z","path":"2016/08/14/BucketSortæ¡¶æ’åº/","text":"Bucket Sortä»‹ç»æ¡¶æ’åº (Bucket sort)æˆ–æ‰€è°“çš„ç®±æ’åºï¼Œæ˜¯ä¸€ä¸ªæ’åºç®—æ³•ï¼Œå·¥ä½œçš„åŸç†æ˜¯å°†æ•°ç»„åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶å­é‡Œã€‚æ¯ä¸ªæ¡¶å­å†ä¸ªåˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å½’æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’åºï¼‰ã€‚æ¡¶æ’åºæ˜¯é¸½å·¢æ’åºçš„ä¸€ç§å½’çº³ç»“æœã€‚å½“è¦è¢«æ’åºçš„æ•°ç»„å†…çš„æ•°å€¼æ˜¯å‡åŒ€åˆ†é…çš„æ—¶å€™ï¼Œæ¡¶æ’åºä½¿ç”¨çº¿æ€§æ—¶é—´ï¼ˆÎ˜ï¼ˆnï¼‰ï¼‰ã€‚ä½†æ¡¶æ’åºå¹¶ä¸æ˜¯ æ¯”è¾ƒæ’åºï¼Œä»–ä¸å—åˆ° O(n log n) ä¸‹é™çš„å½±å“ã€‚ å‡å®šï¼šè¾“å…¥æ˜¯ç”±ä¸€ä¸ªéšæœºè¿‡ç¨‹äº§ç”Ÿçš„[0, 1)åŒºé—´ä¸Šå‡åŒ€åˆ†å¸ƒçš„å®æ•°ã€‚å°†åŒºé—´[0, 1)åˆ’åˆ†ä¸ºnä¸ªå¤§å°ç›¸ç­‰çš„å­åŒºé—´ï¼ˆæ¡¶ï¼‰ï¼Œæ¯æ¡¶å¤§å°1/nï¼š[0, 1/n)ï¼Œ [1/n, 2/n)ï¼Œ [2/n, 3/n)ï¼Œâ€¦ï¼Œ[k/n, (k+1)/n )ï¼Œâ€¦å°†nä¸ªè¾“å…¥å…ƒç´ åˆ†é…åˆ°è¿™äº›æ¡¶ä¸­ï¼Œå¯¹æ¡¶ä¸­å…ƒç´ è¿›è¡Œæ’åºï¼Œç„¶åä¾æ¬¡è¿æ¥æ¡¶è¾“å…¥0 â‰¤A[1..n] &lt;1è¾…åŠ©æ•°ç»„B[0..n-1]æ˜¯ä¸€æŒ‡é’ˆæ•°ç»„ï¼ŒæŒ‡å‘æ¡¶ï¼ˆé“¾è¡¨ï¼‰ã€‚ ä»‹ç»ä¸€ä¸ªéå¸¸æ˜“äºç†è§£Bucket Sortçš„ç½‘ç«™ï¼šBucket Sort æ¡¶æ’åºæœ‰ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„ç¼ºç‚¹ï¼šæ•°æ®æœ€å¥½éƒ½å¤„äºä¸€ä¸ªæ¯”è¾ƒå°çš„åŒºé—´å†…ï¼Œå¦‚æœæ•°æ®å¤„äº1-2äº¿çš„åŒºé—´å½“ä¸­ï¼Œç”¨æ¡¶æ’åºæ˜¾ç„¶ä¸åˆé€‚ å®ç°123456789101112131415161718192021222324252627282930313233343536class Solution &#123;public: vector&lt;int&gt; bucket(vector&lt;int&gt;&amp; nums) &#123; int maxValue = getMax(nums); int numsSize = nums.size(); vector&lt;vector&lt;int&gt;&gt;bucket(numsSize + 1); //æ‰¾æ¡¶ï¼švalue*numsSize/(maxValue+1) for (int i = 0; i &lt; numsSize; i++) &#123; int bucketNum = (nums[i] * numsSize) / (maxValue + 1); bucket[bucketNum].push_back(nums[i]); &#125; //æŒ‰é¡ºåºéå†æ¡¶ï¼Œç”Ÿæˆç»“æœ for (int i = 0, m = 0; i &lt; numsSize + 1; i++) &#123; if (!bucket[i].empty()) &#123; //å¦‚æœæ¡¶çš„æ•°å­—ä¸ªæ•°å¤§äº1ï¼Œå¯¹æ¡¶å†…è¿›è¡Œæ’åº if (bucket[i].size() &gt; 1) &#123; sort(bucket[i].begin(), bucket[i].end()); &#125; for (int size = bucket[i].size(), j = 0; j &lt; size; j++, m++) &#123; nums[m] = bucket[i][j]; &#125; &#125; &#125; return nums; &#125; int getMax(vector&lt;int&gt; &amp;nums) &#123; int size = nums.size(); int max = INT_MIN; for (int i = 0; i &lt; size; i++) &#123; if (nums[i] &gt; max) &#123; max = nums[i]; &#125; &#125; return max; &#125;&#125;;","tags":[{"name":"BucketSort","slug":"BucketSort","permalink":"https://github.com/kong36088/kong36088.github.io/tags/BucketSort/"},{"name":"æ’åº","slug":"æ’åº","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æ’åº/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ç®—æ³•/"}]},{"title":"Leetcodeé¢˜è§£â€”â€”347Top K Frequent Elements","date":"2016-08-14T06:24:25.000Z","path":"2016/08/14/Leetcodeé¢˜è§£â€”â€”347Top K Frequent Elements/","text":"é¢˜ç›®é¢˜ç›®åœ°å€ï¼š347. Top K Frequent Elements Given a non-empty array of integers, return the k most frequent elements. For example,Given [1,1,1,2,2,3] and k = 2, return [1,2]. Note:You may assume k is always valid, 1 â‰¤ k â‰¤ number of unique elements.Your algorithmâ€™s time complexity must be better than O(n log n), where n is the arrayâ€™s size. æ ¹æ®é¢˜ç›®å¤§æ„å°±æ˜¯ï¼Œç»™å‡ºä¸€ä¸ªæ•°ç»„ï¼Œæ‰¾å‡ºå…¶ä¸­å‡ºç°æ¬¡æ•°å‰Kå¤šçš„æ•°å­—å¹¶ä»¥æ•°ç»„å½¢å¼è¿”å› é¢˜è§£åˆ©ç”¨ä¼˜å…ˆé˜Ÿåˆ—123456789101112131415161718192021222324252627282930class Solution &#123;private : unordered_map&lt;int, int&gt;um; vector&lt;int&gt;n; int numsSize;public: vector&lt;int&gt; topKFrequent(vector&lt;int&gt;&amp; nums, int k) &#123; numsSize = nums.size(); n = nums; priority_queue&lt;pair&lt;int,int&gt;&gt;pq; vector&lt;int&gt;result; //åˆ©ç”¨hashmapè¿›è¡Œä¸ªæ•°çš„ç»Ÿè®¡ for (int i = 0; i &lt; numsSize; i++) &#123; um[n[i]]++; &#125; auto it = um.begin(); //æ–°å»ºä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œä¼˜å…ˆé˜Ÿåˆ—æ˜¯å †æ’åºçš„å‡çº§ç‰ˆO(nlog2n)çš„æ—¶é—´å¤æ‚åº¦ï¼Œé»˜è®¤å¤§é¡¶å † for (int size = um.size(),i = 0; i &lt; size; i++) &#123; pq.push(make_pair(it-&gt;second, it-&gt;first)); it++; &#125; //æœ€åå–å †é¡¶ for (int i = 0; i &lt; k; i++) &#123; result.push_back(pq.top().second); pq.pop(); &#125; return result; &#125;&#125;; å¤§é¡¶å †çš„ç‰¹æ€§æ˜¯ä»é¡¶éƒ¨å…ƒç´ å¾€ä¸‹ä¾æ¬¡ä»å¤§åˆ°å°è¿›è¡Œæ’åºï¼Œå°é¡¶å †åˆ™åä¹‹è¦å–å¾—å‰Kä¸ªå‡ºç°æ¬¡æ•°æœ€å¤šçš„æ•°ï¼Œåªéœ€è¦æ¯æ¬¡éƒ½å–å †é¡¶å…ƒç´ -&gt;åˆ é™¤å †é¡¶-&gt;è°ƒæ•´å †ç»§ç»­å–å †é¡¶ åˆ©ç”¨Bucket Sortåˆ©ç”¨æ¡¶æ’åºä¸­æ¡¶å·ä½œä¸ºå‡ºç°æ¬¡æ•°ï¼Œæ¡¶ä¸­æ”¾å…¥æ¬¡æ•°å¯¹åº”çš„æ•°å­— 1234567891011121314151617181920212223242526public List&lt;Integer&gt; topKFrequent(int[] nums, int k) &#123; List&lt;Integer&gt;[] bucket = new List[nums.length + 1]; Map&lt;Integer, Integer&gt; frequencyMap = new HashMap&lt;Integer, Integer&gt;(); for (int n : nums) &#123; frequencyMap.put(n, frequencyMap.getOrDefault(n, 0) + 1); &#125; for (int key : frequencyMap.keySet()) &#123; int frequency = frequencyMap.get(key); if (bucket[frequency] == null) &#123; bucket[frequency] = new ArrayList&lt;&gt;(); &#125; bucket[frequency].add(key); &#125; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); for (int pos = bucket.length - 1; pos &gt;= 0 &amp;&amp; res.size() &lt; k; pos--) &#123; if (bucket[pos] != null) &#123; res.addAll(bucket[pos]); &#125; &#125; return res;&#125;","tags":[{"name":"C++","slug":"C","permalink":"https://github.com/kong36088/kong36088.github.io/tags/C/"},{"name":"LeetCode","slug":"LeetCode","permalink":"https://github.com/kong36088/kong36088.github.io/tags/LeetCode/"}]},{"title":"LeetCodeé¢˜è§£â€”â€”299Bulls_and_Cows","date":"2016-07-28T06:24:25.000Z","path":"2016/07/28/LeetCodeé¢˜è§£â€”â€”299Bulls_and_Cows/","text":"æˆ‘çš„4msè§£æ³•é¢˜ç›®åœ°å€ï¼šBulls and Cowsé¢˜ç›®ï¼šYou are playing the following Bulls and Cows game with your friend: You write down a number and ask your friend to guess what the number is. Each time your friend makes a guess, you provide a hint that indicates how many digits in said guess match your secret number exactly in both digit and position (called â€œbullsâ€) and how many digits match the secret number but locate in the wrong position (called â€œcowsâ€). Your friend will use successive guesses and hints to eventually derive the secret number. For example: Secret number: â€œ1807â€Friendâ€™s guess: â€œ7810â€Hint: 1 bull and 3 cows. (The bull is 8, the cows are 0, 1 and 7.)Write a function to return a hint according to the secret number and friendâ€™s guess, use A to indicate the bulls and B to indicate the cows. In the above example, your function should return â€œ1A3Bâ€. Please note that both secret number and friendâ€™s guess may contain duplicate digits, for example: Secret number: â€œ1123â€Friendâ€™s guess: â€œ0111â€In this case, the 1st 1 in friendâ€™s guess is a bull, the 2nd or 3rd 1 is a cow, and your function should return â€œ1A1Bâ€.You may assume that the secret number and your friendâ€™s guess only contain digits, and their lengths are always equal. é¢˜ç›®å¤§æ„åœ¨Secretä¸²å’ŒGuessä¸²ä¸­æ‰¾å‡ºä½ç½®ç›¸åŒä¸”æ•°å­—ç›¸åŒçš„æ•°é‡Aï¼Œå¹¶ä¸”è®¡ç®—å‡ºä½ç½®ä¸ä¸€æ ·ä½†æ˜¯æ•°å­—ç›¸åŒçš„æ•°é‡B ä»¥ä¸‹æ˜¯ä»£ç 1234567891011121314151617181920212223242526272829class Solution &#123;public: string getHint(string secret, string guess) &#123; int countA = 0, countB = 0; int sizeA = secret.size(), sizeB = guess.size(); int pos = 0; int markA[10] = &#123;0&#125;,markB[10]=&#123;0&#125;; for (pos=0;pos &lt; sizeA;pos++) &#123; int tmpA=secret.at(pos)-48,tmpB=guess.at(pos)-48; if(tmpA==tmpB)&#123; countA++; continue; &#125; markA[tmpA]++; markB[tmpB]++; &#125; //è®¡ç®—Bçš„å¤§å° for(int i=0;i&lt;10;i++)&#123; if(markA[i]&gt;0&amp;&amp;markB[i]&gt;0)&#123; if(markA[i]&gt;=markB[i])&#123; countB+=markB[i]; &#125;else&#123; countB+=markA[i]; &#125; &#125; &#125; return to_string(countA)+\"A\"+to_string(countB)+\"B\"; &#125;&#125;;","tags":[{"name":"C++","slug":"C","permalink":"https://github.com/kong36088/kong36088.github.io/tags/C/"},{"name":"LeetCode","slug":"LeetCode","permalink":"https://github.com/kong36088/kong36088.github.io/tags/LeetCode/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ äºŒï¼‰â€”â€”å•ä¾‹æ¨¡å¼å’ŒåŸå‹æ¨¡å¼","date":"2016-07-25T10:24:25.000Z","path":"2016/07/25/è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ äºŒï¼‰â€”â€”å•ä¾‹æ¨¡å¼å’ŒåŸå‹æ¨¡å¼/","text":"æœ¬æ–‡ä¸»è¦è®²è§£è®¾è®¡æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰ã€åŸå‹æ¨¡å¼ï¼ˆPrototypeï¼‰ å•ä¾‹æ¨¡å¼å•ä¾‹æ¨¡å¼å¯ä»¥ä½¿ä¸€äº›ç‰¹æ®Šçš„ç±»åªè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œä¿æŒæ¯æ¬¡åªä½¿ç”¨åŒä¸€ä¸ªç±»å…³äºé€‚ç”¨æ€§ï¼š1ï¼‰å½“ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹è€Œä¸”å®¢æˆ·å¯ä»¥ä»ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„è®¿é—®ç‚¹è®¿é—®å®ƒæ—¶ã€‚2ï¼‰å½“è¿™ä¸ªå”¯ä¸€å®ä¾‹åº”è¯¥æ˜¯é€šè¿‡å­ç±»åŒ–å¯æ‰©å±•çš„ï¼Œå¹¶ä¸”å®¢æˆ·åº”è¯¥æ— éœ€æ›´æ”¹ä»£ç å°±èƒ½ä½¿ç”¨ä¸€ä¸ªæ‰©å±•çš„å®ä¾‹æ—¶ã€‚ å…³äºå•ä¾‹æ¨¡å¼çš„å®ç°ä¹Ÿéå¸¸ç®€å•ä»¥ä¸‹æ˜¯å®ç°çš„ä»£ç 1234567891011121314151617181920&lt;?php class Singleton &#123; static private $_instance = null;//é™æ€æˆå‘˜ä¿å­˜å”¯ä¸€å®ä¾‹ /** * ç§æœ‰æ„é€ å‡½æ•°ï¼Œä¿è¯ä¸èƒ½è¢«å¤–éƒ¨è®¿é—® * */ private function __construct() &#123;&#125; /** * é™æ€æ–¹æ³•å°†åˆ›å»ºè¿™ä¸ªå®ä¾‹çš„æ“ä½œå¹¶ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»º * * @return unknown */ public static function getInstance() &#123; if (!self::$_instance) &#123; self::$_instance = new self(); &#125; return self::$_instance; &#125; &#125; åŒæ—¶ï¼Œé€šè¿‡æ”¹é€ å•ä¾‹æ¨¡å¼ä¹Ÿå¯ä»¥å®ç°å¤šä¾‹æ¨¡å¼1234567891011121314151617181920212223&lt;?php class Singleton &#123; static private $_instance[] = array();//é™æ€æˆå‘˜ä¿å­˜å”¯ä¸€å®ä¾‹ private $uid; /** * ç§æœ‰æ„é€ å‡½æ•°ï¼Œä¿è¯ä¸èƒ½è¢«å¤–éƒ¨è®¿é—® * */ private function __construct($uid) &#123; $this-&gt;uid = $uid; &#125; /** * é™æ€æ–¹æ³•å°†åˆ›å»ºè¿™ä¸ªå®ä¾‹çš„æ“ä½œå¹¶ä¿è¯åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»º * * @return unknown */ public static function getInstance($uid = 0) &#123; if (!self::$_instance || !isset(self::$_instance[$uid])) &#123; self::$_instance[$uid] = new self($uid); &#125; return self::$_instance[$uid]; &#125; &#125; åŸå‹æ¨¡å¼åŸå‹æ¨¡å¼é€‚ç”¨äºåˆå§‹åŒ–è¿‡ç¨‹éå¸¸ç¹ççš„ç±»å½“ä¸­ã€‚é€šè¿‡clone()è¿™ä¸€æ–¹æ³•å¯ä»¥æ›´ä¸ºç®€å•çš„å¾—åˆ°åˆå§‹åŒ–ä¹‹åçš„ç±»åŒæ—¶ä¹Ÿé€‚ç”¨äºå·²ç»æ”¹å˜ç»“æ„çš„ç±»ã€‚ç®€è€Œè¨€ä¹‹ï¼Œç®€åŒ–åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæé«˜è®¡ç®—æ•ˆç‡ 1 ) è¿è¡Œæ—¶åˆ»å¢åŠ å’Œåˆ é™¤äº§å“ï¼š Prototypeå…è®¸åªé€šè¿‡å®¢æˆ·æ³¨å†ŒåŸå‹å®ä¾‹å°±å¯ä»¥å°†ä¸€ä¸ªæ–°çš„å…·ä½“äº§å“ç±»å¹¶å…¥ç³»ç»Ÿã€‚å®ƒæ¯”å…¶ä»–åˆ›å»ºå‹æ¨¡å¼æ›´ä¸ºçµæ´»ï¼Œå› ä¸ºå®¢æˆ·å¯ä»¥åœ¨è¿è¡Œæ—¶åˆ»å»ºç«‹å’Œåˆ é™¤åŸå‹ã€‚2 ) æ”¹å˜å€¼ä»¥æŒ‡å®šæ–°å¯¹è±¡ï¼š é«˜åº¦åŠ¨æ€çš„ç³»ç»Ÿå…è®¸ä½ é€šè¿‡å¯¹è±¡å¤åˆå®šä¹‰æ–°çš„è¡Œä¸ºâ€”ä¾‹å¦‚ï¼Œé€šè¿‡ä¸ºä¸€ä¸ªå¯¹è±¡å˜é‡æŒ‡å®šå€¼â€”å¹¶ä¸”ä¸å®šä¹‰æ–°çš„ç±»ã€‚ä½ é€šè¿‡å®ä¾‹åŒ–å·²æœ‰ç±»å¹¶ä¸”å°†è¿™äº›å®ä¾‹æ³¨å†Œä¸ºå®¢æˆ·å¯¹è±¡çš„åŸå‹ï¼Œå°±å¯ä»¥æœ‰æ•ˆå®šä¹‰æ–°ç±»åˆ«çš„å¯¹è±¡ã€‚å®¢æˆ·å¯ä»¥å°†èŒè´£ä»£ç†ç»™åŸå‹ï¼Œä»è€Œè¡¨ç°å‡ºæ–°çš„è¡Œä¸ºã€‚è¿™ç§è®¾è®¡ä½¿å¾—ç”¨æˆ·æ— éœ€ç¼–ç¨‹å³å¯å®šä¹‰æ–°â€œç±»â€ ã€‚å®é™…ä¸Šï¼Œå…‹éš†ä¸€ä¸ªåŸå‹ç±»ä¼¼äºå®ä¾‹åŒ–ä¸€ä¸ªç±»ã€‚Prototypeæ¨¡å¼å¯ä»¥æå¤§çš„å‡å°‘ç³»ç»Ÿæ‰€éœ€è¦çš„ç±»çš„æ•°ç›®ã€‚3) æ”¹å˜ç»“æ„ä»¥æŒ‡å®šæ–°å¯¹è±¡ï¼šè®¸å¤šåº”ç”¨ç”±éƒ¨ä»¶å’Œå­éƒ¨ä»¶æ¥åˆ›å»ºå¯¹è±¡ã€‚4) å‡å°‘å­ç±»çš„æ„é€  Factory Method ç»å¸¸äº§ç”Ÿä¸€ä¸ªä¸äº§å“ç±»å±‚æ¬¡å¹³è¡Œçš„ Creatorç±»å±‚æ¬¡ã€‚Prototypeæ¨¡å¼ä½¿å¾—ä½ å…‹éš†ä¸€ä¸ªåŸå‹è€Œä¸æ˜¯è¯·æ±‚ä¸€ä¸ªå·¥å‚æ–¹æ³•å»äº§ç”Ÿä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚å› æ­¤ä½ æ ¹æœ¬ä¸éœ€è¦Creatorç±»å±‚æ¬¡ã€‚è¿™ä¸€ä¼˜ç‚¹ä¸»è¦é€‚ç”¨äºåƒ C + +è¿™æ ·ä¸å°†ç±»ä½œä¸ºä¸€çº§ç±»å¯¹è±¡çš„è¯­è¨€ã€‚åƒSmalltalkå’ŒObjective Cè¿™æ ·çš„è¯­è¨€ä»ä¸­è·ç›Šè¾ƒå°‘ï¼Œå› ä¸ºä½ æ€»æ˜¯å¯ä»¥ç”¨ä¸€ä¸ªç±»å¯¹è±¡ä½œä¸ºç”Ÿæˆè€…ã€‚åœ¨è¿™äº›è¯­è¨€ä¸­ï¼Œç±»å¯¹è±¡å·²ç»èµ·åˆ°åŸå‹ä¸€æ ·çš„ä½œç”¨äº†ã€‚5) ç”¨ç±»åŠ¨æ€é…ç½®åº”ç”¨ ä¸€äº›è¿è¡Œæ—¶åˆ»ç¯å¢ƒå…è®¸ä½ åŠ¨æ€å°†ç±»è£…è½½åˆ°åº”ç”¨ä¸­ã€‚åœ¨åƒ C + +è¿™æ ·çš„è¯­è¨€ä¸­ï¼ŒPrototypeæ¨¡å¼æ˜¯åˆ©ç”¨è¿™ç§åŠŸèƒ½çš„å…³é”®ã€‚ä¸€ä¸ªå¸Œæœ›åˆ›å»ºåŠ¨æ€è½½å…¥ç±»çš„å®ä¾‹çš„åº”ç”¨ä¸èƒ½é™æ€å¼•ç”¨ç±»çš„æ„é€ å™¨ã€‚è€Œåº”è¯¥ç”±è¿è¡Œç¯å¢ƒåœ¨è½½å…¥æ—¶è‡ªåŠ¨åˆ›å»ºæ¯ä¸ªç±»çš„å®ä¾‹ï¼Œå¹¶ç”¨åŸå‹ç®¡ç†å™¨æ¥æ³¨å†Œè¿™ä¸ªå®ä¾‹ï¼ˆå‚è§å®ç°ä¸€èŠ‚ï¼‰ ã€‚è¿™æ ·åº”ç”¨å°±å¯ä»¥å‘åŸå‹ç®¡ç†å™¨è¯·æ±‚æ–°è£…è½½çš„ç±»çš„å®ä¾‹ï¼Œè¿™äº›ç±»åŸæœ¬å¹¶æ²¡æœ‰å’Œç¨‹åºç›¸è¿æ¥ã€‚ E T + +åº”ç”¨æ¡†æ¶[ W G M 8 8 ]æœ‰ä¸€ä¸ªè¿è¡Œç³»ç»Ÿå°±æ˜¯ä½¿ç”¨è¿™ä¸€æ–¹æ¡ˆçš„ã€‚ ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637/** * åŸå‹æ¨¡å¼ */ /** * æŠ½è±¡åŸå‹è§’è‰² */ interface Prototype &#123; public function copy(); &#125; /** * å…·ä½“åŸå‹è§’è‰² */ class ConcretePrototype implements Prototype&#123; private $_name; public function __construct($name) &#123; $this-&gt;_name = $name; &#125; public function setName($name) &#123; $this-&gt;_name = $name; &#125; public function getName() &#123; return $this-&gt;_name; &#125; public function copy() &#123; /** æ·±æ‹·è´ */ return clone $this; /** æµ…æ‹·è´ */ //return $this; &#125; &#125; å‚è€ƒæ–‡ç« è®¾è®¡æ¨¡å¼ï¼ˆäºŒï¼‰å•ä»¶æ¨¡å¼Singletonï¼ˆåˆ›å»ºå‹ï¼‰è®¾è®¡æ¨¡å¼ï¼ˆå››ï¼‰åŸå‹æ¨¡å¼Prototypeï¼ˆåˆ›å»ºå‹ï¼‰","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è®¾è®¡æ¨¡å¼/"}]},{"title":"è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ ä¸€ï¼‰â€”â€”å»ºé€ æ¨¡å¼ä¸å·¥å‚æ¨¡å¼","date":"2016-07-25T06:24:25.000Z","path":"2016/07/25/è®¾è®¡æ¨¡å¼ï¼ˆåˆ›å»ºå‹ ä¸€ï¼‰â€”â€”å»ºé€ æ¨¡å¼ä¸å·¥å‚æ¨¡å¼/","text":"åˆ›å»ºå‹çš„è®¾è®¡æ¨¡å¼ä¸»è¦åŒ…æ‹¬ï¼šå·¥å‚æ¨¡å¼ã€å»ºé€ æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€åŸå‹æ¨¡å¼æœ¬æ–‡ä¸»è¦é’ˆå¯¹å»ºé€ æ¨¡å¼ç±»ä¼¼çš„ä¸¤ç§è®¾è®¡æ¨¡å¼è¿›è¡Œå­¦ä¹ è®°å½•æ€»ç»“ä¸»è¦ä»‹ç»ï¼šå·¥å‚æ¨¡å¼Factoryã€å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰ å·¥å‚æ¨¡å¼å·¥å‚æ¨¡å¼åœ¨æ—¥å¸¸è®¾è®¡å¼€å‘ä¸­è¾ƒä¸ºå¸¸è§ã€‚ä½¿ç”¨åœºæ™¯ï¼š1)å½“å®¢æˆ·ç¨‹åºä¸éœ€è¦çŸ¥é“è¦ä½¿ç”¨å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ã€‚2)å®¢æˆ·ç¨‹åºä½¿ç”¨çš„å¯¹è±¡å­˜åœ¨å˜åŠ¨çš„å¯èƒ½ï¼Œæˆ–è€…æ ¹æœ¬å°±ä¸çŸ¥é“ä½¿ç”¨å“ªä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ã€‚ ç”±äº§å“ç±»ã€å·¥å‚ç±»ã€å®¢æˆ·ç±»ä¸‰ä¸­ç±»æ„æˆè¿™é‡Œä¸¾ä¸ªä¾‹å­ äº§å“ç±»ï¼š12345678910111213141516171819/** * è½¦å­ç³»åˆ— * */ abstract Class BWM&#123; function __construct($pa) &#123; &#125; &#125; Class BWM320 extends BWM&#123; function __construct($pa) &#123; &#125; &#125; Class BMW523 extends BWM&#123; function __construc($pb)&#123; &#125;&#125; å·¥å‚ç±»1234567891011121314151617181920212223242526272829/** * åˆ›å»ºå·¥å‚çš„æ¥å£ * */ interface FactoryBMW &#123; function createBMW(); &#125; /** * * åˆ›å»ºBWM320è½¦ */ class FactoryBWM320 implements FactoryBMW &#123; function createBMW($type)&#123; return new BWM320(); &#125; &#125; /** * * åˆ›å»ºBWM523è½¦ */ class FactoryBWM523 implements FactoryBMW &#123; function createBMW($type)&#123; return new BMW523(); &#125; &#125; å®¢æˆ·ç±»123456789101112131415161718/** * * å®¢æˆ·å¾—åˆ°è½¦ */ class Customer &#123; private $BMW; function getBMW($type)&#123; switch ($type) &#123; case 320: $BWM320 = new FactoryBWM320(); return $BWM320-&gt;createBMW(); case 523: $BWM523 = new FactoryBWM523(); return $BWM320-&gt;createBMW(); //.... &#125; &#125;&#125; å·¥å‚æ¨¡å¼è¾ƒä¸ºé€‚åˆè¿›è¡ŒæœªçŸ¥äº§å“ç±»å‹çš„å¼€å‘ï¼Œåœ¨éœ€è¦è¿›è¡Œå¤šç§ä¸åŒç±»å‹çš„äº§å“çš„å¼€å‘æ—¶ï¼Œä½¿ç”¨å•ä¸€çš„å·¥å‚å¯ä»¥ä¿æŒäº§å“çš„å•ä¸€å…¥å£ï¼Œä»è€Œæé«˜ä»£ç çš„å¤ç”¨ç‡å’Œå¼€å‘æ—¶æ•ˆç‡ å»ºé€ è€…æ¨¡å¼å»ºé€ è€…æ¨¡å¼å’Œå·¥å‚æ¨¡å¼è¾ƒä¸ºç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨ç”Ÿæˆå¤æ‚äº§å“çš„æ—¶å€™ä½¿ç”¨å»ºé€ è€…æ¨¡å¼ä¼šæ¯”è¾ƒçš„é€‚åˆå»ºé€ è€…æ¨¡å¼æ¯”å·¥å‚æ¨¡å¼å¤šå‡ºä¸€ä¸ªæŒ‡å¯¼è€…ç±»ï¼Œç”¨äºç»„è£…builderç”Ÿäº§å‡ºçš„ç»„ä»¶ä»¥ä¸‹æ˜¯ä¾‹å­ï¼š æŒ‡å¯¼è€…ç±»12345678910111213141516&lt;?php /** * æŒ‡å¯¼è€…:æ”¶é“¶å‘˜ * */ class DirectorCashier &#123; /** * æ”¶é“¶é¤é¦†å‘˜å·¥è¿”å›çš„é£Ÿç‰© * */ public function buildFood(Builder $builder) &#123; $builder-&gt;buildPart1(); $builder-&gt;buildPart2(); &#125; &#125; å»ºé€ è€…ç±»ï¼ˆä¸åŒçš„äº§å“æœ‰ä¸åŒçš„ç»„ä»¶ï¼‰ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869/** * å…·ä½“å»ºé€ è€…ç±»:é¤é¦†å‘˜å·¥,è¿”å›çš„å¥—é¤æ˜¯ï¼šæ±‰å ¡ä¸¤ä¸ª+é¥®æ–™ä¸€ä¸ª * */ class ConcreteBuilder1 extends Builder &#123; protected $_product = null;//äº§å“å¯¹è±¡ function __construct()&#123; $this-&gt;_product = new Product(); &#125; /** * åˆ›å»ºäº§å“çš„ç¬¬ä¸€éƒ¨åˆ†::æ±‰å ¡=2 */ public function buildPart1() &#123; $this-&gt;_product-&gt;add('Hamburger',2); &#125; /** * * åˆ›å»ºäº§å“çš„ç¬¬äºŒéƒ¨åˆ†ï¼š */ public function buildPart2() &#123; $this-&gt;_product-&gt;add('Drink', 1); &#125; /** * è¿”å›äº§å“å¯¹è±¡ : * */ public function getProduct() &#123; return $this-&gt;_product; &#125; &#125; /** * å…·ä½“å»ºé€ è€…ç±»:é¤é¦†å‘˜å·¥ï¼Œæ±‰å ¡1ä¸ª+é¥®æ–™2ä¸ª * */ class ConcreteBuilder2 extends Builder &#123; protected $_product = null;//äº§å“å¯¹è±¡ function __construct()&#123; $this-&gt;_product = new Product(); &#125; /** * åˆ›å»ºäº§å“çš„ç¬¬ä¸€éƒ¨åˆ†:æ±‰å ¡ */ public function buildPart1() &#123; $this-&gt;_product-&gt;add('Hamburger', 1); &#125; /** * * åˆ›å»ºäº§å“çš„ç¬¬äºŒéƒ¨åˆ†:drink=2 */ public function buildPart2() &#123; $this-&gt;_product-&gt;add('Drink', 2); &#125; /** * è¿”å›äº§å“å¯¹è±¡ : * */ public function getProduct() &#123; return $this-&gt;_product; &#125; &#125; äº§å“ç±»12345678910111213141516171819202122/** * äº§å“ç±» */ class Product &#123; public $products = array(); /** * æ·»åŠ å…·ä½“äº§å“ */ public function add($name, $value) &#123; $this-&gt;products[$name] = $value; &#125; /** * ç»™é¡¾å®¢æŸ¥çœ‹äº§å“ */ public function showToClient() &#123; foreach ($this-&gt;products as $key =&gt; $v) &#123; echo $key , '=' , $v ,'&lt;br&gt;'; &#125; &#125; &#125; å®¢æˆ·ç¨‹åº123456789101112131415161718192021222324class Client &#123; /** * é¡¾å®¢è´­ä¹°å¥—é¤ * */ public function buy($type) &#123; //æŒ‡å¯¼è€…ï¼Œæ”¶é“¶å‘˜ $director = new DirectorCashier(); //é¤é¦†å‘˜å·¥ï¼Œæ”¶é“¶å‘˜ $class = new ReflectionClass('ConcreteBuilder' .$type ); $concreteBuilder = $class-&gt;newInstanceArgs(); //æ”¶é“¶å‘˜ç»„åˆå‘˜å·¥è¿”å›çš„é£Ÿç‰© $director-&gt;buildFood($concreteBuilder); //è¿”å›ç»™é¡¾å®¢ $concreteBuilder-&gt;getProduct()-&gt;showToClient(); &#125; &#125; //æµ‹è¯• ini_set('display_errors', 'On'); $c = new Client(); $c-&gt;buy(1);//è´­ä¹°å¥—é¤1 $c-&gt;buy(2);//è´­ä¹°å¥—é¤1 å¦‚æœäº§å“çš„å»ºé€ å¾ˆå¤æ‚ï¼Œä½¿ç”¨å·¥å‚æ¨¡å¼å¦‚æœäº§å“çš„å»ºé€ æ›´åŠ å¤æ‚ï¼Œä½¿ç”¨å»ºé€ è€…æ¨¡å¼æŒ‰ç…§ä¸ªäººç†è§£æ¥è¯´ï¼Œå…¶å®å»ºé€ è€…æ¨¡å¼å°±æ˜¯å·¥å‚æ¨¡å¼çš„ä¸Šå‡ï¼Œåœ¨ç”Ÿäº§å‡ºäº§å“çš„ç±»ä¸Šå†æ¬¡å°è£…ä¸€å±‚ï¼Œä½¿å¾—ä»£ç å°è£…ç¨‹åº¦æ›´é«˜ï¼Œæ›´åŠ ä¾¿äºç»´æŠ¤å»ºé€ æ¨¡å¼æŠŠç”Ÿäº§å‡ºäº§å“ä¹‹ä¸Šå†åŠ ä¸€å±‚ï¼Œå·¥å‚ç”Ÿäº§å‡ºçš„åªæ˜¯ç»„ä»¶ï¼Œè¿˜éœ€è¦æŒ‡å¯¼è€…å»ç»„è£…è¿™äº›ç»„ä»¶ä½¿ä¹‹æˆä¸ºäº§å“ å‚è€ƒæ–‡ç« è®¾è®¡æ¨¡å¼ï¼ˆä¸€ï¼‰å·¥å‚æ¨¡å¼Factoryï¼ˆåˆ›å»ºå‹ï¼‰è®¾è®¡æ¨¡å¼ï¼ˆä¸‰ï¼‰å»ºé€ è€…æ¨¡å¼Builderï¼ˆåˆ›å»ºå‹ï¼‰","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è®¾è®¡æ¨¡å¼/"}]},{"title":"åŸºäºdockeræ­å»ºgogs","date":"2016-07-08T06:24:25.000Z","path":"2016/07/08/åŸºäºdockeræ­å»ºgogs/","text":"åœ¨linuxä¸‹åˆ©ç”¨dockeræ­å»ºgogsé¦–å…ˆéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…docker-composeå’Œdockeråœ¨ä¹‹å‰çš„ docker-composeå¿«é€Ÿæ­å»ºlnmp+redisæœåŠ¡å™¨ç¯å¢ƒ æ–‡ç« ä¸­æœ‰ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº† æ­å»ºmysqlçš„å®¹å™¨123mkdir /mysqlcd /mysqlvi docker-compose.yml ç”Ÿæˆdocker-compose.ymlå¹¶ä¸”å†…å®¹å¦‚ä¸‹12345678910mysql: container_name: mysql build: . volumes: - /mysql/data/:/var/lib/mysql environment: MYSQL_ROOT_PASSWORD: root ports: - &quot;3306:3306&quot; restart: always ä¿å­˜å¹¶é€€å‡º :wqï¼Œåœ¨åŒä¸€ç›®å½•ä¸‹åˆ›å»ºDockerfile123456vi Dockerfile#ç¼–è¾‘Dockerfileæ–‡ä»¶ä¿å­˜From mysql#ä¿å­˜é€€å‡º :wqmkdir /mysql/datadocker-compose up -d mysqlå®¹å™¨æ­å»ºå®Œæˆ æ­å»ºgogså®¹å™¨1234mkdir /gogsmkdir /gogs/datacd /gogsvi docker-compose.yml å…¶ä¸­docker-compose.ymlå†…å®¹å¦‚ä¸‹ï¼Œå®Œæˆç¼–è¾‘åä¿å­˜é€€å‡º1234567891011gogs: container_name: gogs build: . ports: - &quot;10002:22&quot; - &quot;3000:3000&quot; external_links: - mysql:mysql volumes: - /gogs/data:/data restart: always 1234vi Dockerfile#å†…å®¹å¦‚ä¸‹From gogs/gogsdocker-compose up -d å®Œæˆåˆ›å»º è¿›å…¥mysqlåˆ›å»ºgogsåº“123mysql -uroot -proot -h0.0.0.0 mysql &gt; CREATE DATABASE `gogs` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;mysql &gt; exit è¿›è¡Œgogsçš„ç›¸å…³è®¾ç½®åœ¨æµè§ˆå™¨è®¿é—®æœ¬æœºåœ°å€çš„3000ç«¯å£ï¼Œè¿›è¡Œåˆå§‹åŒ–è®¾ç½®æŒ‰ç…§ä¸‹å›¾å‚è€ƒè®¾ç½® å®‰è£…å®Œæˆåæ³¨å†Œä¸€ä¸ªè´¦æˆ·ä½œä¸ºç®¡ç†å‘˜è´¦æˆ·å¤§åŠŸå‘Šæˆï¼","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"docker","slug":"docker","permalink":"https://github.com/kong36088/kong36088.github.io/tags/docker/"}]},{"title":"docker-composeå¿«é€Ÿæ­å»ºlnmp+redisæœåŠ¡å™¨ç¯å¢ƒ","date":"2016-06-01T06:24:25.000Z","path":"2016/06/01/docker-composeå¿«é€Ÿæ­å»ºlnmp7+redisæœåŠ¡å™¨ç¯å¢ƒ/","text":"å®‰è£…æœ€æ–°ç‰ˆæœ¬dockerè¿™é‡Œæˆ‘ç³»ç»Ÿç”¨çš„æ˜¯centos7ï¼Œå…·ä½“å®‰è£…æ–¹æ³•ä¹Ÿå¯ä»¥åˆ°å®˜ç½‘ä¸Šå»æŸ¥çœ‹å®˜ç½‘åœ°å€ Docker requires a 64-bit installation regardless of your CentOS version. Also, your kernel must be 3.10 at minimum, which CentOS 7 runs.To check your current kernel version, open a terminal and use uname -r to display your kernel version: 12$ uname -r3.10.0-229.el7.x86_64 ç¡®è®¤ç³»ç»Ÿç‰ˆæœ¬ç¬¦åˆåå¼€å§‹å®‰è£…1234567891011$ sudo yum update$ sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-'EOF'[dockerrepo]name=Docker Repositorybaseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/enabled=1gpgcheck=1gpgkey=https://yum.dockerproject.org/gpgEOF$ sudo yum install docker-engine$ sudo service docker start å®‰è£…docker-composeå…ˆå®‰è£…pip123sudo yum updatesudo yum -y install epel-releasesudo yum -y install python-pip å®‰è£…å®Œæˆåæˆ‘ä»¬æ¥ç€å®‰è£…docker-compose1sudo pip install -U docker-compose å¤§åŠŸå‘Šæˆ æ­å»ºlnmp7+redisç¯å¢ƒç”Ÿæˆç›®å½•ç»“æ„åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªappç›®å½•ç„¶ååœ¨appç›®å½•ä¸‹ç”Ÿæˆnginx-php mysql rediså­ç›®å½•ï¼Œç”¨äºå­˜æ”¾å„ç±»æ•°æ®1sudo mkdir /app è¿™é‡Œæ˜¯ç›®å½•ç»“æ„ ~/Dockerfilesâ”œâ”€â”€ mysqlâ”‚ â””â”€â”€ Dockerfileâ”œâ”€â”€ nginx-phpâ”‚ â”œâ”€â”€ Dockerfileâ”œâ”€â”€ redisâ”‚ â””â”€â”€ Dockerfileâ””â”€â”€ www â””â”€â”€ ç½‘ç«™ä»£ç  åˆ©ç”¨docker-composeç”Ÿæˆç¯å¢ƒdocker-compose.ymlçš„å†…å®¹1234567891011121314151617181920212223242526nginx-php: build: ./nginx-php ports: - &quot;80:80&quot; links: - &quot;mysql&quot; volumes: - /app/www:/var/www/html environment: WEB_DOCUMENT_ROOT: /var/www/htmlmysql: build: ./mysql ports: - &quot;3306:3306&quot; volumes: - /app/mysql/data:/var/lib/mysql environment: MYSQL_ROOT_PASSWORD: rootredis: build: ./redis ports: - &quot;6379:6379&quot; volumes: - /app/redis/data:/data nginx-phpçš„Dockerfile1From webdevops/php-nginx:debian-8-php7 è¿™ä¸ªæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„nginx phpæœåŠ¡å™¨ï¼Œè‡ªå¸¦redis memcached gd mysqlç­‰æ‹“å±•mysqlçš„Dockerfile1From mysql:latest redisçš„Dockerfile1From redis:latest æœ€åè¿è¡Œå‘½ä»¤12cd /appdocker-compose up -d ç­‰å¾…è‡ªåŠ¨ç”Ÿæˆå®¹å™¨åç¯å¢ƒæ­å»ºæˆåŠŸ å‚è€ƒèµ„æ–™Docker File ReferenceDockeråœ¨PHPé¡¹ç›®å¼€å‘ç¯å¢ƒä¸­çš„åº”ç”¨ç”¨ Docker æ¥è¿è¡Œå’Œè°ƒè¯• PHP ç½‘ç«™","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"docker","slug":"docker","permalink":"https://github.com/kong36088/kong36088.github.io/tags/docker/"}]},{"title":"åˆ©ç”¨dockeræ­å»ºlnmp7æœåŠ¡å™¨ç¯å¢ƒæ•™ç¨‹","date":"2016-05-30T06:24:25.000Z","path":"2016/05/30/åˆ©ç”¨dockeræ­å»ºlnmp7æœåŠ¡å™¨ç¯å¢ƒæ•™ç¨‹/","text":"ubuntué•œåƒä»å®˜æ–¹ä¸‹è½½ä¸€ä¸ªubuntué•œåƒ1docker pull ubuntu:14.04 å®‰è£…nginxå®‰è£…nginxæœåŠ¡1234docker run --net=host -it ubuntu:14.04 bashapt-get update apt-get install nginx å®Œæˆå®‰è£… é…ç½®1sudo vim /etc/nginx/sites-available/kejyun.dev å®Œæˆä¸»æœºçš„è®¾å®š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051server &#123; # è¨­å®š Listen çš„ port listen 80; # è¨­å®šæœå‹™ä¸»æ©Ÿåç¨± server_name kejyun.dev; # è¨­å®šç¶²ç«™æ ¹ç›®éŒ„è·¯å¾‘ root \"/home/kejyun/laravel52/public\"; # è¨­å®šè®€å–æª”æ¡ˆå„ªå…ˆé †åº index index.html index.htm index.php; # è¨­å®šç¶²ç«™ç·¨ç¢¼ charset utf-8; location / &#123; try_files $uri $uri/ /index.php?$query_string; &#125; location = /favicon.ico &#123; access_log off; log_not_found off; &#125; location = /robots.txt &#123; access_log off; log_not_found off; &#125; access_log off; # è¨­å®š Log è·¯å¾‘ error_log /var/log/nginx/kejyun.dev-error.log error; sendfile off; client_max_body_size 100m; # è¨­å®š php æª”æ¡ˆè™•ç†æ–¹å¼ location ~ \\.php$ &#123; fastcgi_split_path_info ^(.+\\.php)(/.+)$; fastcgi_pass unix:/var/run/php/php7.0-fpm.sock; fastcgi_index index.php; include fastcgi_params; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; fastcgi_intercept_errors off; fastcgi_buffer_size 16k; fastcgi_buffers 4 16k; fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; &#125; location ~ /\\.ht &#123; deny all; &#125;&#125; è¿æ¥é…ç½®æ–‡ä»¶1sudo ln -s /etc/nginx/sites-available/kejyun.dev /etc/nginx/sites-enabled/kejyun.dev é‡å¯æœåŠ¡1service nginx restart å®‰è£…php7æ·»åŠ ç¯å¢ƒå®‰è£…æ·»åŠ ppaæ‰€éœ€ç¯å¢ƒ12sudo apt-get install software-properties-commonsudo apt-get install python3-software-properties æ·»åŠ æº1LC_ALL=C.UTF-8 add-apt-repository ppa:ondrej/php LC_ALL=C.UTF-8æ˜¯ä¸ºäº†æŒ‡å®šç¼–ç ï¼Œä¸æ·»åŠ è¿™ä¸€æ®µä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å®˜æ–¹çš„ä¸€ä¸ªbug å…³é—­selinuxè¿™é‡Œè¦å…ˆå…³é—­selinuxå¦åˆ™ä¼šæŠ¥é”™1sudo vim /etc/selinux/.conf åœ¨æ–‡ä»¶åº•éƒ¨å¢åŠ è¿™ä¸€è¡Œ1SELINUX=disabled é‡å¯å®¹å™¨12exitdocker restart xxxx å®‰è£…php712sudo apt-get updatesudo apt-get install php7.0-fpm php7.0-mysql php7.0-mcrypt php7.0-gd php7.0-cli php7.0-curl php7.0-imap å®Œæˆ å®‰è£…mysql5.7è·å–mysql5.7å¥—ä»¶123wget http://dev.mysql.com/get/mysql-apt-config_0.6.0-1_all.debsudo dpkg -i mysql-apt-config_0.6.0-1_all.debsudo dpkg-reconfigure mysql-apt-config è®¾å®šmysqlé¢„è®¾å®‰è£…ç‰ˆæœ¬ å®‰è£…mysql12sudo apt-get updatesudo apt-get install mysql-server-5.7 å®Œæˆ å‚è€ƒèµ„æ–™ä¸»æ©Ÿç’°å¢ƒå»ºç½®","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"docker","slug":"docker","permalink":"https://github.com/kong36088/kong36088.github.io/tags/docker/"}]},{"title":"Centos7ä¸‹æ­å»ºgogs","date":"2016-05-24T06:24:25.000Z","path":"2016/05/24/Centos7ä¸‹æ­å»ºgogs/","text":"æ–°å»ºç”¨æˆ·Gogs é»˜è®¤ä»¥ git ç”¨æˆ·è¿è¡Œã€‚è¿è¡Œ sudo adduser git æ–°å»ºå¥½ git ç”¨æˆ·ã€‚su git ä»¥ git ç”¨æˆ·ç™»å½•ï¼Œåˆ° git ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­æ–°å»ºå¥½ .ssh æ–‡ä»¶å¤¹ã€‚å®Œæˆ ä¸‹è½½äºŒè¿›åˆ¶ä»£ç åœ¨ è¿™é‡Œ å¯ä»¥æ ¹æ®ç³»ç»Ÿä¸‹è½½äºŒè¿›åˆ¶ä»£ç ä¹‹åè§£å‹åˆ°ä»»æ„åœ°æ–¹ï¼Œåœ¨è¿™é‡Œæˆ‘é€‰æ‹©è§£å‹åˆ°/home/git ä¸‹12345$ ls /home/git/gogs/$ custom data gogs LICENSE log public README.md README_ZH.md scripts templates$ #è¿™é‡Œç»™æŠŠgogsç›®å½•æƒé™èµ‹äºˆgitç”¨æˆ·$ sudo chown -R git:git /home/git/gogs/$ sudo chmod -R 760 /home/git/gogs/ è¿è¡Œå®‰è£…é¦–å…ˆå®‰è£…æ•°æ®åº“ï¼Œè¿™é‡Œæˆ‘ä»¬å®‰è£…mariadbï¼Œåœ¨centos7ä¸­mariadbä»£æ›¿äº†mysql 12sudo yum updateyum -y install mariadb å®‰è£…å¥½æ•°æ®åº“åæˆ‘ä»¬è¿›è¡Œå®‰è£…gogs123456$ mysql -u root -p&gt; # ï¼ˆè¾“å…¥å¯†ç ï¼‰&gt; create user 'gogs'@'localhost' identified by 'å¯†ç ';&gt; grant all privileges on gogs.* to 'gogs'@'localhost';&gt; flush privileges;&gt; exit; è¿™é‡Œé…ç½®å¥½æ•°æ®åº“åå³å¯å¼€å§‹å®‰è£…gogså•¦12$ cd /home/git/gogs/$ ./gogs web åˆ°gogsè§£å‹ç›®å½•ä¸‹ï¼Œ./gogs webå¼€å¯gogsé»˜è®¤ç«¯å£æ˜¯3000ï¼Œä¹Ÿå¯ä»¥é€šè¿‡./gogos web -port 3301æ¥æ”¹å˜ç«¯å£è‡³3301è®¿é—®localhost:3000/installè¿›è¡Œå®‰è£…åœ¨è¿™é‡Œè¦æ³¨æ„å¯¹gogsç›¸åº”ç›®å½•èµ‹äºˆgitç”¨æˆ·æƒé™ï¼Œæ ¹æ®ç¼ºçœè®¾ç½®ï¼Œè¿™é‡Œæˆ‘è¿™ä¹ˆé…ç½®123$ mkdir /home/git/gogs-repositories/$ sudo chown -R git:git ./gogs-repositories/$ sudo chmod -R 760 ./gogs-repositories/ å®‰è£…å®Œæˆåå³å¯è®¿é—®å•¦ gogså®ˆæŠ¤è¿›ç¨‹å¯åŠ¨gogsä¸­çš„app.inié…ç½®é¦–å…ˆé…ç½® gogs/custom/conf/app.iniæ ¹æ®æœ¬åœ°ç¯å¢ƒè¿›è¡Œç›¸åº”é…ç½®ä»¥ä¸‹æ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142APP_NAME = Gogs: Go Git ServiceRUN_USER = gitRUN_MODE = prod[database]DB_TYPE = mysqlHOST = 127.0.0.1:3306NAME = gogsUSER = rootPASSWD = rootSSL_MODE = disablePATH = data/gogs.db[repository]ROOT = /home/git/gogs-repositories[server]DOMAIN = 115.159.146.149HTTP_PORT = 3000ROOT_URL = http://115.159.146.149:3000/DISABLE_SSH = falseSSH_PORT = 22OFFLINE_MODE = false[mailer]ENABLED = false[service]REGISTER_EMAIL_CONFIRM = falseENABLE_NOTIFY_MAIL = falseDISABLE_REGISTRATION = falseENABLE_CAPTCHA = trueREQUIRE_SIGNIN_VIEW = false[picture]DISABLE_GRAVATAR = false[session]PROVIDER = file[log]MODE = file RUN_USER é»˜è®¤æ˜¯ gitï¼ŒæŒ‡å®š Gogs ä»¥å“ªä¸ªç”¨æˆ·è¿è¡Œ ROOT æ‰€æœ‰ä»“åº“çš„å­˜å‚¨æ ¹è·¯å¾„ PROTOCOL å¦‚æœä½ ä½¿ç”¨ nginx åä»£çš„è¯è¯·ä½¿ç”¨ httpï¼Œå¦‚æœç›´æ¥è£¸è·‘å¯¹å¤–æœåŠ¡çš„è¯éšæ„ DOMAIN åŸŸåã€‚ä¼šå½±å“ SSH clone åœ°å€ ROOT_URL å®Œæ•´çš„æ ¹è·¯å¾„ï¼Œä¼šå½±å“è®¿é—®æ—¶é¡µé¢ä¸Šé“¾æ¥çš„æŒ‡å‘ï¼Œä»¥åŠ HTTP clone çš„åœ°å€ HTTP_ADDR ç›‘å¬åœ°å€ï¼Œä½¿ç”¨ nginx çš„è¯å»ºè®® 127.0.0.1ï¼Œå¦åˆ™ 0.0.0.0 ä¹Ÿå¯ä»¥ HTTP_PORT ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ 3000 INSTALL_LOCK é”å®šå®‰è£…é¡µé¢ Mailer ç›¸å…³çš„é€‰é¡¹ systemdæœåŠ¡é…ç½®åœ¨ GitHub ä¸Šçš„ Gogs ä»“åº“æœ‰ä¸€ä¸ª systemdæœåŠ¡æ¨¡ç‰ˆæ–‡ä»¶ æ›´æ–° Userã€Groupã€WorkingDirectoryã€ExecStart å’Œ Environment ä¸ºç›¸å¯¹åº”çš„å€¼ã€‚å…¶ä¸­ WorkingDirectory ä¸ºGogså®é™…å®‰è£…è·¯å¾„æ ¹ç›®å½•ã€‚[å¯é€‰] å¦‚æœæ‚¨ Gogs å®‰è£…ç¤ºä¾‹ä½¿ç”¨ MySQL/MariaDBã€PostgreSQLã€Redis æˆ– memcachedï¼Œè¯·å»æ‰ç›¸åº” After å±æ€§çš„æ³¨é‡Šã€‚å®Œæˆä¿®æ”¹åï¼Œå°†æ–‡ä»¶ä¿å­˜è‡³ /etc/systemd/system/gogs.serviceï¼Œç„¶åé€šè¿‡ sudo systemctl enable gogs å‘½ä»¤æ¿€æ´»ï¼Œæœ€åæ‰§è¡Œ sudo systemd start gogså¯åŠ¨ã€‚ é€šè¿‡ sudo systemd status gogs -l æˆ– sudo journalctl -b -u gogs å¯ä»¥æŸ¥çœ‹ Gogs çš„è¿è¡ŒçŠ¶æ€ã€‚ è¿™æ˜¯æˆ‘çš„/etc/systemd/system/gogs.serviceé…ç½®æ–‡ä»¶1234567891011121314151617181920212223242526[Unit]Description=Gogs (Go Git Service)After=syslog.targetAfter=network.targetAfter=mariadb.service#After=postgresql.service#After=memcached.service#After=redis.service[Service]# Modify these two values and uncomment them if you have# repos with lots of files and get an HTTP error 500 because# of that####LimitMEMLOCK=infinity#LimitNOFILE=65535Type=simpleUser=gitGroup=gitWorkingDirectory=/home/git/gogsExecStart=/home/git/gogs/gogs webRestart=alwaysEnvironment=USER=git HOME=/home/git[Install]WantedBy=multi-user.target å¤§åŠŸå‘Šæˆ å¦ä¸€ç§æ¯”è¾ƒæš´åŠ›çš„å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ–¹å¼åˆ‡æ¢åˆ°gogsæ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œnohup ./gogs web &amp;12$ cd /home/git/gogs$ nohup ./gogs web &amp; å‚è€ƒå‚è€ƒæ–‡ç« ï¼šhttps://mynook.info/blog/post/host-your-own-git-server-using-gogs","tags":[{"name":"gogs","slug":"gogs","permalink":"https://github.com/kong36088/kong36088.github.io/tags/gogs/"},{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"}]},{"title":"åœ¨JSä¸­å¯¹å¼‚æ­¥æ•°æ®è¯·æ±‚è¿›è¡Œå°è£…","date":"2016-05-23T06:24:25.000Z","path":"2016/05/23/åœ¨JSä¸­å¯¹å¼‚æ­¥æ•°æ®è¯·æ±‚è¿›è¡Œå°è£…/","text":"å‰æˆä»‹ç»jQuery.ajaxè¿”å›çš„æ˜¯jqXHRå¯¹è±¡ï¼Œå®ƒæ˜¯æµè§ˆå™¨åŸç”ŸXMLHttpRequestå¯¹è±¡çš„ä¸€ä¸ªè¶…é›†ï¼Œå¹¶å®ç°äº†Promiseæ¥å£ã€‚ä½¿å®ƒæ‹¥æœ‰äº†Promiseçš„æ‰€æœ‰å±æ€§ï¼Œæ–¹æ³•å’Œè¡Œä¸ºã€‚ä¸ºäº†è®©å›è°ƒå‡½æ•°åå­—ç»Ÿä¸€ï¼Œä¾¿äº$.ajaxä¸­ä½¿ç”¨ï¼ŒjqXHRä¹Ÿæä¾›äº†.error()ï¼Œ.success()ï¼Œ.complete()ä½†æ˜¯ç”±äºç‰ˆæœ¬çš„å‡çº§ç›¸åº”çš„.fail()ï¼Œ.done()ï¼Œ.always()ä»£æ›¿äº†å‰ä¸‰ä¸ªæ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼å’Œè§£é‡Šå¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ jqXHR.fail(function(jqXHR, textStatus, errorThrown) {});ä¸€ç§å¯ä¾›é€‰æ‹©çš„è¯·æ±‚å¤±è´¥æ—¶è°ƒç”¨çš„å›è°ƒé€‰é¡¹æ„é€ å‡½æ•°ï¼Œ.fail()æ–¹æ³•å–ä»£äº†çš„è¿‡æ—¶çš„.error()æ–¹æ³•ã€‚jqXHR.done(function(data, textStatus, jqXHR) {});ä¸€ç§å¯ä¾›é€‰æ‹©çš„è¯·æ±‚æˆåŠŸæ—¶è°ƒç”¨çš„å›è°ƒé€‰é¡¹æ„é€ å‡½æ•°ï¼Œ.done()æ–¹æ³•å–ä»£äº†è¿‡æ—¶çš„.success()æ–¹æ³•ã€‚jqXHR.always(function(data|jqXHR, textStatus, jqXHR|errorThrown) {});ä¸€ç§å¯ä¾›é€‰æ‹©çš„è¯·æ±‚ç»“æŸæ—¶è°ƒç”¨çš„å›è°ƒé€‰é¡¹æ„é€ å‡½æ•°ï¼Œ.always()æ–¹æ³•ä»£æ›¿äº†è¿‡æ—¶çš„.complete()æ–¹æ³•,å½“è¯·æ±‚æˆåŠŸæ—¶ï¼Œè¯¥å‡½æ•°çš„å‚æ•°ä¸.done()çš„å‚æ•°ä¸€è‡´ï¼›å½“è¯·æ±‚å¤±è´¥æ—¶ï¼Œè¯¥å‡½æ•°çš„å‚æ•°ä¸.fail()çš„å‚æ•°ä¸€è‡´ã€‚ è¿‡ç¨‹ä»‹ç»å°è£…æˆä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºé€»è¾‘å±‚å’Œè§†å›¾å±‚ é€»è¾‘å±‚ 12345678910111213141516171819202122232425262728293031323334353637$(function () &#123; http = &#123; httpGet: function (url, data) &#123; return $.ajax(&#123; type: \"GET\", headers: &#123;'X-CSRF-TOKEN': csrf_token&#125;, url: url, async: true &#125;); &#125;, httpPost: function (url, data) &#123; return $.ajax(&#123; type: \"POST\", headers: &#123;'X-CSRF-TOKEN': csrf_token&#125;, url: url, data: data, async: true &#125;); &#125;, httpPut: function (url, data) &#123; return $.ajax(&#123; type: \"PUT\", headers: &#123;'X-CSRF-TOKEN': csrf_token&#125;, url: url, data: data, async: true &#125;); &#125;, httpDelete: function (url, data) &#123; return $.ajax(&#123; type: \"DELETE\", headers: &#123;'X-CSRF-TOKEN': csrf_token&#125;, url: url, data: data, async: true &#125;); &#125; &#125;;&#125;); è§†å›¾å±‚ 1234567891011121314151617181920212223242526272829303132333435$(function () &#123; callAjax = function (type, request_url, data, redirect) &#123; var xhr; $(\".loading\").css('display', 'block'); type = type.toLowerCase(); switch (type) &#123; case 'get': xhr = http.httpGet(request_url, data); break; case 'post': xhr = http.httpPost(request_url, data); break; case 'put': xhr = http.httpPut(request_url, data); break; case 'delete': xhr = http.httpDelete(request_url, data); break; &#125; xhr.fail(function (jqXHR, textStatus, errorThrown) &#123; alert(\"åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•\"); &#125;).done(function (data, textStatus, jqXHR) &#123; if (data.status == 1) &#123; alert(data.message); if (redirect) &#123; window.location.href = redirect; &#125; &#125; else &#123; alert(data.message); &#125; &#125;).always(function (data, textStatus, errorThrown) &#123; $(\".loading\").css('display', 'none'); &#125;); &#125;&#125;); å°è£…ä»£ç å¾ˆå¥½åœ°æé«˜äº†ä»£ç çš„è§„èŒƒå’Œä»£ç çš„å¤ç”¨æ€§","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"}]},{"title":"dockerä½¿ç”¨å®‰è£…æ•™ç¨‹ï¼ˆäºŒï¼‰","date":"2016-05-10T11:24:25.000Z","path":"2016/05/10/dockerä½¿ç”¨å®‰è£…æ•™ç¨‹ï¼ˆäºŒï¼‰/","text":"æ ¹æ®ä¸Šä¸€èŠ‚é…ç½®çš„å®¹å™¨ï¼Œç»§ç»­è¿›è¡Œæ“ä½œ apt-get update apt-get install -y nginx å®‰è£…å¥½ä¹‹åï¼Œé€€å‡ºå®¹å™¨ root@ubuntu:/# exit exit root@ubuntu:/home/jwl# ä¿å­˜ä¿®æ”¹ root@ubuntu:/home/jwl# docker commit -m \"add nginx\" 596e william/ubuntu-nginx:v1 dab208031d1dc8f6a10f91363959a943f86f6233d790bbba10f44fe278b4c195 root@ubuntu:/home/jwl# docker images REPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE william/ubuntu-nginx v1 dab208031d1d 8 seconds ago 299.9 MB ubuntu 14.04 d4751aa1c40a 6 days ago 188 MB æ­¤æ—¶å·²ç»åŠ å…¥åˆ°é•œåƒäº†","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Docker","slug":"Docker","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Docker/"}]},{"title":"dockerä½¿ç”¨å®‰è£…æ•™ç¨‹ï¼ˆä¸€ï¼‰","date":"2016-05-10T06:24:25.000Z","path":"2016/05/10/dockerä½¿ç”¨å®‰è£…æ•™ç¨‹ï¼ˆä¸€ï¼‰/","text":"æœ¬äººä½¿ç”¨çš„å®‰è£…ç¯å¢ƒæ˜¯ubuntu15.04é‚£ä¹ˆï¼Œå¼€å§‹~ å®‰è£…dockeré¦–å…ˆï¼Œå®‰è£…docker apt-get update apt-get install docker.io å®‰è£…å®Œæˆåï¼Œè¾“å…¥dockeræŸ¥çœ‹dockerä¿¡æ¯ Usage: docker [OPTIONS] COMMAND [arg...] A self-sufficient runtime for linux containers. Options: --api-cors-header= Set CORS headers in the remote API -b, --bridge= Attach containers to a network bridge --bip= Specify network bridge IP -D, --debug=false Enable debug mode -d, --daemon=false Enable daemon mode --default-ulimit=[] Set default ulimits for containers --dns=[] DNS server to use --dns-search=[] DNS search domains to use -e, --exec-driver=native Exec driver to use --fixed-cidr= IPv4 subnet for fixed IPs --fixed-cidr-v6= IPv6 subnet for fixed IPs -G, --group=docker Group for the unix socket -g, --graph=/var/lib/docker Root of the Docker runtime -H, --host=[] Daemon socket(s) to connect to -h, --help=false Print usage --icc=true Enable inter-container communication --insecure-registry=[] Enable insecure registry communication --ip=0.0.0.0 Default IP when binding container ports --ip-forward=true Enable net.ipv4.ip_forward --ip-masq=true Enable IP masquerading --iptables=true Enable addition of iptables rules --ipv6=false Enable IPv6 networking -l, --log-level=info Set the logging level --label=[] Set key=value labels to the daemon --log-driver=json-file Containers logging driver --mtu=0 Set the containers network MTU -p, --pidfile=/var/run/docker.pid Path to use for daemon PID file --registry-mirror=[] Preferred Docker registry mirror -s, --storage-driver= Storage driver to use --selinux-enabled=false Enable selinux support --storage-opt=[] Set storage driver options --tls=false Use TLS; implied by --tlsverify --tlscacert=~/.docker/ca.pem Trust certs signed only by this CA --tlscert=~/.docker/cert.pem Path to TLS certificate file --tlskey=~/.docker/key.pem Path to TLS key file --tlsverify=false Use TLS and verify the remote -v, --version=false Print version information and quit Commands: attach Attach to a running container build Build an image from a Dockerfile commit Create a new image from a container's changes cp Copy files/folders from a container's filesystem to the host path create Create a new container diff Inspect changes on a container's filesystem events Get real time events from the server exec Run a command in a running container export Stream the contents of a container as a tar archive history Show the history of an image images List images import Create a new filesystem image from the contents of a tarball info Display system-wide information inspect Return low-level information on a container or image kill Kill a running container load Load an image from a tar archive login Register or log in to a Docker registry server logout Log out from a Docker registry server logs Fetch the logs of a container port Lookup the public-facing port that is NAT-ed to PRIVATE_PORT pause Pause all processes within a container ps List containers pull Pull an image or a repository from a Docker registry server push Push an image or a repository to a Docker registry server rename Rename an existing container restart Restart a running container rm Remove one or more containers rmi Remove one or more images run Run a command in a new container save Save an image to a tar archive search Search for an image on the Docker Hub start Start a stopped container stats Display a stream of a containers' resource usage statistics stop Stop a running container tag Tag an image into a repository top Lookup the running processes of a container unpause Unpause a paused container version Show the Docker version information wait Block until a container stops, then print its exit code Run 'docker COMMAND --help' for more information on a command. å¼€å§‹æ–°å»ºä¸€ä¸ªdockerå®¹å™¨åœ¨dockeré•œåƒå¸‚åœºä¸Šæ‰¾åˆ°éœ€è¦ä¸‹è½½çš„é•œåƒï¼Œè¿›è¡Œä¸‹è½½ docker pull ubuntu:14.04 ä¸‹è½½é•œåƒçš„è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œé•œåƒå¤§å°æœ‰å·®ä¸å¤š200MB ä¸‹è½½å®Œæˆä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹æœ¬åœ°æ‹¥æœ‰çš„é•œåƒ root@ubuntu:/# docker images REPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE ubuntu 14.04 d4751aa1c40a 5 days ago 188 MB ä¹‹åå°±å¯ä»¥å¼€å§‹åˆ›å»ºå®¹å™¨äº† root@ubuntu:/# docker run --net=host -it ubuntu:14.04 root@c944a54f35dc:/# åˆ›å»ºæˆåŠŸ ä½†æ˜¯å‘ç°ping 8.8.8.8å¤±è´¥ root@c944a54f35dc:/# ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. From 172.17.0.1 icmp_seq=1 Destination Host Unreachable From 172.17.0.1 icmp_seq=2 Destination Host Unreachable æ ¹æ®stackoveræ‰¾åˆ°çš„ç­”æ¡ˆI was facing the same problem. So, to solve that issue Iâ€™ve started the container using the argument â€“net=host, it worked perfectly for me. Here goes the full statement sudo docker start --net=host -it --name ex_ngninx ubuntu This made it temporarily work but I still couldnâ€™t docker build. A sudo systemctl restart docker fixed it tho â€“ Freedom_Ben Jan 24 at 22:41 æ‰€ä»¥é‡åˆ°ä¸èƒ½ä¸Šç½‘çš„æƒ…å†µå¯ä»¥é€šè¿‡sudo systemctl restart dockerè§£å†³ root@5acfffe415ce:/# exit exit root@ubuntu:/home/jwl# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 5acfffe415ce ubuntu:14.04 \"/bin/bash\" 15 seconds ago Exited (0) 5 seconds ago dreamy_feynman root@ubuntu:/home/jwl# sudo systemctl restart docker root@ubuntu:/home/jwl# docker start 5acff 5acff root@ubuntu:/home/jwl# docker exec -it 5acff bash root@5acfffe415ce:/# ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=127 time=28.2 ms 64 bytes from 8.8.8.8: icmp_seq=2 ttl=127 time=27.0 ms æˆåŠŸ","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Docker","slug":"Docker","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Docker/"}]},{"title":"åˆ†äº«ä¸€ä¸ªJSä¸­å»é™¤æŒ‡å®šå­—ç¬¦çš„trimæ–¹æ³•","date":"2016-05-08T06:24:25.000Z","path":"2016/05/08/åˆ†äº«ä¸€ä¸ªJSä¸­å»é™¤æŒ‡å®šå­—ç¬¦çš„trimæ–¹æ³•/","text":"è¯´æ˜ç¬¬ä¸€ä¸ªå‚æ•°charæŒ‡å®šè¦å»é™¤çš„å­—ç¬¦ç¬¬äºŒä¸ªå‚æ•°typeæŒ‡å®šå·¦è¾¹æˆ–å³è¾¹ ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142String.prototype.trim = function (char, type) &#123; if (char) &#123; if (type == 'left') &#123; return this.replace(new RegExp('^\\\\'+char+'+', 'g'), ''); &#125; else if (type == 'right') &#123; return this.replace(new RegExp('\\\\'+char+'+$', 'g'), ''); &#125; return this.replace(new RegExp('^\\\\'+char+'+|\\\\'+char+'+$', 'g'), ''); &#125; return this.replace(/^\\s+|\\s+$/g, '');&#125;;// å»é™¤å­—ç¬¦ä¸²é¦–å°¾çš„å…¨éƒ¨ç©ºç™½var str = ' Ruchee ';console.log('xxx' + str.trim() + 'xxx'); // xxxRucheexxx// å»é™¤å­—ç¬¦ä¸²å·¦ä¾§ç©ºç™½str = ' Ruchee ';console.log('xxx' + str.trim(' ', 'left') + 'xxx'); // xxxRuchee xxx&lt;!--more--&gt;// å»é™¤å­—ç¬¦ä¸²å³ä¾§ç©ºç™½str = ' Ruchee ';console.log('xxx' + str.trim(' ', 'right') + 'xxx'); // xxx Rucheexxx// å»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§æŒ‡å®šå­—ç¬¦str = '/Ruchee/';console.log(str.trim('/')); // Ruchee// å»é™¤å­—ç¬¦ä¸²å·¦ä¾§æŒ‡å®šå­—ç¬¦str = '/Ruchee/';console.log(str.trim('/', 'left')); // Ruchee/// å»é™¤å­—ç¬¦ä¸²å³ä¾§æŒ‡å®šå­—ç¬¦str = '/Ruchee/';console.log(str.trim('/', 'right')); // /Ruchee å‚è€ƒè‡ªï¼šhttps://segmentfault.com/a/1190000002438098","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"},{"name":"trim","slug":"trim","permalink":"https://github.com/kong36088/kong36088.github.io/tags/trim/"}]},{"title":"jquery-file-uploadä½¿ç”¨æ€»ç»“","date":"2016-04-30T17:24:25.000Z","path":"2016/05/01/jquery-file-uploadä½¿ç”¨æ€»ç»“/","text":"123456789101112131415&lt;div class=\"row fileupload-buttonbar\" style=\"padding-left:15px;\"&gt; &lt;div class=\"thumbnail\"&gt; &lt;img id=\"weixin_show\" style=\"height:300px;margin-top:10px;margin-bottom:8px;\" src=\"/uploads/head/head.jpg\" data-holder-rendered=\"true\"&gt; &lt;div class=\"progress progress-striped active\" role=\"progressbar\" aria-valuemin=\"10\" aria-valuemax=\"100\" aria-valuenow=\"0\"&gt; &lt;div id=\"weixin_progress\" class=\"progress-bar progress-bar-success\" style=\"width:0%;\"&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=\"caption\" align=\"center\"&gt; &lt;span id=\"weixin_upload\" class=\"btn btn-primary fileinput-button\"&gt; &lt;span&gt;ä¸Šä¼ &lt;/span&gt; &lt;input type=\"file\" id=\"weixin_image\" name=\"weixin_image\" multiple&gt; &lt;/span&gt; &lt;a id=\"weixin_cancel\" href=\"javascript:void(0)\" class=\"btn btn-warning\" role=\"button\" style=\"display:none\"&gt;åˆ é™¤&lt;/a&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 1234567891011121314151617181920212223242526$(\"#weixin_image\").fileupload(&#123; acceptFileTypes: /(\\.|\\/)(gif|jpe?g|png)$/i, maxFileSize: 999000, url: '/data/upload', sequentialUploads: true, previewCrop: true &#125;).on('fileuploadprogress', function (e, data) &#123; var progress = parseInt(data.loaded / data.total * 100, 10); $(\"#weixin_progress\").css('width', progress + '%'); $(\"#weixin_progress\").html(progress + '%'); &#125;).on('fileuploaddone', function (e, data) &#123; d = data.result; console.log(e); console.log(data); if (d.status == 1) &#123; $(\"#weixin_show\").attr(\"src\", d.url); $(\"#weixin_upload\").css(&#123;display: \"none\"&#125;); $(\"#weixin_cancel\").css(&#123;display: \"\"&#125;); &#125; else &#123; alert(d.msg); &#125;&#125;).on('fileuploadfail', function (e, data) &#123; console.log(e); console.log(data); alert(data.msg);&#125;); serverç«¯ä»£ç ï¼Œjava spring12345678910111213141516@RequestMapping(value = \"/upload\", method = RequestMethod.POST, produces = &#123;\"application/json;charset=UTF-8\"&#125;)@ResponseBodypublic String upload(@RequestParam(\"weixin_image\") MultipartFile multipartFile) throws IOException &#123; JSONObject res = new JSONObject(); if (!multipartFile.isEmpty()) &#123; String preName = \"/uploads/head/\"; String subName = System.currentTimeMillis() + multipartFile.getOriginalFilename(); FileUtils.copyInputStreamToFile(multipartFile.getInputStream(), new File(\"H:\\\\apache-tomcat-9.0.0.M4\\\\webapps\\\\contact\\\\src\\\\main\\\\webapp\\\\WEB-INF\\\\uploads\\\\head\\\\\", subName)); res.put(\"url\", preName+subName); res.put(\"status\", 1); &#125; else &#123; res.put(\"msg\", \"ä¸Šä¼ å¤±è´¥\"); res.put(\"status\", 0); &#125; return res.toString();&#125; ä»¥ä¸Šdemoæ˜¯å•æ–‡ä»¶ä¸Šä¼ ï¼Œè‹¥è¦å¼€å¯å¤šæ–‡ä»¶ä¸Šä¼ å¯ä»¥æŠŠ$(&quot;#weixin_upload&quot;).css({display: &quot;none&quot;});è¿™å¥æ³¨é‡Šæ‰","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"},{"name":"file-upload","slug":"file-upload","permalink":"https://github.com/kong36088/kong36088.github.io/tags/file-upload/"}]},{"title":"Laravelä¸­æç¤ºClass XXSeeder does not existè§£å†³åŠæ³•","date":"2016-04-21T06:24:25.000Z","path":"2016/04/21/Laravelä¸­æç¤ºClass XXSeeder does not existè§£å†³åŠæ³•/","text":"åœ¨codingçš„æ—¶å€™å†™äº†ä¸€ä¸ªseedï¼Œç”¨ä½œå¡«å……æ•°æ®åº“æ•°æ®åœ¨æœ¬åœ°è°ƒè¯•çš„æ—¶å€™æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œphp artisan db:seed å®Œç¾è¿è¡Œå½“æŠŠä»£ç ä¸Šä¼ åˆ°æœåŠ¡å™¨è¿›è¡Œè°ƒè¯•çš„æ—¶å€™å´å‡ºç°äº†é—®é¢˜ï¼Œæç¤ºä»¥ä¸‹é”™è¯¯ï¼š [ReflectionException] Class EquipmentSeeder does not exist åœ¨stackoverflowä¸Šæ‰¾åˆ°äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼š You need to put SongsTableSeeder into file SongsTableSeeder.php in the same directory where you have your DatabaseSeeder.php file. And you need to run in your console: composer dump-autoload to generate new class map and then run: php artisan db:seedIâ€™ve just tested it. It is working without a problem in Laravel 5 æ ¹æ®æ„æ€å°±æ˜¯ï¼Œè¦æŠŠæ–°å»ºçš„seederæ–‡ä»¶ä¸DatabaseSeeder.phpæ”¾åœ¨åŒä¸€ç›®å½•ä¸‹å¹¶ä¸”æ‰§è¡Œå‘½ä»¤composer dump-autoload ï¼Œé—®é¢˜è§£å†³","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"Laravel","slug":"Laravel","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Laravel/"}]},{"title":"PHPä¸­å¾ªç¯foreachå°ç¬”è®°","date":"2016-04-04T06:24:25.000Z","path":"2016/04/04/PHPä¸­å¾ªç¯foreachå°ç¬”è®°/","text":"foreachä¼šä¿å­˜æ•°ç»„å½“å‰çš„çŠ¶æ€ï¼Œæ”¹å˜$arrå¯¹äº$vå¹¶æ²¡æœ‰å½±å“å³ï¼Œåœ¨ä¸‹é¢ä¾‹å­foreachå½“ä¸­ï¼Œ$arrçš„å€¼ä¼šè¢«å¤åˆ¶åˆ°å†…å­˜å½“ä¸­ï¼Œä¾›å¾ªç¯ä½¿ç”¨ï¼Œæ”¹å˜$arrçš„å€¼ä¸ä¼šå½±å“$vï¼ˆæ³¨ï¼šåœ¨$arrä¸­å·²èµ‹å€¼äºŒç»´æ•°ç»„ï¼‰ //PHPä¼šå¤åˆ¶$arrçš„å€¼åˆ°å†…å­˜ä¸­ foreach ($arr as $k1 =&gt; $v1) { $arr['id']=1; $parent_id = $v1['id']; echo $parent_id; } //è¾“å‡ºå€¼ï¼š5049484746454443424140393837369143419242913828332318121732227271162621311615351025302015432 å¦‚æœå¯¹$vä½¿ç”¨å¼•ç”¨ï¼Œå³$vå¼•ç”¨$arrä¸­çš„å¯¹åº”çš„æ¯ä¸€ä¸ªå€¼ï¼Œç»“æœå°†ä¼šä¸åŒ foreach ($arr as $key =&gt; &amp;$v1) { $arr[$key]['id'] = 1; $parent_id = $v1['id']; echo $parent_id; } //è¾“å‡ºï¼š11111111111111111111111111111111111111111111111111","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"JSè·å–URLä¸­çš„query string","date":"2016-03-30T06:24:25.000Z","path":"2016/03/30/JSè·å–URLä¸­çš„query string/","text":"function getQueryString(key){ var reg = new RegExp(\"(^|&amp;)\"+key+\"=([^&amp;]*)(&amp;|$)\"); var result = window.location.search.substr(1).match(reg); return result?decodeURIComponent(result[2]):null; } //ç”¨æ³•ï¼š //getQueryString('arg') //getQueryString('test')","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"}]},{"title":"JSåˆ·æ–°é¡µé¢çš„å‡ ç§æ–¹å¼","date":"2016-03-30T06:24:25.000Z","path":"2016/03/30/JSåˆ·æ–°é¡µé¢çš„å‡ ç§æ–¹å¼/","text":"history.go(0) location.reload() location=location location.assign(location) document.execCommand('Refresh') window.navigate(location) location.replace(location) document.URL=location.href","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"}]},{"title":"CSRFæ”»å‡»ä»¥åŠé˜²èŒƒ","date":"2016-03-29T06:24:25.000Z","path":"2016/03/29/CSRFæ”»å‡»ä»¥åŠé˜²èŒƒ/","text":"CSRFç®€ä»‹CSRFä¸€ç§ç½‘ç«™çš„æ”»å‡»æ–¹å¼ï¼Œé»‘å®¢åˆ©ç”¨ç½‘ç«™å¯¹ç”¨æˆ·çš„ä¿¡ä»»è¿›è¡Œä¼ªé€ è¯·æ±‚è¿›è€Œå‘å‡ºéç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ç®€è€Œè¨€ä¹‹ï¼Œä¼ªé€ ç”¨æˆ·çš„èº«ä»½å‘å‡ºè¡¨å•è¯·æ±‚ ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼šä¸€ä¸ªç½‘ç«™ç”¨æˆ·Bobå¯èƒ½æ­£åœ¨æµè§ˆèŠå¤©è®ºå›ï¼Œè€ŒåŒæ—¶å¦ä¸€ä¸ªç”¨æˆ·Aliceä¹Ÿåœ¨æ­¤è®ºå›ä¸­ï¼Œå¹¶ä¸”åè€…åˆšåˆšå‘å¸ƒäº†ä¸€ä¸ªå…·æœ‰Bobé“¶è¡Œé“¾æ¥çš„å›¾ç‰‡æ¶ˆæ¯ã€‚è®¾æƒ³ä¸€ä¸‹ï¼ŒAliceç¼–å†™äº†ä¸€ä¸ªåœ¨Bobçš„é“¶è¡Œç«™ç‚¹ä¸Šè¿›è¡Œå–æ¬¾çš„formæäº¤çš„é“¾æ¥ï¼Œå¹¶å°†æ­¤é“¾æ¥ä½œä¸ºå›¾ç‰‡srcã€‚å¦‚æœBobçš„é“¶è¡Œåœ¨cookieä¸­ä¿å­˜ä»–çš„æˆæƒä¿¡æ¯ï¼Œå¹¶ä¸”æ­¤cookieæ²¡æœ‰è¿‡æœŸï¼Œé‚£ä¹ˆå½“Bobçš„æµè§ˆå™¨å°è¯•è£…è½½å›¾ç‰‡æ—¶å°†æäº¤è¿™ä¸ªå–æ¬¾formå’Œä»–çš„cookieï¼Œè¿™æ ·åœ¨æ²¡ç»BobåŒæ„çš„æƒ…å†µä¸‹ä¾¿æˆæƒäº†è¿™æ¬¡äº‹åŠ¡ã€‚ å¯è§è¿™å¯¹äºç”¨æˆ·æˆ–ç³»ç»Ÿéƒ½æ˜¯ä¸¥é‡çš„ç ´åï¼Œé€ æˆç”¨æˆ·åˆ©ç›ŠæŸå¤±ï¼Œè´¦æˆ·è¢«ç›—ç­‰ã€‚ å‡ ç§CSRFçš„é˜²èŒƒæ–¹æ³•ä¸€ã€ åœ¨è¡¨å•ä¸­åŠ å…¥ä¸€ä¸ªcookieçš„Hashå€¼$value=\"someValueHere\"; setcookie(\"cookie\",$value,time()+3600); &lt;input type=\"hidden\" name=\"hash\" value=\"&lt;?php echo md5($_COOKIE('cookie'));\" /&gt; æœåŠ¡ç«¯çš„éªŒè¯ $hash=md5($_COOKIE('cookie')); if($hash==$_POST['hash']){ //éªŒè¯é€šè¿‡ }else{ //éªŒè¯ä¸é€šè¿‡ } äºŒã€ éªŒè¯ç åœ¨è¡¨å•åŸŸä¸­åŠ å…¥éªŒè¯ç å¯ä»¥æœç»csrfæ”»å‡»çš„å¯èƒ½ä½†æ˜¯è¿™ä¸ªå¯¹äºç”¨æˆ·ä½“éªŒå¹¶ä¸æ˜¯é‚£ä¹ˆå¥½ ä¸‰ã€ åŠ å…¥ä¸€ä¸ªcsrf token&lt;input type=\"hidden\" name=\"csrf_token\" value=\"&lt;?php echo $_SESSION['STOKEN_NAME'];?&gt;\"&gt; $pToken = \"\"; if($_SESSION[STOKEN_NAME] == $pToken){ //æ²¡æœ‰å€¼ï¼Œèµ‹æ–°å€¼ $_SESSION[STOKEN_NAME] = gen_token(); } else{ //ç»§ç»­ä½¿ç”¨æ—§çš„å€¼ } function gen_token() { //è¿™é‡Œæˆ‘æ˜¯è´ªæ–¹ä¾¿ï¼Œå®é™…ä¸Šå•ä½¿ç”¨Rand()å¾—å‡ºçš„éšæœºæ•°ä½œä¸ºä»¤ç‰Œï¼Œä¹Ÿæ˜¯ä¸å®‰å…¨çš„ã€‚ //è¿™ä¸ªå¯ä»¥å‚è€ƒæˆ‘å†™çš„Findbugsç¬”è®°ä¸­çš„ã€ŠRandom object created and used only onceã€‹ $token = md5(uniqid(rand(), true)); return $token; } æœ€åå¯¹tokenè¿›è¡ŒéªŒè¯ $token=$_POST['csrf_token']; if($token==$_SESSION('STOKEN_NAME')){ //éªŒè¯é€šè¿‡ }else{ //éªŒè¯ä¸é€šè¿‡ } å‚è€ƒ http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.htmlhttp://baike.baidu.com/link?url=IhevG_bwOLXJBLKcOTo-tn19lfk6P70IwOdAJW9FDLMTzSoJumMZr58OwJr20YhpNYcGm9dX-UH3FHzyI0cQr_","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"centos6ã€centos7é€šè¿‡yumæ–¹å¼å®‰è£…php7","date":"2016-03-21T06:24:25.000Z","path":"2016/03/21/centos6ã€centos7é€šè¿‡yumæ–¹å¼å®‰è£…php7/","text":"å®‰è£…PHP7å¦‚æœæƒ³è¦é€šè¿‡yumå®‰è£…php7çš„è¯ï¼Œæ ¹æ®ä½ çš„centosçš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…æºçš„ç±»å‹ï¼Œä»ä¸‹é¢çš„åœ°å€è¿›è¡Œé€‰æ‹©https://mirror.webtatic.com/å¦‚æœå’Œæˆ‘ä¸€æ ·ï¼Œæ˜¯centos6é€‰æ‹©https://mirror.webtatic.com/yum/el6/latest.rpmå¦‚æœæ˜¯centos7çš„ç‰ˆæœ¬çš„è¯ï¼Œé€‰æ‹©https://mirror.webtatic.com/yum/el7/webtatic-release.rpmè‡³äºå®‰è£…æ–¹å¼ï¼Œä¹Ÿéå¸¸ç®€å•ï¼Œcentos6ä¸‹é¢å®‰è£…å¦‚ä¸‹ rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpmcentos7ä¸‹é¢çš„å®‰è£…æ–¹å¼ rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpmç„¶åå°±å¯ä»¥å®‰è£…php7äº†ï¼Œå®‰è£…æ–¹å¼å¦‚ä¸‹ [root@VM_13_18_centos /]# php -v PHP 7.0.4 (cli) (built: Mar 5 2016 00:55:49) ( NTS ) Copyright (c) 1997-2016 The PHP Group Zend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies with Xdebug v2.4.0RC3, Copyright (c) 2002-2015, by Derick Rethans [root@VM_13_18_centos /]# yum search php70 Loaded plugins: fastestmirror, langpacks Repository epel is listed more than once in the configuration Loading mirror speeds from cached hostfile * webtatic: uk.repo.webtatic.com =============================================================================================== N/S matched: php70 =============================================================================================== php70w.x86_64 : PHP scripting language for creating dynamic web sites php70w-bcmath.x86_64 : A module for PHP applications for using the bcmath library php70w-cli.x86_64 : Command-line interface for PHP php70w-common.x86_64 : Common files for PHP php70w-dba.x86_64 : A database abstraction layer module for PHP applications php70w-devel.x86_64 : Files needed for building PHP extensions php70w-embedded.x86_64 : PHP library for embedding in applications php70w-enchant.x86_64 : Enchant spelling extension for PHP applications php70w-fpm.x86_64 : PHP FastCGI Process Manager php70w-gd.x86_64 : A module for PHP applications for using the gd graphics library php70w-imap.x86_64 : A module for PHP applications that use IMAP php70w-interbase.x86_64 : A module for PHP applications that use Interbase/Firebird databases php70w-intl.x86_64 : Internationalization extension for PHP applications php70w-ldap.x86_64 : A module for PHP applications that use LDAP php70w-mbstring.x86_64 : A module for PHP applications which need multi-byte string handling php70w-mcrypt.x86_64 : Standard PHP module provides mcrypt library support php70w-mysql.x86_64 : A module for PHP applications that use MySQL databases php70w-mysqlnd.x86_64 : A module for PHP applications that use MySQL databases php70w-odbc.x86_64 : A module for PHP applications that use ODBC databases php70w-opcache.x86_64 : An opcode cache Zend extension php70w-pdo.x86_64 : A database access abstraction module for PHP applications php70w-pdo_dblib.x86_64 : MSSQL database module for PHP php70w-pear.noarch : PHP Extension and Application Repository framework php70w-pecl-apcu.x86_64 : APCu - APC User Cache php70w-pecl-apcu-devel.x86_64 : APCu developer files (header) php70w-pecl-imagick.x86_64 : Provides a wrapper to the ImageMagick library php70w-pecl-imagick-devel.x86_64 : Imagick developer files (header) php70w-pecl-xdebug.x86_64 : PECL package for debugging PHP scripts php70w-pgsql.x86_64 : A PostgreSQL database module for PHP php70w-phpdbg.x86_64 : Interactive PHP debugger php70w-process.x86_64 : Modules for PHP script using system process interfaces php70w-pspell.x86_64 : A module for PHP applications for using pspell interfaces php70w-recode.x86_64 : A module for PHP applications for using the recode library php70w-snmp.x86_64 : A module for PHP applications that query SNMP-managed devices php70w-soap.x86_64 : A module for PHP applications that use the SOAP protocol php70w-tidy.x86_64 : Standard PHP module provides tidy library support php70w-xml.x86_64 : A module for PHP applications which use XML php70w-xmlrpc.x86_64 : A module for PHP applications which use the XML-RPC protocol æ ¹æ®è‡ªå·±éœ€è¦è¿›è¡Œå®‰è£…ï¼Œè¦è¯´æ˜çš„æ˜¯ï¼Œphp70w-mysql.x86_64 å’Œphp70w-mysqlnd.x86_64 åªèƒ½å¤Ÿå®‰è£…å…¶ä¸­ä¸€ä¸ª,æœ¬åœ°ç”µè„‘å¸¦å®‰è£…æ–¹å¼ yum install php70w php70w-bcmath php70w-cli php70w-common php70w-dba php70w-devel php70w-embedded php70w-enchant php70w-gd php70w-imap php70w-interbase php70w-intl php70w-ldap php70w-mbstring php70w-mcrypt php70w-mysqlnd php70w-odbc php70w-opcache php70w-pdo php70w-pdo_dblib php70w-pear php70w-pecl-apcu php70w-pecl-apcu-devel php70w-pecl-imagick php70w-pecl-imagick-devel php70w-pecl-xdebug php70w-pgsql php70w-phpdbg php70w-process php70w-pspell php70w-recode php70w-snmp php70w-soap php70w-tidy php70w-xml php70w-xmlrpc é™„ï¼šcentosä¸‹ç¼–è¯‘å®‰è£…PHPæ‰€éœ€ç¯å¢ƒ#cå’Œc++ç¼–è¯‘å™¨ yum install -y gcc gcc-c++ #PHPæ‰©å±•ä¾èµ– yum install -y libxml2-devel openssl-devel libcurl-devel libjpeg-devel libpng-devel libicu-devel openldap-devel","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"PHP7","slug":"PHP7","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP7/"}]},{"title":"Nginxåå‘ä»£ç†é…ç½®ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰","date":"2016-03-10T06:24:25.000Z","path":"2016/03/10/Nginxåå‘ä»£ç†é…ç½®ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰/","text":"è´Ÿè½½å‡è¡¡åˆ†é… æ ¹æ®ipè½®è¯¢ï¼š upstream backend { server 192.168.102.143; server 192.168.102.144; } æ ¹æ®ipçš„hashå€¼åˆ†é…ï¼ˆè½®è¯¢ï¼‰ï¼š upstream backend { ip_hash; server 192.168.102.143; server 192.168.102.144; } æ ¹æ®æƒå€¼åˆ†é…ï¼š upstream hello{ server 192.168.102.143 weight=1; server 192.168.102.144 weight=1; } æœ€å°‘è¿æ¥æ•°ï¼š upstream hello{ least_conn; server 192.168.102.143; server 192.168.102.144; } å®Œæ•´æ–‡ä»¶çš„é…ç½® #è´Ÿè´£å‹ç¼©æ•°æ®æµ worker_processes 1; events { worker_connections 1024; } gzip on; gzip_min_length 1000; gzip_types text/plain text/css application/x-javascript; #è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨ upstream backend { server 192.168.102.143; server 192.168.102.144; } server { #ä¾¦å¬çš„80ç«¯å£ listen 80; server_name localhost; #è®¾å®šæŸ¥çœ‹NginxçŠ¶æ€çš„åœ°å€ location /nginxstatus{ stub_status on; access_log on; auth_basic \"nginxstatus\"; auth_basic_user_file htpasswd; } #åŒ¹é…ä»¥jspç»“å°¾çš„ï¼Œtomcatçš„ç½‘é¡µæ–‡ä»¶æ˜¯ä»¥jspç»“å°¾ location / { index index.jsp; proxy_pass http://backend; #åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªä»£ç†ï¼Œå’Œupstreamçš„åå­—ä¸€æ · #ä»¥ä¸‹æ˜¯ä¸€äº›åå‘ä»£ç†çš„é…ç½®å¯åˆ é™¤ proxy_redirect off; #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; client_max_body_size 10m; #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•° client_body_buffer_size 128k; #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•° proxy_connect_timeout 300; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶) proxy_send_timeout 300; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶) proxy_read_timeout 300; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½® proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼  } } é…ç½®å®Œæˆåï¼Œé‡å¯nginxï¼š service nginx restart å‚è€ƒæ–‡ç« ï¼šhttp://www.cnblogs.com/sixiweb/p/3988805.htmlhttp://www.jb51.net/article/60523.htm","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Nginx","slug":"Nginx","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Nginx/"}]},{"title":"PHPä¸­çš„è‡ªåŠ¨åŠ è½½å‡½æ•°","date":"2016-03-04T06:24:25.000Z","path":"2016/03/04/PHPä¸­çš„è‡ªåŠ¨åŠ è½½å‡½æ•°/","text":"å¯¹äºå¤§å¤šæ•°æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šä½¿ç”¨spl_autoload_registerå‡½æ•°ï¼Œè€Œä¸ä½¿ç”¨__autoloadå‡½æ•° åœ¨å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šæ˜¯è¿™æ ·çš„ï¼š If there must be multiple autoload functions, spl_autoload_register() allows for this. It effectively creates a queue of autoload functions, and runs through each of them in the order they are defined. By contrast, __autoload() may only be defined once. spl_autoload_register å¯ä»¥å¾ˆå¥½åœ°å¤„ç†éœ€è¦å¤šä¸ªåŠ è½½å™¨çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹ spl_autoload_register ä¼šæŒ‰é¡ºåºä¾æ¬¡è°ƒç”¨ä¹‹å‰æ³¨å†Œè¿‡çš„åŠ è½½å™¨ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œ __autoload å› ä¸ºæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥åªèƒ½è¢«å®šä¹‰ä¸€æ¬¡ã€‚ __autoloadåªèƒ½è¢«å®šä¹‰ä¸€æ¬¡ï¼Œè‡ªç„¶spl_autoload_registeræ›´å¥½ç”¨ ä»¥ä¸‹æ˜¯ä»£ç ï¼š Main.php &lt;?php class Loader { public static function load($class) { $file = $class . '.class.php'; if (is_file ( $file )) { include ($file); } } } spl_autoload_register(array('Loader','load')); /* æ›¿ä»£æ–¹æ³• function __autoload($class){ $file = $class . '.class.php'; if (is_file ( $file )) { include ($file); } } */ $main=new Class1(); $main-&gt;index(); $main=new Class2(); $main-&gt;index(); Class1.class.php &lt;?php class Class1{ public function index(){ echo \"Class Class1 function index here\\n\"; } } Class2.class.php &lt;?php class Class2{ public function index(){ echo \"Class Class2 function index here\\n\"; } } è¿è¡ŒMain.phpè¾“å‡ºï¼š Class Class1 function index here class Class2 function index here","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"ä½¿ç”¨Nginxã€Nginx PlusæŠµå¾¡DDOSæ”»å‡»","date":"2016-03-02T06:24:25.000Z","path":"2016/03/02/ä½¿ç”¨Nginxã€Nginx PlusæŠµå¾¡DDOSæ”»å‡»/","text":"DDOSæ˜¯ä¸€ç§é€šè¿‡å¤§æµé‡çš„è¯·æ±‚å¯¹ç›®æ ‡è¿›è¡Œè½°ç‚¸å¼è®¿é—®ï¼Œå¯¼è‡´æä¾›æœåŠ¡çš„æœåŠ¡å™¨èµ„æºè€—å°½è¿›è€Œæ— æ³•ç»§ç»­æä¾›æœåŠ¡çš„æ”»å‡»æ‰‹æ®µã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…é€šè¿‡å¤§é‡è¯·æ±‚ä¸è¿æ¥ä½¿æœåŠ¡å™¨å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œä»¥è‡³äºæ— æ³•æ¥å—æ–°çš„è¯·æ±‚æˆ–å˜å¾—å¾ˆæ…¢ã€‚ åº”ç”¨å±‚DDOSæ”»å‡»çš„ç‰¹å¾åº”ç”¨å±‚ï¼ˆä¸ƒå±‚/HTTPå±‚ï¼‰DDOSæ”»å‡»é€šå¸¸ç”±æœ¨é©¬ç¨‹åºå‘èµ·ï¼Œå…¶å¯ä»¥é€šè¿‡è®¾è®¡æ›´å¥½çš„åˆ©ç”¨ç›®æ ‡ç³»ç»Ÿçš„è„†å¼±ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ— æ³•å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚çš„ç³»ç»Ÿï¼Œä»…ä»…é€šè¿‡å»ºç«‹å¤§é‡çš„è¿æ¥ï¼Œå¹¶å‘¨æœŸæ€§çš„å‘å‡ºå°‘é‡æ•°æ®åŒ…æ¥ä¿æŒä¼šè¯å°±å¯ä»¥è€—å°½ç³»ç»Ÿçš„èµ„æºï¼Œä½¿å…¶æ— æ³•æ¥å—æ–°çš„è¿æ¥è¯·æ±‚è¾¾åˆ°DDOSçš„ç›®çš„ã€‚å…¶ä»–è¿˜æœ‰é‡‡ç”¨å‘é€å¤§é‡è¿æ¥è¯·æ±‚å‘é€å¤§æ•°æ®åŒ…çš„è¯·æ±‚è¿›è¡Œæ”»å‡»çš„å½¢å¼ã€‚å› ä¸ºæ”»å‡»æ˜¯ç”±æœ¨é©¬ç¨‹åºå‘èµ·ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨å¾ˆçŸ­æ—¶é—´å†…å¿«é€Ÿå»ºç«‹å¤§é‡çš„è¿æ¥ï¼Œå¹¶å‘å‡ºå¤§é‡çš„è¯·æ±‚ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›DDOSçš„ç‰¹è¯ï¼Œæˆ‘ä»¬å¯ä»¥æ®æ­¤ç‰¹å¾æ¥æŠµæŠ—DDOSï¼ˆåŒ…æ‹¬ä½†ä¸é™äºï¼‰ï¼šæ”»å‡»ç»å¸¸æ¥æºäºä¸€äº›ç›¸å¯¹å›ºå®šçš„IPæˆ–IPæ®µï¼Œæ¯ä¸ªIPéƒ½æœ‰è¿œå¤§äºçœŸå®ç”¨æˆ·çš„è¿æ¥æ•°å’Œè¯·æ±‚æ•°ã€‚å¤‡æ³¨ï¼šè¿™å¹¶ä¸è¡¨æ˜è¿™ç§è¯·æ±‚éƒ½æ˜¯ä»£è¡¨ç€DDOSæ”»å‡»ã€‚åœ¨å¾ˆå¤šä½¿ç”¨NATçš„ç½‘ç»œæ¶æ„ä¸­ï¼Œå¾ˆå¤šçš„å®¢æˆ·ç«¯ä½¿ç”¨ç½‘å…³çš„IPåœ°å€è®¿é—®å…¬ç½‘èµ„æºã€‚ä½†æ˜¯ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œè¿™æ ·çš„è¯·æ±‚æ•°å’Œè¿æ¥æ•°ä¹Ÿä¼šè¿œå°‘äºDDOSæ”»å‡»ã€‚å› ä¸ºæ”»å‡»æ˜¯ç”±æœ¨é©¬å‘å‡ºä¸”ç›®çš„æ˜¯ä½¿æœåŠ¡å™¨è¶…è´Ÿè·ï¼Œè¯·æ±‚çš„é¢‘ç‡ä¼šè¿œè¿œè¶…è¿‡æ­£å¸¸äººçš„è¯·æ±‚ã€‚User-Agenté€šå¸¸æ˜¯ä¸€ä¸ªéæ ‡å‡†çš„å€¼Refereræœ‰æ—¶æ˜¯ä¸€ä¸ªå®¹æ˜“è”æƒ³åˆ°æ”»å‡»çš„å€¼ ä½¿ç”¨Nginxã€Nginx PlusæŠµæŠ—DDOSæ”»å‡»ç»“åˆä¸Šé¢æåˆ°çš„DDOSæ”»å‡»çš„ç‰¹å¾ï¼ŒNginxã€Nginx Plusæœ‰å¾ˆå¤šçš„ç‰¹æ€§å¯ä»¥ç”¨æ¥æœ‰æ•ˆçš„é˜²å¾¡DDOSæ”»å‡»ï¼Œå¯ä»¥ä»è°ƒæ•´å…¥å£è®¿é—®æµé‡å’Œæ§åˆ¶åå‘ä»£ç†åˆ°åç«¯æœåŠ¡å™¨çš„æµé‡ä¸¤ä¸ªæ–¹é¢æ¥è¾¾åˆ°æŠµå¾¡DDOSæ”»å‡»çš„ç›®çš„ã€‚ é™åˆ¶è¯·æ±‚é€Ÿåº¦ è®¾ç½®Nginxã€Nginx Plusçš„è¿æ¥è¯·æ±‚åœ¨ä¸€ä¸ªçœŸå®ç”¨æˆ·è¯·æ±‚çš„åˆç†èŒƒå›´å†…ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ è§‰å¾—ä¸€ä¸ªæ­£å¸¸ç”¨æˆ·æ¯ä¸¤ç§’å¯ä»¥è¯·æ±‚ä¸€æ¬¡ç™»å½•é¡µé¢ï¼Œä½ å°±å¯ä»¥è®¾ç½®Nginxæ¯ä¸¤ç§’é’Ÿæ¥æ”¶ä¸€ä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚ï¼ˆå¤§çº¦ç­‰åŒäºæ¯åˆ†é’Ÿ30ä¸ªè¯·æ±‚ï¼‰ã€‚ limit_req_zone $binary_remote_addr zone=one:10m rate=30r/m; server { ... location /login.html { limit_req zone=one; ... } } limit_req_zoneå‘½ä»¤è®¾ç½®äº†ä¸€ä¸ªå«oneçš„å…±äº«å†…å­˜åŒºæ¥å­˜å‚¨è¯·æ±‚çŠ¶æ€çš„ç‰¹å®šé”®å€¼ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æ˜¯å®¢æˆ·ç«¯IP($binary_remote_addr)ã€‚locationå—ä¸­çš„limit_reqé€šè¿‡å¼•ç”¨oneå…±äº«å†…å­˜åŒºæ¥å®ç°é™åˆ¶è®¿é—®/login.htmlçš„ç›®çš„ã€‚ é™åˆ¶è¿æ¥æ•°é‡è®¾ç½®Nginxã€Nginx Plusçš„è¿æ¥æ•°åœ¨ä¸€ä¸ªçœŸå®ç”¨æˆ·è¯·æ±‚çš„åˆç†èŒƒå›´å†…ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥è®¾ç½®æ¯ä¸ªå®¢æˆ·ç«¯IPè¿æ¥/storeä¸å¯ä»¥è¶…è¿‡10ä¸ªã€‚ limit_conn_zone $binary_remote_addr zone=addr:10m; server { ... location /store/ { limit_conn addr 10; ... } } limit_conn_zoneå‘½ä»¤è®¾ç½®äº†ä¸€ä¸ªå«addrçš„å…±äº«å†…å­˜åŒºæ¥å­˜å‚¨ç‰¹å®šé”®å€¼çš„çŠ¶æ€ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æ˜¯å®¢æˆ·ç«¯IPï¼ˆ $binary_remote_addrï¼‰ã€‚locationå—ä¸­limit_conné€šè¿‡å¼•ç”¨addrå…±äº«å†…å­˜åŒºæ¥é™åˆ¶åˆ°/store/çš„æœ€å¤§è¿æ¥æ•°ä¸º10ã€‚ å…³é—­æ…¢è¿æ¥æœ‰ä¸€äº›DDOSæ”»å‡»ï¼Œæ¯”å¦‚Slowlrisï¼Œæ˜¯é€šè¿‡å»ºç«‹å¤§é‡çš„è¿æ¥å¹¶å‘¨æœŸæ€§çš„å‘é€ä¸€äº›æ•°æ®åŒ…ä¿æŒä¼šè¯æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ï¼Œè¿™ç§å‘¨æœŸé€šå¸¸ä¼šä½äºæ­£å¸¸çš„è¯·æ±‚ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é—­æ…¢è¿æ¥æ¥æŠµå¾¡æ”»å‡»ã€‚ client_body_timeoutå‘½ä»¤ç”¨æ¥å®šä¹‰è¯»å–å®¢æˆ·ç«¯è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œclient_header_timeoutå‘½ä»¤ç”¨æ¥å®šäºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´ã€‚è¿™ä¸¤ä¸ªå‚æ•°çš„é»˜è®¤å€¼éƒ½æ˜¯60sï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å°†ä»–ä»¬è®¾ç½®ä¸º5sï¼š server { client_body_timeout 5s; client_header_timeout 5s; ... } è®¾ç½®IPé»‘åå•å¦‚æœç¡®å®šæ”»å‡»æ¥æºäºæŸäº›IPåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åŠ å…¥é»‘åå•ï¼ŒNginxå°±ä¸ä¼šå†æ¥å—ä»–ä»¬çš„è¯·æ±‚ã€‚æ¯”å¦‚ï¼Œä½ å·²ç»ç¡®å®šæ”»å‡»æ¥è‡ªäºä»123.123.123.1åˆ°123.123.123.16çš„ä¸€æ®µIPåœ°å€ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ï¼š location / { deny 123.123.123.0/28; ... } æˆ–è€…ä½ ç¡®å®šæ”»å‡»æ¥æºäº123.123.123.3ã€123.123.123.5ã€123.123.123.7å‡ ä¸ªIPï¼Œå¯ä»¥è¿™æ ·è®¾ç½®ï¼š location / {deny 123.123.123.3;deny 123.123.123.5;deny 123.123.123.7;â€¦} è®¾ç½®IPç™½åå•å¦‚æœä½ çš„ç½‘ç«™ä»…å…è®¸ç‰¹å®šçš„IPæˆ–IPæ®µè®¿é—®ï¼Œä½ å¯ä»¥ç»“åˆä½¿ç”¨allowå’Œdenyå‘½ä»¤æ¥é™åˆ¶ä»…å…è®¸ä½ æŒ‡å®šçš„IPåœ°å€è®¿é—®ä½ çš„ç½‘ç«™ã€‚å¦‚ä¸‹ï¼Œä½ å¯ä»¥è®¾ç½®ä»…å…è®¸192.168.1.0æ®µçš„å†…ç½‘ç”¨æˆ·è®¿é—®ï¼š location / { allow 192.168.1.0/24; deny all; ... } denyå‘½ä»¤ä¼šæ‹’ç»é™¤äº†allowæŒ‡å®šçš„IPæ®µä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–IPçš„è®¿é—®è¯·æ±‚ã€‚ ä½¿ç”¨ç¼“å­˜è¿›è¡Œæµé‡å‰Šå³°é€šè¿‡æ‰“å¼€Nginxçš„ç¼“å­˜åŠŸèƒ½å¹¶è®¾ç½®ç‰¹å®šçš„ç¼“å­˜å‚æ•°ï¼Œå¯ä»¥å‰Šå‡æ¥è‡ªæ”»å‡»çš„æµé‡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡è½»å¯¹åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å‹åŠ›ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„è®¾ç½®ï¼šproxy_cache_use_staleçš„updatingå‚æ•°å‘Šè¯‰Nginxä»€ä¹ˆæ—¶å€™è¯¥æ›´æ–°æ‰€ç¼“å­˜çš„å¯¹è±¡ã€‚åªéœ€è¦åˆ°åç«¯çš„ä¸€ä¸ªæ›´æ–°è¯·æ±‚ï¼Œåœ¨ç¼“å­˜æœ‰æ•ˆæœŸé—´å®¢æˆ·ç«¯å¯¹è¯¥å¯¹è±¡çš„è¯·æ±‚éƒ½æ— éœ€è®¿é—®åç«¯æœåŠ¡å™¨ã€‚å½“é€šè¿‡å¯¹ä¸€ä¸ªæ–‡ä»¶çš„é¢‘ç¹è¯·æ±‚æ¥å®æ–½æ”»å‡»æ—¶ï¼Œç¼“å­˜åŠŸèƒ½å¯æå¤§çš„é™ä½åˆ°åç«¯æœåŠ¡å™¨çš„è¯·æ±‚ã€‚proxy_cache_keyå‘½ä»¤å®šä¹‰çš„é”®å€¼é€šå¸¸åŒ…å«ä¸€äº›å†…åµŒçš„å˜é‡ï¼ˆé»˜è®¤çš„é”®å€¼$scheme$proxy_host$request_uriåŒ…å«äº†ä¸‰ä¸ªå˜é‡ï¼‰ã€‚å¦‚æœé”®å€¼åŒ…å«$query_stringå˜é‡ï¼Œå½“æ”»å‡»çš„è¯·æ±‚å­—ç¬¦ä¸²æ˜¯éšæœºçš„æ—¶å€™å°±ä¼šç»™Nginxä»£ç†è¿‡é‡çš„ç¼“å­˜è´Ÿæ‹…ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦åŒ…å«$query_stringå˜é‡ã€‚ å±è”½ç‰¹å®šçš„è¯·æ±‚å¯ä»¥è®¾ç½®Nginxã€Nginx Pluså±è”½ä¸€äº›ç±»å‹çš„è¯·æ±‚ï¼šé’ˆå¯¹ç‰¹å®šURLçš„è¯·æ±‚é’ˆå¯¹ä¸æ˜¯å¸¸è§çš„User-Agentçš„è¯·æ±‚é’ˆå¯¹Refererå¤´ä¸­åŒ…å«å¯ä»¥è”æƒ³åˆ°æ”»å‡»çš„å€¼çš„è¯·æ±‚é’ˆå¯¹å…¶ä»–è¯·æ±‚å¤´ä¸­åŒ…å«å¯ä»¥è”æƒ³åˆ°æ”»å‡»çš„å€¼çš„è¯·æ±‚ æ¯”å¦‚ï¼Œå¦‚æœä½ åˆ¤å®šæ”»å‡»æ˜¯é’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„URLï¼š/foo.phpï¼Œæˆ‘ä»¬å°±å¯ä»¥å±è”½åˆ°è¿™ä¸ªé¡µé¢çš„è¯·æ±‚ï¼š location /foo.php { deny all; } æˆ–è€…ä½ åˆ¤å®šæ”»å‡»è¯·æ±‚çš„User-Agentä¸­åŒ…å«fooæˆ–barï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å±è”½è¿™äº›è¯·æ±‚ï¼š location / { if ($http_user_agent ~* foo|bar) { return 403; } ... } http_nameå˜é‡å¼•ç”¨ä¸€ä¸ªè¯·æ±‚å¤´ï¼Œä¸Šè¿°ä¾‹å­ä¸­æ˜¯User-Agentå¤´ã€‚å¯ä»¥é’ˆå¯¹å…¶ä»–çš„httpå¤´ä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•æ¥è¯†åˆ«æ”»å‡»ã€‚ é™åˆ¶åˆ°åç«¯æœåŠ¡å™¨çš„è¿æ¥æ•°ä¸€ä¸ªNginxã€Nginx Pluså®ä¾‹å¯ä»¥å¤„ç†æ¯”åç«¯æœåŠ¡å™¨å¤šçš„å¤šçš„å¹¶å‘è¯·æ±‚ã€‚åœ¨Nginx Plusä¸­ï¼Œä½ å¯ä»¥é™åˆ¶åˆ°æ¯ä¸€ä¸ªåç«¯æœåŠ¡å™¨çš„è¿æ¥æ•°ï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®Nginx Plusä¸website upstreamä¸­çš„æ¯ä¸ªåç«¯æœåŠ¡å™¨å»ºç«‹çš„è¿æ¥æ•°ä¸å¾—è¶…è¿‡200ä¸ªï¼š upstream website { server 192.168.100.1:80 max_conns=200; server 192.168.100.2:80 max_conns=200; queue 10 timeout=30s; } max_connså‚æ•°å¯ä»¥é’ˆå¯¹æ¯ä¸€ä¸ªåç«¯æœåŠ¡å™¨è®¾ç½®Nginx Pluså¯ä»¥ä¸ä¹‹å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ã€‚queueå‘½ä»¤è®¾ç½®äº†å½“æ¯ä¸ªåç«¯æœåŠ¡å™¨éƒ½è¾¾åˆ°æœ€å¤§è¿æ¥æ•°åçš„é˜Ÿåˆ—å¤§å°ï¼Œtimeoutå‚æ•°æŒ‡å®šäº†è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­çš„ä¿ç•™æ—¶é—´ã€‚ å¤„ç†ç‰¹å®šç±»å‹çš„æ”»å‡»æœ‰ä¸€ç§æ”»å‡»æ˜¯å‘é€åŒ…å«ç‰¹åˆ«å¤§çš„å€¼çš„è¯·æ±‚å¤´ï¼Œå¼•èµ·æœåŠ¡å™¨ç«¯ç¼“å†²åŒºæº¢å‡ºã€‚Nginxã€Nginx Plusé’ˆå¯¹è¿™ç§æ”»å‡»ç±»å‹çš„é˜²å¾¡ï¼Œå¯ä»¥å‚è€ƒUsing NGINX and NGINX Plus to Protect Against CVE-2015-1635 ä¼˜åŒ–Nginxæ€§èƒ½DDOSæ”»å‡»é€šå¸¸ä¼šå¸¦æ¥é«˜çš„è´Ÿè½½å‹åŠ›ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›è°ƒä¼˜å‚æ•°ï¼Œæé«˜Nginxã€Nginx Pluså¤„ç†æ€§èƒ½ï¼Œç¡¬æŠ—DDOSæ”»å‡»ï¼Œè¯¦ç»†å‚è€ƒï¼šTuning NGINX for Performance è¯†åˆ«DDOSæ”»å‡»åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½æ˜¯é›†ä¸­åœ¨å¦‚ä½•æ˜¯ç”¨Nginxã€Nginx Plusæ¥å‡è½»DDOSæ”»å‡»å¸¦æ¥çš„å½±å“ã€‚å¦‚ä½•æ‰èƒ½è®©Nginxã€Nginx Pluså¸®åŠ©æˆ‘ä»¬è¯†åˆ«DDOSæ”»å‡»å‘¢ï¼ŸNginx Plus Status moduleæä¾›äº†åˆ°åç«¯æœåŠ¡å™¨æµé‡çš„è¯¦ç»†ç»Ÿè®¡ï¼Œå¯ä»¥ç”¨æ¥è¯†åˆ«å¼‚å¸¸çš„æµé‡ã€‚Nginx Plusæä¾›ä¸€ä¸ªå½“å‰æœåŠ¡çŠ¶æ€çš„ä»ªè¡¨ç›˜é¡µé¢ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨è‡ªå®šä¹‰ç³»ç»Ÿæˆ–å…¶ä»–ç¬¬ä¸‰æ–¹ç³»ç»Ÿä¸­é€šè¿‡APIçš„æ–¹å¼è·å–è¿™äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶æ ¹æ®å†å²è¶‹åŠ¿åˆ†æè¯†åˆ«éæ­£å¸¸çš„æµé‡è¿›è€Œå‘å‡ºå‘Šè­¦ã€‚ æ€»ç»“Nginxå’ŒNginx Pluså¯ä»¥ä½œä¸ºæŠµå¾¡DDOSæ”»å‡»çš„ä¸€ä¸ªæœ‰åŠ›æ‰‹æ®µï¼Œè€Œä¸”Nginx Plusä¸­æä¾›äº†ä¸€äº›é™„åŠ çš„ç‰¹æ€§æ¥æ›´å¥½çš„æŠµå¾¡DDOSæ”»å‡»å¹¶ä¸”å½“æ”»å‡»å‘ç”Ÿæ—¶åŠæ—¶çš„è¯†åˆ«åˆ°ã€‚ åŸæ–‡åœ°å€ï¼šhttp://mp.weixin.qq.com/s?__biz=MzA3MzYwNjQ3NA==&amp;mid=208998983&amp;idx=1&amp;sn=57c74bef6c19227660236fff74557c50&amp;scene=1&amp;srcid=1016w7ZDYGI9DVkRNtr8fNis&amp;from=groupmessage&amp;isappinstalled=0#wechat_redirectè¯‘è€…ï¼šé™ˆæ´‹ (è¿ç»´å¸®)","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Nginx","slug":"Nginx","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Nginx/"}]},{"title":"PHPçš„é­”æœ¯æ–¹æ³•ï¼ˆä¸‹ï¼‰","date":"2016-02-25T15:24:25.000Z","path":"2016/02/25/PHPçš„é­”æœ¯æ–¹æ³•ï¼ˆä¸‹ï¼‰/","text":"sleepå’Œwakeup serialize() å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• __sleep()ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª E_NOTICE çº§åˆ«çš„é”™è¯¯ã€‚serialize â€” äº§ç”Ÿä¸€ä¸ªå¯å­˜å‚¨çš„å€¼çš„è¡¨ç¤ºã€‚ __toString __toString() æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚ echo $obj; åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡ E_RECOVERABLE_ERROR çº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚ __invoke å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ __set_state è‡ª PHP 5.1.0 èµ·å½“è°ƒç”¨ var_export() å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€ æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ æœ¬æ–¹æ³•çš„å”¯ä¸€å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æŒ‰ array(â€˜propertyâ€™ =&gt; value, â€¦) æ ¼å¼æ’åˆ—çš„ç±»å±æ€§ã€‚ __debugInfo å½“å°è¯•ä½¿ç”¨var_dump()æ‰“å°å‡ºå¯¹è±¡æ—¶ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰è¯¥é­”æœ¯æ–¹æ³•ï¼ŒPHPä¼šæ‰“å°å‡ºæ‰€æœ‰publicï¼Œprotectedï¼Œprivateå±æ€§ &lt;?php class Train2 { public $public_num = 1; protected $protected_num = 2; private $private_num = 3; public function __sleep() { return array ( 'public_num' ); } public function __wakeup() { echo __CLASS__ . \" wakeup\\n\"; } public function __invoke() { echo \"invoke here\\n\"; } public function __toString() { return __CLASS__ . \" to string \\n\"; } public function __debugInfo() { return [ 'public_num' =&gt; $this-&gt;public_num * 100 ]; } public static function __set_state() { $obj = new Train2 (); $obj-&gt;public_num = 999; return $obj; } } $train = new Train2 (); // serialize â€” äº§ç”Ÿä¸€ä¸ªå¯å­˜å‚¨çš„å€¼çš„è¡¨ç¤º(via phpæ‰‹å†Œ) $serial = serialize ( $train ); echo \"serial value: \" . $serial . \"\\n\"; unset ( $train ); $train = unserialize ( $serial ); echo $train (); echo $train; var_dump ( $train ) . \"\\n\"; eval ( '$val=' . var_export ( $train, true ) . ';' ); echo var_export ( $val ) . \"\\n\"; è¾“å‡ºï¼š root@ubuntu:/var/www/html/train# php Train2.php serial value: O:6:\"Train2\":1:{s:10:\"public_num\";i:1;} Train2 wakeup invoke here Train2 to string object(Train2)#1 (1) { [\"public_num\"]=&gt; int(100) } Train2::__set_state(array( 'public_num' =&gt; 999, 'protected_num' =&gt; 2, 'private_num' =&gt; 3, )) å‚è€ƒè‡ªPHPæ‰‹å†Œ","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"PHPçš„é­”æœ¯æ–¹æ³•ï¼ˆä¸Šï¼‰","date":"2016-02-25T06:24:25.000Z","path":"2016/02/25/PHPçš„é­”æœ¯æ–¹æ³•ï¼ˆä¸Šï¼‰/","text":"PHPæ‰€æä¾›çš„â€é‡è½½â€ï¼ˆoverloadingï¼‰æ˜¯æŒ‡åŠ¨æ€åœ°â€åˆ›å»ºâ€ç±»å±æ€§å’Œæ–¹æ³•ã€‚æˆ‘ä»¬æ˜¯é€šè¿‡é­”æœ¯æ–¹æ³•ï¼ˆmagic methodsï¼‰æ¥å®ç°çš„ã€‚ å½“è°ƒç”¨å½“å‰ç¯å¢ƒä¸‹æœªå®šä¹‰æˆ–ä¸å¯è§çš„ç±»å±æ€§æˆ–æ–¹æ³•æ—¶ï¼Œé‡è½½æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚æœ¬èŠ‚åé¢å°†ä½¿ç”¨â€ä¸å¯è®¿é—®å±æ€§ï¼ˆinaccessible propertiesï¼‰â€å’Œâ€ä¸å¯è®¿é—®æ–¹æ³•ï¼ˆinaccessible methodsï¼‰â€æ¥ç§°å‘¼è¿™äº›æœªå®šä¹‰æˆ–ä¸å¯è§çš„ç±»å±æ€§æˆ–æ–¹æ³•ã€‚ æ‰€æœ‰çš„é‡è½½æ–¹æ³•éƒ½å¿…é¡»è¢«å£°æ˜ä¸º publicã€‚ åœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶ï¼Œ__set() ä¼šè¢«è°ƒç”¨ã€‚ è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ__get() ä¼šè¢«è°ƒç”¨ã€‚ å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ isset() æˆ– empty() æ—¶ï¼Œ__isset() ä¼šè¢«è°ƒç”¨ã€‚ å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨ unset() æ—¶ï¼Œ__unset() ä¼šè¢«è°ƒç”¨ã€‚ &lt;?php class Train { public $public_num = 999; private $private_num = 1; public function __construct(){ echo __CLASS__.\" construct\\n\"; } public function __clone() { echo __CLASS__ . \" is cloned\\n\"; } public function __get($name) { echo \"Get {$name} \"; return $this-&gt;$name; } public function __set($name, $value) { echo \"Set {$name}\\n\"; $this-&gt;$name = $value; } public function __destruct(){ echo __CLASS__.\" destruct\\n\"; } public function __isset($name){ echo \"judging {$name}\\n\"; if(empty($this-&gt;$name)){ return false; }else{ return true; } } public function __unset($name){ echo \"unset {$name}\\n\"; } } $train1 = new Train (); $train2 = clone $train1; echo $train1-&gt;private_num . \"\\n\"; $train2-&gt;private_num = 666; echo $train2-&gt;private_num . \"\\n\"; echo $train1-&gt;public_num . \"\\n\"; if(empty($train1-&gt;private_num)){ echo '$private_num isn\\'t set'.\"\\n\"; }else{ echo '$private_num is set'.\"\\n\"; } unset($train1-&gt;private_num); æµ‹è¯•ç»“æœï¼š root@ubuntu:/var/www/html/train# php Train.php Train construct Train is cloned Get private_num 1 Set private_num Get private_num 666 999 judging private_num Get private_num $private_num is set unset private_num Train destruct Train destruct","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"Centoså‡çº§phpç‰ˆæœ¬","date":"2016-02-20T06:24:25.000Z","path":"2016/02/20/Centoså‡çº§phpç‰ˆæœ¬/","text":"é»˜è®¤çš„ç‰ˆæœ¬å¤ªä½äº†ï¼Œæ‰‹åŠ¨å®‰è£…æœ‰ä¸€äº›éº»çƒ¦ï¼Œæƒ³é‡‡ç”¨Yumå®‰è£…çš„å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ¡ˆï¼š æ£€æŸ¥å½“å‰å®‰è£…çš„PHPåŒ… yum list installed | grep php å¦‚æœæœ‰å®‰è£…çš„PHPåŒ…ï¼Œå…ˆåˆ é™¤ä»–ä»¬ yum remove php.x86_64 php-cli.x86_64 php-common.x86_64 php-gd.x86_64 php-ldap.x86_64 php-mbstring.x86_64 php-mcrypt.x86_64 php-mysql.x86_64 php-pdo.x86_64 Centos 5.X rpm -Uvh http://mirror.webtatic.com/yum/el5/latest.rpm CentOs 6.x rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm CentOs 7.X rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpmrpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm å¦‚æœæƒ³åˆ é™¤ä¸Šé¢å®‰è£…çš„åŒ…ï¼Œé‡æ–°å®‰è£…rpm -qa | grep webstaticrpm -e ä¸Šé¢æœç´¢åˆ°çš„åŒ…å³å¯ è¿è¡Œyum install yum install php55w.x86_64 php55w-cli.x86_64 php55w-common.x86_64 php55w-gd.x86_64 php55w-ldap.x86_64 php55w-mbstring.x86_64 php55w-mcrypt.x86_64 php55w-mysql.x86_64 php55w-pdo.x86_64 yum install php56w.x86_64 php56w-cli.x86_64 php56w-common.x86_64 php56w-gd.x86_64 php56w-ldap.x86_64 php56w-mbstring.x86_64 php56w-mcrypt.x86_64 php56w-mysql.x86_64 php56w-pdo.x86_64 æ³¨ï¼šå¦‚æœæƒ³å‡çº§åˆ°5.6æŠŠä¸Šé¢çš„55wæ¢æˆ56wå°±å¯ä»¥äº†ã€‚ yum install php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64 php70w-mysql.x86_64 php70w-pdo.x86_644.å®‰è£…PHP FPMyum install php55w-fpmyum install php56w-fpmyum install php70w-fpmæ³¨ï¼šå¦‚æœæƒ³å‡çº§åˆ°5.6æŠŠä¸Šé¢çš„55wæ¢æˆ56wå°±å¯ä»¥äº†ã€‚ è½¬è‡ªvb2005xu","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Centos","slug":"Centos","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Centos/"}]},{"title":"æ­å»ºä¸€ä¸ªç®€å•çš„gitæœåŠ¡å™¨","date":"2016-02-15T06:24:25.000Z","path":"2016/02/15/æ­å»ºä¸€ä¸ªç®€å•çš„gitæœåŠ¡å™¨/","text":"åœ¨è¿œç¨‹ä»“åº“ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®²äº†è¿œç¨‹ä»“åº“å®é™…ä¸Šå’Œæœ¬åœ°ä»“åº“æ²¡å•¥ä¸åŒï¼Œçº¯ç²¹ä¸ºäº†7x24å°æ—¶å¼€æœºå¹¶äº¤æ¢å¤§å®¶çš„ä¿®æ”¹ã€‚ GitHubå°±æ˜¯ä¸€ä¸ªå…è´¹æ‰˜ç®¡å¼€æºä»£ç çš„è¿œç¨‹ä»“åº“ã€‚ä½†æ˜¯å¯¹äºæŸäº›è§†æºä»£ç å¦‚ç”Ÿå‘½çš„å•†ä¸šå…¬å¸æ¥è¯´ï¼Œæ—¢ä¸æƒ³å…¬å¼€æºä»£ç ï¼Œåˆèˆä¸å¾—ç»™GitHubäº¤ä¿æŠ¤è´¹ï¼Œé‚£å°±åªèƒ½è‡ªå·±æ­å»ºä¸€å°GitæœåŠ¡å™¨ä½œä¸ºç§æœ‰ä»“åº“ä½¿ç”¨ã€‚ æ­å»ºGitæœåŠ¡å™¨éœ€è¦å‡†å¤‡ä¸€å°è¿è¡ŒLinuxçš„æœºå™¨ï¼Œå¼ºçƒˆæ¨èç”¨Ubuntuæˆ–Debianï¼Œè¿™æ ·ï¼Œé€šè¿‡å‡ æ¡ç®€å•çš„aptå‘½ä»¤å°±å¯ä»¥å®Œæˆå®‰è£…ã€‚ å‡è®¾ä½ å·²ç»æœ‰sudoæƒé™çš„ç”¨æˆ·è´¦å·ï¼Œä¸‹é¢ï¼Œæ­£å¼å¼€å§‹å®‰è£…ã€‚ git serveré…ç½®å®‰è£… ç¬¬ä¸€æ­¥ï¼Œå®‰è£…gitï¼š $ sudo apt-get install git ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªgitç”¨æˆ·ï¼Œç”¨æ¥è¿è¡ŒgitæœåŠ¡ï¼š $ sudo adduser git ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºè¯ä¹¦ç™»å½•ï¼š æ”¶é›†æ‰€æœ‰éœ€è¦ç™»å½•çš„ç”¨æˆ·çš„å…¬é’¥ï¼Œå°±æ˜¯ä»–ä»¬è‡ªå·±çš„id_rsa.pubæ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰å…¬é’¥å¯¼å…¥åˆ°/home/git/.ssh/authorized_keysæ–‡ä»¶é‡Œï¼Œä¸€è¡Œä¸€ä¸ªã€‚ ç¬¬å››æ­¥ï¼Œåˆå§‹åŒ–Gitä»“åº“ï¼š å…ˆé€‰å®šä¸€ä¸ªç›®å½•ä½œä¸ºGitä»“åº“ï¼Œå‡å®šæ˜¯/srv/sample.gitï¼Œåœ¨/srvç›®å½•ä¸‹è¾“å…¥å‘½ä»¤ï¼š $ sudo git init --bare sample.git Gitå°±ä¼šåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“æ²¡æœ‰å·¥ä½œåŒºï¼Œå› ä¸ºæœåŠ¡å™¨ä¸Šçš„Gitä»“åº“çº¯ç²¹æ˜¯ä¸ºäº†å…±äº«ï¼Œæ‰€ä»¥ä¸è®©ç”¨æˆ·ç›´æ¥ç™»å½•åˆ°æœåŠ¡å™¨ä¸Šå»æ”¹å·¥ä½œåŒºï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸Šçš„Gitä»“åº“é€šå¸¸éƒ½ä»¥.gitç»“å°¾ã€‚ç„¶åï¼ŒæŠŠowneræ”¹ä¸ºgitï¼š $ sudo chown -R git:git sample.git ç¬¬äº”æ­¥ï¼Œç¦ç”¨shellç™»å½•ï¼š å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç¬¬äºŒæ­¥åˆ›å»ºçš„gitç”¨æˆ·ä¸å…è®¸ç™»å½•shellï¼Œè¿™å¯ä»¥é€šè¿‡ç¼–è¾‘/etc/passwdæ–‡ä»¶å®Œæˆã€‚æ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¸€è¡Œï¼š git:x:1001:1001:,,,:/home/git:/bin/bash æ”¹ä¸ºï¼š git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell è¿™æ ·ï¼Œgitç”¨æˆ·å¯ä»¥æ­£å¸¸é€šè¿‡sshä½¿ç”¨gitï¼Œä½†æ— æ³•ç™»å½•shellï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºgitç”¨æˆ·æŒ‡å®šçš„git-shellæ¯æ¬¡ä¸€ç™»å½•å°±è‡ªåŠ¨é€€å‡ºã€‚ ç¬¬å…­æ­¥ï¼Œå…‹éš†è¿œç¨‹ä»“åº“ï¼š ç°åœ¨ï¼Œå¯ä»¥é€šè¿‡git cloneå‘½ä»¤å…‹éš†è¿œç¨‹ä»“åº“äº†ï¼Œåœ¨å„è‡ªçš„ç”µè„‘ä¸Šè¿è¡Œï¼š $ git clone git@server:/srv/sample.git Cloning into 'sample'... warning: You appear to have cloned an empty repository. å‰©ä¸‹çš„å°±æ˜¯æ™®é€šçš„gitæ“ä½œäº†ï¼Œå¦‚æœå¯¹gitæ“ä½œæœ‰é™Œç”Ÿçš„å¯ä»¥å‚è€ƒè¿™é‡Œã€‚ å¦‚æœå›¢é˜Ÿå¾ˆå°ï¼ŒæŠŠæ¯ä¸ªäººçš„å…¬é’¥æ”¶é›†èµ·æ¥æ”¾åˆ°æœåŠ¡å™¨çš„/home/git/.ssh/authorized_keysæ–‡ä»¶é‡Œå°±æ˜¯å¯è¡Œçš„ã€‚å¦‚æœå›¢é˜Ÿæœ‰å‡ ç™¾å·äººï¼Œå°±æ²¡æ³•è¿™ä¹ˆç©äº†ï¼Œè¿™æ—¶ï¼Œå¯ä»¥ç”¨Gitosisæ¥ç®¡ç†å…¬é’¥ã€‚ Gitosisé…ç½®ç›¸å…³ï¼š ä¸€ã€æ¶è®¾æ­¥éª¤ ä¸‹è½½å¹¶å®‰è£…python setuptoolssudo apt-get install python-setuptools ä¸‹è½½å¹¶å®‰è£…gitosiscd ~/src git clone https://github.com/res0nat0r/gitosis.git cd gitosis python setup.py install æ·»åŠ ç”¨æˆ·gitsudo adduser \\ --system \\ --shell /bin/sh \\ --gecos 'git version control' \\ --group \\ --disabled-password \\ --home /home/git \\ git ç”Ÿæˆæœ¬æœºå¯†é’¥åˆ‡æ¢åˆ°ä¸ªäººæœºï¼Œå¦‚æœå·²æœ‰~/.ssh/id_rsa.pubç•¥è¿‡æ­¤æ­¥ssh-keygen -t rsa ä¸Šä¼ å¯†é’¥åˆ°æœåŠ¡å™¨ä¸´æ—¶ç›®å½•scp ~/.ssh/id_rsa.pub ç”¨æˆ·å@ä¸»æœº:/tmp åˆä½¿åŒ–gitosisåˆ‡å›åˆ°æœåŠ¡å™¨sudo -H -u git gitosis-init &lt; /tmp/id_rsa.pub ä¿®æ”¹post-updateæƒé™sudo chmod 755 /home/git/repositories/gitosis-admin.git/hooks/post-update clone gitosisç®¡ç†å¹³å°git clone git@ä¸»æœºå:gitosis-admin.git cd gitosis-admin å®‰è£…å®Œæˆé€šè¿‡ä¿®æ”¹gitosis-adminç®¡ç†gitosisç”¨æˆ·æƒé™æ·»åŠ å…¬å¯†åˆ°keydirï¼Œæ·»åŠ ç”¨æˆ·ä¿®æ”¹å®Œåcommitï¼Œpushåˆ°ä¸­æœåŠ¡å™¨å³å¯å®Œæˆä»“åº“æƒé™çš„ç›¸å…³æ“ä½œã€‚ äºŒã€å®ä¾‹ ç”¨æˆ·johnæ·»åŠ å¹¶å‘é€id_rsa.pubç»™miaoç›®æ ‡ï¼šæ·»åŠ ç”¨æˆ· john å’Œä»“åº“ foo åˆ°gitosisï¼Œå¹¶å’Œç®¡ç†å‘˜miaoåˆä½œç®¡ç†john:~$ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/home/john/.ssh/id_rsa): Created directory '/home/john/.ssh'. Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/john/.ssh/id_rsa. Your public key has been saved in /home/john/.ssh/id_rsa.pub. john:~$ cp /home/john/.ssh/id_rsa.pub /tmp gitosisç®¡ç†å‘˜miaoåˆ†é…johnæƒé™miao:~$ cd ~/projects git clone git@192.168.1.115:gitosis-admin cd gitosis-admin cat gitosis.conf [gitosis] [group gitosis-admin] writable = gitosis-admin members = miao@u32-192-168-1-110 ls keydir/ miao@u32-192-168-1-110.pub cp /tmp/id_rsa.pub keydir/john.pub vi gitosis.conf [gitosis] [group gitosis-admin] writable = gitosis-admin members = miao@u32-192-168-1-110 [group foo] writable = foo members = miao@u32-192-168-1-110 john git add . git commit -am \"add member john and project foo\" git push ç”¨æˆ· miao æ·»åŠ é¡¹ç›®foomiao:~$ cd ~/projects mkdir foo cd foo git init touch hello.txt git add hello.txt git commit -am 'first commit' git remote add origin git@192.168.1.115:foo.git git push origin master ç”¨æˆ· john clone Fooå¹¶ä¿®æ”¹hello.txtjohn:~$ git clone git@192.168.1.115:foo.git cd foo ls date &gt; hello.txt git commit -am 'add time to hello.txt' &amp;&amp; git push ç”¨æˆ· miao pull Foomiao:~/projects/foo$ vi .git/config [core] repositoryformatversion = 0 filemode = true bare = false logallrefupdates = true [remote \"origin\"] url = git@192.168.1.115:foo.git fetch = +refs/heads/*:refs/remotes/origin/* [branch \"master\"] remote = origin merge = refs/heads/master git pull ä¸‰ã€å¸¸è§é—®é¢˜é¦–å…ˆç¡®å®š /home/git/repositories/gitosis-admin.git/hooks/post-update ä¸ºå¯æ‰§è¡Œå³å±æ€§ä¸º 0755 gitæ“ä½œéœ€è¦è¾“å…¥å¯†ç åŸå› å…¬å¯†æœªæ‰¾åˆ°è§£å†³ä¸Šä¼ id_pub.rsaåˆ°keydirå¹¶æ”¹ä¸ºâ€™gitosiså¸å·.pubâ€™å½¢å¼ï¼Œå¦‚miao.pubã€‚æ‰©å±•å.pubä¸å¯çœç•¥ ERROR:gitosis.serve.main:Repository read access deniedåŸå› gitosis.confä¸­çš„membersä¸keydirä¸­çš„ç”¨æˆ·åä¸ä¸€è‡´ï¼Œå¦‚gitosisä¸­çš„members = foo@barï¼Œä½†keydirä¸­çš„å…¬å¯†åå´å«foo.pubè§£å†³ä½¿keydirçš„åç§°ä¸gitosisä¸­membersæ‰€æŒ‡çš„åç§°ä¸€è‡´ã€‚æ”¹ä¸ºmembers = foo æˆ– å…¬å¯†åç§°æ”¹ä¸ºfoo@bar.pub å‚è€ƒæ–‡ç« åœ°å€ï¼š http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000http://blog.csdn.net/king_sundi/article/details/7065525","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"}]},{"title":"pythonç™¾åº¦å›¾ç‰‡çˆ¬è™«","date":"2016-02-06T06:24:25.000Z","path":"2016/02/06/pythonç™¾åº¦å›¾ç‰‡çˆ¬è™«/","text":"èŠ±äº†ä¸€æ™šæ—¶é—´å†™äº†ä¸€ä¸ªç™¾åº¦å›¾ç‰‡çš„çˆ¬è™«ï¼Œå¯ä»¥æœç´¢ä»»æ„å…³é”®å­—python2.7å¯¹äºä¸­æ–‡çš„æ”¯æŒå®åœ¨æ˜¯ååˆ†ä¹‹è›‹ç–¼å¯¹äºå‡ºç°å¼‚å¸¸çš„æƒ…å†µå¤„ç†çš„å¹¶ä¸æ˜¯å¾ˆå®Œç¾ï¼Œç­‰å¾…åç»­å¤„ç†getImagesURL(max_number, word) max_numberæ˜¯è¦æŠ“å–å›¾ç‰‡çš„æ•°é‡ï¼Œwordæ˜¯æœç´¢çš„å…³é”®å­— #!/usr/bin/env python # -*- coding:utf-8 -*- import os import urllib import json from urllib import quote import socket import sys reload(sys) sys.setdefaultencoding('utf-8') #è®¾ç½®è¶…æ—¶ socket.setdefaulttimeout(10) counter=1 # è·å–å›¾ç‰‡urlå†…å®¹ç­‰ def getImagesURL(max_number, word='ç¾å¥³'): search = quote(word) pn = 0 while pn &lt;= max_number: global counter url = 'http://image.baidu.com/search/avatarjson?tn=resultjsonavatarnew&amp;ie=utf-8&amp;word=' + search + '&amp;cg=girl&amp;pn=' + str(pn) + '&amp;rn=60&amp;itg=0&amp;z=0&amp;fr=&amp;width=&amp;height=&amp;lm=-1&amp;ic=0&amp;s=0&amp;st=-1&amp;gsm=1e0000001e' page = urllib.urlopen(url) data = page.read() data = json.loads(data) saveImage(data, word) pn += 60 # ä¿å­˜å›¾ç‰‡ def saveImage(json, word): global counter if not os.path.exists(\"./\" + word): os.mkdir(\"./\" + word) #åˆ¤æ–­åå­—æ˜¯å¦é‡å¤ index=len(os.listdir('./'+word)) if os.path.exists(\"./\"+word+\"/\"+str(counter)+\".jpeg\"): counter=index check='&lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;' for info in json['imgs']: urllib.urlretrieve(info['objURL'], './' + word + '/' + str(counter) +'.jpeg') #åˆ¤æ–­é˜²çˆ¬è™« &lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt; fp=open(\"./\"+word+\"/\"+str(counter)+\".jpeg\") if not cmp(fp.readline(),'&lt;html&gt;&lt;body&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;\\n'): os.remove(\"./\"+word+\"/\"+str(counter)+\".jpeg\") counter-=1 fp.close() counter += 1 print \"å°é»„å›¾+1ï¼Œå·²ç»ä¿å­˜\"+str(counter-1)+\"å¼ å°é»„å›¾\\n\" return counter #è·å–åç¼€å def getFix(name): return name[name.find('.'):] #è·å–å‰ç¼€ def getPrefix(name): return name[:name.find('.')] #print getFix('123.txt') #getImagesURL(390,'ç¾å¥³') getImagesURL(240,'äºŒæ¬¡å…ƒ') #getImagesURL(360,'å¸…å“¥') æ•ˆæœå›¾","tags":[{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://github.com/kong36088/kong36088.github.io/tags/çˆ¬è™«/"},{"name":"Python","slug":"Python","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Python/"}]},{"title":"å¾®ä¿¡å®¢æœæ¥å£ï¼ˆä¸»åŠ¨å‘ç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼‰","date":"2016-01-30T15:50:25.000Z","path":"2016/01/30/å¾®ä¿¡å®¢æœæ¥å£ï¼ˆä¸»åŠ¨å‘ç”¨æˆ·æ¨é€æ¶ˆæ¯ï¼‰/","text":"function http_post_data($url, $data) { $curl = curl_init (); curl_setopt ( $curl, CURLOPT_URL, $url ); curl_setopt ( $curl, CURLOPT_SSL_VERIFYPEER, FALSE ); curl_setopt ( $curl, CURLOPT_SSL_VERIFYHOST, FALSE ); curl_setopt ( $curl, CURLOPT_POST, 1 ); curl_setopt ( $curl, CURLOPT_POSTFIELDS, $data ); curl_setopt ( $curl, CURLOPT_RETURNTRANSFER, 1 ); $result = curl_exec ( $curl ); if (curl_errno ( $curl )) { return 'Errno' . curl_error ( $curl ); } curl_close ( $curl ); return $result; } $url = 'https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=' . ACCESS_TOKEN; $data = json_encode ( array ( \"touser\" =&gt; \"oUc9GvzIY4ZZkb5yxIY8zGTUS0kI\", \"msgtype\" =&gt; \"text\", \"text\" =&gt; array ( \"content\" =&gt; \"abc\" ) ) ); http_post_data($url,$data); è¿™é‡Œæ˜¯åˆ©ç”¨curlæ¥postæ•°æ®åˆ°å¾®ä¿¡çš„æœåŠ¡å™¨ï¼Œå…¶ä¸­éœ€è¦access_tokençš„æ”¯æŒï¼Œä»¥ä¸‹æ˜¯access_tokenè·å–çš„æ–¹æ³• function get_access_token() { $values = json_decode ( file_get_contents ( 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=' . APPID . '&amp;secret=' . APPSECRET ) ); if ($values) { $access_token = $values-&gt;access_token; return $access_token; } else { return false; } }","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å¾®ä¿¡/"}]},{"title":"ubuntuä¸‹apacheå¼€å¯SSLæç¤º443ç«¯å£è¢«å ç”¨","date":"2016-01-30T15:24:25.000Z","path":"2016/01/30/ubuntuä¸‹apacheå¼€å¯SSLæç¤º443ç«¯å£è¢«å ç”¨/","text":"You guys are going to laugh at this. I had an extra Listen 443 in ports.conf that shouldnâ€™t have been there. Removing that solved this. å› ä¸ºåœ¨ports.confä¸­é‡å¤å‡ºç°443ç«¯å£çš„é…ç½®ï¼Œæ‰€ä»¥åšä»¥ä¸‹ä¿®æ”¹æŠŠå¤šä½™çš„Listen 443æ³¨é‡Šæ‰ï¼Œæ‰€ä»¥ports.confçš„å†…å®¹åº”è¯¥æ˜¯è¿™æ ·çš„ NameVirtualHost *:80 Listen 80 NameVirtualHost *:443 #Listen 443 &lt;IfModule mod_ssl.c&gt; Listen 443 &lt;/IfModule&gt; &lt;IfModule mod_gnutls.c&gt; Listen 443 &lt;/IfModule&gt; å¦å¤–åœ¨è™šæ‹ŸæœåŠ¡å™¨ä¸­ä¸è¦åŠ  NameVirtualHost *:443","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"å¾®ä¿¡æ”¯ä»˜çš„ç»éªŒæ€»ç»“","date":"2016-01-30T06:24:25.000Z","path":"2016/01/30/å¾®ä¿¡æ”¯ä»˜çš„ç»éªŒæ€»ç»“/","text":"åœ¨è¿™æ¬¡å¾®ä¿¡æ”¯ä»˜å¼€å‘è¿‡ç¨‹ä¸­æ€»å…±é‡åˆ°è¿‡ä¸¤ç§é”™è¯¯ 1.è¦è®°å¾—æŠŠå¾®ä¿¡æ”¯ä»˜æˆæƒç²¾ç¡®åˆ°äºŒçº§æˆ–è€…ä¸‰çº§ç›®å½•ï¼Œå¹¶ä¸”ä¿è¯æ”¯ä»˜è°ƒç”¨çš„é¡µé¢å’Œæ”¯ä»˜æ¥å£APIä¸€è‡´2.è¦æŠŠtimestampç±»å‹è½¬æ¢ä¸ºstringç±»å‹3.å¦‚æœè¦ä¿è¯ä»£ç é€»è¾‘æ§åˆ¶å™¨ä¹‹é—´çš„åˆ†ç¦»ä½†æ˜¯åˆè¦ä¿è¯æ”¯ä»˜çš„åŸŸåç»Ÿä¸€ï¼Œå¯ä»¥ä½¿ç”¨è·¯ç”±åŠŸèƒ½å°†è·¯å¾„é‡å®šå‘ è‹¹æœçš„ç‚¹å‡»é€‰æ‹©åŠŸèƒ½æœ‰ä¸€ä¸ªå‘å°±æ˜¯ï¼Œåœ¨å…ƒç´ å†…éœ€è¦åŠ ä¸€ä¸ªcsså±æ€§ï¼š cursor:pointer","tags":[{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å¾®ä¿¡/"},{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://github.com/kong36088/kong36088.github.io/tags/éšç¬”/"}]},{"title":"ubuntuè®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸ç½‘ç»œåŒæ­¥ï¼ˆè½¬ï¼‰","date":"2016-01-06T08:24:25.000Z","path":"2016/01/06/ubuntuè®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸ç½‘ç»œåŒæ­¥/","text":"Linuxçš„æ—¶é—´åˆ†ä¸ºSystem Clockï¼ˆç³»ç»Ÿæ—¶é—´ï¼‰å’ŒReal Time Clock ï¼ˆç¡¬ä»¶æ—¶é—´ï¼Œç®€ç§°RTCï¼‰ã€‚ ç³»ç»Ÿæ—¶é—´ï¼šæŒ‡å½“å‰Linux Kernelä¸­çš„æ—¶é—´ã€‚ ç¡¬ä»¶æ—¶é—´ï¼šä¸»æ¿ä¸Šæœ‰ç”µæ± ä¾›ç”µçš„æ—¶é—´ã€‚ æŸ¥çœ‹ç³»ç»Ÿæ—¶é—´çš„å‘½ä»¤ï¼š #date è®¾ç½®ç³»ç»Ÿæ—¶é—´çš„å‘½ä»¤ï¼š #date â€“setï¼ˆæœˆ/æ—¥/å¹´ æ—¶ï¼šåˆ†ï¼šç§’ï¼‰ ä¾‹ï¼š#date â€“set â€œ10/11/10 10:15â€ æŸ¥çœ‹ç¡¬ä»¶æ—¶é—´çš„å‘½ä»¤ï¼š # hwclock è®¾ç½®ç¡¬ä»¶æ—¶é—´çš„å‘½ä»¤ï¼š # hwclock â€“set â€“date = ï¼ˆæœˆ/æ—¥/å¹´ æ—¶ï¼šåˆ†ï¼šç§’ï¼‰ ä¸Šè¿°æåˆ°çš„æ˜¯æ‰‹åŠ¨è®¾ç½®æ—¶é—´åˆ°ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå¯èƒ½ä¸å½“å‰ç½‘ç»œçš„æ—¶é—´æœ‰è¯¯å·®ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹ä¸æ—¶é—´æœåŠ¡å™¨ä¸Šçš„æ—¶é—´åŒæ­¥çš„æ–¹æ³• å®‰è£…ntpdateå·¥å…·# sudo apt-get install ntpdate è®¾ç½®ç³»ç»Ÿæ—¶é—´ä¸ç½‘ç»œæ—¶é—´åŒæ­¥# ntpdate cn.pool.ntp.org å°†ç³»ç»Ÿæ—¶é—´å†™å…¥ç¡¬ä»¶æ—¶é—´# hwclock --systohc","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"å¾®ä¿¡ç½‘é¡µæˆæƒçš„å·¨å‘","date":"2016-01-06T06:24:25.000Z","path":"2016/01/06/å¾®ä¿¡ç½‘é¡µæˆæƒçš„å·¨å‘/","text":"å¾®ä¿¡æˆæƒè®°å¾—åœ¨ä¸‹é¢å¡«å†™æˆæƒçš„è¦æˆæƒçš„URLï¼ï¼ï¼æˆæƒçš„URLè®°å¾—ä¸è¦åŠ httpï¼ï¼ï¼ï¼ï¼æˆæƒçš„URLè®°å¾—ä¸è¦åŠ httpï¼ï¼ï¼ï¼ï¼æˆæƒçš„URLè®°å¾—ä¸è¦åŠ httpï¼ï¼ï¼ï¼ï¼","tags":[{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å¾®ä¿¡/"},{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://github.com/kong36088/kong36088.github.io/tags/éšç¬”/"}]},{"title":"PHPä¸‰ç§POSTæ•°æ®çš„æ–¹å¼","date":"2015-12-28T08:24:25.000Z","path":"2015/12/28/PHPä¸‰ç§POSTæ•°æ®çš„æ–¹å¼/","text":"ç¬¬ä¸€ç§ $_POSTè¿™ç§æ–¹å¼åªèƒ½å¤Ÿæ¥æ”¶Content-typeä¸ºapplication/x-www-form-urlencodedæäº¤çš„æ•°æ®è¿™ç§æ–¹å¼æäº¤serverä¼šè‡ªåŠ¨å°†æ•°æ®è½¬ä¸ºkey=&gt;valueçš„æ–¹å¼ ç¬¬äºŒç§ $GLOBALS[â€˜HTTP_RAW_POST_DATAâ€™]æ€»æ˜¯äº§ç”Ÿ $HTTP_RAW_POST_DATA å˜é‡åŒ…å«æœ‰åŸå§‹çš„ POST æ•°æ®ã€‚æ­¤å˜é‡ä»…åœ¨ç¢°åˆ°æœªè¯†åˆ« MIME ç±»å‹çš„æ•°æ®æ—¶äº§ç”Ÿã€‚$HTTP_RAW_POST_DATA å¯¹äº enctype=â€multipart/form-dataâ€ è¡¨å•æ•°æ®ä¸å¯ç”¨å¦‚æœpostè¿‡æ¥çš„æ•°æ®ä¸æ˜¯PHPèƒ½å¤Ÿè¯†åˆ«çš„ï¼Œå¯ä»¥ç”¨ $GLOBALS[â€˜HTTP_RAW_POST_DATAâ€™]æ¥æ¥æ”¶ï¼Œæ¯”å¦‚ text/xml æˆ–è€… soap ç­‰ç­‰ ç¬¬ä¸‰ç§ file_get_contents(â€œphp://inputâ€)å…è®¸è¯»å– POST çš„åŸå§‹æ•°æ®ã€‚å’Œ $HTTP_RAW_POST_DATA æ¯”èµ·æ¥ï¼Œå®ƒç»™å†…å­˜å¸¦æ¥çš„å‹åŠ›è¾ƒå°ï¼Œå¹¶ä¸”ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„ php.ini è®¾ç½®ã€‚php://input ä¸èƒ½ç”¨äº enctype=â€multipart/form-dataâ€ã€‚è¿™ä¸€ç§æ¥å—åŸå§‹æ•°æ®çš„æ–¹å¼ä¼˜äºç¬¬äºŒç§æ–¹å¼ï¼Œæ¨èä½¿ç”¨è¯¥æ–¹æ³•æ¥å—POSTæ•°æ® å‚è€ƒè‡ªâ€”â€”here","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"ubuntuå®‰è£…swooleæ‹“å±•","date":"2015-12-28T06:24:25.000Z","path":"2015/12/28/ubuntuå®‰è£…swooleæ‹“å±•/","text":"1å®‰è£…swooleï¼šå¯peclç›´æ¥åœ¨çº¿å®‰è£…ï¼Œæˆ–ä¸‹è½½ releasesç‰ˆæœ¬çš„swooleç¼–è¯‘å®‰è£…2.11ç¼–è¯‘å®‰è£…swooleæ‰©å±• ä»æ­¤å¤„ä¸‹è½½ï¼š http://pecl.php.net/package/swoole # cd swoole # phpize # ./configure # make &amp;&amp; make install 2.peclå®‰è£…swooleæ‰©å±• peclä¸å¯ç”¨çš„è¯·ç¡®è®¤phpå®‰è£…ç›®å½•çš„binç›®å½•å·²åŠ å…¥ç³»ç»Ÿå˜é‡ ç”¨peclæ–¹å¼æ¥å®‰è£… zzs@ubuntu:~$ sudo pecl install swoole downloading swoole-1.7.8.tgz â€¦ Starting to download swoole-1.7.8.tgz (412,906 bytes) â€¦.done: 412,906 bytes 130 source files, building running: phpize sh: 1: phpize: not found If the command failed with â€˜phpize: not foundâ€™ then you need to install php5-dev packageYou can do it by running â€˜apt-get install php5-devâ€™ as a root userERROR: `phpizeâ€™ failed zzs@ubuntu:~$ sudo apt-get install php5-dev æ­£åœ¨è¯»å–è½¯ä»¶åŒ…åˆ—è¡¨â€¦ å®Œæˆ æ­£åœ¨åˆ†æè½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»æ ‘ æ­£åœ¨è¯»å–çŠ¶æ€ä¿¡æ¯â€¦ å®Œæˆ å°†ä¼šå®‰è£…ä¸‹åˆ—é¢å¤–çš„è½¯ä»¶åŒ…ï¼š pkg-php-tools shtool å»ºè®®å®‰è£…çš„è½¯ä»¶åŒ…ï¼š dh-make ä¸‹åˆ—ã€æ–°ã€‘è½¯ä»¶åŒ…å°†è¢«å®‰è£…ï¼š php5-dev pkg-php-tools shtool å‡çº§äº† 0 ä¸ªè½¯ä»¶åŒ…ï¼Œæ–°å®‰è£…äº† 3 ä¸ªè½¯ä»¶åŒ…ï¼Œè¦å¸è½½ 0 ä¸ªè½¯ä»¶åŒ…ï¼Œæœ‰ 13 ä¸ªè½¯ä»¶åŒ…æœªè¢«å‡çº§ã€‚ éœ€è¦ä¸‹è½½ 0 B/527 kB çš„è½¯ä»¶åŒ…ã€‚ è§£å‹ç¼©åä¼šæ¶ˆè€—æ‰ 4,431 kB çš„é¢å¤–ç©ºé—´ã€‚ æ‚¨å¸Œæœ›ç»§ç»­æ‰§è¡Œå—ï¼Ÿ [Y/n] y â€¦ install ok: channel://pecl.php.net/swoole-1.7.8 configuration option â€œphp_iniâ€ is not set to php.ini location You should add â€œextension=swoole.soâ€ to php.ini zzs@ubuntu:~$ sudo vim /etc/php5/mods-available/swoole.ini é‡Œé¢åŠ å…¥å†…å®¹ ; configuration for php Swoole module extension=swoole.so php -m | grep swoole æ­¤æ—¶è¿˜æ²¡æœ‰swooleæ¨¡å— sudo ln -s /etc/php5/mods-available/swoole.ini /etc/php5/cli/conf.d/20-swoole.ini ä¸‹é¢ä¸¤è¡Œé…Œæƒ…ä½¿ç”¨ sudo ln -s /etc/php5/mods-available/swoole.ini /etc/php5/apache2/conf.d/20-swoole.ini sudo ln -s /etc/php5/mods-available/swoole.ini /etc/php5/fpm/conf.d/20-swoole.ini php -m | grep swoole swoole æµ‹è¯•æ‰©å±• server.php: on('connect', function ($serv, $fd){ echo \"Client:Connect.\\n\"; }); $serv-&gt;on('receive', function ($serv, $fd, $from_id, $data) { $serv-&gt;send($fd, 'Swoole: '.$data); }); $serv-&gt;on('close', function ($serv, $fd) { echo \"Client: Close.\\n\"; }); $serv-&gt;start(); ?&gt; client.php: on(\"connect\", function($cli) { $cli-&gt;send(\"hello world\\n\"); }); $client-&gt;on(\"receive\", function($cli, $data){ echo \"Receive: $data\\n\"; }); $client-&gt;on(\"error\", function($cli){ echo \"connect fail\\n\"; }); $client-&gt;on(\"close\", function($cli){ echo \"close\\n\"; }); $client-&gt;connect('127.0.0.1', 9501, 0.5); ?&gt;","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"ubuntuåœ¨é‡åˆ°ä¸€ç›´åœç•™åœ¨waiting for headersçš„è§£å†³åŠæ³•","date":"2015-12-26T06:24:25.000Z","path":"2015/12/26/ubuntuåœ¨é‡åˆ°ä¸€ç›´åœç•™åœ¨waiting for headersçš„è§£å†³åŠæ³•/","text":"æ–°è£…äº†ä¸€ä¸ªubuntu kylin15.10ï¼Œåœ¨æ›´æ¢æˆé˜¿é‡Œçš„æºä¹‹åï¼Œå‰é¢çš„updateå’Œinstalléƒ½éå¸¸çš„é¡ºç•…ä½†æ˜¯åœ¨å®‰è£…phpmyadminçš„æ—¶å€™å´ä¸€ç›´åœ¨waiting for headersç½‘ä¸Šè¯´å¯ä»¥rm -rvf /var/cache/apt/archivesä½†æ˜¯é™¤äº†é‡æ–°åŠ è½½åˆ°79%ç„¶åç»§ç»­waitingä¹‹å¤–æ¯«æ— ä½œç”¨æœ€åçœ‹äº†ä¸‹installçš„è¿‡ç¨‹ï¼Œå‘ç° Get:12 http://mirrors.hust.edu.cn/ubuntu/ wily-security/main php5-mysql amd64 5.6.11+dfsg-1ubuntu3.1 [65.3 kB] æœ€åé€šè¿‡å–æ¶ˆSoftware&amp;Updates-&gt;other softwareé‡Œé¢æ‰€æœ‰æºçš„é’©å­ï¼Œå†æ‰§è¡Œ sudo apt-get update æå®š","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"JSæ—¶é—´æ ¼å¼åŒ–","date":"2015-12-15T06:24:25.000Z","path":"2015/12/15/JSæ—¶é—´æ ¼å¼åŒ–/","text":"javascriptæ—¶é—´æ ¼å¼åŒ– // å¯¹Dateçš„æ‰©å±•ï¼Œå°† Date è½¬åŒ–ä¸ºæŒ‡å®šæ ¼å¼çš„String // æœˆ(M)ã€æ—¥(d)ã€å°æ—¶(h)ã€åˆ†(m)ã€ç§’(s)ã€å­£åº¦(q) å¯ä»¥ç”¨ 1-2 ä¸ªå ä½ç¬¦ï¼Œ // å¹´(y)å¯ä»¥ç”¨ 1-4 ä¸ªå ä½ç¬¦ï¼Œæ¯«ç§’(S)åªèƒ½ç”¨ 1 ä¸ªå ä½ç¬¦(æ˜¯ 1-3 ä½çš„æ•°å­—) // ä¾‹å­ï¼š // (new Date()).Format(\"yyyy-MM-dd hh:mm:ss.S\") ==&gt; 2015-07-02 08:09:04.423 // (new Date()).Format(\"yyyy-M-d h:m:s.S\") ==&gt; 2015-7-2 8:9:4.18 Date.prototype.Format = function(fmt) { var o = { \"M+\" : this.getMonth()+1, //æœˆä»½ \"d+\" : this.getDate(), //æ—¥ \"h+\" : this.getHours(), //å°æ—¶ \"m+\" : this.getMinutes(), //åˆ† \"s+\" : this.getSeconds(), //ç§’ \"q+\" : Math.floor((this.getMonth()+3)/3), //å­£åº¦ \"S\" : this.getMilliseconds() //æ¯«ç§’ }; if(/(y+)/.test(fmt)) fmt=fmt.replace(RegExp.$1, (this.getFullYear()+\"\").substr(4 - RegExp.$1.length)); for(var k in o) if(new RegExp(\"(\"+ k +\")\").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : ((\"00\"+ o[k]).substr((\"\"+ o[k]).length))); return fmt; }","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"},{"name":"æ—¶é—´","slug":"æ—¶é—´","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æ—¶é—´/"}]},{"title":"æ— æ³•ä¿®æ­£é”™è¯¯ï¼Œå› ä¸ºæ‚¨è¦æ±‚æŸäº›è½¯ä»¶åŒ…ä¿æŒç°çŠ¶ï¼Œå°±æ˜¯å®ƒä»¬ç ´åäº†è½¯ä»¶åŒ…é—´çš„ä¾èµ–å…³ç³» è§£å†³åŠæ³•","date":"2015-12-04T06:24:25.000Z","path":"2015/12/04/æ— æ³•ä¿®æ­£é”™è¯¯ï¼Œå› ä¸ºæ‚¨è¦æ±‚æŸäº›è½¯ä»¶åŒ…ä¿æŒç°çŠ¶ï¼Œå°±æ˜¯å®ƒä»¬ç ´åäº†è½¯ä»¶åŒ…é—´çš„ä¾èµ–å…³ç³» è§£å†³åŠæ³•/","text":"ubuntuä¸‹apt-get installå®‰è£…è½¯ä»¶ï¼Œ æŠ¥â€œæ— æ³•ä¿®æ­£é”™è¯¯ï¼Œå› ä¸ºæ‚¨è¦æ±‚æŸäº›è½¯ä»¶åŒ…ä¿æŒç°çŠ¶ï¼Œå°±æ˜¯å®ƒä»¬ç ´åäº†è½¯ä»¶åŒ…é—´çš„ä¾èµ–å…³ç³»â€ï¼Œä»Šå¤©ç»ˆäºæ‰¾åˆ°è§£å†³æ–¹æ³•äº†ã€‚ ä¸€èˆ¬å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ—¶ è¦è£…Aï¼Œ ä¾èµ–B, ä½†æ˜¯å·²ç»å®‰è£…çš„è½¯ä»¶Cä¹Ÿä¾èµ–Bï¼Œ ä½†æ˜¯Aä¾èµ–çš„Bçš„ç‰ˆæœ¬å’ŒCä¾èµ–çš„Bçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œ å¯¼è‡´äº†å¦‚æœè¦å®‰è£…Bï¼Œé‚£ä¹ˆCä¾¿ä¸èƒ½æ­£å¸¸è¿è¡Œäº†ï¼Œæ‰€ä»¥ç³»ç»ŸæŠ¥é”™ï¼Œç»„ç»‡å®‰è£…Bã€‚ é‚£ä¹ˆè§£å†³æ–¹æ³•å°±æ˜¯ï¼š å®‰è£…æŒ‡å®šç‰ˆæœ¬å·çš„Bã€‚ ä¾‹å¦‚ æˆ‘ä»Šå¤© sudo apt-get install subversion ç³»ç»ŸæŠ¥é”™å¦‚ä¸‹ï¼š ä¸‹åˆ—è½¯ä»¶åŒ…æœ‰æœªæ»¡è¶³çš„ä¾èµ–å…³ç³»ï¼š subversion : ä¾èµ–: libsvn1 (= 1.8.8-1ubuntu3) ä½†æ˜¯ 1.8.8-1ubuntu3.1 æ­£è¦è¢«å®‰è£…E: æ— æ³•ä¿®æ­£é”™è¯¯ï¼Œå› ä¸ºæ‚¨è¦æ±‚æŸäº›è½¯ä»¶åŒ…ä¿æŒç°çŠ¶ï¼Œå°±æ˜¯å®ƒä»¬ç ´åäº†è½¯ä»¶åŒ…é—´çš„ä¾èµ–å…³ç³»ã€‚ è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š sudo apt-get install libsvn1=1.8.8-1ubuntu3 ï¼Œ è¿™æ ·å¯ä»¥åˆ¶å®šlibsvnçš„ç‰ˆæœ¬å®‰è£…ï¼Œå®‰è£…æˆåŠŸåï¼Œ åœ¨è¿è¡Œsudo apt-get install subversion å°±å¯ä»¥å®‰è£…äº†ã€‚ å…¶ä»–é‡åˆ°ç±»ä¼¼é—®é¢˜çš„åŒå­¦ä»¬å¯ä»¥è¯•ä¸€ä¸‹ï¼š æ ¹æ®æŠ¥é”™çš„ä¿¡æ¯ â€œsubversion : ä¾èµ–: libsvn1 (= 1.8.8-1ubuntu3) ä½†æ˜¯ 1.8.8-1ubuntu3.1 æ­£è¦è¢«å®‰è£…â€ é‚£ä¹ˆåªéœ€è¦sudo apt-get install xxx=yyy (xxxä¸ºæç¤ºä¿¡æ¯çš„libsvn1ï¼Œ yyyä¸ºæç¤ºé”™è¯¯çš„1.8.8-1ubuntu3) åŸæ–‡ï¼šhttp://blog.csdn.net/smallmao/article/details/45626555","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"Linuxä¸‹PHPæºç ç¼–è¯‘å®‰è£…","date":"2015-11-30T06:24:25.000Z","path":"2015/11/30/Linuxä¸‹PHPæºç ç¼–è¯‘å®‰è£…/","text":"è¦ç”¨swooleï¼Œé¦–å…ˆéœ€è¦æœ‰PHPç¯å¢ƒã€‚ç”±äºswooleçš„æŸäº›ç‰¹æ€§ï¼Œæœ€å¥½æ˜¯èƒ½å¤Ÿä»æºç ç¼–è¯‘å®‰è£…PHPï¼Œè¿™æ ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¯ä»¥é¿å…å¾ˆå¤šä¸å¿…è¦çš„é”™è¯¯ã€‚PHPä¸‹è½½åœ°å€ï¼šPHPå®˜ç½‘åœ¨è¿™é‡ŒæŒ‘é€‰ä½ æƒ³ç”¨çš„ç‰ˆæœ¬å³å¯ã€‚ä¸‹è½½æºç åŒ…åï¼Œè§£å‹è‡³æœ¬åœ°ä»»æ„ç›®å½•ï¼ˆä¿è¯è¯»å†™æƒé™ï¼‰ï¼Œç•™å¾…ä½¿ç”¨ã€‚å®‰è£…PHPå‰ï¼Œéœ€è¦å®‰è£…ç¼–è¯‘ç¯å¢ƒå’ŒPHPçš„ç›¸å…³ä¾èµ–ã€‚ä¸‹é¢æ˜¯ç›¸å…³å‘½ä»¤ï¼šUbuntuç¯å¢ƒä¸‹ï¼šsudo apt-get install build-essential gcc g++ autoconf libiconv-hook-dev libmcrypt-dev libxml2-dev libmysqlclient-dev libcurl4-openssl-dev libjpeg8-dev libpng12-dev libfreetype6-devCentOSç¯å¢ƒä¸‹ï¼šyum -y install gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel nss_ldap openldap-clients openldap-servers gd gd2 gd-devel gd2-devel perl-CPAN pcre-develï¼ˆæ³¨ï¼šä»¥ä¸Šå‘½ä»¤æ˜¯æˆ‘åœ¨å®é™…ä½¿ç”¨ä¸­éªŒè¯è¿‡çš„å¯ä»¥ä½¿ç”¨çš„ï¼Œå¯èƒ½ä¼šå’Œå…¶ä»–æ•™ç¨‹æä¾›çš„å‘½ä»¤ä¸åŒï¼‰å½“ä¸Šè¿°å‘½ä»¤æ‰§è¡Œåï¼Œå³å¯å¼€å§‹å®‰è£…PHPã€‚å‘½ä»¤å¦‚ä¸‹ï¼š cd php-5.5.10/ ./configure --prefix=/usr/local/php --with-config-file-path=/etc/php --enable-fpm --enable-pcntl --enable-mysqlnd --enable-opcache --enable-sockets --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-shmop --enable-zip --enable-ftp --enable-soap --enable-xml --enable-mbstring --disable-rpath --disable-debug --disable-fileinfo --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-pcre-regex --with-iconv --with-zlib --with-mcrypt --with-gd --with-openssl --with-mhash --with-xmlrpc --with-curl --with-imap-ssl sudo make sudo make install sudo cp php.ini-development /etc/php/ è‡³æ­¤ï¼ŒPHPå·²ç»æˆåŠŸå®‰è£…ï¼Œä½†æ˜¯æ­¤æ—¶åœ¨ç»ˆç«¯é‡Œæ˜¯æ— æ³•ç›´æ¥é€šè¿‡php â€“versionæŸ¥çœ‹phpç‰ˆæœ¬çš„è¿˜éœ€è¦å°†PHPçš„å¯æ‰§è¡Œç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚ä½¿ç”¨Vim/Sublimeæ‰“å¼€~/.bashrcï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š export PATH=/usr/local/php/bin:$PATH export PATH=/usr/local/php/sbin:$PATH ä¿å­˜åï¼Œç»ˆç«¯è¾“å…¥å‘½ä»¤ï¼š source ~/.bashrc æ­¤æ—¶å³å¯é€šè¿‡php â€“versionæŸ¥çœ‹phpç‰ˆæœ¬ï¼Œçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š PHP 5.5.10 (cli) (built: Apr 26 2014 09:46:14)Copyright (c) 1997-2014 The PHP GroupZend Engine v2.5.0, Copyright (c) 1998-2014 Zend Technologieså³è¯´æ˜å®‰è£…æˆåŠŸã€‚ memcachedæ‰©å±•ï¼š wget https://launchpad.net/libmemcached/1.0/1.0.18/+download/libmemcached-1.0.18.tar.gz tar -zxvf libmemcached-1.0.18.tar.gz ./configure make &amp;&amp; make install wget http://pecl.php.net/get/memcached-2.2.0.tgz tar -zxvf memcached-2.2.0.tgz phpize ./configure make &amp;&amp; make install vi /etc/php/php.ini extension = memcached.so redisæ‰©å±•ï¼š https://github.com/phpredis/phpredis.git cd phpredis/ /usr/local/php/bin/phpize ./configure --with-php-config=/usr/local/php/bin/php-config make &amp;&amp; make install vi /etc/php/php.ini extension=redis.so mongoæ‰©å±•ï¼š wget http://pecl.php.net/get/mongo-1.5.8.tgz tar -zxvf mongo-1.5.8.tgz /usr/local/php/bin/phpize ./configure --with-php-config=/usr/local/php/bin/php-config make make install vi /etc/php/php.ini extension=mongo.so","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"PHPåˆ†ç¦»curl headerå’Œbody","date":"2015-11-28T07:24:25.000Z","path":"2015/11/28/PHPåˆ†ç¦»curl headerå’Œbody/","text":"$header = array ( \"Content-Type:application/json;encoding=utf-8\" ); $ch = curl_init (); curl_setopt ( $ch, CURLOPT_URL, $uri ); curl_setopt ( $ch, CURLOPT_POST, 1 ); curl_setopt ( $ch, CURLOPT_HEADER, $header ); curl_setopt ( $ch, CURLOPT_RETURNTRANSFER, 1 ); curl_setopt ( $ch, CURLOPT_POSTFIELDS, $data ); $response = curl_exec ( $ch ); $http_status = curl_getinfo ( $ch, CURLINFO_HTTP_CODE ); curl_close ( $ch ); print_r($response); è¿”å›ç»“æœå¦‚ä¸‹ HTTP/1.1 200 OK Content-Type: application/json;encoding=utf-8 Access-Control-Allow-Origin: * Set-Cookie: key1=value1 Set-Cookie: key2=value2 {â€œheaderâ€:{â€œhandler_idâ€:3001,â€command_idâ€:3004,â€terminalâ€:1001,â€versionâ€:0,â€reservedâ€:0},â€dataâ€:{â€œservice_typesâ€:[{â€œnameâ€:â€Aå·ï¼šæ”¶æ¬¾ã€é€€è´¹ã€ç§‘ç ”ç»è´¹å…¥è´¦â€,â€idâ€:1,â€countâ€:0},{â€œnameâ€:â€Bå·ï¼šè¯·æ¬¾ã€å†…éƒ¨è½¬è´¦ã€å‡ºå›½ä¸šåŠ¡å’¨è¯¢åŠæŠ¥é”€â€,â€idâ€:2,â€countâ€:0},{â€œnameâ€:â€Cå·ï¼šæŠ¥é”€ï¼ˆå«åŠ³åŠ¡æ”¶å…¥é…¬é‡‘æŠ¥é”€ï¼‰â€,â€idâ€:3,â€countâ€:0},{â€œnameâ€:â€Då·ï¼šé›¶ä½™é¢ä¼˜å…ˆæŠ¥è´¦â€,â€idâ€:4,â€countâ€:0}],â€codeâ€:1,â€msgCodeâ€:23000,â€msgâ€:â€è·å¾—æ’é˜Ÿä¸šåŠ¡æ¸…å•è¯·æ±‚æˆåŠŸâ€}} è¦è·å–åˆ†ç¦»bodyå’Œheaderçš„æ•°æ®å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š if (curl_getinfo($ch, CURLINFO_HTTP_CODE) == '200') {//åˆ¤æ–­æ˜¯å¦æˆåŠŸè·å–æ•°æ® $headerSize = curl_getinfo($ch, CURLINFO_HEADER_SIZE); $header = substr($response, 0, $headerSize); $body = substr($response, $headerSize); } æˆ–è€…ï¼ˆä¸ªäººæ¯”è¾ƒåå¥½ç¬¬äºŒç§ï¼‰ if (curl_getinfo($ch, CURLINFO_HTTP_CODE) == '200') {//åˆ¤æ–­æ˜¯å¦æˆåŠŸè·å–æ•°æ® list($header, $body) = explode(\"\\r\\n\\r\\n\", response, 2); } å¤„ç†ç»“æœå¦‚ä¸‹ï¼ˆbodyéƒ¨åˆ†ï¼‰ï¼š { â€œheaderâ€: { â€œhandler_idâ€: 3001, â€œcommand_idâ€: 3004, â€œterminalâ€: 1001, â€œversionâ€: 0, â€œreservedâ€: 0 }, â€œdataâ€: { â€œservice_typesâ€: [ { â€œnameâ€: â€œAå·ï¼šæ”¶æ¬¾ã€é€€è´¹ã€ç§‘ç ”ç»è´¹å…¥è´¦â€, â€œidâ€: 1, â€œcountâ€: 0 }, { â€œnameâ€: â€œBå·ï¼šè¯·æ¬¾ã€å†…éƒ¨è½¬è´¦ã€å‡ºå›½ä¸šåŠ¡å’¨è¯¢åŠæŠ¥é”€â€, â€œidâ€: 2, â€œcountâ€: 0 }, { â€œnameâ€: â€œCå·ï¼šæŠ¥é”€ï¼ˆå«åŠ³åŠ¡æ”¶å…¥é…¬é‡‘æŠ¥é”€ï¼‰â€, â€œidâ€: 3, â€œcountâ€: 0 }, { â€œnameâ€: â€œDå·ï¼šé›¶ä½™é¢ä¼˜å…ˆæŠ¥è´¦â€, â€œidâ€: 4, â€œcountâ€: 0 } ], â€œcodeâ€: 1, â€œmsgCodeâ€: 23000, â€œmsgâ€: â€œè·å¾—æ’é˜Ÿä¸šåŠ¡æ¸…å•è¯·æ±‚æˆåŠŸâ€ }}","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"curl","slug":"curl","permalink":"https://github.com/kong36088/kong36088.github.io/tags/curl/"}]},{"title":"è®¡ç®—æœºç½‘ç»œâ€”â€”åº”ç”¨å±‚çš„åè®®æ€»ç»“","date":"2015-11-25T07:24:25.000Z","path":"2015/11/25/è®¡ç®—æœºç½‘ç»œâ€”â€”åº”ç”¨å±‚çš„åè®®æ€»ç»“/","text":"åè®®å¤§è‡´æœ‰ï¼šHTTPã€FTPã€DNSã€SMTPã€‚HTTP HTTPçš„å‘å±•æ˜¯ä¸‡ç»´ç½‘åä¼šï¼ˆWorld Wide Web Consortiumï¼‰å’ŒInternetå·¥ä½œå°ç»„ï¼ˆInternet Engineering Task Forceï¼‰åˆä½œçš„ç»“æœï¼Œï¼ˆä»–ä»¬ï¼‰æœ€ç»ˆå‘å¸ƒäº†ä¸€ç³»åˆ—çš„RFCï¼Œå…¶ä¸­æœ€è‘—åçš„å°±æ˜¯RFC 2616ã€‚RFC 2616å®šä¹‰äº†HTTPåè®®ä¸­ä¸€ä¸ªç°ä»Šè¢«å¹¿æ³›ä½¿ç”¨çš„ç‰ˆæœ¬â€”â€”HTTP 1.1ã€‚HTTPæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼ˆTCPï¼‰ã€‚å®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ç”¨æˆ·ï¼ŒæœåŠ¡å™¨ç«¯æ˜¯ç½‘ç«™ã€‚é€šè¿‡ä½¿ç”¨Webæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶å®ƒçš„å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ç«¯å£ä¸º80ï¼‰çš„HTTPè¯·æ±‚ã€‚ï¼ˆæˆ‘ä»¬ç§°è¿™ä¸ªå®¢æˆ·ç«¯ï¼‰è°ƒç”¨æˆ·ä»£ç†ï¼ˆuser agentï¼‰ã€‚åº”ç­”çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨ç€ï¼ˆä¸€äº›ï¼‰èµ„æºï¼Œæ¯”å¦‚HTMLæ–‡ä»¶å’Œå›¾åƒã€‚ï¼ˆæˆ‘ä»¬ç§°ï¼‰è¿™ä¸ªåº”ç­”æœåŠ¡å™¨ä¸ºæºæœåŠ¡å™¨ï¼ˆorigin serverï¼‰ã€‚åœ¨ç”¨æˆ·ä»£ç†å’ŒæºæœåŠ¡å™¨ä¸­é—´å¯èƒ½å­˜åœ¨å¤šä¸ªä¸­é—´å±‚ï¼Œæ¯”å¦‚ä»£ç†ï¼Œç½‘å…³ï¼Œæˆ–è€…éš§é“ï¼ˆtunnelï¼‰ã€‚å°½ç®¡TCP/IPåè®®æ˜¯äº’è”ç½‘ä¸Šæœ€æµè¡Œçš„åº”ç”¨ï¼ŒHTTPåè®®å¹¶æ²¡æœ‰è§„å®šå¿…é¡»ä½¿ç”¨å®ƒå’Œï¼ˆåŸºäºï¼‰å®ƒæ”¯æŒçš„å±‚ã€‚äº‹å®ä¸Šï¼ŒHTTPå¯ä»¥åœ¨ä»»ä½•å…¶ä»–äº’è”ç½‘åè®®ä¸Šï¼Œæˆ–è€…åœ¨å…¶ä»–ç½‘ç»œä¸Šå®ç°ã€‚HTTPåªå‡å®šï¼ˆå…¶ä¸‹å±‚åè®®æä¾›ï¼‰å¯é çš„ä¼ è¾“ï¼Œä»»ä½•èƒ½å¤Ÿæä¾›è¿™ç§ä¿è¯çš„åè®®éƒ½å¯ä»¥è¢«å…¶ä½¿ç”¨ã€‚é€šå¸¸ï¼Œç”±HTTPå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå»ºç«‹ä¸€ä¸ªåˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤æ˜¯80ç«¯å£ï¼‰çš„TCPè¿æ¥ã€‚HTTPæœåŠ¡å™¨åˆ™åœ¨é‚£ä¸ªç«¯å£ç›‘å¬å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨ï¼ˆå‘å®¢æˆ·ç«¯ï¼‰å‘å›ä¸€ä¸ªçŠ¶æ€è¡Œï¼Œæ¯”å¦‚â€HTTP/1.1 200 OKâ€ï¼Œå’Œï¼ˆå“åº”çš„ï¼‰æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„æ¶ˆæ¯ä½“å¯èƒ½æ˜¯è¯·æ±‚çš„æ–‡ä»¶ã€é”™è¯¯æ¶ˆæ¯ã€æˆ–è€…å…¶å®ƒä¸€äº›ä¿¡æ¯ã€‚HTTPä½¿ç”¨TCPè€Œä¸æ˜¯UDPçš„åŸå› åœ¨äºï¼ˆæ‰“å¼€ä¸€ä¸ªï¼‰ä¸€ä¸ªç½‘é¡µå¿…é¡»ä¼ é€å¾ˆå¤šæ•°æ®ï¼Œè€ŒTCPåè®®æä¾›ä¼ è¾“æ§åˆ¶ï¼ŒæŒ‰é¡ºåºç»„ç»‡æ•°æ®ï¼Œå’Œé”™è¯¯çº æ­£ã€‚å…·ä½“ç»†èŠ‚è¯·å‚è€ƒâ€˜TCPå’ŒUDPçš„ä¸åŒâ€™ã€‚é€šè¿‡HTTPæˆ–è€…HTTPSåè®®è¯·æ±‚çš„èµ„æºç”±ç»Ÿä¸€èµ„æºå®šä½å™¨ï¼ˆUniform Resource Identifiersï¼Œæˆ–è€…ï¼Œæ›´å‡†ç¡®ä¸€äº›ï¼ŒURIï¼‰æ¥æ ‡è¯†ã€‚ FTP FTPæœåŠ¡ä¸€èˆ¬è¿è¡Œåœ¨20å’Œ21ä¸¤ä¸ªç«¯å£ã€‚ç«¯å£20ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®æµï¼Œè€Œç«¯å£21ç”¨äºä¼ è¾“æ§åˆ¶æµï¼Œå¹¶ä¸”æ˜¯å‘½ä»¤é€šå‘ftpæœåŠ¡å™¨çš„è¿›å£ã€‚å½“æ•°æ®é€šè¿‡æ•°æ®æµä¼ è¾“æ—¶ï¼Œæ§åˆ¶æµå¤„äºç©ºé—²çŠ¶æ€ã€‚è€Œå½“æ§åˆ¶æµï¼Œç©ºé—²å¾ˆé•¿æ—¶é—´åï¼Œå®¢æˆ·ç«¯çš„é˜²ç«å¢™ï¼Œä¼šå°†å…¶ä¼šè¯ç½®ä¸ºè¶…æ—¶ï¼Œè¿™æ ·å½“å¤§é‡æ•°æ®é€šè¿‡é˜²ç«å¢™æ—¶ï¼Œä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚æ­¤æ—¶ï¼Œè™½ç„¶æ–‡ä»¶å¯ä»¥æˆåŠŸçš„ä¼ è¾“ï¼Œä½†å› ä¸ºæ§åˆ¶ä¼šè¯ï¼Œä¼šè¢«é˜²ç«å¢™æ–­å¼€ï¼›ä¼ è¾“ä¼šäº§ç”Ÿä¸€äº›é”™è¯¯ã€‚FTPå®ç°çš„ç›®æ ‡ï¼šä¿ƒè¿›æ–‡ä»¶çš„å…±äº«ï¼ˆè®¡ç®—æœºç¨‹åºæˆ–æ•°æ®ï¼‰é¼“åŠ±é—´æ¥æˆ–è€…éšå¼çš„ä½¿ç”¨è¿œç¨‹è®¡ç®—æœºå‘ç”¨æˆ·å±è”½ä¸åŒä¸»æœºä¸­å„ç§æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼ˆFile systemï¼‰çš„ç»†èŠ‚å¯é å’Œé«˜æ•ˆçš„ä¼ è¾“æ•°æ®ç¼ºç‚¹ï¼šå¯†ç å’Œæ–‡ä»¶å†…å®¹éƒ½ä½¿ç”¨æ˜æ–‡ä¼ è¾“ï¼Œå¯èƒ½äº§ç”Ÿä¸å¸Œæœ›å‘ç”Ÿçš„çªƒå¬ã€‚å› ä¸ºå¿…é¡»å¼€æ”¾ä¸€ä¸ªéšæœºçš„ç«¯å£ä»¥å»ºç«‹è¿æ¥ï¼Œå½“é˜²ç«å¢™å­˜åœ¨æ—¶ï¼Œå®¢æˆ·ç«¯å¾ˆéš¾è¿‡æ»¤å¤„äºä¸»åŠ¨æ¨¡å¼ä¸‹çš„FTPæµé‡ã€‚è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä½¿ç”¨è¢«åŠ¨æ¨¡å¼çš„FTPï¼Œå¾—åˆ°äº†å¾ˆå¤§è§£å†³ã€‚æœåŠ¡å™¨å¯èƒ½ä¼šè¢«å‘ŠçŸ¥è¿æ¥ä¸€ä¸ªç¬¬ä¸‰æ–¹è®¡ç®—æœºçš„ä¿ç•™ç«¯å£ã€‚æ­¤æ–¹å¼åœ¨éœ€è¦ä¼ è¾“æ–‡ä»¶æ•°é‡å¾ˆå¤šçš„å°æ–‡ä»¶æ—¶ï¼Œæ•ˆèƒ½ä¸å¥½FTPè™½ç„¶å¯ä»¥è¢«ç»ˆç«¯ç”¨æˆ·ç›´æ¥ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒæ˜¯è®¾è®¡æˆè¢«FTPå®¢æˆ·ç«¯ç¨‹åºæ‰€æ§åˆ¶ã€‚è¿è¡ŒFTPæœåŠ¡çš„è®¸å¤šç«™ç‚¹éƒ½å¼€æ”¾åŒ¿åæœåŠ¡ï¼Œåœ¨è¿™ç§è®¾ç½®ä¸‹ï¼Œç”¨æˆ·ä¸éœ€è¦å¸å·å°±å¯ä»¥ç™»å½•æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ¿åç”¨æˆ·çš„ç”¨æˆ·åæ˜¯ï¼šâ€œanonymousâ€ã€‚è¿™ä¸ªå¸å·ä¸éœ€è¦å¯†ç ï¼Œè™½ç„¶é€šå¸¸è¦æ±‚è¾“å…¥ç”¨æˆ·çš„é‚®ä»¶åœ°å€ä½œä¸ºè®¤è¯å¯†ç ï¼Œä½†è¿™åªæ˜¯ä¸€äº›ç»†èŠ‚æˆ–è€…æ­¤é‚®ä»¶åœ°å€æ ¹æœ¬ä¸è¢«ç¡®å®šï¼Œè€Œæ˜¯ä¾èµ–äºFTPæœåŠ¡å™¨çš„é…ç½®æƒ…å†µã€‚åº”ç”¨å±‚åè®®ä¸ºåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æä¾›è§„åˆ™ï¼Œä¸ºç¡®ä¿é€šä¿¡ç•…é€šï¼Œæºä¸»æœºå’Œç›®çš„ä¸»æœºä¸Šæ‰€å®ç°çš„åº”ç”¨å±‚åè®®å¿…é¡»ä¸€è‡´ã€‚åº”ç”¨å±‚åè®®çš„åŠŸèƒ½ï¼šä¸ºé€šä¿¡åŒæ–¹å®šä¹‰è¿‡ç¨‹ï¼›å®šä¹‰æ¶ˆæ¯ç±»å‹ï¼›å®šä¹‰æ¶ˆæ¯çš„è¯­æ³•ï¼›å®šä¹‰ä»»ä½•ä¿¡æ¯æ€§å­—æ®µçš„å«ä¹‰ï¼›å®šä¹‰å‘é€æ¶ˆæ¯çš„æ–¹å¼å’Œé¢„æœŸçš„å“åº”ï¼›å®šä¹‰ä¸ä¸‹ä¸€å±‚ä¹‹é—´çš„äº¤äº’ã€‚ DNS æ¯ä¸ªIPåœ°å€éƒ½å¯ä»¥æœ‰ä¸€ä¸ªä¸»æœºåï¼Œä¸»æœºåç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ç»„æˆï¼Œå­—ç¬¦ä¸²ä¹‹é—´ç”¨å°æ•°ç‚¹éš”å¼€ã€‚æœ‰äº†ä¸»æœºåï¼Œå°±ä¸è¦æ­»è®°ç¡¬èƒŒæ¯å°IPè®¾å¤‡çš„IPåœ°å€ï¼Œåªè¦è®°ä½ç›¸å¯¹ç›´è§‚æœ‰æ„ä¹‰çš„ä¸»æœºåå°±è¡Œäº†ã€‚è¿™å°±æ˜¯DNSåè®®æ‰€è¦å®Œæˆçš„åŠŸèƒ½ã€‚ä¸»æœºååˆ°IPåœ°å€çš„æ˜ å°„æœ‰ä¸¤ç§æ–¹å¼ï¼š1ï¼‰é™æ€æ˜ å°„ï¼Œæ¯å°è®¾å¤‡ä¸Šéƒ½é…ç½®ä¸»æœºåˆ°IPåœ°å€çš„æ˜ å°„ï¼Œå„è®¾å¤‡ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„æ˜ å°„è¡¨ï¼Œè€Œä¸”åªä¾›æœ¬è®¾å¤‡ä½¿ç”¨ï¼›2ï¼‰åŠ¨æ€æ˜ å°„ï¼Œå»ºç«‹ä¸€å¥—åŸŸåè§£æç³»ç»Ÿï¼ˆDNSï¼‰ï¼Œåªåœ¨ä¸“é—¨çš„DNSæœåŠ¡å™¨ä¸Šé…ç½®ä¸»æœºåˆ°IPåœ°å€çš„æ˜ å°„ï¼Œç½‘ç»œä¸Šéœ€è¦ä½¿ç”¨ä¸»æœºåé€šä¿¡çš„è®¾å¤‡ï¼Œé¦–å…ˆéœ€è¦åˆ°DNSæœåŠ¡å™¨æŸ¥è¯¢ä¸»æœºæ‰€å¯¹åº”çš„IPåœ°å€ã€‚[1]é€šè¿‡ä¸»æœºåï¼Œæœ€ç»ˆå¾—åˆ°è¯¥ä¸»æœºåå¯¹åº”çš„IPåœ°å€çš„è¿‡ç¨‹å«åšåŸŸåè§£æï¼ˆæˆ–ä¸»æœºåè§£æï¼‰ã€‚åœ¨è§£æåŸŸåæ—¶ï¼Œå¯ä»¥é¦–å…ˆé‡‡ç”¨é™æ€åŸŸåè§£æçš„æ–¹æ³•ï¼Œå¦‚æœé™æ€åŸŸåè§£æä¸æˆåŠŸï¼Œå†é‡‡ç”¨åŠ¨æ€åŸŸåè§£æçš„æ–¹æ³•ã€‚å¯ä»¥å°†ä¸€äº›å¸¸ç”¨çš„åŸŸåæ”¾å…¥é™æ€åŸŸåè§£æè¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜åŸŸåè§£ææ•ˆç‡ã€‚ SMTP SMTPï¼ˆSimple Mail Transfer Protocolï¼‰å³ç®€å•é‚®ä»¶ä¼ è¾“åè®®,å®ƒæ˜¯ä¸€ç»„ç”¨äºç”±æºåœ°å€åˆ°ç›®çš„åœ°å€ä¼ é€é‚®ä»¶çš„è§„åˆ™ï¼Œç”±å®ƒæ¥æ§åˆ¶ä¿¡ä»¶çš„ä¸­è½¬æ–¹å¼ã€‚SMTPåè®®å±äºTCP/IPåè®®ç°‡ï¼Œå®ƒå¸®åŠ©æ¯å°è®¡ç®—æœºåœ¨å‘é€æˆ–ä¸­è½¬ä¿¡ä»¶æ—¶æ‰¾åˆ°ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚é€šè¿‡SMTPåè®®æ‰€æŒ‡å®šçš„æœåŠ¡å™¨,å°±å¯ä»¥æŠŠE-mailå¯„åˆ°æ”¶ä¿¡äººçš„æœåŠ¡å™¨ä¸Šäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹åªè¦å‡ åˆ†é’Ÿã€‚SMTPæœåŠ¡å™¨åˆ™æ˜¯éµå¾ªSMTPåè®®çš„å‘é€é‚®ä»¶æœåŠ¡å™¨ï¼Œç”¨æ¥å‘é€æˆ–ä¸­è½¬å‘å‡ºçš„ç”µå­é‚®ä»¶ã€‚å®ƒä½¿ç”¨ç”±TCPæä¾›çš„å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡æŠŠé‚®ä»¶æ¶ˆæ¯ä»å‘ä¿¡äººçš„é‚®ä»¶æœåŠ¡å™¨ä¼ é€åˆ°æ”¶ä¿¡äººçš„é‚®ä»¶æœåŠ¡å™¨ã€‚è·Ÿå¤§å¤šæ•°åº”ç”¨å±‚åè®®ä¸€æ ·ï¼ŒSMTPä¹Ÿå­˜åœ¨ä¸¤ä¸ª ç«¯ï¼šåœ¨å‘ä¿¡äººçš„é‚®ä»¶æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„å®¢æˆ·ç«¯å’Œåœ¨æ”¶ä¿¡äººçš„é‚®ä»¶æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„æœåŠ¡å™¨ç«¯ã€‚SMTPçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åŒæ—¶è¿è¡Œåœ¨æ¯ä¸ªé‚®ä»¶æœåŠ¡å™¨ä¸Šã€‚å½“ä¸€ä¸ªé‚®ä»¶æœ åŠ¡å™¨åœ¨å‘å…¶ä»–é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶æ¶ˆæ¯æ—¶ï¼Œå®ƒæ˜¯ä½œä¸ºSMTPå®¢æˆ·åœ¨è¿è¡Œã€‚SMTPåè®®ä¸äººä»¬ç”¨äºé¢å¯¹é¢äº¤äº’çš„ç¤¼ä»ªä¹‹é—´æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚é¦–å…ˆï¼Œè¿è¡Œåœ¨å‘é€ç«¯é‚®ä»¶æœåŠ¡å™¨ä¸»æœºä¸Šçš„SMTPå®¢æˆ·ï¼Œå‘èµ·å»ºç«‹ä¸€ä¸ªåˆ°è¿è¡Œåœ¨æ¥æ”¶ç«¯é‚®ä»¶æœåŠ¡ å™¨ä¸»æœºä¸Šçš„SMTPæœåŠ¡å™¨ç«¯å£å·25ä¹‹é—´çš„TCPè¿æ¥ã€‚å¦‚æœæ¥æ”¶é‚®ä»¶æœåŠ¡å™¨å½“å‰ä¸åœ¨å·¥ä½œï¼ŒSMTPå®¢æˆ·å°±ç­‰å¾…ä¸€æ®µæ—¶é—´åå†å°è¯•å»ºç«‹è¯¥è¿æ¥ã€‚SMTPå®¢æˆ·å’ŒæœåŠ¡å™¨å…ˆæ‰§è¡Œä¸€äº›åº”ç”¨å±‚æ¡æ‰‹æ“ä½œã€‚å°±åƒäººä»¬åœ¨è½¬æ‰‹ä¸œè¥¿ä¹‹å‰å¾€å¾€å…ˆè‡ªæˆ‘ä»‹ç»é‚£æ ·ï¼ŒSMTPå®¢æˆ·å’ŒæœåŠ¡å™¨ä¹Ÿåœ¨ä¼ é€ä¿¡æ¯ä¹‹å‰å…ˆè‡ªæˆ‘ä»‹ç»ä¸€ä¸‹ã€‚ åœ¨è¿™ä¸ªSMTPæ¡æ‰‹é˜¶æ®µï¼ŒSMTPå®¢æˆ·å‘æœåŠ¡å™¨åˆ†åˆ«æŒ‡å‡ºå‘ä¿¡äººå’Œæ”¶ä¿¡äººçš„ç”µå­é‚®ä»¶åœ°å€ã€‚å½¼æ­¤è‡ªæˆ‘ä»‹ç»å®Œæ¯•ä¹‹åï¼Œå®¢æˆ·å‘å‡ºé‚®ä»¶æ¶ˆæ¯ã€‚ å‚è€ƒè‡ªç™¾åº¦ç™¾ç§‘","tags":[{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è®¡ç®—æœºåŸºç¡€/"},{"name":"è®¡ç®—æœºç½‘ç»œ","slug":"è®¡ç®—æœºç½‘ç»œ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è®¡ç®—æœºç½‘ç»œ/"}]},{"title":"ubuntuå½»åº•å¸è½½è½¯ä»¶","date":"2015-11-22T07:24:25.000Z","path":"2015/11/22/ubuntuå½»åº•å¸è½½è½¯ä»¶/","text":"åœ¨ubuntuä¸­å®‰è£…è½¯ä»¶åé€šå¸¸æƒ³å¸è½½éƒ½ä¼šå¸è½½å¾—ä¸å¹²å‡€ï¼Œä»¥ä¸‹çŒ®ä¸ŠæŠŠè½¯ä»¶å®Œå…¨å¸è½½å¹²å‡€çš„æ–¹æ³•é¦–å…ˆæ‰¾åˆ°ä½ æƒ³å¸è½½çš„è½¯ä»¶ï¼šsoftwareï¼ˆè¿™ä¸ªæ˜¯ä½ æƒ³è¦å¸è½½çš„è½¯ä»¶çš„åç§°ï¼‰ç„¶åæ‰“å¼€teminalæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ sudo apt-get purge software purgeå‚æ•°ä¸ºå½»åº•åˆ é™¤æ–‡ä»¶,ç„¶åæ‰§è¡Œ sudo apt-get autoremove software sudo apt-get clean software dpkg -l |grep ^rc|awk '{print $2}' |sudo xargs dpkg -P software è¿™äº›å‘½ä»¤ä¹‹åå°±å¯ä»¥å½»åº•å¸è½½å¹²å‡€è½¯ä»¶äº†","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"javaçš„ä¸€ç™¾å¤šä¸ªç»ƒæ‰‹å°é¡¹ç›®","date":"2015-11-22T07:24:25.000Z","path":"2015/11/22/javaçš„ä¸€ç™¾å¤šä¸ªç»ƒæ‰‹å°é¡¹ç›®/","text":"æ–‡æœ¬æ“ä½œ é€†è½¬å­—ç¬¦ä¸²â€”â€”è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†å…¶é€†è½¬å¹¶è¾“å‡ºã€‚æ‹‰ä¸çŒªæ–‡å­—æ¸¸æˆâ€”â€”è¿™æ˜¯ä¸€ä¸ªè‹±è¯­è¯­è¨€æ¸¸æˆã€‚åŸºæœ¬è§„åˆ™æ˜¯å°†ä¸€ä¸ªè‹±è¯­å•è¯çš„ç¬¬ä¸€ä¸ªè¾…éŸ³éŸ³ç´ çš„å­—æ¯ç§»åŠ¨åˆ°è¯å°¾å¹¶ä¸”åŠ ä¸Šåç¼€-ayï¼ˆè­¬å¦‚â€œbananaâ€ä¼šå˜æˆâ€œanana-bayâ€ï¼‰ã€‚å¯ä»¥åœ¨ç»´åŸºç™¾ç§‘ä¸Šäº†è§£æ›´å¤šå†…å®¹ã€‚ç»Ÿè®¡å…ƒéŸ³å­—æ¯â€”â€”è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»Ÿè®¡å¤„å…¶ä¸­å…ƒéŸ³å­—æ¯çš„æ•°é‡ã€‚æ›´å¤æ‚ç‚¹çš„è¯ç»Ÿè®¡å‡ºæ¯ä¸ªå…ƒéŸ³å­—æ¯çš„æ•°é‡ã€‚åˆ¤æ–­æ˜¯å¦ä¸ºå›æ–‡â€”â€”åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦ä¸ºå›æ–‡ã€‚å›æ–‡æ˜¯æŒ‡æ­£åæ‹¼å†™å½¢å¼éƒ½æ˜¯ä¸€æ ·çš„è¯ï¼Œè­¬å¦‚â€œracecarâ€ã€‚ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­çš„å•è¯æ•°ç›®â€”â€”ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­å•è¯çš„æ•°ç›®ï¼Œæ›´å¤æ‚çš„è¯ä»ä¸€ä¸ªæ–‡æœ¬ä¸­è¯»å‡ºå­—ç¬¦ä¸²å¹¶ç”Ÿæˆå•è¯æ•°ç›®ç»Ÿè®¡ç»“æœã€‚æ–‡æœ¬ç¼–è¾‘å™¨â€”â€”è®°äº‹æœ¬ç±»å‹çš„åº”ç”¨ï¼Œå¯ä»¥æ‰“å¼€ã€ç¼–è¾‘ã€ä¿å­˜æ–‡æœ¬æ–‡æ¡£ã€‚å¯ä»¥å¢åŠ å•è¯é«˜äº®å’Œå…¶å®ƒçš„ä¸€äº›ç‰¹æ€§ã€‚RSSæºåˆ›å»ºå™¨â€”â€”å¯ä»¥ä»å…¶å®ƒæ¥æºè¯»å–æ–‡æœ¬å¹¶å°†å…¶ä»¥RSSæˆ–è€…Atomçš„æ ¼å¼å‘å¸ƒå‡ºå»ã€‚å®æ—¶è‚¡ä»·â€”â€”å¯ä»¥æŸ¥è¯¢è‚¡ç¥¨å½“å‰ä»·æ ¼ã€‚ç”¨æˆ·å¯ä»¥è®¾å®šæ•°æ®åˆ·æ–°é¢‘ç‡ï¼Œç¨‹åºä¼šç”¨ç»¿è‰²å’Œçº¢è‰²çš„ç®­å¤´è¡¨ç¤ºè‚¡ä»·èµ°åŠ¿ã€‚è®¿å®¢ç•™è¨€ç°¿/æ—¥å¿—â€”â€”å…è®¸äººä»¬æ·»åŠ è¯„è®ºæˆ–è€…æ—¥è®°ï¼Œå¯ä»¥è®¾ç½®å¼€å¯/å…³é—­è¯„è®ºï¼Œå¹¶ä¸”å¯ä»¥è®°å½•ä¸‹æ¯ä¸€æ¡ç›®çš„æ—¶é—´ã€‚ä¹Ÿå¯ä»¥åšæˆå–Šè¯å™¨ã€‚æ–°é—»å’Œæ¯”åˆ†æ’­æŠ¥å™¨â€”â€”ä¸€ä¸ªæ¡Œé¢åº”ç”¨ï¼Œå¯ä»¥ä»ç½‘ä¸Šæ”¶é›†æ–°é—»å’Œæ¯”èµ›åˆ†æ•°ï¼Œå°†ç»“æœåœ¨å±å¹•ä¸Šæ»šåŠ¨æ’­å‡ºã€‚å æ˜Ÿç½—ç›˜â€”â€”ç”¨å æ˜Ÿæœ¯æ¥é¢„æµ‹æ¯å¤©çš„è¿ç¨‹ã€‚å¯†ç çŸ­ä¿¡â€”â€”å¯ä»¥å°†æ•°æ®åŠ å¯†è§£å¯†ï¼Œå¹¶èƒ½å°†å…¶å‘é€ç»™æœ‹å‹ã€‚å¸®ä½ æŒ‘ç¤¼ç‰©â€”â€”è¾“å…¥ä¸€å †ä½ å¯èƒ½ä¼šé€çš„ç¤¼ç‰©ï¼Œå½“æœ‰äººè¿‡ç”Ÿæ—¥æ—¶ï¼Œè¯¥ç¨‹åºä¼šéšæœºé€‰æ‹©ä¸€æ ·ç¤¼ç‰©ã€‚ä¹Ÿå¯ä»¥åŠ ä¸Šä¸€ä¸ªé¢å¤–åŠŸèƒ½ï¼Œå¯ä»¥å‘ŠçŸ¥å“ªé‡Œå¯ä»¥å¼„åˆ°è¿™ä¸ªç¤¼ç‰©ã€‚HTMLç”Ÿæˆå™¨â€”â€”å°† TEXT æ–‡æ¡£è½¬æ¢æˆHTMLæ–‡ä»¶ï¼Œå¯¹åˆ¶ä½œç½‘é¡µHTMLæ–‡æ¡£å¾ˆæœ‰ç”¨ã€‚CD-Keyç”Ÿæˆå™¨â€”â€”åˆ©ç”¨æŸç§ç®—æ³•ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„keyã€‚è½¯ä»¶å¼€å‘è€…å¯ä»¥ç”¨å®ƒæ¥ä½œä¸ºè½¯ä»¶çš„æ¿€æ´»å™¨ã€‚æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢å·¥å…·â€”â€”ç”¨æˆ·å¯ä»¥è¾“å…¥ä¸€æ®µæ–‡æœ¬ï¼Œåœ¨å¦å¤–çš„æ§ä»¶é‡Œè¾“å…¥ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚è¿è¡Œä»¥åä¼šè¿”å›åŒ¹é…çš„å†…å®¹æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„é”™è¯¯ã€‚ ç½‘ç»œ FTPå·¥å…·â€”â€”ä¸è¿œç¨‹ç½‘ç»œæœåŠ¡å™¨äº¤äº’æ–‡ä»¶ã€‚åŸå­é’Ÿæ ¡æ—¶â€”â€”ä»ç½‘ä¸ŠåŒæ­¥åŸå­é’Ÿæ—¶é—´ã€‚å…¨ä¸–ç•Œæœ‰å¾ˆå¤šåŸå­é’Ÿï¼Œå¯ä»¥æŠŠå®ƒä»¬éƒ½åˆ—å‡ºæ¥ã€‚èŠå¤©åº”ç”¨ï¼ˆIRCæˆ–è€…MSNé£æ ¼çš„ï¼‰â€”â€”åƒIRCé‚£æ ·çš„èŠå¤©å®¤è½¯ä»¶æˆ–è€…MSNé‚£æ ·çš„å®æ—¶èŠå¤©è½¯ä»¶ã€‚æ›´å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œå¯ä»¥ä¸ºèŠå¤©åˆ¶å®šä¸€å¥—ä½ è‡ªå·±çš„ä¼ è¾“åè®®ã€‚è·å–å½“å‰å¤©æ°”â€”â€”è·å–æŸä¸ªåœ°åŒºå½“å‰çš„å¤©æ°”æƒ…å†µã€‚P2Pæ–‡ä»¶å…±äº«åº”ç”¨â€”â€”åƒLimeWireã€FrostWireã€Bearshareæˆ–è€…torrenté£æ ¼çš„åº”ç”¨ã€‚ç«¯å£æ‰«æå™¨â€”â€”è¾“å…¥æŸä¸ªipåœ°å€å’Œç«¯å£åŒºé—´ï¼Œç¨‹åºä¼šé€ä¸ªå°è¯•åŒºé—´å†…çš„ç«¯å£ï¼Œå¦‚æœèƒ½æˆåŠŸè¿æ¥çš„è¯å°±å°†è¯¥ç«¯å£æ ‡è®°ä¸ºopenã€‚é‚®ä»¶æ£€æŸ¥å·¥å…·ï¼ˆPOP3/IMAPï¼‰â€”â€”ç”¨æˆ·è¾“å…¥ä¸€äº›è´¦å·ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ã€ipã€åè®®ç±»å‹ï¼ˆPOP3æˆ–è€…IMAPï¼‰ï¼Œåº”ç”¨æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šæ£€æŸ¥ä¸‹è¯¥è´¦å·ä¸‹çš„é‚®ç®±ã€‚æ•°æ®åŒ…å—…æ¢å™¨â€”â€”ä¾¦æµ‹ç”µè„‘ä¸Šè¿›å‡ºçš„æ•°æ®åŒ…ï¼Œè·å–è¯¸å¦‚ç›®çš„åœ°å’Œå¤§å°ä¹‹ç±»çš„ä¿¡æ¯ã€‚IPæ³¨å†Œåœ°æŸ¥è¯¢â€”â€”è¾“å…¥ipåœ°å€ï¼ŒæŸ¥è¯¢è¯¥ipæ˜¯åœ¨å“ªæ³¨å†Œçš„ã€‚WhoisæŸ¥è¯¢å·¥å…·â€”â€”è¾“å…¥ä¸€ä¸ªipæˆ–è€…ä¸»æœºåœ°å€ï¼Œé€šè¿‡whoisæŸ¥è¯¢å¹¶å°†ç»“æœè¿”å›ã€‚é‚®ç¼–æŸ¥è¯¢â€”â€”è¾“å…¥é‚®ç¼–ï¼Œè¿”å›ä½¿ç”¨è¯¥é‚®ç¼–çš„åœ°åŒºåç§°ã€‚è¿œç¨‹ç™»å…¥â€”â€”è¿œç¨‹ç™»å…¥æ¡Œé¢ç±»å‹çš„åº”ç”¨ï¼Œå¯ä»¥æŸ¥çœ‹å’Œæ§åˆ¶è¿œç¨‹ç”µè„‘ï¼ˆå‡å¦‚ä½ å·²ç»è·å¾—æƒé™ï¼‰ã€‚å¯èƒ½éœ€è¦ä½ è‡ªå·±çš„ç½‘ç»œå’Œä¸¤å°ç”µè„‘æ¥è¿›è¡Œæµ‹è¯•ã€‚ç½‘ç«™å®šæ—¶æ£€æŸ¥å™¨â€”â€”æ¯éš”ä¸€æ®µæ—¶é—´æˆ–è€…åœ¨é¢„å®šçš„æ—¶é—´å°è¯•è¿æ¥æŸä¸ªç½‘ç«™æˆ–è€…æœåŠ¡å™¨ï¼Œæ¥æ£€æŸ¥å®ƒæ˜¯å¦å¯ä»¥è¿ä¸Šï¼Œå¦‚æœè¿ä¸ä¸Šäº†ä¼šé€šè¿‡é‚®ä»¶æˆ–è€…æ¡Œé¢é€šçŸ¥æ¥å‘ŠçŸ¥ä½ ã€‚å°å‹ç½‘é¡µæœåŠ¡å™¨â€”â€”ç®€æ˜“ç‰ˆçš„ç½‘é¡µæœåŠ¡å™¨ï¼Œå¯ä»¥å­˜æ”¾åŒ…å«Javascriptå’Œå…¶å®ƒå½¢å¼ä»£ç çš„HTMLæ–‡ä»¶ã€‚å¤æ‚ä¸€ç‚¹çš„è¯å¯ä»¥å°è¯•æµåª’ä½“è§†é¢‘ã€åˆ›å»ºä¸€ç§æœåŠ¡å™¨ç«¯è¯­è¨€æˆ–è€…å…¶å®ƒç±»å‹çš„æµåª’ä½“ã€‚ç½‘ç»œèœ˜è››â€”â€”ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨æ‰§è¡Œç½‘é¡µä¸Šå„ç§ä»»åŠ¡çš„ç¨‹åºï¼Œä»»åŠ¡åŒ…æ‹¬ç½‘ç«™æ£€æŸ¥ã€é¡µé¢æŠ“å–ã€æ•°æ®æ‘˜è¦ä»¥åŠç½‘ç»œé‚®åŠ¡ã€‚ ç±» äº§å“åº“å­˜ç®¡ç†â€”â€”åˆ›å»ºä¸€ä¸ªç®¡ç†äº§å“åº“å­˜çš„åº”ç”¨ã€‚å»ºç«‹ä¸€ä¸ªäº§å“ç±»ï¼ŒåŒ…å«ä»·æ ¼ã€idã€åº“å­˜æ•°é‡ã€‚ç„¶åå»ºç«‹ä¸€ä¸ªåº“å­˜ç±»ï¼Œè®°å½•å„ç§äº§å“å¹¶èƒ½è®¡ç®—åº“å­˜çš„æ€»ä»·å€¼ã€‚ç”µå½±å•†åº—â€”â€”ç®¡ç†å½•åƒå¸¦ç§Ÿå€Ÿï¼Œè®°å½•å€Ÿå‡ºæ—¶é—´ã€åˆ°æœŸæ—¶é—´ã€é€¾æœŸè´¹ç”¨ã€‚å¤æ‚ä¸€ç‚¹å¯ä»¥ç”Ÿæˆé€¾æœŸç”¨æˆ·çš„è´¦å·æŠ¥å‘Šã€‚èˆªç©º/é…’åº—é¢„è®¢ç³»ç»Ÿâ€”â€”åˆ›å»ºä¸€å¥—é¢„è®¢èˆªç­æˆ–é…’åº—çš„é¢„è®¢ç³»ç»Ÿã€‚ä¸åŒçš„èˆªç­åº§ä½å’Œé…’åº—æˆ¿é—´æ”¶è´¹ä¸ä¸€æ ·ã€‚è­¬å¦‚å¤´ç­‰èˆ±è¦æ¯”ç»æµèˆ±è´µã€‚å¸¦é˜æ¥¼çš„å¥—é—´è¦æ›´è´µäº›ã€‚è®°å½•ä¸‹ä½•æ—¶æœ‰ç©ºæˆ¿å¯ä¾›é¢„è®¢ã€‚å­¦ç”Ÿæˆç»©ç®¡ç†å™¨â€”â€”è®°å½•ä¸€ä¸ªç­çº§çš„å­¦ç”Ÿï¼ˆåˆ›å»ºä¸€ä¸ªStudentç±»ï¼Œè®°å½•ä»–ä»¬çš„åå­—ã€å¹³å‡åˆ†å’Œè€ƒè¯•åˆ†æ•°ï¼‰å’Œä»–ä»¬çš„æˆç»©ç­‰çº§ã€‚æ ¹æ®å­¦ç”Ÿçš„æµ‹éªŒå’Œä½œä¸šçš„åˆ†æ•°è®¡ç®—å‡ºå¹³å‡åˆ†å’Œæˆç»©ç­‰çº§ã€‚å¤æ‚ä¸€ç‚¹å¯ä»¥å°†æ•°æ®ç”»åœ¨è´å°”æ›²çº¿ä¸Šã€‚é“¶è¡Œè´¦æˆ·ç®¡å®¶â€”â€”åˆ›å»ºä¸€ä¸ªåä¸ºâ€œAccountâ€çš„æŠ½è±¡ç±»ï¼Œæœ‰ä¸‰ä¸ªä¸ºâ€œCheckingAccountâ€ã€â€œSavingsAccountâ€å’Œâ€œBusinessAccountâ€çš„å­ç±»ã€‚é€šè¿‡ç±»ä¼¼ATMçš„ç¨‹åºæ¥ç®¡ç†è¿™äº›è´¦æˆ·çš„å€Ÿè´·ã€‚é¦†è—ç›®å½•â€”â€”åˆ›å»ºä¸€ä¸ªå›¾ä¹¦ç±»ï¼Œè®°å½•ä¹¦åã€é¡µæ•°ã€å›½é™…æ ‡å‡†ä¹¦å·ã€æ˜¯å¦å€Ÿå‡ºã€‚ç”¨å®ƒæ¥ç®¡ç†å„ç§ä¹¦ç±ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œå€Ÿå‡ºå’Œå½’è¿˜æ“ä½œã€‚å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œå¯ä»¥ç”Ÿæˆé€¾æœŸå›¾ä¹¦å’Œé€¾æœŸè´¹ç”¨çš„æŠ¥å‘Šã€‚ä¹Ÿå¯ä»¥è®©ç”¨æˆ·è¿›è¡Œé¢„çº¦æ“ä½œã€‚ çº¿ç¨‹å¤„ç† ä¸‹è½½è¿›åº¦æ¡â€”â€”åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºä¸‹è½½è¿›åº¦çš„è¿›åº¦æ¡ã€‚è¿›åº¦æ¡ç”±ç‹¬ç«‹çš„çº¿ç¨‹æ“ä½œï¼Œé€šè¿‡å§”æ‰˜æ¥å’Œä¸»çº¿ç¨‹è¿›è¡Œé€šè®¯ã€‚ä¸‹è½½ç®¡ç†å™¨â€”â€”å…è®¸ç¨‹åºåŒæ—¶ä¸‹è½½æ•°ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªéƒ½ç”¨å•ç‹¬çš„çº¿ç¨‹è¿›è¡ŒèƒŒæ™¯ä¸‹è½½ã€‚ä¸»çº¿ç¨‹ä¼šå…³æ³¨ä¸‹è½½è¿›åº¦å¹¶ä¸”åœ¨ä¸‹è½½å®Œæˆæ—¶é€šçŸ¥ç”¨æˆ·ã€‚èŠå¤©è½¯ä»¶ï¼ˆè¿œç¨‹èŠå¤©ï¼‰â€”â€”åšä¸€ä¸ªèŠå¤©è½¯ä»¶ï¼Œå…è®¸ä½ é€šè¿‡ipç›´æ¥è¿æ¥åˆ°å¦ä¸€å°ç”µè„‘ï¼Œä¹Ÿå…è®¸ä½ çš„â€œæœåŠ¡å™¨â€ç¨‹åºå¤„ç†å¤šä¸ªè¯·æ±‚è¿æ¥ã€‚æ‰¹é‡ç¼©ç•¥å›¾ç”Ÿæˆå™¨â€”â€”åœ¨è¿›è¡Œå›¾ç‰‡è½¬æ¢çš„å¤„ç†æ—¶ä¼šéœ€è¦å¾ˆå¤šæ—¶é—´ï¼Œå°¤å…¶æ˜¯å›¾ç‰‡å¾ˆå¤§æ—¶ã€‚åšä¸€ä¸ªå›¾ç‰‡å¤„ç†ç¨‹åºï¼Œèƒ½è®©ä½ åœ¨åšå…¶å®ƒäº‹çš„æ—¶å€™åœ¨åå°çº¿ç¨‹é‡Œå°†æ•°ç™¾å¼ å›¾ç‰‡è½¬æ¢æˆæŸä¸ªå¤§å°çš„å›¾ç‰‡ã€‚å¤æ‚ä¸€ç‚¹çš„è¯å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥ç¼©æ”¾ï¼Œç”¨å¦ä¸€ä¸ªçº¿ç¨‹æ¥ä¸ºç¼©ç•¥å›¾é‡å‘½åã€‚ Webåº”ç”¨ æ‰€è§å³æ‰€å¾—ç¼–è¾‘å™¨â€”â€”åˆ›å»ºä¸€ä¸ªåœ¨çº¿ç¼–è¾‘å™¨ï¼Œå…è®¸ç”¨æˆ·ç§»åŠ¨å…ƒç´ ã€åˆ›å»ºè¡¨æ ¼ã€ä¹¦å†™æ–‡æœ¬ã€è®¾ç½®é¢œè‰²ï¼Œè€Œç”¨æˆ·ä¸å¿…æ‡‚HTMLã€‚å°±åƒDreamweaveræˆ–è€…FrontPageã€‚å¦‚æœéœ€è¦ä¾‹å­çš„è¯ï¼Œå¯ä»¥å‚çœ‹DICã€‚åˆ†é¡µæµè§ˆå™¨â€”â€”åˆ›å»ºä¸€ä¸ªå¯ä»¥åˆ†é¡µçš„å°å‹ç½‘é¡µæµè§ˆå™¨ï¼Œå¯ä»¥åŒæ—¶æµè§ˆå‡ ä¸ªç½‘é¡µã€‚ç®€åŒ–ä¸€ç‚¹çš„è¯ä¸è¦è€ƒè™‘Javascriptæˆ–è€…å…¶å®ƒå®¢æˆ·ç«¯ä»£ç ã€‚æ–‡ä»¶ä¸‹è½½å™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥ä»ç½‘é¡µä¸Šä¸‹è½½å„ç§èµ„æºï¼ŒåŒ…æ‹¬è§†é¢‘å’Œå…¶å®ƒæ–‡ä»¶ã€‚ç”¨äºæœ‰å¾ˆå¤šä¸‹è½½é“¾æ¥çš„ç½‘é¡µã€‚è¿œç¨‹ç™»å½•â€”â€”åˆ›å»ºä¸€ä¸ªè¿œç¨‹ç™»å½•çš„åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œç™»å½•æœåŠ¡å™¨å¹¶èƒ½æ‰§è¡Œä¸€äº›åŸºæœ¬å‘½ä»¤ã€‚åœ¨çº¿ç™½æ¿â€”â€”åšä¸€ä¸ªåœ¨çº¿ç™½æ¿ç¨‹åºï¼Œä½ å’Œæœ‹å‹ä»¬å¯ä»¥ä¸€èµ·åœ¨ç™½æ¿ä¸Šè¿›è¡Œä¸€äº›æ“ä½œï¼Œç”»å›¾ã€å†™å­—ç­‰ç­‰ã€‚å¸¦å®½ç›‘è§†å™¨â€”â€”è¿™ä¸ªå°å·¥å…·å¯ä»¥è®°å½•ä½ å·²ç»åœ¨ç½‘ä¸Šä¸Šä¼ å’Œä¸‹è½½å¤šå°‘æ•°æ®æµé‡äº†ã€‚å¯ä»¥è¯•ç€åšä»½æŠ¥å‘Šæˆ–è€…å›¾è¡¨æ¥å±•ç¤ºå„æ—¶æ®µçš„ä½¿ç”¨æƒ…å†µã€‚ä¹¦ç­¾æœé›†ç®¡ç†å™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥è®©ç”¨æˆ·ä¸Šä¼ ä¹¦ç­¾å¹¶å°†å®ƒä»¬æ’åºï¼Œå»æ‰é‡å¤çš„ï¼Œå¹¶èƒ½ç”Ÿæˆä¹¦ç­¾æ–‡ä»¶ä»¥ä¾›Firefox/IE/Safariç­‰ä½¿ç”¨ã€‚å¤æ‚ä¸€ç‚¹çš„è¯å¯ä»¥è¯•ç€å°†ä¹¦ç­¾æ•´ç†è¿›ä¸åŒçš„æ–‡ä»¶å¤¹ã€‚å¯†ç ä¿é™©ç®±â€”â€”ç”¨æ¥è®°å½•å„ç§å¯†ç ï¼Œå¹¶ä¸”å°†å®ƒä»¬åŠ å¯†ï¼Œè¿™æ ·åˆ«äººå°±çœ‹ä¸åˆ°äº†ã€‚iGoogleåª’ä½“æ’­æ”¾å™¨å°éƒ¨ä»¶â€”â€”åšä¸€ä¸ªiGoogleå°éƒ¨ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ’­æ”¾æœ¬åœ°éŸ³ä¹åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ¯å¤©åˆ†äº«ä¸€é¦–æ­Œã€‚ä¹Ÿè®¸è¿˜å¯ä»¥è®©åˆ«äººçœ‹åˆ°ä½ æœ€è¿‘å¬äº†äº›ä»€ä¹ˆæ­Œã€‚åŸºäºæ–‡æœ¬çš„æ¸¸æˆâ€”â€”åšä¸€ä¸ªåƒUtopiaé‚£æ ·çš„æ–‡æœ¬RPGï¼Œæ¸¸æˆä¸­ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–‡æ˜ã€æ”¶é›†èµ„æºã€å…±é“¸è”ç›Ÿã€æ–½æ”¾æ³•æœ¯ã€å›åˆåˆ¶ç³»ç»Ÿã€‚çœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿç»Ÿä¸€ç‹å›½ã€‚å®šæ—¶è‡ªåŠ¨ç™»å½•â€”â€”åšä¸€ä¸ªç¨‹åºå¯ä»¥åœ¨é¢„å®šçš„æ—¶é—´ç™»å½•è¿›æŸä¸ªæŒ‡å®šçš„ç½‘é¡µå¹¶ä¸”æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œï¼Œç„¶ååœ¨ç™»å‡ºã€‚å¯ä»¥ç”¨æ¥æ£€æŸ¥é‚®ç®±ã€å‘å¸ƒå¸¸è§„å†…å®¹ã€ä¸ºå…¶å®ƒç¨‹åºè·å–ä¿¡æ¯ã€‚ç”µå­å¡ç‰‡ç”Ÿæˆå™¨â€”â€”å¯ä»¥è®©ç”¨æˆ·åˆ¶ä½œè‡ªå·±çš„ç”µå­å¡ç‰‡å¹¶å‘é€ç»™å…¶ä»–äººã€‚å¯ä»¥ä½¿ç”¨flashä¹Ÿå¯ä»¥ä¸ç”¨ã€‚å¯ä»¥ä½¿ç”¨å›¾ç‰‡åº“ï¼Œä¹Ÿå¯ä»¥åŠ ä¸Šæ·±åˆ»çš„æ ¼è¨€è­¦å¥ã€‚å†…å®¹ç®¡ç†ç³»ç»Ÿâ€”â€”åƒJoomalaã€Drupalã€PHP Nukeè¿™æ ·çš„å†…å®¹ç®¡ç†ç³»ç»Ÿã€‚ä»ç®€å•çš„åšèµ·ï¼Œæ…¢æ…¢å¢åŠ å…¶å®ƒåŠŸèƒ½ã€‚æ¨¡æ¿åˆ¶ä½œå™¨â€”â€”è¯¥ç½‘ç«™åº”ç”¨å…è®¸ç”¨æˆ·è¾“å…¥å„ç§é¢œè‰²ä»£ç ã€å…ƒç´ ã€å°ºå¯¸ï¼Œæ¥ä¸ºPHPBBã€Invision Boardã€MySpaceä¹‹ç±»çš„åº”ç”¨åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ã€‚éªŒè¯ç ç”Ÿæˆå™¨â€”â€”åº”è¯¥åœ¨ç™»å½•æ—¶è§è¿‡æœ‰æ•°å­—æœ‰å­—æ¯çš„éªŒè¯ç å›¾ç‰‡å§ï¼Ÿè¿™å¯ä»¥é˜²æ­¢è‡ªåŠ¨ç™»å½•å’Œåƒåœ¾å¹¿å‘Šã€‚è¯•ç€è‡ªå·±åšä¸€ä¸ªï¼Œå¦‚æœä½¿ç”¨PHPçš„è¯ï¼Œçœ‹ä¸‹GDçš„å›¾ç‰‡å‡½æ•°ã€‚ æ–‡ä»¶ è¯•å·ç”Ÿæˆå™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥ä»æ–‡ä»¶ä¸­éšæœºæŒ‘é€‰å‡ºä¸åŒçš„é¢˜ç›®ç”Ÿæˆä¸€ä»½è¯•å·ã€‚æ¯ä»½è¯•å·å¯ä»¥ä¸ä¸€æ ·ï¼Œé€šè¿‡è¯»å–ç­”æ¡ˆæ¥ç»™æ‰“åˆ†ã€‚å¿«é€Ÿå¯åŠ¨â€”â€”è¯¥å·¥å…·å¯ä»¥æ·»åŠ å„ä¸ªç¨‹åºçš„å°å›¾æ ‡ï¼Œç‚¹å‡»å°å›¾æ ‡å°±å¯ä»¥è¿è¡Œç¨‹åºã€‚å’ŒWindowsçš„å¿«é€Ÿå¯åŠ¨ç±»ä¼¼ã€‚æ–‡ä»¶ç®¡ç†å™¨â€”â€”åšä¸€ä¸ªæ–‡ä»¶ç®¡ç†å™¨ï¼Œè¦åŠ äº›æ–°ç‰¹æ€§ï¼Œæ›´ä½³çš„æœç´¢åŠŸèƒ½ã€æ–°å›¾æ ‡ã€æ–°å¤–è§‚ã€‚æ–‡ä»¶è®°å½•æ’åºå·¥å…·â€”â€”ä»æ–‡ä»¶ä¸­è¯»å–è®°å½•ï¼Œå°†å…¶æ’åºå¹¶å†™å›æ–‡ä»¶ä¸­ã€‚å…è®¸ç”¨æˆ·é€‰æ‹©æ’åºé£æ ¼ä»¥åŠæ’åºå…³é”®å­—ã€‚ç”Ÿæˆè´¢åŠ¡äº¤æ˜“æ–‡ä»¶å¹¶ä¸”ç®—å‡ºå¹³å‡å€¼â€”â€”å°†è´¢åŠ¡äº¤æ˜“è¯»è¿›æ–‡ä»¶ï¼ŒæŒ‰ç…§è´¦æˆ·åˆ†ç±»ã€ç®—å‡ºå„é¡¹ç›®çš„æ€»é‡æˆ–å¹³å‡å€¼ã€ç†æ¸…å„è´¦æˆ·çš„å€Ÿè´·æ•°æ®ã€‚Zipæ–‡ä»¶ç”Ÿæˆå™¨â€”â€”ç”¨æˆ·è¾“å…¥ä¸åŒæ–‡ä»¶å¤¹çš„æ–‡ä»¶ï¼Œä¹Ÿè®¸è¿˜åŒ…æ‹¬å…¶ä»–ç”µè„‘ä¸­çš„æ–‡ä»¶ï¼Œç„¶åç¨‹åºå°†è¿™äº›æ–‡ä»¶æ‰“åŒ…æˆzipæ–‡ä»¶ã€‚å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œæ‰“åŒ…æ—¶å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚PDFç”Ÿæˆå™¨â€”â€”ä»txtã€htmlæˆ–å…¶å®ƒæ–‡ä»¶ä¸­è¯»å–æ•°æ®ç”ŸæˆPDFæ–‡ä»¶ã€‚å¯ä»¥åšæˆä¸€ä¸ªç½‘é¡µæœåŠ¡ï¼Œç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªpdfç‰ˆæœ¬ã€‚æ‰¹é‡æ–‡ä»¶å‘½åå™¨â€”â€”ç¨‹åºæ‰¹é‡å¤„ç†ä¸€äº›æ–‡ä»¶ï¼Œå°†æ ¹æ®ç”¨æˆ·æä¾›çš„è¿‡æ»¤å™¨ä¸ºå®ƒä»¬é‡å‘½åã€‚è­¬å¦‚ç”¨æˆ·è¾“å…¥çš„è¿‡æ»¤å™¨ä¸ºmyimage###.jpgï¼Œé‚£ä¹ˆä¼šç”Ÿæˆè‡³å°‘åŒ…å«3ä½æ•°çš„æ–‡ä»¶åï¼Œè­¬å¦‚myimage001.jpgã€myimage145.jpgï¼Œç”šè‡³æ˜¯myimage1987.jpgï¼Œå› ä¸º1987ä¹Ÿæ»¡è¶³äº†è‡³å°‘åŒ…å«3ä½æ•°çš„æ¡ä»¶ã€‚MP3æ ‡ç­¾ç”Ÿæˆå™¨â€”â€”ä¿®æ”¹MP3æ–‡ä»¶çš„id3v1æ ‡ç­¾ã€‚è¿˜å¯ä»¥è¯•ç€åœ¨MP3æ–‡ä»¶çš„å¤´éƒ¨åŠ å…¥id3v2çš„æ ‡ç­¾ï¼Œè­¬å¦‚album artæ ‡ç­¾ã€‚æ—¥å¿—æ–‡ä»¶ç”Ÿæˆå™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥è®°å½•æŒ‡å®šäº‹ä»¶çš„æ—¥å¿—ã€‚è­¬å¦‚ç¨‹åºåšäº†ä»€ä¹ˆã€ç³»ç»Ÿåœ¨å¹²ä»€ä¹ˆã€æ–‡ä»¶ä»€ä¹ˆæ—¶å€™è¢«ä¿®æ”¹äº†ã€‚Excelåˆ†é¡µè¾“å‡ºå™¨â€”â€”åšä¸€ä¸ªåœ¨çº¿ç¨‹åºï¼Œå¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹ç”Ÿæˆä¸€ä¸ªexcelåˆ†é¡µã€‚å¯ä»¥é€šè¿‡CVSæˆ–è€…å…¶å®ƒæ–‡ä»¶æ ¼å¼æ¥åšã€‚å¤æ‚ä¸€ç‚¹çš„è¯çœ‹çœ‹æ˜¯å¦èƒ½åˆ›å»ºå…¬å¼å­—æ®µã€‚RPGè§’è‰²å±æ€§ç”Ÿæˆå™¨â€”â€”åšä¸€ä¸ªç¨‹åºæ¥ç»™RPGè§’è‰²éšæœºåˆ†é…å±æ€§ç‚¹æ•°ï¼Œå¯ä»¥ç”±ç”¨æˆ·åˆ¶å®šä¸€äº›åˆ†é…è§„åˆ™ã€‚å¯ä»¥ç”ŸæˆèŒä¸šã€æ€§åˆ«ã€åŠ›é‡/é­”æ³•/æ•æ·ç‚¹æ•°ã€é¢å¤–èƒ½åŠ›æˆ–è€…è´¸æ˜“æŠ€èƒ½ã€‚æŠŠç»“æœä¿å­˜æˆæ–‡ä»¶ï¼Œè¿™æ ·è·‘å›¢çš„æ—¶å€™åœ°ä¸‹åŸä¸»å¯ä»¥æŠŠå®ƒæ‰“å°å‡ºæ¥ã€‚æ–‡ä»¶å¤åˆ¶å·¥å…·â€”â€”è¯¥å·¥å…·å¯ä»¥æ‰¹é‡å¤„ç†æ–‡ä»¶å¤åˆ¶å’Œå¤‡ä»½æ“ä½œã€‚ æ•°æ®åº“ SQLæŸ¥è¯¢åˆ†æå™¨â€”â€”è¯¥å·¥å…·å¯ä»¥è®©ç”¨æˆ·è¾“å…¥ä¸€æ¡æŸ¥è¯¢å‘½ä»¤ï¼Œè®©å…¶è¿è¡Œäºæœ¬åœ°æ•°æ®åº“ä¸­ã€‚å°½é‡è®©å®ƒè¿è¡Œå¾—æ›´é«˜æ•ˆã€‚è¿œç¨‹SQLå·¥å…·â€”â€”è¯¥å·¥å…·èƒ½è®©ä½ é€šè¿‡ç½‘ç»œåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚å®ƒèƒ½æ¥æ”¶è¿œç¨‹ä¸»æœºåœ°å€ã€éªŒè¯ç”¨æˆ·åå’Œå¯†ç ã€æ‰§è¡ŒæŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚å¡ç‰‡æ•´ç†å™¨â€”â€”åˆ›å»ºä¸€ä¸ªåœ¨çº¿åº”ç”¨ï¼Œç”¨æ¥è®°å½•æœé›†åˆ°çš„å¡ç‰‡ã€‚å¯ä»¥è®©ç”¨æˆ·è¾“å…¥æ•´å¥—å¡ç‰‡ï¼ŒæŸ¥çœ‹å“ªäº›å·²ç»æœ‰äº†ï¼Œå“ªäº›è¿˜éœ€è¦æœé›†ã€‚è¦å¢åŠ å¤æ‚åº¦çš„è¯ï¼Œè¿˜å¯ä»¥è®©ç”¨æˆ·çŸ¥é“è¿˜å·®å¤šå°‘å¯ä»¥å®Œæˆï¼Œæˆ–è€…å·²ç»æ”¶é›†å¡ç‰‡çš„ä»·å€¼ã€‚æŠ¥å‘Šç”Ÿæˆå™¨â€”â€”è¯¥å·¥å…·å¯ä»¥æ ¹æ®æ•°æ®åº“ä¸­çš„è¡¨æ ¼ç”Ÿæˆä¸€ä»½æŠ¥å‘Šã€‚è­¬å¦‚æ ¹æ®è®¢å•è¡¨æ ¼ç”Ÿæˆé”€å”®æŠ¥å‘Šã€‚æ•°æ®åº“å¤‡ä»½è„šæœ¬åˆ¶ä½œå™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥è¯»å–æ•°æ®åº“çš„å¯¹è±¡ã€å…³ç³»ã€è®°å½•å’Œæ­¥éª¤ï¼Œç”Ÿæˆä¸€ä¸ªsqlæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥å¯¼å…¥å¦ä¸€ä¸ªæ•°æ®åº“æˆ–è€…ä½œä¸ºå¤‡ä»½æ–‡ä»¶ã€‚å¤‡å¿˜å½•â€”â€”è¯¥ç¨‹åºå¯ä»¥è®©ç”¨æˆ·è®¾ç½®ä¸€ä¸ªæ—¥æœŸå’ŒæŸä¸ªäº‹ä»¶çš„æ—¶é—´ã€äº‹ä»¶å¤‡æ³¨å¹¶å°†å®ƒä»¬æ”¾åˆ°æ—¥å†ä¸Šã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ—¥å†ã€æœç´¢ç‰¹å®šçš„äº‹ä»¶ã€‚å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œå¯ä»¥è®©ç”¨æˆ·è®¾ç½®é‡å¤å‘ç”Ÿçš„äº‹ä»¶ï¼Œè­¬å¦‚æ¯å¤©ã€æ¯å‘¨ã€æ¯æœˆã€æ¯å¹´ç­‰ç­‰ã€‚é¢„ç®—è®°å½•å™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥è®°å½•å®¶åº­é¢„ç®—ã€‚ç”¨æˆ·å¯ä»¥æ·»åŠ æ”¯å‡ºã€æ”¶å…¥ï¼Œè®¡ç®—ä¸€æ®µæ—¶é—´å†…çš„æ”¶å…¥å’Œæ”¯å‡ºã€‚å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œè®©ç”¨æˆ·æŒ‡å®šä¸€ä¸ªæ—¶é—´æ®µï¼Œæ˜¾ç¤ºè¯¥æ—¶é—´æ®µå†…çš„å®¶åº­æ”¶æ”¯æƒ…å†µã€‚ç”µè¯ç°¿â€”â€”è®°å½•å„ç§è”ç³»äººå’Œä»–ä»¬çš„å·ç ã€é‚®ç®±ã€å¤‡æ³¨ã€‚å¤æ‚ä¸€ç‚¹çš„è¯å¯ä»¥è®©ç”¨æˆ·è¿ä¸Šç½‘å°†ç”µè¯ç°¿å‘å¸ƒåˆ°è®¾ç½®å¥½çš„ç½‘ç«™ä¸Šã€‚ç”µè§†èŠ‚ç›®è®°å½•å™¨â€”â€”ä½ æ˜¯å¦æœ‰ä¸æƒ³é”™è¿‡çš„ç”µè§†èŠ‚ç›®ï¼Ÿä½†æ²¡æœ‰å½•åƒæœºæˆ–è€…æƒ³ä¹‹åèƒ½æ‰¾åˆ°è¯¥ç”µè§†èŠ‚ç›®ç„¶åå½•ä¸‹æ¥ï¼Œé‚£ä¹ˆå¯ä»¥åšä¸ªç¨‹åºå¯»æ‰¾å„ç§åœ¨çº¿ç”µè§†å¯¼èˆªç½‘ç«™ï¼Œè®°å½•ä¸‹ç”µè§†èŠ‚ç›®åç§°ã€æ’­æ”¾æ—¶é—´ã€æ’­æ”¾é¢‘é“ï¼Œå­˜åœ¨æ•°æ®åº“ä¸­ã€‚æ•°æ®åº“æˆ–è€…ç½‘ç«™åˆ°æ—¶å°±ä¼šå‘é‚®ä»¶æé†’ä½ ï¼ŒèŠ‚ç›®å°±å¿«åœ¨æŸä¸ªé¢‘é“å¼€å§‹äº†ã€‚æ—…è¡Œè®¡åˆ’ç³»ç»Ÿâ€”â€”è¯¥ç³»ç»Ÿå¯ä»¥è®©ç”¨æˆ·ç®¡ç†æ—…è¡Œè·¯çº¿ï¼Œè®°å½•ä¸‹èˆªç­å’Œé…’åº—å®‰æ’ã€æ„Ÿå…´è¶£çš„åœ°æ–¹ã€é¢„ç®—å’Œæ—¶é—´è¡¨ã€‚å®ä½“å…³ç³»å›¾ç”Ÿæˆå™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥è®©ç”¨æˆ·æ•´åˆå®ä½“å…³ç³»å›¾ï¼Œå¹¶å°†å…¶ä¿å­˜èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨å®ƒæ¥ç”Ÿæˆä¸€äº›åŸºç¡€SQLè¯­å¥ã€‚æ•°æ®åº“ç¿»è¯‘å™¨ï¼ˆMySQL&lt;-&gt;SQL Serverï¼‰â€”â€”è¯¥å·¥å…·å¯ä»¥ä»æ•°æ®åº“Aè¯»å–æ•°æ®ï¼Œç”Ÿæˆæ•°æ®åº“Bä½¿ç”¨çš„SQLè¯­å¥ï¼Œå°†æ•°æ®å­˜å…¥æ•°æ®åº“Bã€‚æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯SQL Serverå’ŒOracleä½¿ç”¨çš„MySQLæœåŠ¡å™¨ã€‚BBSè®ºå›â€”â€”ä¸ºä½ å’Œå°ä¼™ä¼´ä»¬åšä¸€ä¸ªè®ºå›ï¼Œå¯ä»¥å‘å¸–ã€ç®¡ç†ã€åˆ†äº«æƒ³æ³•å’Œæ„æ€ã€‚ å›¾åƒå’Œå¤šåª’ä½“ å¹»ç¯ç‰‡â€”â€”åšä¸€ä¸ªä»¥å¹»ç¯ç‰‡å½¢å¼æ˜¾ç¤ºå„ç§å›¾ç‰‡çš„ç¨‹åºã€‚ä¸ºäº†å¢åŠ éš¾åº¦å¯ä»¥åšäº›é¢å¤–çš„æ•ˆæœï¼Œè­¬å¦‚æ¸è¿›æ£€å‡ºã€æ˜Ÿå‹æ“¦é™¤ã€çª—å£æ¸éšã€‚æ€ç»´å¯¼å›¾â€”â€”å…è®¸ç”¨æˆ·è®°å½•ä¸‹å„ç§æ„æ€å¹¶ä¸”å¿«é€Ÿåœ°è¿›è¡Œå¤´è„‘é£æš´å°†è¿™äº›æ„æ€æ•´åˆåˆ°ä¸€å¼ æ€ç»´å¯¼å›¾ä¸­ã€‚è¶Šå¿«è¶Šå¥½ï¼Œå› æ­¤è¦è®©ç”¨æˆ·èƒ½è¿…é€Ÿåœ°å†™ä¸‹æ„æ€ï¼Œç„¶åå°†å…¶æ‹–åˆ°å¯è§†çš„å¯¼å›¾ä¸­å»ï¼Œå°†æ„æ€ä¹‹é—´çš„å…³ç³»å±•ç°å‡ºæ¥ã€‚å¯¼å…¥å›¾ç‰‡å¹¶å­˜æˆç°åº¦å›¾â€”â€”è¯¥å·¥å…·å°†å›¾ç‰‡ä¸Šçš„å½©è‰²é™¤å°½å¹¶ä¿å­˜ã€‚å¯ä»¥å¢åŠ å¯¹æ¯”åº¦è°ƒæ•´ã€è‰²åŒ–ç­‰é¢å¤–åŠŸèƒ½ä»¥å¢åŠ å¤æ‚åº¦ã€‚åœ¨çº¿æµåª’ä½“è§†é¢‘â€”â€”è¯•ç€è‡ªå·±åšä¸€ä¸ªåœ¨çº¿æµåª’ä½“è§†é¢‘æ’­æ”¾å™¨ã€‚MP3æ’­æ”¾å™¨ï¼ˆä»¥åŠå…¶ä»–æ ¼å¼çš„éŸ³ä¹æ’­æ”¾å™¨ï¼‰â€”â€”è¯¥å°ç¨‹åºç”¨æ¥æ’­æ”¾ä½ æœ€çˆ±çš„éŸ³ä¹æ–‡ä»¶ã€‚å¤æ‚ä¸€ç‚¹çš„è¯çœ‹çœ‹èƒ½å¦åŠ ä¸ªæ’­æ”¾åˆ—è¡¨åŠŸèƒ½å’Œå‡è¡¡å™¨ã€‚æ‰¹é‡å›¾ç‰‡å¤„ç†â€”â€”è¯¥ç¨‹åºå¯ä»¥å°†ä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„å›¾ç‰‡è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ï¼Œè­¬å¦‚é™ä½å›¾ç‰‡è‰²è°ƒã€è½¬æ¢æ ¼å¼æˆ–è€…ä¿®æ”¹æ–‡ä»¶å±æ€§ã€‚è¿˜å¯ä»¥å°è¯•ç»™å›¾ç‰‡å¢åŠ æ ‡ç­¾ã€‚CDçƒ§å½•å™¨â€”â€”å¯ä»¥è½»æ¾çƒ§å½•CDçš„å·¥å…·ã€‚YouTubeä¸‹è½½å™¨â€”â€”å¯ä»¥ä»Youtube.comä¸Šä¸‹è½½è§†é¢‘åˆ°ç¡¬ç›˜ä¸­ï¼Œè¦æ”¯æŒåŒ…æ‹¬FLVå’ŒAVIåœ¨å†…çš„æ–‡ä»¶æ ¼å¼ã€‚å¢™çº¸ç®¡ç†å·¥å…·â€”â€”åšä¸€ä¸ªç®¡ç†å¢™çº¸çš„ç¨‹åºï¼Œå¯ä»¥å®šæ—¶æ›´æ¢åˆ·æ–°å¢™çº¸ï¼Œä¹Ÿå¯ä»¥é’ˆå¯¹åˆ†è¾¨ç‡è¿›è¡Œç¼©æ”¾ã€‚æˆªå±ç¨‹åºâ€”â€”åšä¸€ä¸ªå¯ä»¥æˆªå±çš„å·¥å…·ï¼Œå¤æ‚ä¸€ç‚¹å¯ä»¥å¢åŠ ä¸€ä¸ªè½¬å‘é‚®ä»¶çš„åŠŸèƒ½ã€‚å›¾ç‰‡æµè§ˆå™¨â€”â€”è¯¥ç¨‹åºå¯ä»¥æŸ¥çœ‹ç”µè„‘ä¸Šå„ç§æ ¼å¼çš„å›¾ç‰‡ï¼Œè­¬å¦‚PNGã€GIFã€JPGã€BMPã€TIFFç­‰ç­‰ã€‚äº¤é€šä¿¡å·ç¯â€”â€”è¯•ç€åšä¸€ä¸ªäº¤é€šä¿¡å·ç¯å¹¶ä¸”æŠŠå®ƒæ”¾åˆ°å¯ä»¥äº’åŠ¨çš„åœºæ™¯ä¸­ã€‚ä¸è¦è®©æ±½è½¦é—¯çº¢ç¯æˆ–è€…æ’åˆ°å…¶å®ƒè½¦ã€‚MP3-WAVè½¬æ¢å™¨â€”â€”MP3æ ¼å¼æœ¬è´¨ä¸Šå°±æ˜¯å‹ç¼©ç‰ˆçš„WAVã€‚è¯•ç€å°†MP3è½¬æ¢æˆWAVæ ¼å¼ä»¥ä¾›å¯ä»¥å¤„ç†WAVæ ¼å¼çš„ç¨‹åºä½¿ç”¨ã€‚è¯·è®°ä½1MBçš„MP3å¤§çº¦ç­‰äº10MBçš„WAVã€‚ç­¾åç”Ÿæˆå™¨â€”â€”æ˜¯å¦åœ¨ç½‘ä¸Šè§è¿‡æœ‰äººçš„ç•™è¨€åé¢æœ‰æ¡ç”Ÿæˆçš„ç­¾åï¼Ÿè¯•ç€åšä¸ªç¨‹åºè®©ç”¨æˆ·å¯ä»¥æŒ‡å®šèƒŒæ™¯ã€æ–‡å­—ã€é¢œè‰²å’Œå¯¹é½æ–¹å¼æ¥å®šåˆ¶ä¸€ä¸ªç­¾åæ¡£ã€‚å±ä¿â€”â€”ç”µè„‘ç©ºé—²æ—¶ä¼šè¿è¡Œçš„å±ä¿ç¨‹åºã€‚ç®€å•ç‰ˆçš„å¯ä»¥ä½¿ç”¨ä¸€äº›æ ‡å‡†å›¾ç‰‡ï¼Œå¤æ‚ç‰ˆçš„å¯ä»¥åšå‡ºèƒ½åœ¨å±å¹•ä¸Šè½¬æ¥è½¬å»çš„3Dç‰©ä½“ã€‚æ°´å°â€”â€”ä½ æ˜¯å¦æƒ³ä¿æŠ¤ä½ å›¾ç‰‡çš„ç‰ˆæƒï¼Ÿåœ¨å›¾ç‰‡ä¸ŠåŠ ä¸Šæ ‡å¿—æˆ–è€…æ–‡å­—ï¼Œè¿™æ ·åˆ«äººå°±ä¸èƒ½è½»æ˜“åœ°ä»ä½ ç½‘ç«™ä¸Šç›—å›¾äº†ã€‚åšä¸€ä¸ªç¨‹åºæ¥ç»™ä½ çš„å›¾ç‰‡åŠ ä¸Šæ°´å°å§ã€‚æµ·é¾Ÿå›¾â€”â€”åˆ›å»ºä¸€ä¸ª20*20çš„æ ¼å­ï¼Œç”¨å‘½ä»¤è®©ä¸€åªæµ·é¾Ÿåœ¨æ ¼å­ä¸Šç”»çº¿ã€‚å¯ä»¥å‰è¿›ã€å·¦è½¬ã€å³è½¬ï¼Œæ‹¿èµ·æˆ–æ”¾ä¸‹ç¬”ç­‰ç­‰ã€‚å¤æ‚ä¸€ç‚¹çš„è¯ï¼Œå…è®¸ç¨‹åºä»æ–‡ä»¶ä¸­è¯»å–å‘½ä»¤åˆ—è¡¨ã€‚å¯ä»¥åœ¨ç½‘ä¸Šäº†è§£åˆ°æ›´å¤šå…³äºâ€œæµ·é¾Ÿå›¾â€çš„ä¿¡æ¯ã€‚ æ¸¸æˆ æˆ˜èˆ¹â€”â€”åˆ›å»ºä¸¤å—æ¸¸æˆé¢æ¿ï¼Œç©å®¶å„å ä¸€è¾¹ï¼Œåœ¨ä¸Šé¢æ”¾ç½®ä¸€äº›æˆ˜èˆ¹ï¼Œç©å®¶çœ‹ä¸åˆ°å¯¹æ–¹çš„é¢æ¿ã€‚æ¯è‰˜èˆ¹éƒ½å å‡ ä¸ªæ ¼å­ï¼Œç©å®¶è½®æµæ”»å‡»æŸä¸ªæ ¼å­ï¼Œå¦‚æœæ ¼å­ä¸Šæœ‰èˆ¹ï¼Œé‚£å°±å‘½ä¸­ç›®æ ‡ï¼Œå¦åˆ™å°±æ˜¯æœªå‘½ä¸­ã€‚å½“ä¸€è‰˜èˆ¹æ‰€å çš„æ‰€æœ‰æ ¼å­éƒ½è¢«æ”»å‡»å‘½ä¸­äº†ï¼Œé‚£ä¹ˆèˆ¹å°±è¢«å‡»æ²‰ã€‚è°å…ˆå°†å¯¹æ–¹æˆ˜èˆ¹å…¨éƒ¨å‡»æ²‰å°±è·èƒœã€‚è±¡æ£‹è·³æ£‹â€”â€”è±¡æ£‹æˆ–è€…è·³æ£‹æ¸¸æˆã€‚å¯ä»¥è¯•ç€åšæˆå¯ä»¥è”ç½‘ç©ï¼Œç”¨å›¾å½¢ç”¨æˆ·ç•Œé¢æ¥å®ç°æ‚”æ£‹ã€ä¿å­˜èµ°æ£‹è¿‡ç¨‹å¹¶ä¸”å¯ä»¥å›æ”¾ã€‚åˆ½å­æ‰‹â€”â€”ä»æ–‡ä»¶ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯ï¼Œè®©ç©å®¶çŒœå•è¯ä¸­çš„å­—æ¯ã€‚æ—è¾¹æ˜¯ä¸€å¹…éšè—çš„è¡Œç»åˆ‘çš„ç”»ï¼ŒçŒœé”™ä¸€ä¸ªå•è¯ï¼Œç”»å°±æ˜¾ç¤ºå‡ºä¸€éƒ¨åˆ†ã€‚ç”»å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥æ—¶è¿˜æ²¡èƒ½çŒœå…¨çš„è¯ç©å®¶å°±è¾“äº†ã€‚å¡«å­—æ¸¸æˆâ€”â€”åˆ›å»ºä¸€ä¸ªå¡«å­—æ¸¸æˆï¼Œå¹¶ä¸ºæ¯ä¸ªè¯æä¾›ä¸€ä¸ªæç¤ºä¿¡æ¯ï¼Œè®©ç©å®¶å¡«ä¸Šæ‰€æœ‰æ­£ç¡®çš„å•è¯ã€‚é’è›™è·³â€”â€”è®©é’è›™è·³è¿‡æ²³æˆ–è€…é©¬è·¯ï¼Œè¿‡æ²³çš„è¯è¦è·³åœ¨é¡ºæµè€Œä¸‹é€Ÿåº¦å„å¼‚çš„æœ¨å¤´æˆ–è€…ç¡è²å¶å­ä¸Šï¼Œè¿‡é©¬è·¯çš„è¯è¦é¿å¼€é€Ÿåº¦å„å¼‚çš„è½¦å­ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Java/"},{"name":"ç»ƒä¹ é¢˜","slug":"ç»ƒä¹ é¢˜","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ç»ƒä¹ é¢˜/"}]},{"title":"å…¨é¢çš„é˜²sqlæ³¨å…¥æ–¹æ³•ï¼ˆè½¬ï¼‰","date":"2015-11-20T13:24:25.000Z","path":"2015/11/20/å…¨é¢çš„é˜²sqlæ³¨å…¥æ–¹æ³•ï¼ˆè½¬ï¼‰/","text":"function inject_check($sql_str) { return eregi ( 'select|insert|and|or|update|delete|\\'|\\/\\*|\\*|\\.\\.\\/|\\.\\/|union|into|load_file|outfile', $sql_str ); } function verify_id($id = null) { if (! $id) { exit ( 'æ²¡æœ‰æäº¤å‚æ•°ï¼' ); } elseif (inject_check ( $id )) { exit ( 'æäº¤çš„å‚æ•°éæ³•ï¼' ); } elseif (! is_numeric ( $id )) { exit ( 'æäº¤çš„å‚æ•°éæ³•ï¼' ); } $id = intval ( $id ); return $id; } function str_check($str) { if (! get_magic_quotes_gpc ()) { $str = addslashes ( $str ); // è¿›è¡Œè¿‡æ»¤ } $str = str_replace ( \"_\", \"\\_\", $str ); $str = str_replace ( \"%\", \"\\%\", $str ); return $str; } function post_check($post) { if (! get_magic_quotes_gpc ()) { $post = addslashes ( $post ); } $post = str_replace ( \"_\", \"\\_\", $post ); $post = str_replace ( \"%\", \"\\%\", $post ); $post = nl2br ( $post ); $post = htmlspecialchars ( $post ); return $post; } è½¬è‡ªhttp://www.phpddt.com/php/228.html","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"SQL","slug":"SQL","permalink":"https://github.com/kong36088/kong36088.github.io/tags/SQL/"}]},{"title":"PHPsocketé€šä¿¡","date":"2015-11-19T11:24:25.000Z","path":"2015/11/19/PHPsocketé€šä¿¡/","text":"socketé€šä¿¡çš„æ€è·¯æ˜¯ serveråˆ›å»ºä¸€ä¸ªsocket-&gt;serverç«¯å¯¹ç«¯å£è¿›è¡Œç›‘å¬-&gt;writeå’Œread-&gt;close clientåˆ›å»ºä¸€ä¸ªsocket-&gt;è¿æ¥åˆ°serverçš„IP/Port-&gt;writeå’Œreadæ¶ˆæ¯-&gt;close ä¸‹é¢æ˜¯serverç«¯çš„ä»£ç  set_time_limit ( 0 ); $socket = socket_create ( AF_INET, SOCK_STREAM, SOL_TCP ); socket_bind ( $socket, '127.0.0.1', 1995 ); socket_listen ( $socket ); $counter = 0; while ( 1 ) { if (($connection = socket_accept ( $socket )) &lt; 0) { echo \"socket_accept failed:reason:\" . socket_strerror ( $connection ) . PHP_EOL; } else { $msg = 'serverçš„æ¶ˆæ¯' . PHP_EOL; socket_write ( $connection, $msg, strlen ( $msg ) ); echo \"serveræ¥æ”¶socketæˆåŠŸ\" . PHP_EOL; $read = socket_read ( $connection, 1024 ); echo \"æ”¶åˆ°çš„ä¿¡æ¯ï¼š\" . $read . PHP_EOL; if (++ $counter &gt;= 10) { break; } } socket_close ( $connection ); } socket_close ( $socket ); ç„¶åæ˜¯clientç«¯çš„ä»£ç  // clientç«¯ $socket = socket_create ( AF_INET, SOCK_STREAM, SOL_TCP ); if ($socket &lt; 0) { echo socket_strerror ( $socket ); exit (); } else { echo \"åˆ›å»ºsocketæˆåŠŸ\\n\"; } $connection = socket_connect ( $socket, '127.0.0.1', 1995 ); if ($connection &lt; 0) { echo socket_strerror ( $connection ); exit (); } else { echo \"è¿æ¥socketæˆåŠŸ\\n\"; } $in = \"æ¥è‡ªclientçš„æ¶ˆæ¯\\n\"; if (! socket_write ( $socket, $in, strlen ( $in ) )) { echo socket_strerror ( $socket ); exit (); } else { echo \"writeæˆåŠŸ\\n\"; } while ( $out = socket_read ( $socket, 1024 ) ) { echo \"æ¥å—æ¶ˆæ¯æˆåŠŸ\\n\"; echo $out; } socket_close ( $socket ); echo \"å…³é—­socketæˆåŠŸ\\n\"; ?&gt; æ•ˆæœå›¾ï¼š","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"socket","slug":"socket","permalink":"https://github.com/kong36088/kong36088.github.io/tags/socket/"}]},{"title":"MYSQLæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢","date":"2015-11-16T12:24:25.000Z","path":"2015/11/16/MYSQLæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢/","text":"MYSQLæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢æ–¹æ³• å‰30å¤©å†…çš„mysqlæŸ¥è¯¢ï¼š1mysql&gt; select * from TABLENAME where TO_DAYS(NOW())-TO_DAYS(Time_column)&lt;=30; å…¶ä¸­30ä¸ºæ—¶é—´èŒƒå›´ï¼ŒTime_columnå¯ä»¥æ›¿æ¢æˆè¡¨ä¸­çš„æ—¶é—´å­—æ®µåï¼ŒTABLENAMEæ¢æˆè¡¨åã€‚ å¦ä¸€ç§æ–¹æ³•ï¼š1select * from TALBLENAME where DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(Time_column) ä¸€æ®µæ—¶é—´èŒƒå›´çš„æŸ¥è¯¢ï¼š SELECT * FROM sp_xuanjiang WHERE Time between '2015-03-01 00:00:00' AND '2015-05-0 16:59:59'(ç±»å‹ä¸ºdatetime)","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"MYSQL","slug":"MYSQL","permalink":"https://github.com/kong36088/kong36088.github.io/tags/MYSQL/"}]},{"title":"ubuntu14.04ä»¿macç•Œé¢çš„æ€»ç»“","date":"2015-11-16T12:24:25.000Z","path":"2015/11/16/ubuntu14.04ä»¿macç•Œé¢çš„æ€»ç»“/","text":"æœ€è¿‘æƒ³ç€æ€ä¹ˆç”¨è‡ªå·±çš„ubuntuç³»ç»Ÿè£…é€¼æˆä¸€ä¸ªmacç³»ç»Ÿï¼Œå¥½æé«˜è‡ªå·±çš„é€¼æ ¼ï¼Œäºæ˜¯ä¸Šç½‘æ‰¾äº†ä¸‹èµ„æ–™ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š é¦–å…ˆå…ˆä¸‹è½½ä¸€äº›macçš„å£çº¸ï¼Œç”¨äºè£…é€¼ï¼šç‚¹å‡»è¿™é‡Œ ä¸‹è½½å¥½ä¹‹åå¯ä»¥è‡ªå®šä¹‰ä½ çš„å£çº¸ã€‚ ç„¶åå®‰è£…ä¸€ä¸ªä¿®æ”¹ä¸»é¢˜çš„å·¥å…·tweakï¼š sudo apt-get install unity-tweak-tool sudo add-apt-repository ppa:tualatrix/ppa sudo apt-get update sudo apt-get install ubuntu-tweak æŒ‰ä¸‹winé”®ï¼Œæœç´¢tweakæ‰“å¼€ä½ åˆšæ‰å®‰è£…çš„è½¯ä»¶ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š ç„¶åæ•²å…¥ä¸‹é¢å‘½ä»¤å®‰è£…ä¸»é¢˜ï¼š sudo add-apt-repository ppa:noobslab/themes sudo apt-get update sudo apt-get install mac-ithemes-v3 sudo apt-get install mac-icons-v3 ç°åœ¨æ‰“å¼€åˆšæ‰å®‰è£…çš„å·¥å…·æ¥é€‰æ‹©ä¸»é¢˜ï¼Œåœ¨GTKä¸»é¢˜ä¸Šé€‰æ‹©MBuntuã€‚å†æœ¬åœ°tabä¸Šé€‰æ‹©Mbuntu-osxåœ¨å…‰æ ‡tabä¸Šé€‰æ‹©Mac-cursors. å†æ¬¡å®‰è£…dockyï¼Œä¸€ä¸ªè½»é‡çº§çš„ä»»åŠ¡æ è½¯ä»¶ sudo add-apt-repository ppa:docky-core/ppa sudo apt-get update sudo apt-get install docky åœ¨å®‰è£…å¥½ä»¥åï¼Œé€‰æ‹©è®¾ç½®ï¼š ç„¶å å†å¤–è§‚-&gt;è¡Œä¸ºä¸­å¯ä»¥å…³é—­å¯åŠ¨å™¨ï¼Œ ä¹‹åçš„æ¡Œé¢åŸºæœ¬å’Œmacç›¸ä¼¼ï¼Œå¯ä»¥ç”¨æ¥è£…é€¼","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Unbuntu","slug":"Unbuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Unbuntu/"}]},{"title":"PHPçˆ¬è™«ï¼ˆçº¢æ»¡å ‚ï¼‰","date":"2015-11-16T12:24:25.000Z","path":"2015/11/16/PHPçˆ¬è™«ï¼ˆçº¢æ»¡å ‚ï¼‰/","text":"çº¢æ»¡å ‚é“¾æ¥ï¼šhttp://hometown.scau.edu.cn/bbs/forum.php çŒ®ä¸Šæºç ï¼ˆçˆ¬è™«çš„å…³é”®æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„ç¼–å†™ï¼‰ï¼ŒæŒ‰æ¿å—åˆ†ç±»å‡ºæ–‡ç« æ ‡é¢˜å’ŒURLåœ°å€ï¼š // çº¢æ»¡å ‚çˆ¬è™« class Crwaler { private $url; private $times = 1; // åˆå§‹åŒ–ï¼Œè·å¾—URL,çº¢æ»¡å ‚åŸŸå function __construct($url) { $this-&gt;url = $url; } // è·å–å†…å®¹ function get_content($url) { $handle = fopen ( \"$url\", \"r\" ); if ($handle) { $content = stream_get_contents ( $handle ); return $content; } else { die ( 'get_content_1 error' ); } } // è·å–é¦–é¡µurlï¼Œè·å–å„ä¸ªæ¨¡æ¿å—çš„URL function get_url_1() { $match = '/(href=[\\\"]{0,1})(forum\\.php\\?mod=forumdisplay[^\\\"]*)/'; $content = $this-&gt;get_content ( $this-&gt;url ); if (preg_match_all ( $match, $content, $results )) { foreach ( $results [2] as $value ) { $result [] = $value; } // å»é‡ $result = array_unique ( $result ); foreach ( $result as $value ) { $url_total [] = 'http://hometown.scau.edu.cn/bbs/' . $value; } return $url_total; } else { die ( 'get_url_1 error' ); } } // è·å¾—å„ç‰ˆæ ‡é¢˜ function get_title($url) { $match = '/class=\\\"xs2\\\"&gt;[^&lt;]*&lt;a[^&gt;]*&gt;([^&lt;]*)/'; $content = $this-&gt;get_content ( $url ); if (preg_match ( $match, $content, $title )) { // var_dump ( $title [1] ); return $title [1]; } else { die ( 'get_title error' ); } } // è·å–ç‰ˆå†…ä¿¡æ¯ï¼Œè·å¾—å•ä¸€é¡µæ•°å†…çš„URLå’Œæ ‡é¢˜ function get_information($content) { $match = '/href=\\\"(forum\\.php\\?mod=viewthread[^\\\"]*)\\\".*(?:class=\\\"s xst\\\"&gt;)([^&lt;]*).*/'; // $match='/.*(?:class=\\\"s xst\\\")/'; if (preg_match_all ( $match, $content, $results )) { // var_dump ( $results ); for($i = 0, $num = count ( $results [1] ); $i &lt; $num; $i ++) { $results [1] [$i] = str_replace ( ';', '&amp;', $results [1] [$i] ); $results [1] [$i] = str_replace ( '&amp;amp', '', $results [1] [$i] ); $result [] = 'é“¾æ¥ï¼š http://hometown.scau.edu.cn/bbs/' . $results [1] [$i] . ' æ ‡é¢˜ï¼š' . $results [2] [$i] . PHP_EOL; } return $result; } else { die ( 'get_information error' ); } } // è·å–é¡µç ï¼Œè·å–æ¨¡ç‰ˆå†…çš„é¡µæ•° function get_page($url) { $match = '/&lt;span title=\\\"å…±[^0-9]*([0-9]+)/'; $content = $this-&gt;get_content ( $url ); if (preg_match ( $match, $content, $page )) { // var_dump($page); $page = $page [1]; if ($page &gt; 1500) { $page = 1; } return $page; } else { $page = 1; return $page; } } // å°†å†…å®¹å†™å…¥TXT function write($info, $title) { $title = $title . '.txt'; file_put_contents ( $title, $info, FILE_APPEND ); } // è·å–ç‰ˆé¢å†…çš„contentï¼Œå¹¶ä¸”éå†æ‰€æœ‰é¡µæ•°ï¼Œè·å¾—æ ‡é¢˜å’ŒURL function get() { $sign = 1; $url_total = $this-&gt;get_url_1 (); foreach ( $url_total as $url ) { $title = $this-&gt;get_title ( $url ); $page_num = $this-&gt;get_page ( $url ); for($flag = 1; $flag &lt;= $page_num; $flag ++) { $url_n = $url . '&amp;page=' . $flag; $content = $this-&gt;get_content ( $url_n ); $result = $this-&gt;get_information ( $content ); var_dump ( $flag ); $sign ++; $this-&gt;write ( $result, $title ); } } echo \"succeed\"; } } $crawler = new Crwaler ( 'http://hometown.scau.edu.cn/bbs/forum.php' ); $crawler-&gt;get (); æ•ˆæœå›¾ï¼š","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://github.com/kong36088/kong36088.github.io/tags/çˆ¬è™«/"}]},{"title":"å…³äºPHPå¯¹äºæ—¶é—´å­˜å–çš„ç†è§£","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/å…³äºPHPå¯¹äºæ—¶é—´å­˜å–çš„ç†è§£/","text":"åœ¨ä½¿ç”¨PHPå­˜å–æ—¶é—´æ—¶ï¼Œæ•°æ®åº“è¡¨å°½é‡ä½¿ç”¨int(10)è¿™ç§ç±»å‹ï¼Œè€Œä¸è¦ä½¿ç”¨datetimeã€‚ åŸå› ä¸€ï¼šé‡‡ç”¨intæ•°æ®é‡å°ï¼Œä¾¿äºæé«˜æ•°æ®åº“æ•ˆç‡ åŸå› äºŒï¼šåœ¨è¿›è¡Œæå–æ—¶é—´æ“ä½œçš„æ—¶å€™æ—¶é—´å¯ä»¥è¿›è¡Œä»»æ„è½¬æ¢ï¼Œå¯ä»¥é€šè¿‡phpè‡ªå¸¦çš„å‡½æ•° date(format,timestamp)è¿›è¡Œè½¬æ¢ åœ¨å‚¨å­˜æ•°æ®çš„æ—¶å€™åŒæ ·ï¼Œå¯ä»¥åˆ©ç”¨å‡½æ•°strtotimeè½¬æ¢æˆUNIXæ—¶é—´æˆ³ï¼Œç„¶åä½œä¸ºintå­˜å…¥æ•°æ®åº“ï¼Œçµæ´»å˜æ¢ PHPä¸­è¦è·å–ä¸€ä¸ªæœˆå‰çš„æ—¶é—´æˆ³å¯ä»¥è¿™æ ·ç”¨ï¼š strtotime(\"-1 month\") ç»“æœä¸ºï¼š 1429287142 ä¸€å¹´å‰çš„æ—¶é—´æˆ³ï¼š strtotime(\"-1 year\") ç»“æœä¸ºï¼š 1400343128 è½¬æ¢æˆå¯è¯»æ—¶é—´ï¼š date(\"Y-m-d\",strtotime(\"-1 month\")) ç»“æœä¸ºï¼š 2015-04-18 ç”±æ­¤å¯è§ï¼Œstrtotimeè¿™ä¸ªå‡½æ•°ååˆ†ä¹‹å¼ºå¤§","tags":[{"name":"ThinkPHP","slug":"ThinkPHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ThinkPHP/"},{"name":"éªŒè¯ç ","slug":"éªŒè¯ç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/éªŒè¯ç /"}]},{"title":"PHPå¼€å‘å°æŠ€å·§â€”â€”æ˜¾ç¤ºé”™è¯¯","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/PHPå¼€å‘å°æŠ€å·§â€”â€”æ˜¾ç¤ºé”™è¯¯/","text":"åœ¨å¼€å‘è°ƒè¯•é˜¶æ®µï¼Œå¯ä»¥åœ¨ä»£ç çš„å¼€å¤´æ·»åŠ  error_reporting(E_ALL); ini_set('display_errors', '1'); æ¥æ˜¾ç¤ºå‡ºphpè¿è¡Œæ—¶çš„é”™è¯¯ï¼Œä¸ç”¨å»ä¿®æ”¹php.ini","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"ThinkPHPç»å¸¸ç”¨åˆ°çš„ç³»ç»Ÿå˜é‡","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/ThinkPHPç»å¸¸ç”¨åˆ°çš„ç³»ç»Ÿå˜é‡/","text":"åŸæ–‡åœ°å€ï¼šhttp://www.jb51.net/article/47642.htm ï¼ˆ1ï¼‰ç³»ç»Ÿå˜é‡ï¼šåœ¨æ¨¡æ¿ä¸­è¾“å‡ºç³»ç»Ÿå˜é‡ï¼šåŒ…æ‹¬serverã€envã€sessionã€postã€getã€requestã€cookie{$Think.server.script_name} // è¾“å‡º$_SERVERå˜é‡{$Think.session.session_id|md5} // è¾“å‡º$_SESSIONå˜é‡{$Think.get.pageNumber} // è¾“å‡º$_GETå˜é‡{$Think.cookie.name} // è¾“å‡º$_COOKIEå˜é‡ ä»¥ä¸Šæ–¹å¼è¿˜å¯ä»¥å†™æˆï¼š{$_SERVER.script_name} // è¾“å‡º$_SERVERå˜é‡{$_SESSION.session_id|md5} // è¾“å‡º$_SESSIONå˜é‡{$_GET.pageNumber} // è¾“å‡º$_GETå˜é‡{$_COOKIE.name} // è¾“å‡º$_COOKIEå˜é‡ ç³»ç»Ÿå¸¸é‡ ï¼šä½¿ç”¨$Think.const è¾“å‡ºæ³¨æ„ï¼šserverã€cookieã€configä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯å˜é‡åŒºåˆ†å¤§å°å†™ã€‚ä¾‹å¦‚ï¼š{$Think.server.script_name}å’Œ{$Think.SERVER.script_name}ç­‰æ•ˆSESSION ã€COOKIEè¿˜æ”¯æŒäºŒç»´æ•°ç»„çš„è¾“å‡º ä¾‹å¦‚ï¼š{$Think.CONFIG.user.user_name}{$Think.session.user.user_name}ç³»ç»Ÿä¸æ”¯æŒä¸‰ç»´ä»¥ä¸Šçš„æ•°ç»„è¾“å‡ºã€‚ ï¼ˆ2ï¼‰è¯­è¨€å˜é‡ï¼šè¾“å‡ºé¡¹ç›®çš„å½“å‰è¯­è¨€å®šä¹‰å€¼ {$Think.lang.page_error}{$Think.const.MODULE_NAME} æˆ–è€…ç›´æ¥ä½¿ç”¨{$Think.MODULE_NAME} ï¼ˆ3ï¼‰ç‰¹æ®Šå˜é‡ ï¼šç”±ThinkPHPç³»ç»Ÿå†…éƒ¨å®šä¹‰çš„å¸¸é‡ {$Think.version} //ç‰ˆæœ¬{$Think.now} //ç°åœ¨æ—¶é—´{$Think.template|basename} //æ¨¡æ¿é¡µé¢{$Think.LDELIM} //æ¨¡æ¿æ ‡ç­¾èµ·å§‹ç¬¦å·{$Think.RDELIM} //æ¨¡æ¿æ ‡ç­¾ç»“æŸç¬¦å·ï¼ˆ4ï¼‰é…ç½®å‚æ•° ï¼šè¾“å‡ºé¡¹ç›®çš„é…ç½®å‚æ•°å€¼ {$Think.config.db_charset} è¾“å‡ºçš„å€¼å’Œ C(â€˜db_charsetâ€™) çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚ THINK_PATH // ThinkPHP ç³»ç»Ÿç›®å½•APP_PATH // å½“å‰é¡¹ç›®ç›®å½•APP_NAME // å½“å‰é¡¹ç›®åç§°MODULE_NAME //å½“å‰æ¨¡å—åç§°ACTION_NAME // å½“å‰æ“ä½œåç§°TMPL_PATH // é¡¹ç›®æ¨¡ç‰ˆç›®å½•LIB_PATH // é¡¹ç›®ç±»åº“ç›®å½•CACHE_PATH // é¡¹ç›®æ¨¡ç‰ˆç¼“å­˜ç›®å½•CONFIG_PATH //é¡¹ç›®é…ç½®æ–‡ä»¶ç›®å½•LOG_PATH // é¡¹ç›®æ—¥å¿—æ–‡ä»¶ç›®å½•LANG_PATH // é¡¹ç›®è¯­è¨€æ–‡ä»¶ç›®å½•TEMP_PATH //é¡¹ç›®ä¸´æ—¶æ–‡ä»¶ç›®å½•PLUGIN_PATH // é¡¹ç›®æ’ä»¶æ–‡ä»¶ç›®å½•VENDOR_PATH // ç¬¬ä¸‰æ–¹ç±»åº“ç›®å½•DATA_PATH // é¡¹ç›®æ•°æ®æ–‡ä»¶ç›®å½•IS_APACHE // æ˜¯å¦å±äº ApacheIS_IIS //æ˜¯å¦å±äº IISIS_WIN //æ˜¯å¦å±äºWindows ç¯å¢ƒIS_LINUX //æ˜¯å¦å±äº Linux ç¯å¢ƒIS_FREEBSD //æ˜¯å¦å±äº FreeBsd ç¯å¢ƒNOW_TIME // å½“å‰æ—¶é—´æˆ³MEMORY_LIMIT_ON // æ˜¯å¦æœ‰å†…å­˜ä½¿ç”¨é™åˆ¶OUTPUT_GZIP_ON // æ˜¯å¦å¼€å¯è¾“å‡ºå‹ç¼©MAGIC_QUOTES_GPC // MAGIC_QUOTES_GPCTHINK_VERSION //ThinkPHP ç‰ˆæœ¬å·LANG_SET // æµè§ˆå™¨è¯­è¨€TEMPLATE_NAME //å½“å‰æ¨¡ç‰ˆåç§°TEMPLATE_PATH //å½“å‰æ¨¡ç‰ˆè·¯å¾„ROOT // ç½‘ç«™æ ¹ç›®å½•åœ°å€APP // å½“å‰é¡¹ç›®ï¼ˆå…¥å£æ–‡ä»¶ï¼‰åœ°å€URL // å½“å‰æ¨¡å—åœ°å€ACTION // å½“å‰æ“ä½œåœ°å€SELF // å½“å‰ URL åœ°å€TMPL_FILE_NAME //å½“å‰æ“ä½œçš„é»˜è®¤æ¨¡ç‰ˆåï¼ˆå«è·¯å¾„ï¼‰WEB_PUBLIC_URL //ç½‘ç«™å…¬å…±ç›®å½•APP_PUBLIC_URL //é¡¹ç›®å…¬å…±æ¨¡ç‰ˆç›®å½• ROOT // ç½‘ç«™æ ¹ç›®å½•åœ°å€APP // å½“å‰é¡¹ç›®ï¼ˆå…¥å£æ–‡ä»¶ï¼‰åœ°å€URL // å½“å‰æ¨¡å—åœ°å€ACTION // å½“å‰æ“ä½œåœ°å€SELF // å½“å‰ URL åœ°å€PUBLIC // ç½‘ç«™å…¬å…±ç›®å½•../Public (ä¸åŒºåˆ†å¤§å°å†™) // é¡¹ç›®å…¬å…±æ¨¡ç‰ˆç›®å½•æ³¨ï¼šå½“æˆ‘ä»¬ä½¿ç”¨å¸¸é‡æ—¶ï¼Œåœ¨æ¨¡æ¿è¢«åŠ è½½ååœ¨æµè§ˆå™¨æŸ¥çœ‹æºç ï¼Œæˆ‘ä»¬è§‚å¯ŸæŸäº›ä½¿ç”¨äº†å¸¸é‡çš„URLï¼Œä¼šå‘ç°ä¸€ä¸ªç°è±¡ï¼Œçœ‹ä¸åˆ°æœåŠ¡å™¨çš„ipåœ°å€ï¼ŒURLæ˜¯ä»é¡¹ç›®åå¼€å§‹çš„ï¼Œé‚£ä¸ºä»€ä¹ˆèƒ½æ­£ç¡®è®¿é—®å¯¹åº”çš„æ§åˆ¶å™¨å‘¢ï¼Ÿå®é™…ä¸Šè¿™æ˜¯æµè§ˆå™¨ç»™æˆ‘ä»¬å¼€äº†ä¸€ä¸ªç©ç¬‘ï¼Œå½“æˆ‘ä»¬å°†é¼ æ ‡ç§»åŠ¨åˆ°è¯¥URLä¸Šï¼Œå•å‡»å³é”®ï¼Œå¤åˆ¶æºç ä¸­çš„URLï¼Œç²˜è´´åˆ°åˆ«çš„åœ°æ–¹ï¼ŒæœåŠ¡å™¨çš„ipå°±ä¼šæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œå¯è§æœåŠ¡å™¨ipæ˜¯è¢«åŒ…å«è¿›äº†è¯¥URLä¸­ä½¿ç”¨çš„å¸¸é‡çš„ã€‚ åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ ï¼ˆå¦‚ï¼šHomeï¼‰ ä¸­çš„Commonæ–‡ä»¶å¤¹ä¸‹æ–°å»ºcommon.phpåŠ å…¥å¦‚ä¸‹è¯­å¥ï¼šdefine(â€˜XXXâ€™, XXX); //ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¸¸é‡åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¸¸é‡å€¼","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"ThinkPHP","slug":"ThinkPHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ThinkPHP/"}]},{"title":"ThinkPHPç”ŸæˆäºŒç»´ç ","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/ThinkPHPç”ŸæˆäºŒç»´ç /","text":"åœ¨phpä¸­ï¼Œå¤§è‡´ç”ŸæˆäºŒç»´ç çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯å¼•ç”¨åˆ«å®¶æä¾›çš„apiç„¶åè¿›è¡Œè‡ªåŠ¨ç”Ÿæˆï¼Œ googleæœ‰æä¾›apiä¸“é—¨ç”ŸæˆäºŒç»´ç ï¼Œè€Œå›½å†…çš„æ–°æµªä¹Ÿæœ‰apiä¸“é—¨æä¾›ï¼Œ æ–°æµªçš„apiåœ°å€æ˜¯ï¼šhttp://qrcoder.sinaapp.com?t=http://www.gbtags.com t=åé¢åŠ ä¸Šæƒ³è¦ç”Ÿæˆçš„urlå³å¯ ç”ŸæˆäºŒç»´ç çš„å¦ä¸€ç§æ–¹æ³•ï¼šé€šè¿‡å¼€æºçš„phpqrcodeè¿›è¡Œè‡ªåŠ¨ç”Ÿæˆã€‚ ä»¥ä¸‹æ˜¯æºç ï¼š protected function qrcode($data, $filename=false, $picPath = false, $logo = false, $size = '4', $level = 'L', $padding = 2, $saveandprint = false) { /* * function qrcode(){ * $filename='qrcode.png'; * $logo=SITE_PATH.\"\\\\Public\\\\Home\\\\images\\\\logo_80.png\"; * qrcode('http://www.dellidc.com',$filename,false,$logo,8,'L',2,true); * } * * @param $data äºŒç»´ç åŒ…å«çš„æ–‡å­—å†…å®¹ * @param $filename ä¿å­˜äºŒç»´ç è¾“å‡ºçš„æ–‡ä»¶åç§°ï¼Œ*.png * @param bool $picPath äºŒç»´ç è¾“å‡ºçš„è·¯å¾„ * @param bool $logo äºŒç»´ç ä¸­åŒ…å«çš„LOGOå›¾ç‰‡è·¯å¾„ * @param string $size äºŒç»´ç çš„å¤§å° * @param string $level äºŒç»´ç ç¼–ç çº é”™çº§åˆ«ï¼šLã€Mã€Qã€H * @param int $padding äºŒç»´ç è¾¹æ¡†çš„é—´è· * @param bool $saveandprint æ˜¯å¦ä¿å­˜åˆ°æ–‡ä»¶å¹¶åœ¨æµè§ˆå™¨ç›´æ¥è¾“å‡ºï¼Œtrue:åŒæ—¶ä¿å­˜å’Œè¾“å‡ºï¼Œfalse:åªä¿å­˜æ–‡ä»¶ * return string */ vendor ( \"phpqrcode.phpqrcode\" ); // å¼•å…¥å·¥å…·åŒ… // ä¸‹é¢æ³¨é‡Šäº†æŠŠäºŒç»´ç å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°çš„ä»£ç ,å¦‚æœè¦ä¿å­˜å›¾ç‰‡,ç”¨$fileNameæ›¿æ¢ç¬¬äºŒä¸ªå‚æ•°false $path = $picPath ? $picPath : SITE_PATH . \"\\\\Uploads\\\\Picture\\\\QRcode\"; // å›¾ç‰‡è¾“å‡ºè·¯å¾„ mkdir ( $path ); // åœ¨äºŒç»´ç ä¸Šé¢æ·»åŠ LOGO if (empty ( $logo ) || $logo === false) { // ä¸åŒ…å«LOGO if ($filename == false) { \\QRcode::png ( $data, false, $level, $size, $padding, $saveandprint ); // ç›´æ¥è¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œä¸å«LOGO } else { $filename = $path . '/' . $filename; // åˆæˆè·¯å¾„ \\QRcode::png ( $data, $filename, $level, $size, $padding, $saveandprint ); // ç›´æ¥è¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œä¸å«LOGO } } else { // åŒ…å«LOGO if ($filename == false) { // $filename=tempnam('','').'.png';//ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ die ( 'å‚æ•°é”™è¯¯' ); } else { // ç”ŸæˆäºŒç»´ç ,ä¿å­˜åˆ°æ–‡ä»¶ $filename = $path . $filename; // åˆæˆè·¯å¾„ } \\QRcode::png ( $data, $filename, $level, $size, $padding ); $QR = imagecreatefromstring ( file_get_contents ( $filename ) ); $logo = imagecreatefromstring ( file_get_contents ( $logo ) ); $QR_width = imagesx ( $QR ); $QR_height = imagesy ( $QR ); $logo_width = imagesx ( $logo ); $logo_height = imagesy ( $logo ); $logo_qr_width = $QR_width / 5; $scale = $logo_width / $logo_qr_width; $logo_qr_height = $logo_height / $scale; $from_width = ($QR_width - $logo_qr_width) / 2; imagecopyresampled ( $QR, $logo, $from_width, $from_width, 0, 0, $logo_qr_width, $logo_qr_height, $logo_width, $logo_height ); if ($filename === false) { Header ( \"Content-type: image/png\" ); imagepng ( $QR ); } else { if ($saveandprint === true) { imagepng ( $QR, $filename ); header ( \"Content-type: image/png\" ); // è¾“å‡ºåˆ°æµè§ˆå™¨ imagepng ( $QR ); } else { imagepng ( $QR, $filename ); } } } return $filename; } å…¶ä¸­ï¼Œåœ¨ä½¿ç”¨è¯¥ç±»çš„æ—¶å€™å¿…é¡»æŠŠä¸‹è½½åˆ°çš„phpqrcodeæ–‡ä»¶å¤¹æ”¾å…¥ThinkPHP\\Library\\Vendorç›®å½•ä¸‹ï¼Œå¤§è‡´çš„è·¯å¾„æ˜¯ThinkPHP\\Library\\Vendor\\phpqrcode phpqrcodeçš„ä¸‹è½½åœ°å€æ˜¯ï¼šç‚¹æˆ‘","tags":[{"name":"ThinkPHP","slug":"ThinkPHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ThinkPHP/"},{"name":"éªŒè¯ç ","slug":"éªŒè¯ç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/éªŒè¯ç /"}]},{"title":"å…³äºcentos6.5 lampæ­å»ºå¥½åå¤–ç½‘æ— æ³•è®¿é—®çš„ä¸€äº›ç»éªŒæ€»ç»“","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/å…³äºcentos6.5 lampæ­å»ºå¥½åå¤–ç½‘æ— æ³•è®¿é—®çš„ä¸€äº›ç»éªŒæ€»ç»“/","text":"å¤–ç½‘ä¸èƒ½è®¿é—®aoacheï¼ŒæŸ¥çœ‹äº†apacheçš„access_logï¼Œå‘ç°æ ¹æœ¬æ²¡æœ‰è®¿é—®åˆ°æœåŠ¡å™¨ï¼Œç›´æ¥å°±è¢«æ‹’ç»äº†ï¼Œæ‰€ä»¥åœ¨æƒ³å¯èƒ½æ˜¯é˜²ç«å¢™æŠŠ80ç«¯å£å…³äº†ï¼Œç™¾åº¦äº†ä¹‹åå‘ç°äº†åŸå› æ‰€åœ¨ã€‚ å› ä¸ºé˜²ç«å¢™æŠŠ80ç«¯å£ç»™ç¦äº†ï¼Œæ‰€ä»¥æŠŠ80ç«¯å£å¼€æ”¾å‡ºæ¥å°±å¯ä»¥è®©å¤–ç½‘è®¿é—®åˆ°apacheæœåŠ¡å™¨ CentOSé˜²ç«å¢™è®¾ç½®å¼€å¯80ç«¯å£è®¿é—® æˆ‘ä»¬ä»¥æ·»åŠ 80ç«¯å£ä¸ºä¾‹æ“ä½œå¦‚ä¸‹ï¼š [root@centos httpd]# /sbin/iptables -I INPUT -p tcp --dport 80 -j ACCEPT ä¿å­˜ [root@centos httpd]# /etc/rc.d/init.d/iptables save iptablesï¼šå°†é˜²ç«å¢™è§„åˆ™ä¿å­˜åˆ° /etc/sysconfig/iptablesï¼š [ç¡®å®š] å¦‚æœä¸Šé¢çš„æ­¥éª¤è¿˜æ²¡å¥½çš„è¯ï¼Œå¯èƒ½æ˜¯è¿™ä¸ªiptablesæ–‡ä»¶ä½¿ç”¨çš„æ˜¯åŒ…å«è°ƒç”¨ã€‚ ä¸€èˆ¬çš„åœ¨/etc/sysconfig/iptablesè¿™ä¸ªè·¯å¾„ä¸Š æˆ–è€…ä½¿ç”¨viæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ä¿®æ”¹æ‰‹åŠ¨æ·»åŠ ã€‚ [root@centos httpd]# vi /etc/sysconfig/iptables # Generated by iptables-save v1.4.7 on Tue Feb 14 07:32:18 2012 *filter :INPUT ACCEPT [0:0] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [7:640] -A INPUT -p tcp -m tcp --dport 10000 -j ACCEPT -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT -A INPUT -p icmp -j ACCEPT -A INPUT -i lo -j ACCEPT -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT -A INPUT -j REJECT --reject-with icmp-host-prohibited -A FORWARD -j REJECT --reject-with icmp-host-prohibited COMMIT # Completed on Tue Feb 14 07:32:18 2012 é‡æ–°å¯åŠ¨æœåŠ¡ [root@centos httpd]# service iptables restart iptablesï¼šæ¸…é™¤é˜²ç«å¢™è§„åˆ™ï¼š [ç¡®å®š] iptablesï¼šå°†é“¾è®¾ç½®ä¸ºæ”¿ç­– ACCEPTï¼šfilter [ç¡®å®š] iptablesï¼šæ­£åœ¨å¸è½½æ¨¡å—ï¼š [ç¡®å®š] iptablesï¼šåº”ç”¨é˜²ç«å¢™è§„åˆ™ï¼š [ç¡®å®š] æŸ¥çœ‹ç«¯å£æ˜¯å¦ç”Ÿæ•ˆ: [root@centos httpd]# /etc/init.d/iptables status è¡¨æ ¼ï¼šfilter Chain INPUT (policy ACCEPT) num target prot opt source destination 1 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:10000 2 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp dpt:80 3 ACCEPT all -- 0.0.0.0/0 0.0.0.0/0 state RELATED, 4 ACCEPT icmp -- 0.0.0.0/0 0.0.0.0/0 5 ACCEPT all -- 0.0.0.0/0 0.0.0.0/0 6 ACCEPT tcp -- 0.0.0.0/0 0.0.0.0/0 state NEW tcp 7 REJECT all -- 0.0.0.0/0 0.0.0.0/0 reject-with ic Chain FORWARD (policy ACCEPT) num target prot opt source destination 1 REJECT all -- 0.0.0.0/0 0.0.0.0/0 reject-with ic Chain OUTPUT (policy ACCEPT) num target prot opt source destination","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Centos","slug":"Centos","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Centos/"}]},{"title":"Linuxçš„æ–‡ä»¶ç›®å½•å®‰å…¨ä¿®æ”¹","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/Linuxçš„æ–‡ä»¶ç›®å½•å®‰å…¨ä¿®æ”¹/","text":"å‡†å¤‡æŠŠä»£ç æ”¾åœ¨æœåŠ¡å™¨centos6.5ä¸Šè·‘çš„æ—¶å€™ï¼Œåœ¨æ›´æ”¹äº†documentrootä»¥åï¼Œå‘ç°æ— è®ºå¦‚ä½•æœåŠ¡å™¨éƒ½è¿”å›ä¸€ä¸ª403 forbiddenï¼Œååˆ†ä¹‹æ— å¥ˆå’Œçº ç»“ï¼ŒæŠŠæ‰€æœ‰éƒ½allow from alläº†ä¸€éç„¶è€Œè¿˜æ˜¯ä¸è¡Œã€‚æœ€åæ‰¾åˆ°ä¸€ä¸ªç­”æ¡ˆï¼ŒåŸæ¥æ˜¯linuxçš„æ–‡ä»¶çš„å®‰å…¨é—®é¢˜ï¼Œä»¥ä¸‹çŒ®ä¸Šæ–¹æ³• ls -Z -d public_html/ ï¼ƒæ˜¾ç¤ºæ–‡ä»¶ï¼ç›®å½•çš„å®‰å…¨è¯­å¢ƒï¼Z, --context Display security context so it fits on most displays. Displays only mode, user, group, security context and file name.-d, --directory list directory entries instead of contents, and do not dereference symbolic links chcon -R -t httpd_user_content_t public_html/ ï¼ƒä¿®æ”¹æ–‡ä»¶ï¼ç›®å½•çš„å®‰å…¨è¯­å¢ƒ-R, --recursive change files and directories recursively-t, --type set type TYPE in the target security context","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"}]},{"title":"ubuntu14.04å…³äºSome index files failed to download. They have been ignored, or old ones used instead.çš„é”™è¯¯","date":"2015-11-16T11:24:25.000Z","path":"2015/11/16/ubuntu14.04å…³äºSome index files failed to download. They have been ignored, or old ones used instead.çš„é”™è¯¯/","text":"ä»Šå¤©åœ¨ç”¨PHPçš„æ—¶å€™å‘ç°PHPæ²¡æœ‰å®‰è£…CURLæ‹“å±•ï¼Œäºæ˜¯æ‰“ç®—ç”¨ apt-get php5-curlå»è‡ªåŠ¨å®‰è£…ï¼Œå´å‘ç°äº†è¿™æ ·çš„æç¤ºï¼š php5-curl : ä¾èµ–: php5-common (= 5.5.9+dfsg-1ubuntu4) ä½†æ˜¯ 5.5.9+dfsg-1ubuntu4.14 æ­£è¦è¢«å®‰è£… äºæ˜¯ç™¾åº¦äº†å¾ˆä¹…ï¼Œç»ˆäºæ‰¾åˆ°äº†ç­”æ¡ˆï¼ŒåŸæ¥æ˜¯DNSçš„é—®é¢˜ï¼Œç›´æ¥åˆ°ç³»ç»Ÿæ–‡ä»¶ä¸­ä¿®æ”¹ä¸€ä¸‹DNSï¼š 1.ä¿®æ”¹/etc/resolv.confæ–‡ä»¶ï¼šä¸ºnameserver=8.8.8.8 2.sudo rm /var/lib/apt/lists/* -vf 3.sudo apt-get update æå®š","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Linux/"},{"name":"Ubuntu","slug":"Ubuntu","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Ubuntu/"}]},{"title":"å…³äºping++å¯¹æ¥çš„ä¸€ç‚¹çœ‹æ³•","date":"2015-11-16T10:24:25.000Z","path":"2015/11/16/å…³äºping++å¯¹æ¥çš„ä¸€ç‚¹çœ‹æ³•/","text":"é¦–å…ˆæ˜¯å¤„ç†æ”¯ä»˜æ–¹å¼çš„ä¸€ä¸ªæ–¹æ³•ï¼š function deal_way($channel) { $extra = array (); switch ($channel) { case 'alipay_wap' : $extra = array ( 'success_url' =&gt; 'http://127.0.0.1/index.php/Home/Index/success', 'cancel_url' =&gt; 'http://127.0.0.1/index.php/Home/Index/cancel' ); break; case 'upmp_wap' : $extra = array ( 'result_url' =&gt; 'http://127.0.0.1/index.php/Home/Index/result?code=' ); break; case 'bfb_wap' : $extra = array ( 'result_url' =&gt; 'http://127.0.0.1/index.php/Home/Index/result?code=', 'bfb_login' =&gt; true ); break; case 'upacp_wap' : $extra = array ( 'result_url' =&gt; 'http://127.0.0.1/index.php/Home/Index/result?code=' ); break; case 'wx_pub' : $extra = array ( 'open_id' =&gt; 'Openid' ); break; case 'wx_pub_qr' : $extra = array ( 'product_id' =&gt; 'Productid' ); break; default : break; } return $extra; } æ¥ä¸‹æ¥æ˜¯åˆ›å»ºchargeå¯¹è±¡çš„phpä»£ç ï¼š public function get_charge() { $channel = 'alipay_wap'; $extra = deal_way ( $channel ); \\Pingpp\\Pingpp::setApiKey ( 'sk_test_CijTyHCmzzb5GerTSG5m9qHK' ); $charge = \\Pingpp\\Charge::create ( array ( 'subject' =&gt; 'Your Subject', 'body' =&gt; 'Your Body', 'amount' =&gt; 10000, 'order_no' =&gt; 111111111, 'currency' =&gt; 'cny', 'extra' =&gt; $extra, 'channel' =&gt; $channel, 'client_ip' =&gt; '127.0.0.1', 'app' =&gt; array ( 'id' =&gt; 'app_SabjH8bjzHa1XLyr' ) ) ); $this-&gt;response ( $charge ); } æœ€åæ˜¯ajaxçš„å†™æ³•ï¼š function wap_pay(channel) { var amount = document . getElementById ( 'amount' ) . value * 100; var send_data=\"channel=\"+channel+\"&amp;amount=\"+amount; var xhr = new XMLHttpRequest(); xhr.open(\"POST\", \"!:C('PAY')!/Pay/get_charge\", true); xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\"); xhr.send(send_data); xhr.onreadystatechange = function () { if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) { console.log(xhr.responseText); pingpp.createPayment(xhr.responseText, function(result, err) { console.log(result); console.log(err); }); } } } åœ¨è¿™é‡Œè¦æ³¨æ„ï¼Œajaxçš„Content-Typeè¦å†™æˆapplication/x-www-form-urlencoded","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"åˆ†é¡µ","slug":"åˆ†é¡µ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/åˆ†é¡µ/"}]},{"title":"ä¸€ä¸ªä½¿ç”¨çš„åˆ†é¡µæ–¹æ³•","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/ä¸€ä¸ªä½¿ç”¨åˆ†é¡µçš„æ–¹æ³•/","text":"/** * $count æ€»é¡µæ•° * $page å½“å‰é¡µå· * $num æ˜¾ç¤ºçš„é¡µç æ•° **/ function pagebar($count, $page, $num) { $num = min ( $count, $num ); // å¤„ç†æ˜¾ç¤ºçš„é¡µç æ•°å¤§äºæ€»é¡µæ•°çš„æƒ…å†µ if ($page &gt; $count || $page &lt; 1) return; // å¤„ç†éæ³•é¡µå·çš„æƒ…å†µ $end = $page + floor ( $num / 2 ) &lt;= $count ? $page + floor ( $num / 2 ) : $count; // è®¡ç®—ç»“æŸé¡µå· $start = $end - $num + 1; // è®¡ç®—å¼€å§‹é¡µå· if ($start &lt; 1) { // å¤„ç†å¼€å§‹é¡µå·å°äº1çš„æƒ…å†µ $end -= $start - 1; $start = 1; } for($i = $start; $i &lt;= $end; $i ++) { // è¾“å‡ºåˆ†é¡µæ¡ï¼Œè¯·è‡ªè¡Œæ·»åŠ é“¾æ¥æ ·å¼ if ($i == $page) echo \"[$i]\"; else echo \" $i \"; } echo \"($page)&lt;br /&gt;\"; } è¾“å‡ºçš„ç»“æœï¼š 14 15 16 17 [18] 19 20 21 22 (18)","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"åˆ†é¡µ","slug":"åˆ†é¡µ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/åˆ†é¡µ/"}]},{"title":"thinkPHPéªŒè¯ç çš„å‡ ä¸ªè¦ç‚¹","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/thinkPHPéªŒè¯ç çš„å‡ ä¸ªè¦ç‚¹/","text":"åœ¨ä½¿ç”¨éªŒè¯ç ä¹‹å‰ï¼Œé¦–å…ˆè¦ç¡®ä¿æœåŠ¡å™¨ç«¯çš„phpè£…æœ‰GD2çš„æ‹“å±•åº“ class IndexController extends Controller { function index() { $this-&gt;display (); } function log() { $code = I ( 'post.code', '' ); // è·å–POSTå¾—åˆ°çš„éªŒè¯ç ä¿¡æ¯ $Verify = new ThinkVerify (); if (! $this-&gt;check_verify ( $code )) { echo \"succeed\"; } else { echo \"failed\"; } } function verify() { // ç”ŸæˆéªŒè¯ç ï¼Œå¯ä»¥åœ¨HTMLä¸­ç›´æ¥è®¿é—®è¯¥æ§åˆ¶å™¨è·å¾— $Verify = new ThinkVerify (); $Verify-&gt;entry (); } protected function check_verify($code, $id = \"\") { // ä¸€ä¸ªç®€å•çš„æ£€æµ‹éªŒè¯ç çš„å‡½æ•° $verify = new ThinkVerify (); return $verify-&gt;check ( $code, $id ); } } &lt;!--more--&gt; åœ¨å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶ï¼šç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶Index_index.htmlï¼Œå†…å®¹å¦‚ä¸‹ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;title&gt;HCIå®˜æ–¹ç½‘ç«™&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;form action=\"!:U('Home/Index/log')!\" method=\"post\" &gt; &lt;h2&gt;ç®€æ˜“åå°ç™»å½•ç³»ç»Ÿ&lt;/h2&gt; éªŒè¯ç ï¼š&lt;input type=\"code\" name=\"code\" /&gt; &lt;img src=\"/index.php/Home/Index/verify\" id=\"code\" onclick=\"this.src=this.src+'?'+Math.random()\"/&gt; &lt;br /&gt; &lt;input type=\"submit\" value=\"ç™»å½•\"/&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt;","tags":[{"name":"ThinkPHP","slug":"ThinkPHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ThinkPHP/"},{"name":"éªŒè¯ç ","slug":"éªŒè¯ç ","permalink":"https://github.com/kong36088/kong36088.github.io/tags/éªŒè¯ç /"}]},{"title":"dirname(__FILE__) çš„ä½¿ç”¨æ€»ç»“","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/dirname(__FILE__) çš„ä½¿ç”¨æ€»ç»“/","text":"dirname(FILE)phpä¸­å®šä¹‰äº†ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å¸¸æ•°ï¼Œå³file è¿™ä¸ªå†…å®šå¸¸æ•°æ˜¯å½“å‰phpç¨‹åºçš„å°±æ˜¯å®Œæ•´è·¯å¾„ï¼ˆè·¯å¾„+æ–‡ä»¶åï¼‰ã€‚ å³ä½¿è¿™ä¸ªæ–‡ä»¶è¢«å…¶ä»–æ–‡ä»¶å¼•ç”¨(includeæˆ–require)ï¼Œfileå§‹ç»ˆæ˜¯å®ƒæ‰€åœ¨æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œè€Œä¸æ˜¯å¼•ç”¨å®ƒçš„é‚£ä¸ªæ–‡ä»¶å®Œæ•´è·¯å¾„ã€‚ è¯·çœ‹ä¸‹é¢ä¾‹å­ï¼š/home/data/demo/test/a.php $the_full_name=__FILE__; $the_dir=dirname(__FILE__); echo $the_full_name; //è¿”å›/home/data/demo/test/a.php echo $the_dir; //è¿”å›/home/data/demo/test FILE è¿”å›å½“å‰ è·¯å¾„+æ–‡ä»¶ådirname(FILE) è¿”å›å½“å‰æ–‡ä»¶è·¯å¾„çš„ è·¯å¾„éƒ¨åˆ†dirname(dirname(FILE));å¾—åˆ°çš„æ˜¯æ–‡ä»¶ä¸Šä¸€å±‚ç›®å½•åï¼ˆä¸å«æœ€åä¸€ä¸ªâ€œ/â€å·ï¼‰","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"}]},{"title":"ä¸€ä¸ªä½¿ç”¨çš„åˆ†é¡µæ–¹æ³•","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/PHPä¸­è¿­ä»£å™¨æ¨¡å¼çš„ä½¿ç”¨å’Œä½“ä¼š/","text":"è¿­ä»£å™¨æ¨¡å¼æä¾›ä¸€ç§è®¿é—®ä¸€ä¸ªå®¹å™¨å¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨ç»†èŠ‚çš„æ–¹æ³•ã€‚åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ—¶å¸¸ä¼šé‡åˆ°å„ç§å˜é‡ä»£ç ï¼Œforeachåœ¨å¾ˆå¤šä»£ç å¤„éƒ½å¯ä»¥è§åˆ°ï¼Œä½¿ç”¨è¿­ä»£å™¨å¯ä»¥å¯¹ä¸åŒæ•°æ®ç»“æ„çš„é›†åˆå°è£…ï¼Œå¤–éƒ¨åªéœ€è°ƒç”¨è¿­ä»£å™¨æä¾›çš„æ¥å£å³å¯ï¼Œæé«˜äº†åº”ç”¨çš„å¯æ‰©å±•æ€§ã€‚ è¿­ä»£å™¨çš„ä½¿ç”¨å¯ä»¥éå†å®¹å™¨å†…çš„æ•°æ®ï¼Œæ˜¯ä¸€ç§ååˆ†ä¹‹å®ç”¨çš„æ–¹æ³•ã€‚ class travel implements \\Iterator { // ç»§æ‰¿è¿­ä»£å™¨æ¥å£ protected $index = 0; protected $example = array (); public function __construct() { $this-&gt;index = 0; // åˆå§‹åŒ–indexï¼Œè¿­ä»£å™¨åˆå§‹åŒ– $connect = mysqli_connect ( 'localhost', 'root', 'root', 'sphr' ) or die ( 'can not connect' ); mysqli_query ( $connect, 'set names utf8' ); // è®¾ç½®utf8ç¼–ç æ¨¡å¼ï¼Œé˜²æ­¢ä¹±ç  $result = mysqli_query ( $connect, 'SELECT * FROM sp_candidate' ); $this-&gt;example = mysqli_fetch_all ( $result, MYSQLI_ASSOC ); } public function rewind() { $this-&gt;index = 0; } public function current() { return $this-&gt;example [$this-&gt;index]; } public function key() { return $this-&gt;index; } public function next() { $this-&gt;index ++; } public function valid() { return isset ( $this-&gt;example [$this-&gt;index] ); } } è¿­ä»£å™¨çš„æ¥å£æ¨¡å¼ä¸ºï¼š class myIterator implements Iterator { private $position = 0; private $array = array (); public function __construct() { $this-&gt;position = 0; } function rewind() { $this-&gt;position = 0; } function current() { return $this-&gt;array [$this-&gt;position]; } function key() { return $this-&gt;position; } function next() { ++ $this-&gt;position; } function valid() { return isset ( $this-&gt;array [$this-&gt;position] ); } } $it = new myIterator (); foreach ( $it as $key =&gt; $value ) { var_dump ( $key, $value ); echo \"\\n\"; }","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"è¿­ä»£å™¨","slug":"è¿­ä»£å™¨","permalink":"https://github.com/kong36088/kong36088.github.io/tags/è¿­ä»£å™¨/"}]},{"title":"JSç ´è§£å¾®ä¿¡é˜²ç›—é“¾","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/JSç ´è§£å¾®ä¿¡é˜²ç›—é“¾/","text":"2015å¹´å¾®ä¿¡å…¬ä¼—å·çš„å›¾ç‰‡åŠ å…¥äº†é˜²ç›—é“¾åŠŸèƒ½ï¼Œä½¿å¾—ä¸èƒ½ç›´æ¥ç”¨è¿™ç§æ–¹å¼å¼•ç”¨å›¾ç‰‡ï¼Œä½†æ˜¯é’ˆå¯¹å¦‚æ­¤é—®é¢˜ï¼Œç ”ç©¶äº†ä¸€ä¸ªä¸‹åˆï¼Œå°è¯•è¿‡phpçš„curlè¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯å´æ˜¯å¤±è´¥å‘Šç»ˆï¼Œæœ€ç»ˆæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼š function showImg( url ,frameid) { //urlæ˜¯è¦è®¿é—®çš„è¿æ¥ï¼Œframeidæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„frameid //frameidå¯ä»¥è‡ªè¡Œä¼ å…¥ // var frameid = 'frameimg' + Math.random(); window.img = '&lt;img id=\"img\" src=\\''+url+'?'+Math.random()+'\\' height=\"500px\" width=\"500px\" /&gt;&lt;script&gt;window.onload = function() { parent.document.getElementById(\\''+frameid+'\\').height = document.getElementById(\\'img\\').height+\\'px\\'; }&lt;'+'/script&gt;'; // document.write('&lt;iframe id=\"'+frameid+'\" src=\"javascript:parent.img;\" frameBorder=\"0\" scrolling=\"no\" width=\"100%\"&gt;&lt;/iframe&gt;'); } //é€šè¿‡ä»¥ä¸‹æ–¹æ³•è°ƒç”¨ showImg(result.img,result.id); $('#content').append('&lt;iframe id=\"'+result.id+'\" src=\"javascript:parent.img;\" frameBorder=\"0\" scrolling=\"no\" width=\"100%\" height=\"100%\"&gt;&lt;/iframe&gt;');","tags":[{"name":"javascript","slug":"javascript","permalink":"https://github.com/kong36088/kong36088.github.io/tags/javascript/"},{"name":"å¾®ä¿¡","slug":"å¾®ä¿¡","permalink":"https://github.com/kong36088/kong36088.github.io/tags/å¾®ä¿¡/"}]},{"title":"PHPçˆ¬è™«ï¼ˆä¿¡è½¯å®˜ç½‘ï¼‰","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/PHPçˆ¬è™«ï¼ˆä¿¡è½¯å®˜ç½‘ï¼‰/","text":"ä¿¡è½¯å®˜ç½‘ï¼šç‚¹æˆ‘ æºç ï¼š // çˆ¬è™« class Crawler { private $crawler_url; function __construct($url) { $this-&gt;crawler_url = $url; } function GetUrlContent() { $url = $this-&gt;crawler_url; $handle = fopen ( \"$url\", \"r\" ); if ($handle) { $content = stream_get_contents ( $handle, 1024 * 2048 ); return $content; } else { return false; } } function get_url_result() { $match = '/href=[\\'\\\"]{0,1}\\/news-[0-9]*\\.asp\\\" title=[\\'\\\"][^a-zA-Z]*\\\"/'; $content = $this-&gt;GetUrlContent (); if (preg_match_all ( $match, $content, $result )) { return $result; } else { return false; } } function deal_result() { $result = $this-&gt;get_url_result (); foreach ( $result as $list ) { $list = str_replace ( 'href=', \"http://info.scau.edu.cn\", $list ); $list = str_replace ( '\"', '', $list ); $results [] = str_replace ( 'title=', ' ', $list ); } return $results; } function write() { $result = $this-&gt;deal_result (); $fp = fopen ( \"list.txt\", \"w\" ); foreach ( $result as $lists ) { foreach ( $lists as $list ) { fputs ( $fp, $list . \"\\r\\n\" ); } } fclose ( $fp ); echo \"succeed\"; } } $crawler = new Crawler ( \"http://info.scau.edu.cn\" ); $crawler-&gt;write ();","tags":[{"name":"PHP","slug":"PHP","permalink":"https://github.com/kong36088/kong36088.github.io/tags/PHP/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"https://github.com/kong36088/kong36088.github.io/tags/çˆ¬è™«/"}]},{"title":"Sphinxçš„å®‰è£…","date":"2015-11-16T06:24:25.000Z","path":"2015/11/16/Sphinxçš„å®‰è£…/","text":"Sphinxä¸æ¨èåœ¨windowsä¸‹ä½¿ç”¨ åœ¨ubuntuå’Œdebianå…³äºSphinxçš„å®‰è£…æœ‰ä¸¤ç§é€”å¾„ï¼Œä¸€ç§æ˜¯é€šè¿‡debåŒ…å®‰è£…ï¼Œå¦ä¸€ç§åˆ™æ˜¯é€šè¿‡PPAçš„é€”å¾„ DebåŒ…: åˆ©ç”¨apt-getå®‰è£…libpq5æ‹“å±• $ sudo apt-get install mysql-client unixodbc libpq5 å®‰è£…debåŒ… $ sudo dpkg -i sphinxsearch_2.3.1-beta-0ubuntu11~trusty_amd64.deb é€šè¿‡PPAçš„æ–¹å¼ ï¼ˆä»…é™äºubuntuï¼‰ ç”¨PPAçš„æ–¹å¼æ¥å®‰è£…Sphinxä¼šç®€å•è®¸å¤š æ·»åŠ è½¯ä»¶æº $ sudo add-apt-repository ppa:builds/sphinxsearch-rel23 $ sudo apt-get update å®‰è£…Sphinx$ sudo apt-get install sphinxsearchç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘½ä»¤æ¥å¼€å¯Sphinxäº† $ sudo service sphinxsearch start","tags":[{"name":"Sphnix","slug":"Sphnix","permalink":"https://github.com/kong36088/kong36088.github.io/tags/Sphnix/"}]},{"title":"å…³äºå‰ç«¯åˆ¶ä½œçš„ä¸€äº›å¿ƒå¾—ä½“ä¼š","date":"2015-10-21T06:24:25.000Z","path":"2015/10/21/å…³äºå‰ç«¯åˆ¶ä½œçš„ä¸€äº›å¿ƒå¾—ä½“ä¼š/","text":"å¯¹äºç¬¬ä¸€æ¬¡ä½¿ç”¨CSS3è¿›è¡Œç½‘é¡µåˆ¶ä½œï¼Œä½“ä¼šè¿˜æ˜¯ä¸é”™çš„ã€‚ CSS3çš„åŠŸèƒ½ååˆ†ä¹‹å¼ºå¤§ï¼Œé¢ è¦†äº†ä»å‰è€åœŸçš„ç‰¹æ•ˆï¼Œå…¶ä¸­æ„Ÿå—æœ€æ·±çš„æ˜¯transitionï¼Œè¯¥æ ·å¼å¯ä»¥ååˆ†ä¹‹å¥½çš„æ”¯æŒæ ·å¼çš„æ¸å˜è¿‡ç¨‹ï¼Œå˜åŒ–ä¸å†æ˜¯é‚£ä¹ˆçš„çªå…€ï¼Œä½†æ˜¯æµè§ˆå™¨å¯¹äºCSS3çš„æ”¯æŒå‚å·®ä¸é½ï¼Œæ‰€ä»¥è¦æ ¹æ®ä¸åŒçš„å†…æ ¸åŠ ä¸Šç±»ä¼¼-webkit- -moz-ç­‰å¦‚æ­¤çš„å‰ç¼€ä»¥ä½œåŒºåˆ†ã€‚ å½“ç„¶ï¼ŒåŠ¨ä½œæ¸å˜çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡jqueryçš„animateæ¥å®ç°ã€‚ å¯¹äºé¡µé¢å¸ƒå±€ä¸­è¿˜æ˜¯é‡‡ç”¨%è€Œå‡å°‘é‡‡ç”¨pxä»¥é€‚åº”ä¸åŒå±å¹•çš„åˆ†è¾¨ç‡ã€‚","tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://github.com/kong36088/kong36088.github.io/tags/éšç¬”/"}]},{"title":"æ•°æ®åº“è®¾è®¡çš„ä¸‰ä¸ªèŒƒå¼","date":"2015-10-17T16:33:25.000Z","path":"2015/10/18/æ•°æ®åº“è®¾è®¡çš„ä¸‰ä¸ªèŒƒå¼/","text":"ç¬¬ä¸€èŒƒå¼ æ˜¯æ•°æ®åº“è§„èŒƒåŒ–ä¸­æ‰€ä½¿ç”¨çš„ä¸€ç§æ­£è§„å½¢å¼ã€‚ç¬¬ä¸€èŒƒå¼æ˜¯ä¸ºäº†è¦æ’é™¤ é‡å¤ç»„ çš„å‡ºç°ï¼Œæ‰€é‡‡ç”¨çš„æ–¹æ³•æ˜¯è¦æ±‚æ•°æ®åº“çš„æ¯ä¸ªå­—æ®µéƒ½åªèƒ½å­˜æ”¾å•ä¸€å€¼ï¼Œè€Œä¸”æ¯ç¬”è®°å½•éƒ½è¦èƒ½åˆ©ç”¨ä¸€ä¸ªæƒŸä¸€çš„ä¸»é”®æ¥åŠ ä»¥è¯†åˆ«ã€‚ é‡å¤ç»„ é‡å¤ç»„é€šå¸¸ä¼šå‡ºç°åœ¨ä¼šè®¡è´¦ä¸Šï¼Œæ¯ä¸€ç¬”è®°å½•å¯èƒ½æœ‰ä¸å®šä¸ªæ•°çš„å€¼ã€‚ä¸¾ä¾‹æ¥è¯´ï¼š äº¤æ˜“é¡¾å®¢ æ—¥æœŸ æ•°é‡Pete Monday 19.00-28.20Pete Wednesday -84.00Sarah Friday 100.00150.00-40.00â€˜æ•°é‡â€™ å°±æ˜¯æ‰€è°“çš„é‡å¤ç»„äº†ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹è¿™ä»½æ•°æ®å°±ä¸ç¬¦åˆç¬¬ä¸€èŒƒå¼ã€‚æƒ³è¦æ¶ˆé™¤é‡å¤ç»„çš„è¯ï¼Œåªè¦æŠŠæ¯ç¬”è®°å½•éƒ½è½¬åŒ–ä¸ºå•ä¸€è®°å½•å³å¯ï¼š äº¤æ˜“é¡¾å®¢ æ—¥æœŸ æ•°é‡Pete Monday 19.00Pete Monday -28.20Pete Wednesday -84.00Sarah Friday 100.00Sarah Friday 150.00Sarah Friday -40.00 ç¼ºä¹å”¯ä¸€è¯†åˆ«ç  ä¸€æ ·æ˜¯åœ¨äº¤æ˜“è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒä¸€å¤©åŒä¸€ä¸ªäººä¹°äº†åŒæ ·çš„æ•°é‡ï¼Œè¿™æ ·çš„äº¤æ˜“åšäº†ä¸¤æ¬¡ï¼š äº¤æ˜“é¡¾å®¢ æ—¥æœŸ æ•°é‡Pete Monday 19.00Pete Monday 19.00å¦‚ä¸Šæ‰€ç¤ºï¼Œè¿™ä¸¤ç¬”äº¤æ˜“å¯ä»¥è¯´æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœåªé è¿™äº›æ•°æ®æˆ‘ä»¬æ²¡æœ‰åŠæ³•åˆ†è¾¨è¿™ä¸¤ç¬”è®°å½•ã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥è¯´å®ƒä¸ç¬¦åˆç¬¬ä¸€èŒƒå¼ï¼Œæ˜¯å› ä¸ºä¸Šé¢è¿™æ ·çš„è¡¨ç¤ºæ³•æ¬ ç¼ºä¸€ä¸ªå”¯ä¸€è¯†åˆ«ç ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„å­—æ®µï¼Œè€Œä¸”å¯ä»¥ä¿è¯åœ¨è¿™ä¸ªæ•°æ®ä¸­å”¯ä¸€è¯†åˆ«ç ä¸ä¼šé‡å¤å‡ºç°ã€‚è¦å°†å®ƒæ­£è§„åŒ–åˆ°ç¬¦åˆç¬¬ä¸€èŒƒå¼çš„åŸåˆ™åªéœ€è¦åŠ å…¥ä¸€ä¸ªå”¯ä¸€è¯†åˆ«ç å³å¯ï¼š äº¤æ˜“äº¤æ˜“ ID é¡¾å®¢ æ—¥æœŸ æ•°é‡1 Pete Monday 19.002 Pete Monday 19.00 ç¬¬äºŒèŒƒå¼ æ˜¯æ•°æ®åº“è§„èŒƒåŒ–ä¸­æ‰€ä½¿ç”¨çš„ä¸€ç§æ­£è§„å½¢å¼ã€‚å®ƒçš„è§„åˆ™æ˜¯è¦æ±‚æ•°æ®è¡¨é‡Œçš„æ‰€æœ‰æ•°æ®éƒ½è¦å’Œè¯¥æ•°æ®è¡¨çš„ä¸»é”®æœ‰å®Œå…¨ä¾èµ–å…³ç³»ï¼›å¦‚æœæœ‰å“ªäº›æ•°æ®åªå’Œä¸»é”®çš„ä¸€éƒ¨åˆ†æœ‰å…³çš„è¯ï¼Œå°±å¾—æŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥å˜æˆå¦ä¸€ä¸ªæ•°æ®è¡¨ã€‚å¦‚æœä¸€ä¸ªæ•°æ®è¡¨çš„ä¸»é”®åªæœ‰å•ä¸€ä¸€ä¸ªå­—æ®µçš„è¯ï¼Œå®ƒå°±ä¸€å®šç¬¦åˆç¬¬äºŒèŒƒå¼ã€‚ ä¸€ä¸ªæ•°æ®è¡¨ç¬¦åˆç¬¬äºŒèŒƒå¼å½“ä¸”ä»…å½“ å®ƒç¬¦åˆç¬¬ä¸€èŒƒå¼æ‰€æœ‰éä¸»é”®çš„å­—æ®µéƒ½ä¸€å®šå’Œä¸»é”®æœ‰å…³æœ‰ä¸€ä¸ªæ•°æ®è¡¨è®°å½•äº†è®¾å¤‡ç»„ä»¶çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ç»„ä»¶æ¥æºç»„ä»¶ ID (ä¸»é”®) ä»·æ ¼ ä¾›åº”å•†ID (ä¸»é”®) ä¾›åº”å•†åç§° ä¾›åº”å•†ä½å€65 59.99 1 Stylized Parts VA73 20.00 1 Stylized Parts VA65 69.99 2 ACME Industries CAè¿™ä¸ªæ•°æ®è¡¨çš„æ¯ä¸ªå€¼éƒ½æ˜¯å•ä¸€å€¼ï¼Œæ‰€ä»¥å®ƒç¬¦åˆç¬¬ä¸€èŒƒå¼ã€‚å› ä¸ºåŒä¸€ä¸ªç»„ä»¶æœ‰å¯èƒ½ç”±ä¸åŒçš„ä¾›åº”å•†æä¾›ï¼Œæ‰€ä»¥å¾—æŠŠç»„ä»¶ ID å’Œä¾›åº”å•† ID åˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªä¸»é”®ã€‚ ç»„ä»¶(å…³é”®è¯)å’Œä»·æ ¼ä¹‹é—´çš„å…³ç³»å¾ˆæ­£ç¡®ï¼šåŒä¸€ä¸ªç»„ä»¶åœ¨ä¸åŒä¾›åº”å•†æœ‰å¯èƒ½ä¼šæœ‰ä¸åŒçš„æŠ¥ä»·ï¼Œæ‰€ä»¥ä»·æ ¼ç¡®å®å’Œä¸»é”®å®Œå…¨ç›¸å…³(å®Œå…¨ä¾èµ–)ã€‚ å¦ä¸€æ–¹é¢ï¼Œä¾›åº”å•†çš„åç§°å’Œä½å€å°±åªå’Œä¾›åº”å•† ID æœ‰å…³(éƒ¨åˆ†ä¾èµ–)ï¼Œè¿™ä¸ç¬¦åˆç¬¬äºŒèŒƒå¼çš„åŸåˆ™ã€‚ä»”ç»†çœ‹å°±ä¼šå‘ç° â€œStylized Partsâ€ è¿™ä¸ªåç§°å’Œ â€œVAâ€ è¿™ä¸ªä½å€é‡å¤å‡ºç°äº†ä¸¤æ¬¡ï¼›è¦æ˜¯å®ƒæ”¹åäº†æˆ–æ˜¯è¢«å…¶ä»–å…¬å¸å¹¶è´­äº†æ€ä¹ˆåŠï¼Ÿè¿™æ—¶å€™æœ€å¥½æŠŠè¿™äº›æ•°æ®å­˜åˆ°ç¬¬äºŒä¸ªæ•°æ®è¡¨ä¸­ï¼š ä¾›åº”å•†ä¾›åº”å•† ID (ä¸»é”®) åç§° ä½å€2 ACME Industries CA1 Stylized Parts VAè¿™ä¹ˆä¸€æ¥ï¼ŒåŸæœ¬çš„ â€œç»„ä»¶æ¥æºâ€ æ•°æ®è¡¨å°±å¾—è¦åšç›¸å¯¹åº”çš„æ”¹åŠ¨ï¼š ç»„ä»¶æ¥æºç»„ä»¶ ID (ä¸»é”®ä¸»é”®) ä»·æ ¼ ä¾›åº”å•† IDï¼ˆä¸»é”®ã€éå…³é”®è¯ï¼‰65 59.99 173 20.00 165 69.99 2 ç¬¬ä¸‰èŒƒå¼ æ˜¯æ•°æ®åº“è§„èŒƒåŒ–ä¸­æ‰€ä½¿ç”¨çš„ä¸€ç§æ­£è§„å½¢å¼ï¼Œç”¨æ¥æ£€éªŒæ˜¯å¦æ‰€æœ‰éé”®å±æ€§éƒ½åªå’Œå€™é€‰é”®æœ‰ç›¸å…³æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰éé”®å±æ€§äº’ç›¸ä¹‹é—´åº”è¯¥æ˜¯æ— å…³çš„ã€‚ ç¬¬ä¸‰èŒƒå¼å’Œç¬¬äºŒèŒƒå¼ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œåœ¨ç¬¬ä¸‰èŒƒå¼é‡Œï¼Œæ‰€æœ‰çš„éé”®å±æ€§éƒ½å¿…é¡»å’Œæ¯ä¸ªå€™é€‰é”®æœ‰ç›´æ¥ç›¸å…³ã€‚å¦‚æœå†å¯¹ç¬¬ä¸‰èŒƒå¼åšè¿›ä¸€æ­¥åŠ å¼ºå°±æˆäº†BCèŒƒå¼ï¼Œå®ƒæ‰€å¼ºè°ƒçš„é‡ç‚¹å°±åœ¨äº â€œæ•°æ®é—´çš„å…³ç³»æ˜¯å¥ åŸºåœ¨é”®ä¸Šã€ä»¥æ•´ä¸ªé”®ä¸ºè€ƒé‡ã€è€Œä¸”é™¤äº†é”®ä¹‹å¤–ä¸è€ƒè™‘å…¶ä»–å› ç´ â€ã€‚ ä»¥ä¸‹é¢è¿™ä¸ªå®šä¹‰æœºæ¢°ç»„ä»¶çš„å…³ç³»ä¸ºä¾‹ï¼š æœºæ¢°ç»„ä»¶ç»„ä»¶ç¼–å·(ä¸»é”®) åˆ¶é€ å•†åç§° åˆ¶é€ å•†åœ°å€1000 Toyota Park Avenue1001 Mitsubishi Lincoln Street1002 Toyota Park Avenueæœ¬ä¾‹ä¸­åˆ¶é€ å•†åœ°å€å¾ˆæ˜æ˜¾åœ°ä¸è¯¥è¢«åˆ—åœ¨è¿™ä¸ªå…³ç³»é‡Œé¢ï¼Œå› ä¸ºå’Œç»„ä»¶æœ¬èº«æ¯”èµ·æ¥ï¼Œåˆ¶é€ å•†åœ°å€åº”è¯¥å’Œåˆ¶é€ å•†æ¯”è¾ƒæœ‰å…³ç³»ï¼›æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯æŠŠç‹¬ç«‹æˆä¸ºä¸€ä¸ªæ–°çš„æ•°æ®è¡¨ï¼š åˆ¶é€ å•†åˆ¶é€ å•†åç§°(ä¸»é”®) åˆ¶é€ å•†åœ°å€Toyota Park AvenueMitsubishi Lincoln Streetç„¶åæŠŠåŸæœ¬çš„æ•°æ®è¡¨æ”¹æˆè¿™æ ·ï¼š æœºæ¢°ç»„ä»¶ç»„ä»¶ç¼–å·(ä¸»é”®) åˆ¶é€ å•†åç§°1000 Toyota1001 Mitsubishi1002 Toyotaå…ˆå‰é‚£ä¸ªæ•°æ®è¡¨çš„é—®é¢˜åœ¨äºæ¯æåˆ°ä¸€æ¬¡åˆ¶é€ å•†åç§°å°±è¦å¤šå­˜ä¸€æ¬¡å®ƒçš„åœ°å€ï¼Œè€Œè¿™å°±ä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼çš„åŸåˆ™ã€‚ ä¸‹é¢æä¾›äº†å¦ä¸€ä¸ªä¾‹å­ï¼š è®¢å• (Order)è®¢å•ç¼–å· (ORDER NUMBER)(ä¸»é”®) å®¢æˆ·åç§° (CUSTOMER NAME) å•ä»· (UNIT PRICE) æ•°é‡ (QUANTITY) å°è®¡ (TOTAL)1000 David $35.00 3 $105.001001 Jim $25.00 2 $50.001002 Bob $25.00 3 $75.00åœ¨æœ¬ä¾‹ä¸­ï¼Œéä¸»é”®å­—æ®µå®Œå…¨ä¾èµ–äºä¸»é”®è®¢å•ç¼–å·,ä¹Ÿå°±æ˜¯è¯´å”¯ä¸€çš„è®¢å•ç¼–å·èƒ½å¯¼å‡ºå”¯ä¸€éä¸»é”®å­—æ®µå€¼ï¼Œç¬¦åˆç¬¬äºŒèŒƒå¼ã€‚ç¬¬ä¸‰èŒƒå¼è¦æ±‚éä¸»é”®å­—æ®µä¹‹é—´ä¸èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œæ˜¾ç„¶æœ¬ä¾‹ä¸­å°è®¡ä¾èµ–äºéä¸»é”®å­—æ®µå•ä»·å’Œæ•°é‡ï¼Œä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼ã€‚å°è®¡ä¸åº”è¯¥æ”¾åœ¨è¿™ä¸ªæ•°æ®è¡¨é‡Œé¢ï¼Œåªè¦æŠŠå•ä»·ä¹˜ä¸Šæ•°é‡å°±å¯ä»¥å¾—åˆ°å°è®¡äº†ï¼›å¦‚æœæƒ³è¦ç¬¦åˆç¬¬ä¸‰èŒƒå¼çš„è¯ï¼Œå°±æŠŠå°è®¡æ‹¿æ‰å§ (ä¸è¿‡åœ¨åšæŸ¥è¯¢çš„æ—¶å€™ï¼Œæœ¬æ¥ç”¨ â€œSELECT Order.Total FROM Orderâ€ å°±è¦æ”¹æˆç”¨ â€œSELECT UnitPrice * Quantity FROM Orderâ€ äº†)ã€‚ è®¢å• (Order)è®¢å•ç¼–å· (ORDER NUMBER)(ä¸»é”®) å®¢æˆ·åç§° (CUSTOMER NAME) å•ä»· (UNIT PRICE) æ•°é‡ (QUANTITY)1000 David $35.00 31001 Jim $25.00 21002 Bob $25.00 3","tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://github.com/kong36088/kong36088.github.io/tags/æ•°æ®åº“/"},{"name":"èŒƒå¼","slug":"èŒƒå¼","permalink":"https://github.com/kong36088/kong36088.github.io/tags/èŒƒå¼/"}]},{"title":"ä¼˜åŒ– SQL SELECT è¯­å¥æ€§èƒ½çš„ 6 ä¸ªç®€å•æŠ€å·§(è½¬)","date":"2015-10-12T16:24:25.000Z","path":"2015/10/13/ä¼˜åŒ– SQL SELECT è¯­å¥æ€§èƒ½çš„ 6 ä¸ªç®€å•æŠ€å·§(è½¬)/","text":"SELECTè¯­å¥çš„æ€§èƒ½è°ƒä¼˜æœ‰æ—¶æ˜¯ä¸€ä¸ªéå¸¸è€—æ—¶çš„ä»»åŠ¡ï¼Œåœ¨æˆ‘çœ‹æ¥å®ƒéµå¾ªå¸•ç´¯æ‰˜åŸåˆ™ã€‚20%çš„åŠªåŠ›å¾ˆå¯èƒ½ä¼šç»™ä½ å¸¦æ¥80%çš„æ€§èƒ½æå‡ï¼Œè€Œä¸ºäº†è·å¾—å¦å¤–20%çš„æ€§èƒ½æå‡ä½ å¯èƒ½éœ€è¦èŠ±è´¹80%çš„æ—¶é—´ã€‚é™¤éä½ åœ¨é‡‘æ˜Ÿå·¥ä½œï¼Œé‚£é‡Œçš„æ¯ä¸€å¤©éƒ½ç­‰äºåœ°çƒä¸Šçš„243å¤©ï¼Œå¦åˆ™äº¤ä»˜æœŸé™å¾ˆæœ‰å¯èƒ½ä½¿ä½ æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥è°ƒä¼˜SQLæŸ¥è¯¢ã€‚ æ ¹æ®æˆ‘å¤šå¹´ç¼–å†™å’Œè¿è¡ŒSQLè¯­å¥çš„ç»éªŒï¼Œæˆ‘å¼€å§‹å¼€å‘ä¸€ä¸ªæ£€æŸ¥åˆ—è¡¨ï¼Œå½“æˆ‘è¯•å›¾æé«˜æŸ¥è¯¢æ€§èƒ½æ—¶ä¾›æˆ‘å‚è€ƒã€‚åœ¨è¿›è¡ŒæŸ¥è¯¢è®¡åˆ’å’Œé˜…è¯»æˆ‘ä½¿ç”¨çš„æ•°æ®åº“æ–‡æ¡£ä¹‹å‰ï¼Œæˆ‘ä¼šå‚è€ƒå…¶ä¸­çš„å†…å®¹ï¼Œæ•°æ®åº“æ–‡æ¡£æœ‰æ—¶ä¼šå¾ˆå¤æ‚ã€‚æˆ‘çš„æ£€æŸ¥åˆ—è¡¨ç»å¯¹è¯´ä¸ä¸Šå…¨é¢æˆ–ç§‘å­¦ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªä¿å®ˆè®¡ç®—ï¼Œä½†æˆ‘å¯ä»¥è¯´ï¼Œéµå¾ªè¿™äº›ç®€å•çš„æ­¥éª¤å¤§éƒ¨åˆ†æ—¶é—´æˆ‘ç¡®å®èƒ½å¾—åˆ°æ€§èƒ½æå‡ã€‚æ£€æŸ¥åˆ—è¡¨å¦‚ä¸‹ã€‚ #æ£€æŸ¥ç´¢å¼•# åœ¨SQLè¯­å¥çš„WHEREå’ŒJOINéƒ¨åˆ†ä¸­ç”¨åˆ°çš„æ‰€æœ‰å­—æ®µä¸Šï¼Œéƒ½åº”è¯¥åŠ ä¸Šç´¢å¼•ã€‚è¿›è¡Œè¿™ä¸ª3åˆ†é’ŸSQLæ€§èƒ½æµ‹è¯•ã€‚ä¸ç®¡ä½ çš„æˆç»©å¦‚ä½•ï¼Œä¸€å®šè¦é˜…è¯»é‚£äº›å¸¦æœ‰ä¿¡æ¯çš„ç»“æœã€‚ #é™åˆ¶å·¥ä½œæ•°æ®é›†çš„å¤§å°# æ£€æŸ¥é‚£äº›SELECTè¯­å¥ä¸­ç”¨åˆ°çš„è¡¨ï¼Œçœ‹çœ‹ä½ æ˜¯å¦å¯ä»¥åº”ç”¨WHEREå­å¥è¿›è¡Œè¿‡æ»¤ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯ï¼Œå½“è¡¨ä¸­åªæœ‰å‡ åƒè¡Œè®°å½•æ—¶ï¼Œä¸€ä¸ªæŸ¥è¯¢èƒ½å¤Ÿå¾ˆå¥½åœ°æ‰§è¡Œã€‚ä½†éšç€åº”ç”¨ç¨‹åºçš„æˆé•¿ï¼ŒæŸ¥è¯¢æ…¢äº†ä¸‹æ¥ã€‚è§£å†³æ–¹æ¡ˆæˆ–è®¸éå¸¸ç®€å•ï¼Œé™åˆ¶æŸ¥è¯¢æ¥æŸ¥çœ‹å½“å‰æœˆçš„æ•°æ®å³å¯ã€‚ å½“ä½ çš„æŸ¥è¯¢è¯­å¥å¸¦æœ‰å­æŸ¥è¯¢æ—¶ï¼Œæ³¨æ„åœ¨å­æŸ¥è¯¢çš„å†…éƒ¨è¯­å¥ä¸Šä½¿ç”¨è¿‡æ»¤ï¼Œè€Œä¸æ˜¯åœ¨å¤–éƒ¨è¯­å¥ä¸Šã€‚ #åªé€‰æ‹©ä½ éœ€è¦çš„å­—æ®µ# é¢å¤–çš„å­—æ®µé€šå¸¸ä¼šå¢åŠ è¿”å›æ•°æ®çš„çº¹ç†ï¼Œä»è€Œå¯¼è‡´æ›´å¤šçš„æ•°æ®è¢«è¿”å›åˆ°SQLå®¢æˆ·ç«¯ã€‚å¦å¤–ï¼š â€¢ä½¿ç”¨å¸¦æœ‰æŠ¥å‘Šå’Œåˆ†æåŠŸèƒ½çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œæœ‰æ—¶æŠ¥å‘Šæ€§èƒ½ä½æ˜¯å› ä¸ºæŠ¥å‘Šå·¥å…·å¿…é¡»å¯¹æ”¶åˆ°çš„ã€å¸¦æœ‰è¯¦ç»†å½¢å¼çš„æ•°æ®åšèšåˆæ“ä½œã€‚â€¢å¶å°”æŸ¥è¯¢ä¹Ÿå¯èƒ½è¿è¡Œåœ°è¶³å¤Ÿå¿«ï¼Œä½†ä½ çš„é—®é¢˜å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œç›¸å…³çš„é—®é¢˜ï¼Œå› ä¸ºå¤§é‡çš„è¯¦ç»†æ•°æ®é€šè¿‡ç½‘ç»œå‘é€åˆ°æŠ¥å‘ŠæœåŠ¡å™¨ã€‚â€¢å½“ä½¿ç”¨ä¸€ä¸ªé¢å‘åˆ—çš„DBMSæ—¶ï¼Œåªæœ‰ä½ é€‰æ‹©çš„åˆ—ä¼šä»ç£ç›˜è¯»å–ã€‚åœ¨ä½ çš„æŸ¥è¯¢ä¸­åŒ…å«çš„åˆ—è¶Šå°‘ï¼ŒIOå¼€é”€å°±è¶Šå°ã€‚ #ç§»é™¤ä¸å¿…è¦çš„è¡¨# ç§»é™¤ä¸å¿…è¦çš„è¡¨çš„åŸå› ï¼Œå’Œç§»é™¤æŸ¥è¯¢è¯­å¥ä¸­ä¸éœ€è¦çš„å­—æ®µçš„åŸå› ä¸€è‡´ã€‚ ç¼–å†™SQLè¯­å¥æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œé€šå¸¸éœ€è¦å¤§é‡ç¼–å†™å’Œæµ‹è¯•SQLè¯­å¥çš„è¿­ä»£è¿‡ç¨‹ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½å°†è¡¨æ·»åŠ åˆ°æŸ¥è¯¢ä¸­ï¼Œè€Œè¿™å¯¹äºSQLä»£ç è¿”å›çš„æ•°æ®å¯èƒ½ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚ä¸€æ—¦SQLè¿è¡Œæ­£ç¡®ï¼Œæˆ‘å‘ç°è®¸å¤šäººä¸ä¼šå›é¡¾ä»–ä»¬çš„è„šæœ¬ï¼Œä¸ä¼šåˆ é™¤é‚£äº›å¯¹æœ€ç»ˆçš„è¿”å›æ•°æ®æ²¡æœ‰ä»»ä½•å½±å“å’Œä½œç”¨çš„è¡¨ã€‚é€šè¿‡ç§»é™¤ä¸é‚£äº›ä¸å¿…è¦è¡¨çš„JOINSæ“ä½œï¼Œä½ å‡å°‘äº†å¤§é‡æ•°æ®åº“å¿…é¡»æ‰§è¡Œçš„æµç¨‹ã€‚æœ‰æ—¶ï¼Œå°±åƒç§»é™¤åˆ—ä¸€æ ·ï¼Œä½ ä¼šå‘ç°ä½ å‡å°‘çš„æ•°æ®åˆé€šè¿‡æ•°æ®åº“è¿”å›æ¥äº†ã€‚ #ç§»é™¤å¤–éƒ¨è¿æ¥æŸ¥è¯¢# è¿™è¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾ï¼Œå®ƒå–å†³äºæ”¹å˜è¡¨çš„å†…å®¹æœ‰å¤šå¤§çš„å½±å“ã€‚ä¸€ä¸ªè§£å†³åŠæ³•æ˜¯é€šè¿‡åœ¨ä¸¤ä¸ªè¡¨çš„è¡Œä¸­æ”¾ç½®å ä½ç¬¦æ¥åˆ é™¤OUTER JOINSæ“ä½œã€‚å‡è®¾ä½ æœ‰ä»¥ä¸‹çš„è¡¨ï¼Œå®ƒä»¬é€šè¿‡å®šä¹‰OUTER JOINSæ¥ç¡®ä¿è¿”å›æ‰€æœ‰çš„æ•°æ®ï¼š CUSTOMER_ID CUSTOMER_NAME1 John Doe2 Mary Jane3 Peter Pan4 Joe SoapCUSTOMER_ID SALES_PERSONNULL Newbee Smith2 Oldie Jones1 Another OldieNULL Greenhornè§£å†³åŠæ³•æ˜¯åœ¨customerè¡¨çš„è¡Œä¸­å¢åŠ ä¸€ä¸ªå ä½ç¬¦ï¼Œå¹¶æ›´æ–°salesè¡¨ä¸­çš„æ‰€æœ‰NULLå€¼åˆ°å ä½ç¬¦ã€‚ CUSTOMER_ID CUSTOMER_NAME0 NO CUSTOMER1 John Doe2 Mary Jane3 Peter Pan4 Joe SoapCUSTOMER_ID SALES_PERSON0 Newbee Smith2 Oldie Jones1 Another Oldie0 Greenhornä½ ä¸åªæ˜¯åˆ é™¤äº†å¯¹OUTER JOINæ“ä½œçš„ä¾èµ–ï¼ŒåŒæ—¶æ ‡å‡†åŒ–äº†æ²¡æœ‰å®¢æˆ·çš„é”€å”®äººå‘˜å¦‚ä½•è¡¨ç¤ºã€‚å…¶ä»–å¼€å‘äººå‘˜ä¸å¿…ç¼–å†™é¢å¤–è¯­å¥ï¼Œä¾‹å¦‚ISNULL(customer_id, â€œNo customer yetâ€)ã€‚ #åˆ é™¤JOINå’ŒWHEREå­å¥ä¸­çš„è®¡ç®—å­—æ®µ# è¿™æ˜¯å¦å¤–ä¸€ä¸ªæœ‰æ—¶å¯èƒ½è¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾çš„æŠ€å·§ï¼Œå®ƒå–å†³äºä½ æ›´æ”¹è¡¨æ¨¡å¼çš„æƒé™å¤§å°ã€‚å¯ä»¥å°†è¿æ¥è¯­å¥ä¸­ç”¨åˆ°çš„è®¡ç®—å­—æ®µä½œä¸ºä¸€ä¸ªæ–°å­—æ®µåœ¨è¡¨ä¸­åˆ›å»ºã€‚ç»™å‡ºä»¥ä¸‹SQLè¯­å¥ï¼š 12FROM sales aJOIN budget b ON ((YEAR(a.sale_date)* 100) + MONTH(a.sale_date)) = b.budget_year_monthåœ¨salesè¡¨ä¸­åˆ©ç”¨å¹´å’Œæœˆå¢åŠ ä¸€åˆ—ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚æ›´æ–°åçš„SQLè¯­å¥å°†å¦‚ä¸‹: 12SELECT * FROM PRODUCTSFROM sales aJOIN budget b ON a.sale_year_month = b.budget_year_monthæ€»ç»“ ä¸Šè¾¹çš„å»ºè®®å¯ä»¥å½’ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š â€¢æ£€æŸ¥ç´¢å¼•â€¢åœ¨æ‰€éœ€è¦çš„æœ€å°æ•°æ®é›†ä¸Šæ“ä½œâ€¢ç§»é™¤ä¸å¿…è¦çš„å­—æ®µå’Œè¡¨â€¢ç§»é™¤ä½ JOINå’ŒWHEREå­å¥ä¸­çš„è®¡ç®—æ“ä½œ å¦‚æœæ‰€æœ‰çš„è¿™äº›å»ºè®®éƒ½æ²¡èƒ½æé«˜ä½ çš„SQLæŸ¥è¯¢æ€§èƒ½ï¼Œæœ€åä¸€ä¸ªå»ºè®®æ˜¯æ¬å»é‡‘æ˜Ÿå§ã€‚ä½ éœ€è¦çš„å°±æ˜¯ä¸€å¤©èƒ½è°ƒä¼˜ä½ çš„SQLè¯­å¥ã€‚ è½¬è‡ªCSDN","tags":[{"name":"SQL","slug":"SQL","permalink":"https://github.com/kong36088/kong36088.github.io/tags/SQL/"},{"name":"ä¼˜åŒ–","slug":"ä¼˜åŒ–","permalink":"https://github.com/kong36088/kong36088.github.io/tags/ä¼˜åŒ–/"}]}]