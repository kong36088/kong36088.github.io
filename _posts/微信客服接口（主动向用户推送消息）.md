title: 微信客服接口（主动向用户推送消息）
categories: PHP##分类
tags: [PHP,微信]##标签，多标签格式为 [tag1,tag2,...]
keywords: PHP,微信##文章关键词，多关键词格式为 keyword1,keywords2,...
description: PHP微信主动推送消息
date: 2016/01/30 23:50:25 
---
``` php
function http_post_data($url, $data) {
	$curl = curl_init ();
	curl_setopt ( $curl, CURLOPT_URL, $url );
	curl_setopt ( $curl, CURLOPT_SSL_VERIFYPEER, FALSE );
	curl_setopt ( $curl, CURLOPT_SSL_VERIFYHOST, FALSE );
	curl_setopt ( $curl, CURLOPT_POST, 1 );
	curl_setopt ( $curl, CURLOPT_POSTFIELDS, $data );
	curl_setopt ( $curl, CURLOPT_RETURNTRANSFER, 1 );
	$result = curl_exec ( $curl );
	if (curl_errno ( $curl )) {
		return 'Errno' . curl_error ( $curl );
	}
	curl_close ( $curl );
	return $result;
}

$url = 'https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=' . ACCESS_TOKEN;
$data = json_encode ( array (
		"touser" => "oUc9GvzIY4ZZkb5yxIY8zGTUS0kI",
		"msgtype" => "text",
		"text" => array (
				"content" => "abc" 
		) 
) );
http_post_data($url,$data);
``` 
这里是利用curl来post数据到微信的服务器，其中需要access_token的支持，以下是access_token获取的方法
``` php
function get_access_token() {
	$values = json_decode ( file_get_contents ( 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=' . APPID . '&secret=' . APPSECRET ) );
	if ($values) {
		$access_token = $values->access_token;
		return $access_token;
	} else {
		return false;
	}
}
``` 